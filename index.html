<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="the blog from a anroid coder">
<meta property="og:type" content="website">
<meta property="og:title" content="CallteFoot&#39;s blog">
<meta property="og:url" content="https://cattlefoot.github.io/index.html">
<meta property="og:site_name" content="CallteFoot&#39;s blog">
<meta property="og:description" content="the blog from a anroid coder">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CallteFoot&#39;s blog">
<meta name="twitter:description" content="the blog from a anroid coder">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://cattlefoot.github.io/"/>





  <title>CallteFoot's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CallteFoot's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Victory belongs to the most persevering.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2019/01/16/Navigation-leaning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/16/Navigation-leaning/" itemprop="url">Navigationå®˜æ–¹è¯‘æ–‡</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-01-16T10:12:08+08:00">
                2019-01-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p>å¯¼èˆªæ˜¯åº”ç”¨ç¨‹åºè®¾è®¡çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡å¯¼èˆªï¼Œæ‚¨å¯ä»¥è®¾è®¡å…è®¸ç”¨æˆ·åœ¨åº”ç”¨å†…çš„ä¸åŒå†…å®¹åŒºåŸŸç§»åŠ¨ï¼Œè¿›å‡ºå’Œé€€å‡ºçš„äº¤äº’ã€‚</p>
<h4 id="å¯¼èˆªæ¶æ„ç»„ä»¶"><a href="#å¯¼èˆªæ¶æ„ç»„ä»¶" class="headerlink" title="å¯¼èˆªæ¶æ„ç»„ä»¶"></a>å¯¼èˆªæ¶æ„ç»„ä»¶</h4><p>å¯¼èˆªæ¶æ„ç»„ä»¶å¯å¸®åŠ©æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°å¸¸è§ä½†å¤æ‚çš„å¯¼èˆªè¦æ±‚ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ›´è½»æ¾åœ°ä¸ºç”¨æˆ·æä¾›ä¸€è‡´ä¸”å¯é¢„æµ‹çš„ä½“éªŒã€‚</p>
<p>å¯¼èˆªå¯å¤„ç†åœ¨åº”ç”¨ç¨‹åºçš„ç›®çš„åœ°ä¹‹é—´å¯¼èˆª- ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­ç”¨æˆ·å¯ä»¥å¯¼èˆªåˆ°ä»»ä½•ä½ç½®ã€‚è™½ç„¶ç›®æ ‡é€šå¸¸é€šè¿‡Fragmentsä»£è¡¨ç‰¹å®šçš„å±å¹•ï¼Œä½†å¯¼èˆªæ¶æ„ç»„ä»¶æ”¯æŒä¸‹é¢åˆ—å‡ºçš„å…¶ä»–ç›®æ ‡ç±»å‹ï¼š</p>
<ul>
<li>Activities</li>
<li>å¯¼èˆªå›¾å’Œå­å›¾ - å½“ç›®æ ‡æ˜¯å›¾å½¢æˆ–å­å›¾æ—¶ï¼Œç”¨æˆ·å¯¼èˆªåˆ°è¯¥å›¾æˆ–å­å›¾çš„èµ·å§‹ç›®æ ‡</li>
<li><a href="https://developer.android.com/topic/libraries/architecture/navigation/navigation-add-new.html" target="_blank" rel="noopener">è‡ªè®¢ç›®æ ‡ç±»å‹</a></li>
</ul>
<p>è¿™äº›ç›®çš„åœ°é€šè¿‡æ“ä½œè¿æ¥ï¼Œä¸€ç³»åˆ—çš„ç›®çš„åœ°å’Œè¿æ¥æ“ä½œç»„æˆåº”ç”¨ç¨‹åºçš„å¯¼èˆªå›¾ã€‚</p>
<p>å¯¼èˆªæ¶æ„ç»„ä»¶æä¾›äº†è®¸å¤šå…¶ä»–å¥½å¤„ï¼ŒåŒ…æ‹¬ï¼š  </p>
<ul>
<li>å¤„ç†Fragmentäº‹åŠ¡</li>
<li>é»˜è®¤æƒ…å†µä¸‹æ­£ç¡®å¤„ç†å‘ä¸Šå’Œå‘åæ“ä½œ</li>
<li>ä¸ºåŠ¨ç”»å’Œè¿‡æ¸¡æä¾›æ ‡å‡†åŒ–èµ„æº</li>
<li>å°†æ·±å±‚é“¾æ¥è§†ä¸ºä¸€çº§æ“ä½œ</li>
<li>åŒ…æ‹¬å¯¼èˆªUIæ¨¡å¼ï¼Œä¾‹å¦‚å¯¼èˆªæŠ½å±‰å’Œåº•éƒ¨å¯¼èˆªï¼Œåªéœ€æœ€å°‘çš„é¢å¤–å·¥ä½œ</li>
<li>åœ¨å¯¼èˆªä¼ é€’å‚æ•°æ—¶æä¾›ç±»å‹å®‰å…¨æ€§</li>
<li>ä½¿ç”¨Android Studioçš„<a href="https://developer.android.com/topic/libraries/architecture/navigation/navigation-implementing" target="_blank" rel="noopener">å¯¼èˆªç¼–è¾‘å™¨</a>å¯è§†åŒ–å’Œç¼–è¾‘å¯¼èˆªå›¾</li>
</ul>
<p>âš ï¸ï¼šå¦‚æœè¦å°†å¯¼èˆªæ¶æ„ç»„ä»¶ä¸Android Studioä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¿…é¡»ä½¿ç”¨<a href="https://developer.android.com/studio/preview/" target="_blank" rel="noopener">Android Studio 3.2 Canary 14æˆ–æ›´é«˜ç‰ˆæœ¬</a>ã€‚</p>
<h4 id="å¯¼èˆªåŸç†"><a href="#å¯¼èˆªåŸç†" class="headerlink" title="å¯¼èˆªåŸç†"></a>å¯¼èˆªåŸç†</h4><p>å¯¼èˆªæ¶æ„ç»„ä»¶åŸºäºä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š</p>
<h5 id="å›ºå®šèµ·å§‹ç›®çš„åœ°"><a href="#å›ºå®šèµ·å§‹ç›®çš„åœ°" class="headerlink" title="å›ºå®šèµ·å§‹ç›®çš„åœ°"></a>å›ºå®šèµ·å§‹ç›®çš„åœ°</h5><p>åº”ç”¨åº”å…·æœ‰å›ºå®šçš„èµ·å§‹ç›®çš„åœ°ï¼Œå³ç”¨æˆ·ä»å¯åŠ¨å™¨å¯åŠ¨åº”ç”¨æ—¶çœ‹åˆ°çš„å±å¹•ï¼Œä»¥åŠç”¨æˆ·åœ¨æŒ‰ä¸‹åé€€æŒ‰é’®è¿”å›å¯åŠ¨å™¨ä¹‹å‰çœ‹åˆ°çš„æœ€åä¸€ä¸ªå±å¹•ã€‚</p>
<p>âš ï¸ï¼šåº”ç”¨å¯èƒ½å…·æœ‰ä¸€æ¬¡æ€§è®¾ç½®æˆ–ä¸€ç³»åˆ—ç™»å½•å±å¹•ã€‚è¿™äº›æ¡ä»¶å±å¹•ä¸åº”è¢«è§†ä¸ºæ‚¨åº”ç”¨çš„èµ·å§‹ç›®çš„åœ°ã€‚</p>
<h5 id="å¯¼èˆªçŠ¶æ€åº”è¯¥é€šè¿‡å †æ ˆç›®çš„åœ°æ¥è¡¨ç¤º"><a href="#å¯¼èˆªçŠ¶æ€åº”è¯¥é€šè¿‡å †æ ˆç›®çš„åœ°æ¥è¡¨ç¤º" class="headerlink" title="å¯¼èˆªçŠ¶æ€åº”è¯¥é€šè¿‡å †æ ˆç›®çš„åœ°æ¥è¡¨ç¤º"></a>å¯¼èˆªçŠ¶æ€åº”è¯¥é€šè¿‡å †æ ˆç›®çš„åœ°æ¥è¡¨ç¤º</h5><p>ä¸€ä¸ªå¯¼èˆªå †æ ˆåº”è¯¥æœ‰åº”ç”¨ç¨‹åºçš„èµ·å§‹ç›®æ ‡åœ¨å †æ ˆçš„åº•éƒ¨ï¼Œå¹¶åœ¨å †æ ˆé¡¶éƒ¨çš„å½“å‰ç›®æ ‡ã€‚</p>
<p>æ›´æ”¹å¯¼èˆªå †æ ˆçš„æ“ä½œåº”å§‹ç»ˆåœ¨å¯¼èˆªå †æ ˆçš„é¡¶éƒ¨æ“ä½œï¼Œæ–¹æ³•æ˜¯å°†æ–°ç›®æ ‡æ¨é€åˆ°å †æ ˆé¡¶éƒ¨æˆ–ä»å †æ ˆé¡¶éƒ¨å¼¹å‡ºæœ€é¡¶å±‚ç›®æ ‡ã€‚</p>
<h5 id="â€œå‘ä¸Šâ€æŒ‰é’®æ°¸è¿œä¸ä¼šé€€å‡ºæ‚¨çš„åº”ç”¨"><a href="#â€œå‘ä¸Šâ€æŒ‰é’®æ°¸è¿œä¸ä¼šé€€å‡ºæ‚¨çš„åº”ç”¨" class="headerlink" title="â€œå‘ä¸Šâ€æŒ‰é’®æ°¸è¿œä¸ä¼šé€€å‡ºæ‚¨çš„åº”ç”¨"></a>â€œå‘ä¸Šâ€æŒ‰é’®æ°¸è¿œä¸ä¼šé€€å‡ºæ‚¨çš„åº”ç”¨</h5><p>å¦‚æœç”¨æˆ·ä½äºèµ·å§‹ç›®çš„åœ°ï¼Œåˆ™ä¸åº”æ˜¾ç¤ºâ€œå‘ä¸Šâ€æŒ‰é’®ã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨å…¶ä»–åº”ç”¨ç¨‹åºä»»åŠ¡çš„æ·±å±‚é“¾æ¥å¯åŠ¨æ—¶ï¼ŒUpåº”è¯¥å°†ç”¨æˆ·å¸¦åˆ°åˆ†å±‚çˆ¶ç›®æ ‡ï¼Œè€Œä¸æ˜¯è¿”å›åˆ°å…¶ä»–åº”ç”¨ç¨‹åºã€‚</p>
<h5 id="åœ¨åº”ç”¨ç¨‹åºçš„ä»»åŠ¡ä¸­ï¼Œå‘ä¸Šå’Œå‘åç›¸åŒ"><a href="#åœ¨åº”ç”¨ç¨‹åºçš„ä»»åŠ¡ä¸­ï¼Œå‘ä¸Šå’Œå‘åç›¸åŒ" class="headerlink" title="åœ¨åº”ç”¨ç¨‹åºçš„ä»»åŠ¡ä¸­ï¼Œå‘ä¸Šå’Œå‘åç›¸åŒ"></a>åœ¨åº”ç”¨ç¨‹åºçš„ä»»åŠ¡ä¸­ï¼Œå‘ä¸Šå’Œå‘åç›¸åŒ</h5><p>å½“ç³»ç»Ÿâ€œåé€€â€æŒ‰é’®ä¸ä¼šé€€å‡ºæ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œä¾‹å¦‚å½“æ‚¨æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡è€Œä¸æ˜¯å¯åŠ¨ç›®æ ‡æ—¶ï¼Œâ€œå‘ä¸Šâ€æŒ‰é’®çš„åŠŸèƒ½åº”ä¸ç³»ç»Ÿâ€œåé€€â€æŒ‰é’®å®Œå…¨ç›¸åŒã€‚</p>
<h5 id="æ·±åº¦é“¾æ¥å’Œå¯¼èˆªåˆ°ç›®æ ‡åº”è¯¥äº§ç”Ÿç›¸åŒçš„å †æ ˆ"><a href="#æ·±åº¦é“¾æ¥å’Œå¯¼èˆªåˆ°ç›®æ ‡åº”è¯¥äº§ç”Ÿç›¸åŒçš„å †æ ˆ" class="headerlink" title="æ·±åº¦é“¾æ¥å’Œå¯¼èˆªåˆ°ç›®æ ‡åº”è¯¥äº§ç”Ÿç›¸åŒçš„å †æ ˆ"></a>æ·±åº¦é“¾æ¥å’Œå¯¼èˆªåˆ°ç›®æ ‡åº”è¯¥äº§ç”Ÿç›¸åŒçš„å †æ ˆ</h5><p>ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä½¿ç”¨â€œåé€€â€æˆ–â€œä¸Šç§»â€æŒ‰é’®ï¼Œæ— è®ºä»–ä»¬å¦‚ä½•åˆ°è¾¾ç›®çš„åœ°ï¼Œéƒ½å¯ä»¥é€šè¿‡ç›®çš„åœ°è¿”å›åˆ°èµ·å§‹ç›®çš„åœ°ã€‚<br>æ·±åº¦é“¾æ¥æ—¶ï¼Œå°†åˆ é™¤ä»»ä½•ç°æœ‰çš„å¯¼èˆªå †æ ˆï¼Œå¹¶æ›¿æ¢ä¸ºæ·±å±‚é“¾æ¥çš„å¯¼èˆªå †æ ˆã€‚</p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>é€šè¿‡å¯¼èˆªç»„ä»¶å®ç°å¯¼èˆªï¼ŒJetpackçš„æ¶æ„ç»„ä»¶é€šè¿‡æä¾›ä¸€ç»„å¤„ç†å¤§éƒ¨åˆ†ç»†èŠ‚çš„å¯¼èˆªç»„ä»¶ï¼Œå¯ä»¥è½»æ¾å®ç°åº”ç”¨å†…å¯¼èˆªã€‚</p>
<p>ä½¿ç”¨Navigationï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¯¼èˆªå›¾ï¼Œè¿™æ˜¯ä¸€ç§XMLèµ„æºï¼Œè¡¨ç¤ºåº”ç”¨ç¨‹åºä¸­çš„å„ä¸ªç›®æ ‡èŠ‚ç‚¹ä»¥åŠè¿æ¥èŠ‚ç‚¹çš„æ“ä½œã€‚</p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºçš„å¯¼èˆªå›¾çš„ç›´è§‚è¡¨ç¤ºï¼Œè¯¥åº”ç”¨ç¨‹åºåŒ…å«é€šè¿‡5ä¸ªæ“ä½œè¿æ¥çš„6ä¸ªç›®æ ‡ã€‚<br><img src="./images/navigation-grap.png" alt="å¯¼èˆªå›¾"></p>
<p>ä¸€ä¸ªç›®æ ‡å°±æ˜¯ä½ å¯ä»¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºå¯¼èˆªåˆ°ä»»ä½•åœ°æ–¹ã€‚è™½ç„¶ç›®æ ‡é€šå¸¸æ˜¯è¡¨ç¤ºç‰¹å®šå±å¹•çš„Fragmentsï¼Œä½†å¯¼èˆªæ”¯æŒå…¶ä»–ç›®æ ‡ç±»å‹ï¼š</p>
<ul>
<li>Activities</li>
<li>å¯¼èˆªå›¾å’Œå­å›¾-å½“ç›®æ ‡æ˜¯å›¾å½¢æˆ–å­å›¾æ—¶ï¼Œå¯¼èˆªåˆ°è¯¥å›¾æˆ–å­å›¾çš„èµ·å§‹ç›®æ ‡</li>
<li><a href="https://developer.android.com/topic/libraries/architecture/navigation/navigation-add-new.html" target="_blank" rel="noopener">è‡ªè®¢ç›®æ ‡ç±»å‹</a><br>âš ï¸ï¼šå¯¼èˆªç»„ä»¶ä¸“ä¸ºå…·æœ‰ä¸€ä¸ªå…·æœ‰å¤šä¸ªFragmentç›®æ ‡çš„ä¸»è¦activityçš„åº”ç”¨ç¨‹åºè€Œè®¾è®¡ã€‚ä¸»activityæ‰˜ç®¡å¯¼èˆªå›¾ï¼Œå¹¶è´Ÿè´£æ ¹æ®éœ€è¦äº¤æ¢ç›®æ ‡ã€‚åœ¨å…·æœ‰å¤šä¸ªactivityç›®æ ‡çš„åº”ç”¨ä¸­ï¼Œæ¯ä¸ªé™„åŠ activityéƒ½ä¼šæ‰˜ç®¡è‡ªå·±çš„å¯¼èˆªå›¾ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://developer.android.com/topic/libraries/architecture/navigation/navigation-implementing#Modify-activity" target="_blank" rel="noopener">ä¿®æ”¹æ´»åŠ¨ä»¥ä¸»æŒå¯¼èˆª</a> ã€‚</li>
</ul>
<h4 id="ä¸ºé¡¹ç›®å¼•å…¥å¯¼èˆªç»„ä»¶"><a href="#ä¸ºé¡¹ç›®å¼•å…¥å¯¼èˆªç»„ä»¶" class="headerlink" title="ä¸ºé¡¹ç›®å¼•å…¥å¯¼èˆªç»„ä»¶"></a>ä¸ºé¡¹ç›®å¼•å…¥å¯¼èˆªç»„ä»¶</h4><p>âš ï¸ï¼šå¦‚æœæ‚¨è¦ä½¿ç”¨Android Studioå¯¼èˆªï¼Œåˆ™å¿…é¡»ä½¿ç”¨ <a href="https://developer.android.com/studio/preview/" target="_blank" rel="noopener">Android Studio 3.2 Canary 14æˆ–æ›´é«˜ç‰ˆæœ¬</a>ã€‚</p>
<p>è¦åœ¨é¡¹ç›®ä¸­åŒ…å«å¯¼èˆªæ”¯æŒï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ build.gradleæ–‡ä»¶ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    def nav_version = <span class="string">"1.0.0-alpha09"</span></span><br><span class="line"></span><br><span class="line">    implementation <span class="string">"android.arch.navigation:navigation-fragment:$nav_version"</span> <span class="comment">// use -ktx for Kotlin</span></span><br><span class="line">    implementation <span class="string">"android.arch.navigation:navigation-ui:$nav_version"</span> <span class="comment">// use -ktx for Kotlin</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰å…³å‘é¡¹ç›®æ·»åŠ å…¶ä»–ä½“ç³»ç»“æ„ç»„ä»¶çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…å‘é¡¹ç›® <a href="https://developer.android.com/topic/libraries/architecture/adding-components#navigation" target="_blank" rel="noopener">æ·»åŠ ç»„ä»¶</a>ã€‚</p>
<h4 id="åˆ›å»ºå¯¼èˆªå›¾"><a href="#åˆ›å»ºå¯¼èˆªå›¾" class="headerlink" title="åˆ›å»ºå¯¼èˆªå›¾"></a>åˆ›å»ºå¯¼èˆªå›¾</h4><p>è¦å‘é¡¹ç›®æ·»åŠ å¯¼èˆªå›¾ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åœ¨â€œé¡¹ç›®â€çª—å£ä¸­ï¼Œå³é”®å•å‡»è¯¥resç›®å½•ï¼Œç„¶åé€‰æ‹© <strong>New &gt; Android Resource File</strong>ã€‚å‡ºç° <strong>New Resource File</strong> å¯¹è¯æ¡†ã€‚</li>
<li>åœ¨ <strong> File name</strong> å­—æ®µä¸­é”®å…¥åç§°ï¼Œä¾‹å¦‚â€œnav_graphâ€ã€‚</li>
<li>ä» <strong>Resource type</strong> ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹© <strong>Navigation</strong>ã€‚</li>
<li><p>å•å‡» <strong>OK</strong> ã€‚å‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>åœ¨navigationç›®å½•ä¸­åˆ›å»ºèµ„æºresç›®å½•ã€‚</li>
<li>nav_graph.xmlåœ¨å¯¼èˆªç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚</li>
<li>è¯¥ nav_graph.xmlæ–‡ä»¶å°†åœ¨å¯¼èˆªç¼–è¾‘å™¨ä¸­æ‰“å¼€ã€‚æ­¤XMLæ–‡ä»¶åŒ…å«å¯¼èˆªå›¾ã€‚</li>
</ul>
</li>
<li><p>å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥åˆ‡æ¢åˆ°XMLæ–‡æœ¬è§†å›¾ã€‚æ‚¨åº”è¯¥çœ‹åˆ°ä¸€ä¸ªç©ºçš„å¯¼èˆªå›¾ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>å•å‡» <strong>Design</strong> è¿”å› Navigation Editorã€‚</li>
</ol>
<h4 id="æµè§ˆå¯¼èˆªç¼–è¾‘å™¨"><a href="#æµè§ˆå¯¼èˆªç¼–è¾‘å™¨" class="headerlink" title="æµè§ˆå¯¼èˆªç¼–è¾‘å™¨"></a>æµè§ˆå¯¼èˆªç¼–è¾‘å™¨</h4><p>åœ¨Navigation Editorä¸­ï¼Œæ‚¨å¯ä»¥ç›´è§‚åœ°ç¼–è¾‘å¯¼èˆªå›¾ï¼Œè€Œä¸æ˜¯ç›´æ¥ç¼–è¾‘åŸºç¡€XMLã€‚<br><img src="./images/navigation-editor.png" alt="å¯¼èˆªç¼–è¾‘å™¨"></p>
<ul>
<li>ç›®çš„åœ°ï¼šåˆ—å‡ºå¯¼èˆªä¸»æœºå’Œå½“å‰ä½äºâ€œ æ›²çº¿å›¾ç¼–è¾‘å™¨â€ä¸­çš„æ‰€æœ‰ç›®çš„åœ°ã€‚</li>
<li>å›¾è¡¨ç¼–è¾‘å™¨ï¼šåŒ…å«å¯¼èˆªå›¾çš„å¯è§†åŒ–è¡¨ç¤ºã€‚</li>
<li>å±æ€§ï¼šæ˜¾ç¤ºå¯¼èˆªå›¾ä¸­å½“å‰æ‰€é€‰é¡¹çš„å±æ€§ã€‚</li>
</ul>
<h4 id="åˆ›å»ºç›®çš„åœ°"><a href="#åˆ›å»ºç›®çš„åœ°" class="headerlink" title="åˆ›å»ºç›®çš„åœ°"></a>åˆ›å»ºç›®çš„åœ°</h4><p>åˆ›å»ºå¯¼èˆªå›¾çš„ç¬¬ä¸€æ­¥æ˜¯è¯†åˆ«å’Œåˆ›å»ºåº”ç”¨çš„å„ä¸ªç›®æ ‡ã€‚æ‚¨å¯ä»¥åœ¨ç°æœ‰é¡¹ç›®ä¸­çš„Fragmentså’ŒActivitiesä¸­åˆ›å»ºç›®æ ‡ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºå ä½ç¬¦ç›®æ ‡ï¼Œä»¥åå¯ä»¥ä½¿ç”¨Fragmentsæˆ–Activitiesæ›¿æ¢å®ƒä»¬ã€‚</p>
<p>å¦‚æœæ‚¨è¦å°†ç°æœ‰ç‰‡æ®µæˆ–æ´»åŠ¨æ·»åŠ åˆ°å¯¼èˆªå›¾ä¸­ï¼Œæˆ–è€…å¦‚æœè¦æ·»åŠ å ä½ç¬¦ï¼Œè¯·å•å‡» <strong>New Destination</strong> â•ï¼Œç„¶ååœ¨ä¸‹æ‹‰åˆ—è¡¨ä¸­å•å‡»ç›¸åº”çš„ç‰‡æ®µï¼Œæ´»åŠ¨æˆ–å ä½ç¬¦ç›®æ ‡ã€‚å‡ºç°ã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨ <strong>Design</strong> è§†å›¾ä¸­æŸ¥çœ‹ç›®æ ‡çš„é¢„è§ˆä»¥åŠå¯¼èˆªå›¾çš„â€œ æ–‡æœ¬â€è§†å›¾ä¸­çš„ç›¸åº”XML ã€‚</p>
<p>è¦åˆ›å»ºæ–°çš„ç›®æ ‡ç±»å‹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  </p>
<ol>
<li>åœ¨å¯¼èˆªç¼–è¾‘å™¨ä¸­ï¼Œå•å‡» <strong>New Destination</strong> â•ï¼Œç„¶åå•å‡» <strong>Create blank destination</strong> ã€‚</li>
<li>åœ¨å‡ºç°çš„ <strong>New Android Component </strong> å¯¹è¯æ¡†ä¸­ï¼Œè¾“å…¥ <strong>Fragment Name</strong> ã€‚è¿™æ˜¯Fragmentç±»çš„åç§°ã€‚</li>
<li>è¦è®©Android Studioä¸ºFragmentåˆ›å»ºç›¸åº”çš„å¸ƒå±€èµ„æºæ–‡ä»¶ï¼Œè¯·é€‰ä¸­ <strong>Create layout XML</strong> æ—è¾¹çš„æ¡†ï¼Œç„¶ååœ¨ <strong>Fragment Layout Name</strong> å­—æ®µä¸­è¾“å…¥èµ„æºåç§°ã€‚</li>
<li>åœ¨ <strong>Source Language</strong> ä¸‹æ‹‰åˆ—è¡¨ä¸­ï¼Œä¸ºç±»æºæ–‡ä»¶é€‰æ‹©Kotlinæˆ–Javaã€‚</li>
<li>å•å‡»å®Œæˆã€‚<br>æ–°ç›®æ ‡ç±»å‹æ˜¾ç¤ºåœ¨å¯¼èˆªç¼–è¾‘å™¨ä¸­ã€‚Android Studioè¿˜ä»¥æŒ‡å®šçš„æºè¯­è¨€åˆ›å»ºç›¸åº”çš„ç±»æ–‡ä»¶ï¼Œå¦‚æœæŒ‡å®šï¼Œè¿˜ä¼šä¸ºæ–°ç›®æ ‡ç±»å‹åˆ›å»ºå¸ƒå±€èµ„æºæ–‡ä»¶ã€‚</li>
</ol>
<p>å›¾æ˜¾ç¤ºäº†ç›®æ ‡å’Œå ä½ç¬¦çš„ç¤ºä¾‹ã€‚<br><img src="./images/navigation-destination-and-placeholder_2x.png" alt="ç›®æ ‡å’Œå ä½ç¬¦"></p>
<p>å¯ä»¥å•å‡»ä»»ä½•ç›®çš„åœ°ä»¥é€‰æ‹©å®ƒã€‚é€‰æ‹©ç›®æ ‡æ—¶ï¼Œ<strong>Attributes</strong> é¢æ¿ä¸­å°†æ˜¾ç¤ºä»¥ä¸‹å±æ€§ï¼š</p>
<ul>
<li><strong>Type</strong> å­—æ®µæŒ‡ç¤ºç›®æ ‡æ˜¯å¦åœ¨æºä»£ç ä¸­å®ç°ä¸ºç‰‡æ®µæˆ–æ´»åŠ¨ã€‚</li>
<li><strong>Label</strong> å­—æ®µåŒ…å«ç›®æ ‡çš„XMLå¸ƒå±€æ–‡ä»¶çš„åç§°ã€‚</li>
<li><strong>ID</strong> å­—æ®µåŒ…å«è¢«ç”¨äºæŒ‡åœ¨ä»£ç ä¸­çš„ç›®çš„åœ°çš„ç›®çš„åœ°çš„IDã€‚</li>
<li><strong>Class</strong> ä¸‹æ‹‰åˆ—è¡¨æ˜¾ç¤ºä¸ç›®æ ‡å…³è”çš„ç±»çš„åç§°ã€‚æ‚¨å¯ä»¥å•å‡»æ­¤ä¸‹æ‹‰åˆ—è¡¨å°†å…³è”çš„ç±»æ›´æ”¹ä¸ºå…¶ä»–ç›®æ ‡ç±»å‹ã€‚</li>
</ul>
<p>âš ï¸ï¼šå ä½ç¬¦ä¸ç±»æ— å…³ã€‚è¯·åŠ¡å¿…åœ¨è¿è¡Œåº”ç”¨ç¨‹åºä¹‹å‰æ›´æ”¹ç±»å€¼ã€‚</p>
<p>å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥æ˜¾ç¤ºå¯¼èˆªå›¾çš„XMLè§†å›¾ã€‚XMLåŒ…å«ç›¸åŒçš„idï¼Œnameï¼Œlabelï¼Œå’Œlayoutå±æ€§çš„ç›®çš„åœ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">"@id/blankFragment"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/blankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.cashdog.cashdog.BlankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"Blank"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_blank"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="è¿æ¥ç›®çš„åœ°"><a href="#è¿æ¥ç›®çš„åœ°" class="headerlink" title="è¿æ¥ç›®çš„åœ°"></a>è¿æ¥ç›®çš„åœ°</h4><p>æ‚¨å¿…é¡»æœ‰å¤šä¸ªç›®æ ‡æ‰èƒ½è¿æ¥ç›®æ ‡ã€‚ä»¥ä¸‹æ˜¯åŒ…å«ä¸¤ä¸ªç©ºç™½ç›®æ ‡çš„å¯¼èˆªå›¾çš„XMLï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">"@id/blankFragment"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/blankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.cashdog.cashdog.BlankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"fragment_blank"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_blank"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/blankFragment2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.cashdog.cashdog.BlankFragment2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"Blank2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_blank_fragment2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç›®çš„åœ°ä½¿ç”¨åŠ¨ä½œè¿æ¥ã€‚è¦è¿æ¥ä¸¤ä¸ªç›®æ ‡ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åœ¨ <strong>Design</strong> é€‰é¡¹å¡ä¸­ï¼Œå°†é¼ æ ‡æ‚¬åœåœ¨æ‚¨å¸Œæœ›ç”¨æˆ·å¯¼èˆªçš„ç›®æ ‡çš„å³ä¾§ã€‚ç›®çš„åœ°ä¸Šä¼šå‡ºç°ä¸€ä¸ªåœ†åœˆã€‚<br><img src="./images/navigation-actioncircle_2x.png" alt="è§†å›¾è®¾è®¡"><br>å›¾4.åŠ¨ä½œè¿æ¥åœˆ</li>
<li><p>å•å‡»å¹¶æŒ‰ä½ï¼Œå°†å…‰æ ‡æ‹–åˆ°æ‚¨å¸Œæœ›ç”¨æˆ·å¯¼èˆªåˆ°çš„ç›®æ ‡ä¸Šï¼Œç„¶åé‡Šæ”¾ã€‚ç»˜åˆ¶ä¸€æ¡çº¿ä»¥æŒ‡ç¤ºä¸¤ä¸ªç›®çš„åœ°ä¹‹é—´çš„å¯¼èˆªã€‚<br><img src="./images/navigation-connected_2x.png" alt="è¿æ¥ç›®çš„åœ°"><br>å›¾5.è¿æ¥ç›®çš„åœ°<br>å•å‡»ç®­å¤´ä»¥çªå‡ºæ˜¾ç¤ºè¯¥æ“ä½œã€‚<strong>Attributes</strong> é¢æ¿ä¸­æ˜¾ç¤ºä»¥ä¸‹å±æ€§ï¼š</p>
<ul>
<li>Type å­—æ®µåŒ…å« Actionã€‚</li>
<li>è¯¥IDå­—æ®µåŒ…å«åŠ¨ä½œIDã€‚</li>
<li>Destination å­—æ®µåŒ…å«æ‰€è¿°ç›®çš„åœ°ç‰‡Fragmentæˆ–Activityçš„IDã€‚<br>å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥åˆ‡æ¢åˆ°XMLè§†å›¾ã€‚ç°åœ¨ï¼Œæ“ä½œå…ƒç´ å·²æ·»åŠ åˆ°æºç›®æ ‡ã€‚è¯¥æ“ä½œå…·æœ‰IDå’Œç›®æ ‡å±æ€§ï¼Œå…¶ä¸­åŒ…å«ä¸‹ä¸€ä¸ªç›®æ ‡çš„IDï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</li>
</ul>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">"@id/blankFragment"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/blankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.cashdog.cashdog.BlankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"fragment_blank"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_blank"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/action_blankFragment_to_blankFragment2"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:destination</span>=<span class="string">"@id/blankFragment2"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/blankFragment2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.cashdog.cashdog.BlankFragment2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"fragment_blank_fragment2"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_blank_fragment2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="å°†å±å¹•æŒ‡å®šä¸ºèµ·å§‹ç›®çš„åœ°"><a href="#å°†å±å¹•æŒ‡å®šä¸ºèµ·å§‹ç›®çš„åœ°" class="headerlink" title="å°†å±å¹•æŒ‡å®šä¸ºèµ·å§‹ç›®çš„åœ°"></a>å°†å±å¹•æŒ‡å®šä¸ºèµ·å§‹ç›®çš„åœ°</h4><p>å¯¼èˆªç¼–è¾‘å™¨ä½¿ç”¨ğŸ æ¥æŒ‡ç¤ºç”¨æˆ·åœ¨æ‰“å¼€åº”ç”¨ç¨‹åºæ—¶çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªå±å¹•ï¼Œä¹Ÿç§°ä¸º èµ·å§‹ç›®çš„åœ°ã€‚</p>
<p>è¦é€‰æ‹©å…¶ä»–èµ·å§‹ç›®çš„åœ°ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li><p>åœ¨ <strong>Design</strong> é€‰é¡¹å¡ä¸­ï¼Œå•å‡»æ–°çš„èµ·å§‹ç›®æ ‡ä»¥çªå‡ºæ˜¾ç¤ºå®ƒã€‚</p>
</li>
<li><p>å•å‡» <strong>Assign start destination</strong> æŒ‰é’®ğŸ ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å³é”®å•å‡»ç›®æ ‡ï¼Œç„¶åå•å‡» <strong>Set as Start Destination</strong>ã€‚</p>
</li>
</ol>
<h4 id="ä¿®æ”¹æ´»åŠ¨ä»¥ä¸»æŒå¯¼èˆª"><a href="#ä¿®æ”¹æ´»åŠ¨ä»¥ä¸»æŒå¯¼èˆª" class="headerlink" title="ä¿®æ”¹æ´»åŠ¨ä»¥ä¸»æŒå¯¼èˆª"></a>ä¿®æ”¹æ´»åŠ¨ä»¥ä¸»æŒå¯¼èˆª</h4><p>Activityä¸ºNavHostä¸­çš„åº”ç”¨ç¨‹åºæä¾›å¯¼èˆªã€‚ NavHostæ˜¯ä¸€ä¸ªç©ºå®¹å™¨ï¼Œå½“ç”¨æˆ·æµè§ˆæ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œç›®çš„åœ°ä¼šè¢«æ¢å…¥å’Œæ¢å‡ºã€‚<br>Navigationç»„ä»¶ä¸­é»˜è®¤NavHostçš„å®ç°æ˜¯NavHostFragmentã€‚</p>
<h5 id="ä½¿ç”¨å¸ƒå±€ç¼–è¾‘å™¨æ·»åŠ NavHostFragment"><a href="#ä½¿ç”¨å¸ƒå±€ç¼–è¾‘å™¨æ·»åŠ NavHostFragment" class="headerlink" title="ä½¿ç”¨å¸ƒå±€ç¼–è¾‘å™¨æ·»åŠ NavHostFragment"></a>ä½¿ç”¨å¸ƒå±€ç¼–è¾‘å™¨æ·»åŠ NavHostFragment</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨å¸ƒå±€ç¼–è¾‘å™¨é€šè¿‡ä»¥ä¸‹æ­¥éª¤å°†NavHostFragmentæ·»åŠ åˆ°Activityï¼š   </p>
<ol>
<li>å¦‚æœæ‚¨è¿˜æ²¡æœ‰å¯¼èˆªå›¾èµ„æºï¼Œè¯·åˆ›å»ºå¯¼èˆªå›¾èµ„æºã€‚</li>
<li>åœ¨é¡¹ç›®æ–‡ä»¶åˆ—è¡¨ä¸­ï¼ŒåŒå‡»æ´»åŠ¨çš„å¸ƒå±€XMLæ–‡ä»¶ï¼Œåœ¨å¸ƒå±€ç¼–è¾‘å™¨ä¸­å°†å…¶æ‰“å¼€ã€‚</li>
<li>åœ¨Paletteçª—æ ¼ä¸­ï¼Œé€‰æ‹©Containersç±»åˆ«ï¼Œæˆ–è€…æœç´¢â€œNavHostFragmentâ€ã€‚</li>
<li>å°†NavHostFragmentè§†å›¾æ‹–åˆ°æ‚¨çš„æ´»åŠ¨ä¸Šã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œåœ¨å‡ºç°çš„ <strong>Navigation Graphs</strong> å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©è¦ä¸å…¶å…³è”çš„ç›¸åº”å¯¼èˆªå›¾NavHostFragmentï¼Œç„¶åå•å‡» <strong>OK</strong> ã€‚</li>
</ol>
<p>å›åˆ° <strong>Text</strong> è§†å›¾ï¼Œè¯·æ³¨æ„Android Studioæ·»åŠ äº†ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„XMLï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nav_host_fragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"androidx.navigation.fragment.NavHostFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintLeft_toLeftOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintRight_toRightOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">"parent"</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">        <span class="attr">app:defaultNavHost</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:navGraph</span>=<span class="string">"@navigation/mobile_navigation"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯¥app:defaultNavHost=â€trueâ€å±æ€§ç¡®ä¿æ‚¨NavHostFragment æ‹¦æˆªç³»ç»Ÿåé€€æŒ‰é’®ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡è¦†ç›–AppCompatActivity.onSupportNavigateUp() å’Œè°ƒç”¨æ¥å®ç°æ­¤è¡Œä¸ºNavController.navigateUpï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  override fun onSupportNavigateUp(): Boolean &#123;</span></span><br><span class="line"><span class="comment">          return Navigation.findNavController(this, R.id.fragment_nav).navigateUp()</span></span><br><span class="line"><span class="comment">      &#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="function">override fun <span class="title">onSupportNavigateUp</span><span class="params">()</span> </span>= Navigation.findNavController(<span class="keyword">this</span>, R.id.fragment_nav).navigateUp()</span><br></pre></td></tr></table></figure>
<h4 id="ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºNavHostFragment"><a href="#ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºNavHostFragment" class="headerlink" title="ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºNavHostFragment"></a>ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºNavHostFragment</h4><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨NavHostFragment.create() ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºNavHostFragmentå…·æœ‰ç‰¹å®šå›¾å½¢èµ„æºçš„èµ„æºï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val finalHost = NavHostFragment.create(R.navigation.example_graph)</span><br><span class="line">supportFragmentManager.beginTransaction()</span><br><span class="line">    .replace(R.id.nav_host, finalHost)</span><br><span class="line">    .setPrimaryNavigationFragment(finalHost) <span class="comment">// this is the equivalent to app:defaultNavHost="true"</span></span><br><span class="line">    .commit()</span><br></pre></td></tr></table></figure></p>
<h4 id="å°†ç›®æ ‡ç»‘å®šåˆ°uiå°éƒ¨ä»¶"><a href="#å°†ç›®æ ‡ç»‘å®šåˆ°uiå°éƒ¨ä»¶" class="headerlink" title="å°†ç›®æ ‡ç»‘å®šåˆ°uiå°éƒ¨ä»¶"></a>å°†ç›®æ ‡ç»‘å®šåˆ°uiå°éƒ¨ä»¶</h4><p>ä½¿ç”¨NavControllerç±»å¯¼èˆªåˆ°ç›®æ ‡ã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é™æ€æ–¹æ³•ä¹‹ä¸€æ£€ç´¢NavControllerï¼šï¼š</p>
<ul>
<li>NavHostFragment.findNavController(Fragment)</li>
<li>Navigation.findNavController(Activity, @IdRes int viewId)</li>
<li>Navigation.findNavController(View)<br>æ£€ç´¢å NavControllerï¼Œä½¿ç”¨å…¶ navigate() æ–¹æ³•å¯¼èˆªåˆ°ç›®æ ‡ã€‚è¯¥ navigate() æ–¹æ³•æ¥å—èµ„æºIDã€‚IDå¯ä»¥æ˜¯å¯¼èˆªå›¾æˆ–æ“ä½œä¸­ç‰¹å®šç›®æ ‡çš„IDã€‚ä½¿ç”¨æ“ä½œçš„IDè€Œä¸æ˜¯ç›®æ ‡çš„èµ„æºIDå…·æœ‰ä¼˜åŠ¿ï¼Œä¾‹å¦‚å°†è¿‡æ¸¡ä¸å¯¼èˆªç›¸å…³è”ã€‚æœ‰å…³è½¬æ¢çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://developer.android.com/topic/libraries/architecture/navigation/navigation-implementing#Create-transition" target="_blank" rel="noopener">åˆ›å»ºç›®æ ‡ä¹‹é—´çš„è½¬æ¢</a>ã€‚</li>
</ul>
<p>ä»¥ä¸‹ä»£ç æ®µæ˜¾ç¤ºäº†å¦‚ä½•å¯¼èˆªåˆ° ViewTransactionsFragmentï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewTransactionsButton.setOnClickListener &#123; view -&gt;</span><br><span class="line">   view.findNavController().navigate(R.id.viewTransactionsAction)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Androidç³»ç»Ÿç»´æŠ¤ä¸€ä¸ªåŒ…å«æœ€åè®¿é—®ç›®çš„åœ°çš„ <strong>back stack</strong> ã€‚å½“ç”¨æˆ·æ‰“å¼€åº”ç”¨ç¨‹åºæ—¶ï¼Œåº”ç”¨ç¨‹åºçš„ç¬¬ä¸€ä¸ªç›®æ ‡ä½äºå †æ ˆä¸­ã€‚æ¯æ¬¡è°ƒç”¨è¯¥ navigate() æ–¹æ³•éƒ½ä¼šå°†å¦ä¸€ä¸ªç›®æ ‡æ”¾åœ¨å †æ ˆé¡¶éƒ¨ã€‚ç›¸åï¼ŒæŒ‰â€œå‘ä¸Šâ€æˆ–â€œè¿”å›â€æŒ‰é’®åˆ†åˆ«è°ƒç”¨ NavController.navigateUp() å’Œ NavController.popBackStack() æ–¹æ³•ï¼Œå°†é¡¶éƒ¨ç›®æ ‡å¼¹å‡ºå †æ ˆã€‚</p>
<p>å¯¹äºæŒ‰é’®ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Navigationç±»çš„ createNavigateOnClickListener() ä¾¿æ·æ–¹æ³•å¯¼èˆªåˆ°ç›®æ ‡ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">button.setOnClickListener(Navigation.createNavigateOnClickListener(R.id.next_fragment, null))</span><br></pre></td></tr></table></figure></p>
<p>è¦å¤„ç†å…¶ä»–å¸¸è§UIç»„ä»¶ï¼Œä¾‹å¦‚é¡¶éƒ¨åº”ç”¨æ å’Œåº•éƒ¨å¯¼èˆªï¼Œè¯·å‚é˜…<a href="https://developer.android.com/topic/libraries/architecture/navigation/navigation-ui" target="_blank" rel="noopener">ä½¿ç”¨NavigationUIæ›´æ–°UIç»„ä»¶</a>ã€‚</p>
<h4 id="ä¸ºç›®æ ‡åˆ›å»ºæ·±å±‚é“¾æ¥"><a href="#ä¸ºç›®æ ‡åˆ›å»ºæ·±å±‚é“¾æ¥" class="headerlink" title="ä¸ºç›®æ ‡åˆ›å»ºæ·±å±‚é“¾æ¥"></a>ä¸ºç›®æ ‡åˆ›å»ºæ·±å±‚é“¾æ¥</h4><p>åœ¨Androidä¸­ï¼Œ<a href="https://developer.android.com/training/app-links/deep-linking" target="_blank" rel="noopener">æ·±å±‚é“¾æ¥</a>æ˜¯æŒ‡å‘åº”ç”¨ä¸­ç‰¹å®šç›®æ ‡çš„URIã€‚å½“æ‚¨æƒ³è¦å°†ç”¨æˆ·å‘é€åˆ°ç‰¹å®šç›®çš„åœ°ä»¥åœ¨æ‚¨çš„åº”ç”¨ä¸­æ‰§è¡ŒæŸé¡¹ä»»åŠ¡æ—¶ï¼Œè¿™äº›URIå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚å‘é€èµ„é‡‘æµï¼Œå…è®¸ç”¨æˆ·å¿«é€Ÿæ±‡æ¬¾ç»™æŸäººã€‚</p>
<h5 id="ä¸ºç›®æ ‡åˆ†é…æ·±å±‚é“¾æ¥"><a href="#ä¸ºç›®æ ‡åˆ†é…æ·±å±‚é“¾æ¥" class="headerlink" title="ä¸ºç›®æ ‡åˆ†é…æ·±å±‚é“¾æ¥"></a>ä¸ºç›®æ ‡åˆ†é…æ·±å±‚é“¾æ¥</h5><p>è¦åœ¨å¯¼èˆªå›¾ä¸­ä¸ºç›®æ ‡æŒ‡å®šæ·±å±‚é“¾æ¥ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>åœ¨ <strong>Design</strong> è§†å›¾ä¸­ï¼Œé€‰æ‹©æ·±å±‚é“¾æ¥çš„ç›®æ ‡ã€‚</li>
<li>å•å‡» <strong>Add deep link</strong> æŒ‰é’®ğŸ”—ï¼ˆæˆ–å•å‡» <strong>Attributes</strong> é¢æ¿çš„ <strong>Deep Links</strong> éƒ¨åˆ†ä¸­çš„â•ï¼‰ã€‚å‡ºç° <strong>Add Deep Link</strong> å¯¹è¯æ¡†ã€‚</li>
<li>åœ¨URIå­—æ®µä¸­é”®å…¥URIï¼Œä¾‹å¦‚â€œwww.cashdog.com/sendmoneyâ€ï¼Œå®ƒè¡¨ç¤ºåº”ç”¨ä¸­å‘é€è´§å¸åµŒå¥—å›¾çš„èµ·å§‹ç›®çš„åœ°ã€‚</li>
</ul>
<p>è¯·æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š  </p>
<ul>
<li>æœªæŒ‡å®šåè®®çš„URIè¢«å‡å®šä¸ºhttpæˆ–httpsã€‚ä¾‹å¦‚ï¼Œ www.cashdog.comåŒ¹é…<a href="http://www.cashdog.com" target="_blank" rel="noopener">http://www.cashdog.com</a> æˆ–<a href="https://www.cashdog.comã€‚" target="_blank" rel="noopener">https://www.cashdog.comã€‚</a></li>
<li>å ä½ç¬¦çš„{placeholder_name}åŒ¹é…å½¢å¼ä¸º1ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚Stringå ä½ç¬¦çš„å€¼åœ¨Bundleå¸¦æœ‰ç›¸åŒåç§°çš„é”®çš„å‚æ•°ä¸­å¯ç”¨ã€‚ä¾‹å¦‚ï¼Œ<a href="http://www.example.com/users/{id}åŒ¹é…http://www.example.com/users/4" target="_blank" rel="noopener">http://www.example.com/users/{id}åŒ¹é…http://www.example.com/users/4</a>.</li>
<li>ã€‚*é€šé…ç¬¦å¯ç”¨äºåŒ¹é…0ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚<ul>
<li>ï¼ˆå¯é€‰ï¼‰é€‰ä¸­ <strong>Auto Verify</strong> ä»¥è¦æ±‚GoogleéªŒè¯æ‚¨æ˜¯URIçš„æ‰€æœ‰è€…ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="deepLink app:uri=&quot;https://cashdog.com/sendmoney&quot;/">éªŒè¯Androidåº”ç”¨ç¨‹åºé“¾æ¥</a>ã€‚</li>
<li>å•å‡» <strong>Add</strong>ã€‚ æ‰€é€‰ç›®æ ‡ä¸Šæ–¹ä¼šæ˜¾ç¤ºä¸€ä¸ªé“¾æ¥å›¾æ ‡ï¼Œè¡¨ç¤ºè¯¥ç›®æ ‡å…·æœ‰æ·±å±‚é“¾æ¥ã€‚</li>
<li>å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥åˆ‡æ¢åˆ°XMLè§†å›¾ã€‚å·²å°†åµŒå¥—çš„æ·±å±‚é“¾æ¥å…ƒç´ æ·»åŠ åˆ°ç›®æ ‡ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">deepLink</span> <span class="attr">app:uri</span>=<span class="string">"https://cashdog.com/sendmoney"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>å½“ç”¨æˆ·ä»æ·±å±‚é“¾æ¥ç›®æ ‡æŒ‰ä¸‹â€œåé€€â€æŒ‰é’®æ—¶ï¼Œä»–ä»¬ä¼šå¯¼èˆªå›å¯¼èˆªå †æ ˆï¼Œå°±åƒä»–ä»¬ä»åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹è¿›å…¥æ‚¨çš„åº”ç”¨ç¨‹åºä¸€æ ·ã€‚</p>
<h5 id="ä¸ºæ·±å±‚é“¾æ¥æ·»åŠ æ„å›¾è¿‡æ»¤å™¨"><a href="#ä¸ºæ·±å±‚é“¾æ¥æ·»åŠ æ„å›¾è¿‡æ»¤å™¨" class="headerlink" title="ä¸ºæ·±å±‚é“¾æ¥æ·»åŠ æ„å›¾è¿‡æ»¤å™¨"></a>ä¸ºæ·±å±‚é“¾æ¥æ·»åŠ æ„å›¾è¿‡æ»¤å™¨</h5><p>æ‚¨å¿…é¡»æ·»åŠ manifest.xmlæ–‡ä»¶ä»¥åœ¨æ‚¨çš„åº”ç”¨ä¸­å¯ç”¨æ·±å±‚é“¾æ¥ï¼š</p>
<p>å¯¹äºAndroid Studio 3.0å’Œ3.1ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨æ·»åŠ intent-filter å…ƒç´ ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… åˆ›å»ºåº”ç”¨ç¨‹åºå†…å®¹çš„æ·±å±‚é“¾æ¥ã€‚<br>å¯¹äºAndroid Studio 3.2+ï¼Œæ‚¨å¯ä»¥nav-graphå‘æ´»åŠ¨å…ƒç´ æ·»åŠ å…ƒç´ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">name</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">nav-graph</span> <span class="attr">android:value</span>=<span class="string">"@navigation/main_nav"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½œä¸ºæ¸…å•åˆå¹¶æ„å»ºæ­¥éª¤çš„ä¸€éƒ¨åˆ†ï¼Œæ­¤å…ƒç´ å°†æ›¿æ¢<intent-filter>ä¸ºåŒ¹é…å¯¼èˆªå›¾ä¸­æ‰€æœ‰æ·±å±‚é“¾æ¥æ‰€éœ€çš„ç”Ÿæˆå…ƒç´ ã€‚</intent-filter></p>
<h5 id="ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨NavDeepLinkBuilderåˆ›å»ºæ·±å±‚é“¾æ¥"><a href="#ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨NavDeepLinkBuilderåˆ›å»ºæ·±å±‚é“¾æ¥" class="headerlink" title="ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨NavDeepLinkBuilderåˆ›å»ºæ·±å±‚é“¾æ¥"></a>ä»¥ç¼–ç¨‹æ–¹å¼ä½¿ç”¨NavDeepLinkBuilderåˆ›å»ºæ·±å±‚é“¾æ¥</h5><p>æ‚¨å¯ä»¥ä½¿ç”¨NavDeepLinkBuilderè¯¥ç±»æ„å»ºä¸€ä¸ªPendingIntent å°†ç”¨æˆ·å¸¦åˆ°ç‰¹å®šç›®æ ‡çš„ç±»ã€‚</p>
<p>è§¦å‘æ­¤æ·±å±‚é“¾æ¥æ—¶ï¼Œå°†æ¸…é™¤ä»»åŠ¡åå°å †æ ˆå¹¶æ›¿æ¢ä¸ºæ·±å±‚é“¾æ¥ç›®æ ‡ã€‚å½“åµŒå¥—å›¾è¡¨ï¼Œä»æ¯ä¸€çº§çš„å¼€å§‹ç›®çš„åœ°åµŒå¥—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»æ¯ä¸ªç›®çš„åœ°å¼€å§‹ <navigation>åœ¨å…ƒä»¶å±‚æ¬¡ç»“æ„ä¹Ÿè¢«æ·»åŠ åˆ°å †æ ˆä¸­ã€‚</navigation></p>
<p>æ‚¨å¯ä»¥PendingIntentç›´æ¥ æ„é€ ä¸€ä¸ªNavDeepLinkBuilder(Context)ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæä¾›çš„ä¸Šä¸‹æ–‡ä¸æ˜¯a Activityï¼Œåˆ™æ„é€ å‡½æ•°å°†ä½¿ç”¨ PackageManager.getLaunchIntentForPackage() ä½œä¸ºé»˜è®¤æ´»åŠ¨æ¥å¯åŠ¨ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pendingIntent = NavDeepLinkBuilder(context)</span><br><span class="line">    .setGraph(R.navigation.mobile_navigation)</span><br><span class="line">    .setDestination(R.id.android)</span><br><span class="line">    .setArguments(args)</span><br><span class="line">    .createPendingIntent()</span><br></pre></td></tr></table></figure></p>
<p>æœ‰å…³åŒ…å«æ­¤ç¤ºä¾‹çš„å®Œæ•´å¯¼èˆªé¡¹ç›®ï¼Œè¯·å‚é˜… <a href="https://codelabs.developers.google.com/codelabs/android-navigation/#0" target="_blank" rel="noopener">Navigation Codelab</a>ã€‚</p>
<p>âš ï¸ï¼šå¦‚æœæ‚¨æœ‰ç°æœ‰çš„NavControllerï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡åˆ›å»ºæ·±å±‚é“¾æ¥NavController.createDeepLink()ã€‚</p>
<h5 id="åœ¨ç›®çš„åœ°ä¹‹é—´åˆ›å»ºè¿‡æ¸¡"><a href="#åœ¨ç›®çš„åœ°ä¹‹é—´åˆ›å»ºè¿‡æ¸¡" class="headerlink" title="åœ¨ç›®çš„åœ°ä¹‹é—´åˆ›å»ºè¿‡æ¸¡"></a>åœ¨ç›®çš„åœ°ä¹‹é—´åˆ›å»ºè¿‡æ¸¡</h5><p>å¯¼èˆªç»„ä»¶æä¾›äº†åœ¨ç›®çš„åœ°ä¹‹é—´è½»æ¾æ·»åŠ è½¬æ¢ï¼ˆä¾‹å¦‚æ·¡å…¥å’Œæ·¡å‡ºï¼‰çš„åŠŸèƒ½ã€‚è¦æ·»åŠ è½¬æ¢ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åˆ›å»ºåŠ¨ç”»èµ„æºæ–‡ä»¶ã€‚å¯¼èˆªæ”¯æŒå±æ€§å’Œè§†å›¾åŠ¨ç”»ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://developer.android.com/guide/topics/resources/animation-resource" target="_blank" rel="noopener">Animation resources</a>ã€‚</li>
<li>åœ¨å¯¼èˆªç¼–è¾‘å™¨çš„ <strong><a href="https://developer.android.com/guide/topics/resources/animation-resource" target="_blank" rel="noopener">https://developer.android.com/guide/topics/resources/animation-resource</a></strong> é€‰é¡¹å¡ä¸­ï¼Œå•å‡»è¦è¿›è¡Œè½¬æ¢çš„æ“ä½œã€‚</li>
<li>åœ¨ <strong>Attributes</strong> é¢æ¿çš„ <strong>Transitions</strong> éƒ¨åˆ†ä¸­ï¼Œå•å‡» <strong>Enter</strong> æ—è¾¹çš„å‘ä¸‹ç®­å¤´ä»¥æ˜¾ç¤ºé¡¹ç›®ä¸­å¯ç”¨è¿‡æ¸¡çš„åˆ—è¡¨ã€‚</li>
<li>é€‰æ‹©ç”¨æˆ·è¿›å…¥ç›®çš„åœ°æ—¶å‘ç”Ÿçš„è½¬æ¢ã€‚</li>
<li>å›åˆ° <strong>Transitions</strong> éƒ¨åˆ†ï¼Œå•å‡» <strong>Exit</strong> æ—è¾¹çš„å‘ä¸‹ç®­å¤´ï¼Œç„¶åé€‰æ‹©å½“ç”¨æˆ·é€€å‡ºç›®æ ‡æ—¶å‘ç”Ÿçš„è½¬æ¢ã€‚</li>
<li>å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥åˆ‡æ¢åˆ°XMLæ–‡æœ¬è§†å›¾ã€‚è½¬æ¢çš„XMLå‡ºç°åœ¨æŒ‡å®šæ“ä½œçš„<action>å…ƒç´ ä¸­ã€‚è¯¥æ“ä½œåµŒå…¥åœ¨è½¬æ¢å‘ç”Ÿä¹‹å‰å¤„äºæ´»åŠ¨çŠ¶æ€çš„ç›®æ ‡çš„XMLä¸­ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ   specifyAmountFragmentæ˜¯æ´»åŠ¨ç›®æ ‡ï¼Œå› æ­¤å®ƒåŒ…å«å…·æœ‰è¿‡æ¸¡åŠ¨ç”»çš„æ“ä½œï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/specifyAmountFragment"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">"com.example.buybuddy.buybuddy.SpecifyAmountFragment"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:label</span>=<span class="string">"fragment_specify_amount"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_specify_amount"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/confirmationAction"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:destination</span>=<span class="string">"@id/confirmationFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:enterAnim</span>=<span class="string">"@anim/slide_in_right"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:exitAnim</span>=<span class="string">"@anim/slide_out_left"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:popEnterAnim</span>=<span class="string">"@anim/slide_in_left"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:popExitAnim</span>=<span class="string">"@anim/slide_out_right"</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>
</action></li>
</ol>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ç§»åŠ¨åˆ°ç›®çš„åœ°æ—¶ï¼ˆenterAnimä»¥åŠexitAnimé€€å‡ºè¯¥ç›®æ ‡ï¼ˆpopEnterAnim å’ŒpopExitAnimï¼‰æ—¶å‘ç”Ÿè½¬æ¢ï¼‰ã€‚</p>
<h5 id="åœ¨Fragmentç›®æ ‡ä¹‹é—´æ·»åŠ å…±äº«å…ƒç´ è½¬æ¢"><a href="#åœ¨Fragmentç›®æ ‡ä¹‹é—´æ·»åŠ å…±äº«å…ƒç´ è½¬æ¢" class="headerlink" title="åœ¨Fragmentç›®æ ‡ä¹‹é—´æ·»åŠ å…±äº«å…ƒç´ è½¬æ¢"></a>åœ¨Fragmentç›®æ ‡ä¹‹é—´æ·»åŠ å…±äº«å…ƒç´ è½¬æ¢</h5><p>é™¤äº†è¿‡æ¸¡åŠ¨ç”»ä¹‹å¤–ï¼ŒNavigationè¿˜æ”¯æŒåœ¨ç›®æ ‡ä¹‹é—´æ·»åŠ å…±äº«å…ƒç´ è¿‡æ¸¡ã€‚</p>
<p>ä¸åŠ¨ç”»ä¸åŒï¼Œå…±äº«å…ƒç´ è½¬æ¢æ˜¯ä»¥ç¼–ç¨‹æ–¹å¼æä¾›çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯¼èˆªXMLæ–‡ä»¶æä¾›çš„ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å¼•ç”¨Viewæ‚¨å¸Œæœ›åŒ…å«åœ¨å…±äº«å…ƒç´ è½¬æ¢ä¸­çš„ å®ä¾‹ã€‚</p>
<p>æ¯ç§ç±»å‹çš„ç›®æ ‡éƒ½é€šè¿‡Navigator.Extras æ¥å£çš„å­ç±»å®ç°æ­¤ç¼–ç¨‹API ã€‚å°†Extrasè¢«ä¼ é€’åˆ°ä¸€ä¸ªå‘¼å«navigate()ã€‚</p>
<p>Fragmentç›®æ ‡å…±äº«å…ƒç´ è½¬æ¢<br>åœ¨FragmentNavigator.Extras ç±»å…è®¸æ‚¨é™„åŠ å…±äº«å…ƒç´ åˆ°navigate()å‘¼å«ç›®çš„åœ°çš„ç‰‡æ®µï¼Œå¦‚å›¾ä¸‹é¢çš„ä¾‹å­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val extras = FragmentNavigatorExtras(</span><br><span class="line">    imageView to <span class="string">"header_image"</span>,</span><br><span class="line">    titleView to <span class="string">"header_title"</span>)</span><br><span class="line">view.findNavController().navigate(R.id.confirmationAction,</span><br><span class="line">    <span class="keyword">null</span>, <span class="comment">// Bundle of args</span></span><br><span class="line">    <span class="keyword">null</span>, <span class="comment">// NavOptions</span></span><br><span class="line">    extras)</span><br></pre></td></tr></table></figure></p>
<p>âš ï¸ï¼šè¿™é‡Œçš„header_imageå’Œheader_titleè¦ç¡®ä¿åœ¨å½“å‰å¸ƒå±€çš„android:transitionNameå’Œéœ€è¦è°ƒæ•´çš„å¸ƒå±€çš„android:transitionNameä¸€æ ·</p>
<h5 id="Activityç›®æ ‡å…±äº«å…ƒç´ è½¬æ¢"><a href="#Activityç›®æ ‡å…±äº«å…ƒç´ è½¬æ¢" class="headerlink" title="Activityç›®æ ‡å…±äº«å…ƒç´ è½¬æ¢"></a>Activityç›®æ ‡å…±äº«å…ƒç´ è½¬æ¢</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// Rename the Pair class from the Android framework to avoid a name clash</span><br><span class="line">import android.util.Pair as UtilPair</span><br><span class="line">///...</span><br><span class="line">val options = ActivityOptionsCompat.makeSceneTransitionAnimation(activity,</span><br><span class="line">        UtilPair.create(imageView, &quot;header_image&quot;),</span><br><span class="line">        UtilPair.create(titleView, &quot;header_title&quot;))</span><br><span class="line">val extras = ActivityNavigator.Extras(options)</span><br><span class="line">view.findNavController().navigate(R.id.details,</span><br><span class="line">    null, // Bundle of args</span><br><span class="line">    null, // NavOptions</span><br><span class="line">    extras)</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### ä½¿ç”¨NavigationUIæ›´æ–°UIç»„ä»¶</span><br><span class="line"></span><br><span class="line">å¯¼èˆªæ¶æ„ç»„ä»¶åŒ…æ‹¬NavigationUIç±»ã€‚ æ­¤ç±»åŒ…å«ä½¿ç”¨é¡¶éƒ¨åº”ç”¨æ ï¼Œå¯¼èˆªæŠ½å±‰å’Œåº•éƒ¨å¯¼èˆªç®¡ç†å¯¼èˆªçš„é™æ€æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">#### ç›‘å¬å¯¼èˆªäº‹ä»¶</span><br><span class="line">ä¸NavControlleräº¤äº’æ˜¯åœ¨ç›®çš„åœ°ä¹‹é—´å¯¼èˆªçš„ä¸»è¦æ–¹æ³•ã€‚ NavControllerè´Ÿè´£ç”¨æ–°ç›®æ ‡æ›¿æ¢NavHostçš„å†…å®¹ã€‚ åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒUIå…ƒç´  - ä¾‹å¦‚é¡¶çº§åº”ç”¨æ æˆ–å…¶ä»–æŒä¹…æ€§å¯¼èˆªæ§ä»¶ï¼ˆå¦‚BottomNavigationBarï¼‰åœ¨NavHostä¹‹å¤–å­˜åœ¨ï¼Œå¹¶ä¸”éœ€è¦åœ¨ç›®çš„åœ°ä¹‹é—´å¯¼èˆªæ—¶è¿›è¡Œæ›´æ–°ã€‚</span><br><span class="line"></span><br><span class="line">NavControlleræä¾›äº†ä¸€ä¸ªOnDestinationChangedListeneræ¥å£ï¼Œå½“NavControllerçš„å½“å‰ç›®æ ‡æˆ–å…¶å‚æ•°å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œè¯¥æ¥å£å°†è¢«è°ƒç”¨ã€‚ å¯ä»¥é€šè¿‡addOnDestinationChangedListenerï¼ˆï¼‰æ–¹æ³•æ³¨å†Œæ–°çš„ä¾¦å¬å™¨ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚ è¯·æ³¨æ„ï¼Œåœ¨è°ƒç”¨addOnDestinationChangedListenerï¼ˆï¼‰æ—¶ï¼Œå¦‚æœå½“å‰ç›®æ ‡å­˜åœ¨ï¼Œåˆ™ä¼šç«‹å³å°†å…¶å‘é€ç»™æ‚¨çš„ä¾¦å¬å™¨ã€‚</span><br><span class="line"></span><br><span class="line">```Kotlin</span><br><span class="line">navController.addOnDestinationChangedListener &#123; navController, destination, arguments -&gt;</span><br><span class="line">  textView.setText(destination.label)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>NavigationUIä½¿ç”¨OnDestinationChangedListenerä½¿è¿™äº›å¸¸è§çš„UIç»„ä»¶å¯ä»¥æ„ŸçŸ¥å¯¼èˆªäº‹ä»¶ã€‚ ä½†è¯·æ³¨æ„ï¼Œæ‚¨è¿˜å¯ä»¥å•ç‹¬ä½¿ç”¨OnDestinationChangedListeneræ¥ä½¿ä»»ä½•è‡ªå®šä¹‰UIæˆ–ä¸šåŠ¡é€»è¾‘æ„ŸçŸ¥å¯¼èˆªäº‹ä»¶ã€‚</p>
<h4 id="é¡¶éƒ¨åº”ç”¨æ "><a href="#é¡¶éƒ¨åº”ç”¨æ " class="headerlink" title="é¡¶éƒ¨åº”ç”¨æ "></a>é¡¶éƒ¨åº”ç”¨æ </h4><p>é¡¶éƒ¨åº”ç”¨æ åœ¨åº”ç”¨é¡¶éƒ¨ æä¾›äº†ä¸€è‡´çš„ä½ç½®ï¼Œç”¨äºæ˜¾ç¤ºå½“å‰å±å¹•çš„ä¿¡æ¯å’Œæ“ä½œã€‚<br><img src="./images/top-app-bar.png" alt="é¡¶éƒ¨å¯¼èˆª"><br>NavigationUIåŒ…å«åœ¨ç”¨æˆ·æµè§ˆåº”ç”¨æ—¶è‡ªåŠ¨æ›´æ–°é¡¶éƒ¨åº”ç”¨æ ä¸­å†…å®¹çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼ŒNavigationUIä½¿ç”¨å¯¼èˆªå›¾ä¸­çš„ç›®æ ‡æ ‡ç­¾å¯ä»¥ä½¿é¡¶éƒ¨åº”ç”¨æ çš„æ ‡é¢˜ä¿æŒæœ€æ–°ã€‚</p>
<p>ä½¿ç”¨NavigationUIä¸‹é¢è®¨è®ºçš„é¡¶çº§åº”ç”¨æ æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨{argName}æ ‡ç­¾ä¸­çš„æ ¼å¼ä»æä¾›ç»™ç›®æ ‡çš„å‚æ•°ä¸­è‡ªåŠ¨å¡«å……é™„åŠ åˆ°ç›®æ ‡çš„æ ‡ç­¾ã€‚</p>
<p>NavigationUI æä¾›ä»¥ä¸‹é¡¶çº§åº”ç”¨æ ç±»å‹çš„æ”¯æŒï¼š</p>
<ul>
<li>Toolbar</li>
<li>CollapsingToolbarLayout</li>
<li>ActionBar</li>
</ul>
<h4 id="AppBarConfiguration"><a href="#AppBarConfiguration" class="headerlink" title="AppBarConfiguration"></a>AppBarConfiguration</h4><p>NavigationUIä½¿ç”¨AppBarConfiguration å¯¹è±¡æ¥ç®¡ç†åº”ç”¨ç¨‹åºæ˜¾ç¤ºåŒºåŸŸå·¦ä¸Šè§’çš„â€œå¯¼èˆªâ€æŒ‰é’®çš„è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”¨æˆ·ä½äºå¯¼èˆªå›¾çš„é¡¶çº§ç›®æ ‡ä½ç½®æ—¶ï¼Œå¯¼èˆªæŒ‰é’®å°†éšè—ï¼Œå¹¶åœ¨ä»»ä½•å…¶ä»–ç›®æ ‡ä½ç½®æ˜¾ç¤ºä¸ºâ€œå‘ä¸Šâ€æŒ‰é’®ã€‚</p>
<p>è¦å°†å¯¼èˆªå›¾çš„èµ·å§‹ç›®çš„åœ°ç”¨ä½œå”¯ä¸€çš„é¡¶çº§ç›®çš„åœ°ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªAppBarConfigurationå¯¹è±¡å¹¶ä¼ å…¥ç›¸åº”çš„å¯¼èˆªå›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> appBarConfiguration = AppBarConfiguration(navController.graph)</span><br></pre></td></tr></table></figure></p>
<p>å¦‚æœè¦è‡ªå®šä¹‰å“ªäº›ç›®æ ‡è¢«è§†ä¸ºé¡¶çº§ç›®æ ‡ï¼Œåˆ™å¯ä»¥å°†ä¸€ç»„ç›®æ ‡IDä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val appBarConfiguration = AppBarConfiguration(setOf(R.id.main, R.id.android))</span><br></pre></td></tr></table></figure></p>
<h4 id="åˆ›å»ºToolbar"><a href="#åˆ›å»ºToolbar" class="headerlink" title="åˆ›å»ºToolbar"></a>åˆ›å»ºToolbar</h4><p>è¦ä½¿ç”¨NavigationUIåˆ›å»ºå·¥å…·æ ï¼Œè¯·é¦–å…ˆåœ¨Activityä¸­å®šä¹‰å·¥å…·æ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nav_host_fragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼ŒsetupWithNavController() ä»æ‚¨çš„ä¸»è¦æ´»åŠ¨çš„onCreate()æ–¹æ³•è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    //ä¸»å¯¼èˆªFragment</span><br><span class="line">    val navHostFragment = nav_host_fragment as NavHostFragment</span><br><span class="line">    // å…¶ä¸­toolbalä¸ºéœ€è¦ç»‘å®šçš„è§†å›¾æ§ä»¶ï¼Œç›®å‰æ”¯æŒ12ç§è§†å›¾æ§ä»¶ï¼›</span><br><span class="line">    NavigationUI.setupWithNavController(toolbar, navHostFragment.navController)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ï¼šæ³¨æ„ï¼šä½¿ç”¨å·¥å…·æ æ—¶ï¼Œå¯¼èˆªä¼šè‡ªåŠ¨å¤„ç†â€œå¯¼èˆªâ€æŒ‰é’®çš„å•å‡»äº‹ä»¶ï¼Œå› æ­¤æ‚¨æ— éœ€è¦†ç›–onSupportNavigateUpï¼ˆï¼‰ã€‚<strong>ï¼ï¼ï¼å¦‚æœä½¿ç”¨å¸¦menuèœå•çš„æ§ä»¶å¦‚BottomNavigationViewæ—¶ï¼Œéœ€è¦ç¡®ä¿menuçš„idå’Œéœ€è¦è·³è½¬çš„å¯¼èˆªå›¾ä¸­çš„fragmentçš„IDä¸€è‡´ï¼ï¼ï¼</strong></p>
<h4 id="åŒ…æ‹¬CollapsingToolbarLayout"><a href="#åŒ…æ‹¬CollapsingToolbarLayout" class="headerlink" title="åŒ…æ‹¬CollapsingToolbarLayout"></a>åŒ…æ‹¬CollapsingToolbarLayout</h4><p>è¦CollapsingToolbarLayoutåœ¨å·¥å…·æ ä¸­æ·»åŠ a ï¼Œè¯·å…ˆåœ¨ä¸»è¦æ´»åŠ¨ä¸­å®šä¹‰å·¥å…·æ å’Œå‘¨å›´å¸ƒå±€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"@dimen/tall_toolbar_height"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">android.support.design.widget.CollapsingToolbarLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/collapsing_toolbar_layout"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:contentScrim</span>=<span class="string">"?attr/colorPrimary"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:expandedTitleGravity</span>=<span class="string">"top"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|exitUntilCollapsed|snap"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/toolbar"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">app:layout_collapseMode</span>=<span class="string">"pin"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">android.support.design.widget.CollapsingToolbarLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nav_host_fragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span> /&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼ŒsetupWithNavController() ä»æ‚¨çš„ä¸»è¦æ´»åŠ¨çš„onCreateæ–¹æ³•è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    //ä¸»å¯¼èˆªFragment</span><br><span class="line">    val navHostFragment = nav_host_fragment as NavHostFragment</span><br><span class="line">    // å…¶ä¸­toolbalä¸ºéœ€è¦ç»‘å®šçš„è§†å›¾æ§ä»¶ï¼Œç›®å‰æ”¯æŒ12ç§è§†å›¾æ§ä»¶ï¼›</span><br><span class="line">    NavigationUI.setupWithNavController(toolbar, navHostFragment.navController)</span><br></pre></td></tr></table></figure>
<h4 id="Action-bar"><a href="#Action-bar" class="headerlink" title="Action bar"></a>Action bar</h4><p>è¦ä½¿ç”¨é»˜è®¤æ“ä½œæ åŒ…å«å¯¼èˆªæ”¯æŒï¼Œè¯·setupActionBarWithNavController() ä»ä¸»Activityçš„onCreate()æ–¹æ³•ä¸­è°ƒç”¨ ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œæ‚¨éœ€è¦å£°æ˜è‡ªå·±çš„AppBarConfigurationå¤–éƒ¨onCreate()ï¼Œå› ä¸ºæ‚¨åœ¨è¦†ç›–æ—¶ä¹Ÿä½¿ç”¨å®ƒonSupportNavigateUp():<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private lateinit var appBarConfiguration: AppBarConfiguration</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    val navController = findNavController(R.id.nav_host_fragment)</span><br><span class="line">    appBarConfiguration = AppBarConfiguration(navController.graph)</span><br><span class="line">    setupActionBarWithNavController(navController, appBarConfiguration)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œè¦†ç›–onSupportNavigateUp()ä»¥å¤„ç†å‘ä¸Šå¯¼èˆªï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">override fun onSupportNavigateUp(): Boolean &#123;</span><br><span class="line">    return navController.navigateUp(appBarConfiguration) || super.onSupportNavigateUp()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="å°†ç›®çš„åœ°ç»‘å®šåˆ°èœå•é¡¹"><a href="#å°†ç›®çš„åœ°ç»‘å®šåˆ°èœå•é¡¹" class="headerlink" title="å°†ç›®çš„åœ°ç»‘å®šåˆ°èœå•é¡¹"></a>å°†ç›®çš„åœ°ç»‘å®šåˆ°èœå•é¡¹</h4><p>NavigationUIè¿˜æä¾›äº†å°†ç›®æ ‡ç»‘å®šåˆ°èœå•é©±åŠ¨çš„UIç»„ä»¶çš„å¸®åŠ©ç¨‹åºã€‚NavigationUIåŒ…å«ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼ŒonNavDestinationSelected()å®ƒMenuItemä¸NavControlleræ‰˜ç®¡å…³è”ç›®æ ‡çš„æ–¹æ³•ä¸€èµ·ä½¿ç”¨ ã€‚å¦‚æœidåœ¨çš„MenuItemæ¯”èµ›çš„idç›®æ ‡æ—¶ï¼ŒNavControllerå¯ä»¥ç„¶åå¯¼èˆªåˆ°ç›®çš„åœ°ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢çš„XMLç‰‡æ–­å®šä¹‰ä¸€ä¸ªèœå•é¡¹ï¼Œå¹¶å…· <strong>æœ‰å…±åŒçš„ç›®çš„åœ°idï¼ˆidéœ€è¦ä¸€è‡´ï¼‰</strong>  ï¼Œdetails_page_fragmentï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;navigation xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    ... &gt;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    &lt;fragment android:id=&quot;@+id/details_page_fragment&quot;</span><br><span class="line">         android:label=&quot;@string/details&quot;</span><br><span class="line">         android:name=&quot;com.example.android.myapp.DetailsFragment&quot; /&gt;</span><br><span class="line">&lt;/navigation&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    &lt;item</span><br><span class="line">        android:id=&quot;@id/details_page_fragment&quot;</span><br><span class="line">        android:icon=&quot;@drawable/ic_details&quot;</span><br><span class="line">        android:title=&quot;@string/details&quot; /&gt;</span><br><span class="line">&lt;/menu&gt;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„èœå•æ˜¯é€šè¿‡Activityçš„onCreateOptionsMenuï¼ˆï¼‰æ·»åŠ çš„ï¼Œåˆ™å¯ä»¥é€šè¿‡è¦†ç›–Activityçš„onOptionsItemSelectedï¼ˆï¼‰æ¥è°ƒç”¨onNavDestinationSelectedï¼ˆï¼‰æ¥å…³è”èœå•é¡¹å’Œç›®æ ‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onOptionsItemSelected</span><span class="params">(item: <span class="type">MenuItem</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> navController = findNavController(R.id.nav_host)</span><br><span class="line">    <span class="keyword">return</span> item.onNavDestinationSelected(navController) || <span class="keyword">super</span>.onOptionsItemSelected(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç°åœ¨ï¼Œå½“ç”¨æˆ·å•å‡»details_page_fragmentèœå•é¡¹æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨å¯¼èˆªåˆ° <strong>å…·æœ‰ç›¸åŒIDçš„ç›¸åº”ç›®æ ‡</strong> ã€‚</p>
<h4 id="æ·»åŠ å¯¼èˆªæŠ½å±‰"><a href="#æ·»åŠ å¯¼èˆªæŠ½å±‰" class="headerlink" title="æ·»åŠ å¯¼èˆªæŠ½å±‰"></a>æ·»åŠ å¯¼èˆªæŠ½å±‰</h4><p>å¯¼èˆªæŠ½å±‰æ˜¯ä¸€ä¸ªUIé¢æ¿ï¼Œæ˜¾ç¤ºåº”ç”¨ç¨‹åºçš„ä¸»å¯¼èˆªèœå•ã€‚ å½“ç”¨æˆ·è§¦æ‘¸åº”ç”¨æ ä¸­çš„æŠ½å±‰å›¾æ ‡æˆ–ç”¨æˆ·ä»å±å¹•çš„å·¦è¾¹ç¼˜æ»‘åŠ¨æ‰‹æŒ‡æ—¶ï¼ŒæŠ½å±‰å‡ºç°ã€‚<br><img src="./images/navigation-drawer.png" alt="å¯¼èˆªæŠ½å±‰"><br>æŠ½å±‰å›¾æ ‡æ˜¾ç¤ºåœ¨ä½¿ç”¨DrawerLayoutçš„æ‰€æœ‰é¡¶çº§ç›®æ ‡ä¸Šã€‚ é¡¶çº§ç›®æ ‡æ˜¯åº”ç”¨ç¨‹åºçš„æ ¹çº§ç›®æ ‡ã€‚ å®ƒä»¬ä¸ä¼šåœ¨åº”ç”¨æ ä¸­æ˜¾ç¤ºâ€œå‘ä¸Šâ€æŒ‰é’®ã€‚</p>
<p>è¦æ·»åŠ å¯¼èˆªæŠ½å±‰ï¼Œé¦–å…ˆå°†DrawerLayoutå£°æ˜ä¸ºæ ¹è§†å›¾ã€‚ åœ¨DrawerLayoutå†…ï¼Œæ·»åŠ ä¸»UIå†…å®¹çš„å¸ƒå±€å’ŒåŒ…å«å¯¼èˆªæŠ½å±‰å†…å®¹çš„å¦ä¸€ä¸ªè§†å›¾ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹å¸ƒå±€ä½¿ç”¨å…·æœ‰ä¸¤ä¸ªå­è§†å›¾çš„DrawerLayoutï¼šNavHostFragmentåŒ…å«ä¸»è¦å†…å®¹ï¼ŒNavigationViewç”¨äºå¯¼èˆªæŠ½å±‰çš„å†…å®¹ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- Use DrawerLayout as root container for activity --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/drawer_layout"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Layout to contain contents of main body of screen (drawer will slide over this) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"androidx.navigation.fragment.NavHostFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nav_host_fragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:defaultNavHost</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:navGraph</span>=<span class="string">"@navigation/nav_graph"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Container for contents of drawer - use NavigationView to make configuration easier --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.NavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nav_view"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼ŒDrawerLayout é€šè¿‡å°†å…¶ä¼ é€’åˆ°å¯¼èˆªå›¾ï¼Œå°†å…¶è¿æ¥åˆ°AppBarConfigurationï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val appBarConfiguration = AppBarConfiguration(navController.graph, drawerLayout)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ï¼šä½¿ç”¨æ—¶NavigationUIï¼Œé¡¶éƒ¨åº”ç”¨æ å¸®åŠ©å™¨ä¼šåœ¨å½“å‰ç›®æ ‡æ›´æ”¹æ—¶è‡ªåŠ¨åœ¨æŠ½å±‰å›¾æ ‡å’Œâ€œå‘ä¸Šâ€å›¾æ ‡ä¹‹é—´åˆ‡æ¢ã€‚ä½ ä¸éœ€è¦ä½¿ç”¨ ActionBarDrawerToggleã€‚<br>æ¥ä¸‹æ¥ï¼Œåœ¨ä¸»Activityç±»ä¸­ï¼ŒsetupWithNavController() ä»ä¸»æ´»åŠ¨çš„onCreate()æ–¹æ³•è°ƒç”¨ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    val navController = findNavController(R.id.nav_host_fragment)</span><br><span class="line">    findViewById&lt;NavigationView&gt;(R.id.nav_view)</span><br><span class="line">        .setupWithNavController(navController)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="åº•éƒ¨å¯¼èˆª"><a href="#åº•éƒ¨å¯¼èˆª" class="headerlink" title="åº•éƒ¨å¯¼èˆª"></a>åº•éƒ¨å¯¼èˆª</h4><p>NavigationUIä¹Ÿå¯ä»¥å¤„ç†åº•éƒ¨å¯¼èˆªã€‚å½“ç”¨æˆ·é€‰æ‹©èœå•é¡¹æ—¶ï¼ŒNavControllerè°ƒç”¨ onNavDestinationSelected() å¹¶è‡ªåŠ¨æ›´æ–°åº•éƒ¨å¯¼èˆªæ ä¸­çš„æ‰€é€‰é¡¹ã€‚<br><img src="./images/bottom-navigation.png" alt="åº•éƒ¨å¯¼èˆª"><br>è¦åœ¨åº”ç”¨ä¸­åˆ›å»ºåº•éƒ¨å¯¼èˆªæ ï¼Œè¯·å…ˆåœ¨ä¸»è¦æ´»åŠ¨ä¸­å®šä¹‰æ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/nav_host_fragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.BottomNavigationView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/bottom_nav"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:menu</span>=<span class="string">"@menu/menu_bottom_nav"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨Activityä¸­ï¼ŒsetupWithNavController() ä»ä¸»æ´»åŠ¨çš„onCreate()æ–¹æ³•è°ƒç”¨ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    val navController = findNavController(R.id.nav_host_fragment)</span><br><span class="line">    findViewById&lt;BottomNavigationView&gt;(R.id.bottom_nav)</span><br><span class="line">        .setupWithNavController(navController)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åµŒå¥—å¯¼èˆªå›¾"><a href="#åµŒå¥—å¯¼èˆªå›¾" class="headerlink" title="åµŒå¥—å¯¼èˆªå›¾"></a>åµŒå¥—å¯¼èˆªå›¾</h3><p>å¯ä»¥å°†ä¸€ç³»åˆ—ç›®æ ‡åˆ†ç»„ä¸ºç§°ä¸ºæ ¹å›¾çš„çˆ¶å¯¼èˆªå›¾ä¸­çš„åµŒå¥—å›¾ã€‚ åµŒå¥—å›¾å¯¹äºç»„ç»‡å’Œé‡ç”¨åº”ç”¨ç¨‹åºUIçš„å„ä¸ªéƒ¨åˆ†éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚è‡ªåŒ…å«çš„ç™»å½•æµç¨‹ã€‚</p>
<p>åµŒå¥—å›¾å°è£…äº†å…¶ç›®æ ‡ã€‚ ä¸æ ¹å›¾ä¸€æ ·ï¼ŒåµŒå¥—å›¾å¿…é¡»å°†ç›®æ ‡æ ‡è¯†ä¸ºèµ·å§‹ç›®æ ‡ã€‚ åµŒå¥—å›¾å¤–éƒ¨çš„ç›®æ ‡ï¼ˆä¾‹å¦‚æ ¹å›¾ä¸Šçš„ç›®æ ‡ï¼‰ä»…é€šè¿‡å…¶èµ·å§‹ç›®æ ‡è®¿é—®åµŒå¥—å›¾ã€‚</p>
<p>å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ±‡æ¬¾åº”ç”¨ç¨‹åºçš„å¯¼èˆªå›¾ã€‚ ä»å·¦ä¾§çš„èµ·å§‹ç›®çš„åœ°å¼€å§‹ï¼Œå›¾è¡¨æœ‰ä¸¤ä¸ªæµç¨‹ï¼šä¸€ä¸ªæ²¿ç€é¡¶éƒ¨ç”¨äºå‘é€è´§å¸ï¼Œå¦ä¸€ä¸ªæ²¿ç€åº•éƒ¨ç”¨äºæŸ¥çœ‹å¸æˆ·ä½™é¢ã€‚<br><img src="./images/navigation-pre-nestedgraph_2x.png" alt="æ±‡æ¬¾å¯¼èˆªå›¾"><br>è¦å°†ç›®æ ‡åˆ†ç»„åˆ°åµŒå¥—å›¾ä¸­ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åœ¨å¯¼èˆªç¼–è¾‘å™¨ä¸­ï¼ŒæŒ‰ä½Shifté”®ï¼Œç„¶åå•å‡»è¦åŒ…å«åœ¨åµŒå¥—å›¾ä¸­çš„ç›®æ ‡ã€‚</li>
<li>å³é”®å•å‡»ä»¥æ‰“å¼€ä¸Šä¸‹æ–‡èœå•ï¼Œç„¶åé€‰æ‹© <strong>Move to Nested Graph &gt; New Graph</strong> ã€‚ç›®æ ‡åŒ…å«åœ¨åµŒå¥—å›¾ä¸­ã€‚å›¾æ˜¾ç¤ºäº† <strong>Navigation Editor</strong> ä¸­çš„åµŒå¥—å›¾ï¼š<br><img src="./images/navigation-nestedgraph_2x.png" alt="Graph Editorä¸­çš„åµŒå¥—å›¾"></li>
<li><p>å•å‡»åµŒå¥—å›¾ã€‚<strong>Attributes</strong> é¢æ¿ä¸­æ˜¾ç¤ºä»¥ä¸‹å±æ€§ ï¼š</p>
<ul>
<li>Typeï¼Œå…¶ä¸­åŒ…å«â€Nested Graphâ€</li>
<li>IDï¼ŒåŒ…å«åµŒå¥—å›¾çš„ç³»ç»Ÿåˆ†é…IDã€‚æ­¤IDç”¨äºå¼•ç”¨ä»£ç ä¸­çš„åµŒå¥—å›¾ã€‚</li>
</ul>
</li>
<li><p>åŒå‡»åµŒå¥—å›¾å½¢ä»¥æ˜¾ç¤ºå…¶ç›®æ ‡ã€‚</p>
</li>
<li><p>å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥åˆ‡æ¢åˆ°XMLè§†å›¾ã€‚å›¾è¡¨ä¸­æ·»åŠ äº†åµŒå¥—å¯¼èˆªå›¾ã€‚æ­¤å¯¼èˆªå›¾æœ‰è‡ªå·±çš„navigation å…ƒç´ ï¼Œä»¥åŠå®ƒè‡ªå·±çš„IDå’ŒstartDestinationæŒ‡å‘åµŒå¥—å›¾ä¸­ç¬¬ä¸€ä¸ªç›®æ ‡çš„å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;navigation xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    app:startDestination=&quot;@id/mainFragment&quot;&gt;</span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id=&quot;@+id/mainFragment&quot;</span><br><span class="line">        android:name=&quot;com.example.cashdog.cashdog.MainFragment&quot;</span><br><span class="line">        android:label=&quot;fragment_main&quot;</span><br><span class="line">        tools:layout=&quot;@layout/fragment_main&quot; &gt;</span><br><span class="line">        &lt;action</span><br><span class="line">            android:id=&quot;@+id/action_mainFragment_to_chooseRecipient&quot;</span><br><span class="line">            app:destination=&quot;@id/sendMoneyGraph&quot; /&gt;</span><br><span class="line">        &lt;action</span><br><span class="line">            android:id=&quot;@+id/action_mainFragment_to_viewBalanceFragment&quot;</span><br><span class="line">            app:destination=&quot;@id/viewBalanceFragment&quot; /&gt;</span><br><span class="line">    &lt;/fragment&gt;</span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id=&quot;@+id/viewBalanceFragment&quot;</span><br><span class="line">        android:name=&quot;com.example.cashdog.cashdog.ViewBalanceFragment&quot;</span><br><span class="line">        android:label=&quot;fragment_view_balance&quot;</span><br><span class="line">        tools:layout=&quot;@layout/fragment_view_balance&quot; /&gt;</span><br><span class="line">    &lt;navigation android:id=&quot;@+id/sendMoneyGraph&quot; app:startDestination=&quot;@id/chooseRecipient&quot;&gt;</span><br><span class="line">        &lt;fragment</span><br><span class="line">            android:id=&quot;@+id/chooseRecipient&quot;</span><br><span class="line">            android:name=&quot;com.example.cashdog.cashdog.ChooseRecipient&quot;</span><br><span class="line">            android:label=&quot;fragment_choose_recipient&quot;</span><br><span class="line">            tools:layout=&quot;@layout/fragment_choose_recipient&quot;&gt;</span><br><span class="line">            &lt;action</span><br><span class="line">                android:id=&quot;@+id/action_chooseRecipient_to_chooseAmountFragment&quot;</span><br><span class="line">                app:destination=&quot;@id/chooseAmountFragment&quot; /&gt;</span><br><span class="line">        &lt;/fragment&gt;</span><br><span class="line">        &lt;fragment</span><br><span class="line">            android:id=&quot;@+id/chooseAmountFragment&quot;</span><br><span class="line">            android:name=&quot;com.example.cashdog.cashdog.ChooseAmountFragment&quot;</span><br><span class="line">            android:label=&quot;fragment_choose_amount&quot;</span><br><span class="line">            tools:layout=&quot;@layout/fragment_choose_amount&quot; /&gt;</span><br><span class="line">    &lt;/navigation&gt;</span><br><span class="line">&lt;/navigation&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æ‚¨çš„ä»£ç ä¸­ï¼Œå°†è¿æ¥æ ¹å›¾çš„æ“ä½œçš„èµ„æºIDä¼ é€’ç»™åµŒå¥—å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.findNavController().navigate(R.id.action_mainFragment_to_sendMoneyGraph)</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿”å› <strong>Design</strong> é€‰é¡¹å¡ï¼Œå¯ä»¥é€šè¿‡å•å‡» <strong>Root</strong> è¿”å›åˆ°æ ¹å›¾ ã€‚</p>
</li>
</ol>
<h4 id="ä½¿ç”¨å¼•ç”¨å…¶ä»–å¯¼èˆªå›¾"><a href="#ä½¿ç”¨å¼•ç”¨å…¶ä»–å¯¼èˆªå›¾" class="headerlink" title="ä½¿ç”¨å¼•ç”¨å…¶ä»–å¯¼èˆªå›¾"></a>ä½¿ç”¨<include>å¼•ç”¨å…¶ä»–å¯¼èˆªå›¾</include></h4><p>åœ¨å¯¼èˆªå›¾ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨includeå¼•ç”¨å…¶ä»–å›¾å½¢ã€‚ è™½ç„¶è¿™åœ¨åŠŸèƒ½ä¸Šä¸ä½¿ç”¨åµŒå¥—å›¾ç›¸åŒï¼Œä½†includeå…è®¸æ‚¨ä½¿ç”¨å…¶ä»–é¡¹ç›®æ¨¡å—æˆ–åº“é¡¹ç›®ä¸­çš„å›¾å½¢ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- (root) nav_graph.xml --&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/nav_graph"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">"@id/fragment"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">app:graph</span>=<span class="string">"@navigation/included_graph"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/fragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.myapplication.BlankFragment"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"Fragment in Root Graph"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_blank"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/action_fragment_to_second_graph"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:destination</span>=<span class="string">"@id/second_graph"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- included_graph.xml --&gt;</span></span><br><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/second_graph"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:startDestination</span>=<span class="string">"@id/includedStart"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/includedStart"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"com.example.myapplication.IncludedStart"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:label</span>=<span class="string">"fragment_included_start"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:layout</span>=<span class="string">"@layout/fragment_included_start"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®ä¼ é€’"><a href="#æ•°æ®ä¼ é€’" class="headerlink" title="æ•°æ®ä¼ é€’"></a>æ•°æ®ä¼ é€’</h3><p>å¯¼èˆªå…è®¸æ‚¨é€šè¿‡å®šä¹‰ç›®æ ‡çš„å‚æ•°å°†æ•°æ®é™„åŠ åˆ°å¯¼èˆªæ“ä½œã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·é…ç½®æ–‡ä»¶ç›®æ ‡å¯èƒ½ä¼šä½¿ç”¨ç”¨æˆ·IDå‚æ•°æ¥ç¡®å®šè¦æ˜¾ç¤ºçš„ç”¨æˆ·ã€‚</p>
<p>é€šå¸¸ï¼Œæ‚¨åº”è¯¥æ›´å€¾å‘äºä»…åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’æœ€å°‘é‡çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæ‚¨åº”è¯¥ä¼ é€’ä¸€ä¸ªé”®æ¥æ£€ç´¢ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯ä¼ é€’è¯¥å¯¹è±¡æœ¬èº«ï¼Œå› ä¸ºæ‰€æœ‰å·²ä¿å­˜çŠ¶æ€çš„æ€»ç©ºé—´åœ¨Androidä¸Šæ˜¯æœ‰é™çš„ã€‚å¦‚æœéœ€è¦ä¼ é€’å¤§é‡æ•°æ®ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ç‰‡æ®µä¹‹é—´å…±äº«æ•°æ®ä¸­ViewModelæ‰€è¿°çš„æ–¹æ³• ã€‚</p>
<h4 id="å®šä¹‰ç›®æ ‡å‚æ•°"><a href="#å®šä¹‰ç›®æ ‡å‚æ•°" class="headerlink" title="å®šä¹‰ç›®æ ‡å‚æ•°"></a>å®šä¹‰ç›®æ ‡å‚æ•°</h4><p>è¦åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œé¦–å…ˆé€šè¿‡ä»¥ä¸‹æ­¥éª¤å°†å‚æ•°æ·»åŠ åˆ°æ¥æ”¶å®ƒçš„ç›®æ ‡æ¥å®šä¹‰å‚æ•°ï¼š</p>
<ol>
<li>åœ¨å¯¼èˆªç¼–è¾‘å™¨ä¸­ï¼Œå•å‡»æ¥æ”¶å‚æ•°çš„ç›®æ ‡ã€‚</li>
<li>åœ¨ <strong>Attributes</strong> é¢æ¿ä¸­ï¼Œå•å‡» <strong>Addï¼ˆ+ï¼‰</strong>ã€‚</li>
<li>åœ¨å‡ºç°çš„ <strong>Add Argument Link</strong> çª—å£ä¸­ï¼Œè¾“å…¥å‚æ•°åç§°ï¼Œå‚æ•°ç±»å‹ï¼Œå‚æ•°æ˜¯å¦å¯ä¸ºç©ºï¼Œä»¥åŠé»˜è®¤å€¼ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚</li>
<li>å•å‡» <strong>Add</strong> ã€‚è¯·æ³¨æ„ï¼Œè¯¥å‚æ•°ç°åœ¨æ˜¾ç¤º åœ¨ <strong>Arguments</strong> é¢æ¿çš„ <strong>Attributes</strong> åˆ—è¡¨ä¸­ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œå•å‡»å°†æ‚¨å¸¦åˆ°æ­¤ç›®çš„åœ°çš„ç›¸åº”æ“ä½œã€‚åœ¨ <strong>Attributes</strong> é¢æ¿ä¸­ï¼Œæ‚¨ç°åœ¨åº”è¯¥åœ¨  <strong>Argument Default Values</strong> éƒ¨åˆ†ä¸­çœ‹åˆ°æ–°æ·»åŠ çš„å‚æ•°ã€‚</li>
<li>æ‚¨è¿˜å¯ä»¥çœ‹åˆ°è¯¥å‚æ•°æ˜¯ä»¥XMLæ ¼å¼æ·»åŠ çš„ã€‚å•å‡» <strong>Text</strong> é€‰é¡¹å¡ä»¥åˆ‡æ¢åˆ°XMLè§†å›¾ï¼Œå¹¶æ³¨æ„æ‚¨çš„å‚æ•°å·²æ·»åŠ åˆ°æ¥æ”¶å‚æ•°çš„ç›®æ ‡ã€‚ä¸€ä¸ªä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fragment</span> <span class="attr">android:id</span>=<span class="string">"@+id/myFragment"</span> &gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">argument</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:name</span>=<span class="string">"myArg"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">app:argType</span>=<span class="string">"integer"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:defaultValue</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">fragment</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="è¦†ç›–æ“ä½œä¸­çš„ç›®æ ‡å‚æ•°"><a href="#è¦†ç›–æ“ä½œä¸­çš„ç›®æ ‡å‚æ•°" class="headerlink" title="è¦†ç›–æ“ä½œä¸­çš„ç›®æ ‡å‚æ•°"></a>è¦†ç›–æ“ä½œä¸­çš„ç›®æ ‡å‚æ•°</h4><p>ç›®æ ‡çº§å‚æ•°å’Œé»˜è®¤å€¼ç”±å¯¼èˆªåˆ°ç›®æ ‡çš„æ‰€æœ‰æ“ä½œä½¿ç”¨ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨æ“ä½œçº§åˆ«å®šä¹‰å‚æ•°æ¥è¦†ç›–å‚æ•°çš„é»˜è®¤å€¼ï¼ˆå¦‚æœå°šä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®ä¸€ä¸ªå‚æ•°ï¼‰ã€‚æ­¤å‚æ•°å¿…é¡»ä¸ç›®æ ‡ä¸­å£°æ˜çš„å‚æ•° <strong>å…·æœ‰ç›¸åŒçš„åç§°å’Œç±»å‹</strong> ã€‚</p>
<p>ä¸‹é¢çš„XMLå£°æ˜äº†ä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„æ“ä½œï¼Œè¯¥å‚æ•°è¦†ç›–äº†ä¸Šé¢ç¤ºä¾‹ä¸­çš„ç›®æ ‡çº§å‚æ•°ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">android:id</span>=<span class="string">"@+id/startMyFragment"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:destination</span>=<span class="string">"@+id/myFragment"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">argument</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">"myArg"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">app:argType</span>=<span class="string">"integer"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:defaultValue</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h4 id="ä½¿ç”¨Safe-Argsä¼ é€’ç±»å‹å®‰å…¨çš„æ•°æ®"><a href="#ä½¿ç”¨Safe-Argsä¼ é€’ç±»å‹å®‰å…¨çš„æ•°æ®" class="headerlink" title="ä½¿ç”¨Safe Argsä¼ é€’ç±»å‹å®‰å…¨çš„æ•°æ®"></a>ä½¿ç”¨Safe Argsä¼ é€’ç±»å‹å®‰å…¨çš„æ•°æ®</h4><p>Navigation Architecture Componentæœ‰ä¸€ä¸ªåä¸ºSafe Argsçš„Gradleæ’ä»¶ï¼Œå®ƒç”Ÿæˆç®€å•çš„å¯¹è±¡å’Œæ„å»ºå™¨ç±»ï¼Œä»¥ä¾¿å¯¹ç›®æ ‡å’Œæ“ä½œæŒ‡å®šçš„å‚æ•°è¿›è¡Œç±»å‹å®‰å…¨è®¿é—®ã€‚</p>
<p>è¦ä½¿ç”¨Safe Argsï¼Œè¯·å…ˆå°†androidx.navigation.safeargsæ’ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„build.gradleæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'com.android.application'</span></span><br><span class="line">apply plugin: <span class="string">'androidx.navigation.safeargs'</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¾‹å¤–è¿˜éœ€åœ¨é¡¹ç›®build.gradleä¸­æ·»åŠ ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classpath &quot;android.arch.navigation:navigation-safe-args-gradle-plugin:1.0.0-alpha09&quot;</span><br></pre></td></tr></table></figure></p>
<p>å¯ç”¨æ’ä»¶åï¼Œç”Ÿæˆçš„ä»£ç åŒ…å«æ“ä½œçš„å…¶ä»–ç®€å•å¯¹è±¡å’Œæ„å»ºå™¨ç±»ä»¥åŠå‘é€å’Œæ¥æ”¶ç›®æ ‡ã€‚è¿™äº›ç±»æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸ºåŠ¨ä½œå‘èµ·çš„æ¯ä¸ªç›®æ ‡åˆ›å»ºä¸€ä¸ªç±»ã€‚æ­¤ç±»çš„åç§°æ˜¯å§‹å‘ç›®æ ‡çš„åç§°ï¼Œåé¢é™„åŠ  <strong>â€œDirectionsâ€</strong> ä¸€è¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå§‹å‘ç›®æ ‡æ˜¯å·²å‘½åçš„ç‰‡æ®µï¼ŒSpecifyAmountFragmentåˆ™å°†è°ƒç”¨ç”Ÿæˆçš„ç±» SpecifyAmountFragmentDirectionsã€‚</li>
<li>æ­¤ç±»å…·æœ‰é’ˆå¯¹å§‹å‘ç›®æ ‡ä¸­å®šä¹‰çš„æ¯ä¸ªæ“ä½œçš„æ–¹æ³•ã€‚</li>
<li>å¯¹äºç”¨äºä¼ é€’å‚æ•°çš„æ¯ä¸ªæ“ä½œï¼Œå°†åˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå…¶åç§°åŸºäºæ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœè°ƒç”¨confirmationAction,è¯¥æ“ä½œ ï¼Œåˆ™å‘½åè¯¥ç±»ConfirmationActionã€‚</li>
<li>ä¸ºæ¥æ”¶ç›®æ ‡åˆ›å»ºä¸€ä¸ªç±»ã€‚æ­¤ç±»çš„åç§°æ˜¯ç›®æ ‡çš„åç§°ï¼Œåé¢é™„åŠ å•è¯â€œArgsâ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå‘½åç›®æ ‡ç‰‡æ®µï¼ŒConfirmationFragment,åˆ™è°ƒç”¨ç”Ÿæˆçš„ç±»ConfirmationFragmentArgsã€‚ä½¿ç”¨æ­¤ç±»çš„fromBundle()æ–¹æ³•æ¥æ£€ç´¢å‚æ•°ã€‚</li>
</ul>
<p>ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹æ³•è®¾ç½®å‚æ•°å¹¶å°†å…¶ä¼ é€’ç»™navigate() æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override fun <span class="title">onClick</span><span class="params">(v: View)</span> </span>&#123;</span><br><span class="line">   val amountTv: EditText = view!!.findViewById(R.id.editTextAmount)</span><br><span class="line">   val amount = amountTv.text.toString().toInt()</span><br><span class="line">   val action = SpecifyAmountFragmentDirections.confirmationAction(amount)</span><br><span class="line">   v.findNavController().navigate(action)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨æ¥æ”¶ç›®æ ‡çš„ä»£ç ä¸­ï¼Œä½¿ç”¨è¯¥ getArguments()æ–¹æ³•æ£€ç´¢åŒ…å¹¶ä½¿ç”¨å…¶å†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">override fun <span class="title">onViewCreated</span><span class="params">(view: View, savedInstanceState: Bundle?)</span> </span>&#123;</span><br><span class="line">    val tv: TextView = view.findViewById(R.id.textViewAmount)</span><br><span class="line">    val amount = ConfirmationFragmentArgs.fromBundle(arguments).amount</span><br><span class="line">    tv.text = amount.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨å…·æœ‰å…¨å±€æ“ä½œçš„Safe-Args"><a href="#ä½¿ç”¨å…·æœ‰å…¨å±€æ“ä½œçš„Safe-Args" class="headerlink" title="ä½¿ç”¨å…·æœ‰å…¨å±€æ“ä½œçš„Safe Args"></a>ä½¿ç”¨å…·æœ‰å…¨å±€æ“ä½œçš„Safe Args</h5><p>ä½¿ç”¨å…·æœ‰å…¨å±€æ“ä½œçš„ Safe Argsæ—¶ ï¼Œå¿…é¡»ä¸ºandroid:idæ ¹<navigation>å…ƒç´ æä¾›å€¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/main_nav"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:startDestination</span>=<span class="string">"@id/mainFragment"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure></navigation></p>
<p>å¯¼èˆªä¸ºåŸºäºè¯¥å€¼Directionsçš„<navigation>å…ƒç´ ç”Ÿæˆä¸€ä¸ªç±»android:idã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ª<navigation> å…ƒç´ android:id=@+id/main_navï¼Œåˆ™è°ƒç”¨ç”Ÿæˆçš„ç±» MainNavDirectionsã€‚<navigation>å…ƒç´ ä¸­çš„æ‰€æœ‰ç›®æ ‡éƒ½æ‰©å±•äº†MainNavDirectionsç±»ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸ä¸Šä¸€èŠ‚ä¸­æè¿°çš„æ–¹æ³•ç›¸åŒçš„æ–¹æ³•è®¿é—®æ‰€æœ‰å…³è”çš„å…¨å±€æ“ä½œã€‚</navigation></navigation></navigation></p>
<h4 id="ä½¿ç”¨Bundleå¯¹è±¡åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’æ•°æ®"><a href="#ä½¿ç”¨Bundleå¯¹è±¡åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’æ•°æ®" class="headerlink" title="ä½¿ç”¨Bundleå¯¹è±¡åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’æ•°æ®"></a>ä½¿ç”¨Bundleå¯¹è±¡åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’æ•°æ®</h4><p>å¦‚æœæ‚¨ä¸ä½¿ç”¨Gradleï¼Œåˆ™ä»å¯ä»¥ä½¿ç”¨Bundleå¯¹è±¡åœ¨ç›®æ ‡ä¹‹é—´ä¼ é€’å‚æ•°ã€‚ä½¿ç”¨åˆ›å»ºBundleå¯¹è±¡å¹¶å°†å…¶ä¼ é€’åˆ°ç›®æ ‡navigate()ï¼Œå¦‚ä¸‹æ‰€ç¤º<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var bundle = bundleOf(<span class="string">"amount"</span> to amount)</span><br><span class="line">view.findNavController().navigate(R.id.confirmationAction, bundle)</span><br></pre></td></tr></table></figure></p>
<p>åœ¨æ¥æ”¶ç›®æ ‡çš„ä»£ç ä¸­ï¼Œä½¿ç”¨è¯¥ getArguments()æ–¹æ³•æ£€ç´¢Bundleå¹¶ä½¿ç”¨å…¶å†…å®¹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val tv = view.findViewById&lt;TextView&gt;(R.id.textViewAmount)</span><br><span class="line">tv.text = arguments.getString(<span class="string">"amount"</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="æ”¯æŒ"><a href="#æ”¯æŒ" class="headerlink" title="æ”¯æŒ"></a>æ”¯æŒ</h3><p>æ·»åŠ å¯¹æ–°ç›®æ ‡ç±»å‹çš„æ”¯æŒ<br>NavControllersä¾é ä¸€ä¸ªæˆ–å¤šä¸ªNavigatorå¯¹è±¡æ¥æ‰§è¡Œå¯¼èˆªæ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ NavControllersæ”¯æŒé€šè¿‡ä½¿ç”¨ActivityNavigator ç±»åŠå…¶åµŒå¥— ActivityNavigator.Destination ç±»å¯¼èˆªåˆ°å¦ä¸€ä¸ªæ´»åŠ¨è€Œç¦»å¼€å¯¼èˆªå›¾ ã€‚ä¸ºäº†èƒ½å¤Ÿå¯¼èˆªåˆ°ä»»ä½•å…¶ä»–ç±»å‹çš„ç›®æ ‡ï¼ŒNavigatorå¿…é¡»å°†ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å¯¹è±¡æ·»åŠ åˆ° NavControllerã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ç‰‡æ®µä½œä¸ºç›®æ ‡æ—¶ï¼Œä¼š NavHostFragment è‡ªåŠ¨å°†FragmentNavigator ç±»æ·»åŠ åˆ°å…¶ä¸­ NavControllerã€‚</p>
<p>è¦å‘aæ·»åŠ æ–°çš„Navigatorå¯¹è±¡ NavControllerï¼Œå¿…é¡»ä½¿ç”¨ç›¸åº”çš„Navigatorç±»çš„ getNavigatorProvider()æ–¹æ³•ï¼Œç„¶åä½¿ç”¨ç±»çš„addNavigator()æ–¹æ³•ã€‚ä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†å°†è™šæ„CustomNavigator å¯¹è±¡æ·»åŠ åˆ°ä»¥ä¸‹å†…å®¹çš„ç¤ºä¾‹NavControllerï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val customNavigator = CustomNavigator()</span><br><span class="line">navController.navigatorProvider += customNavigator</span><br></pre></td></tr></table></figure></p>
<p>å¤§å¤šæ•°Navigator ç±»éƒ½æœ‰ä¸€ä¸ªåµŒå¥—çš„ç›®æ ‡å­ç±»ã€‚æ­¤å­ç±»å¯ç”¨äºæŒ‡å®šç›®æ ‡å”¯ä¸€çš„å…¶ä»–å±æ€§ã€‚æœ‰å…³Destinationå­ç±»çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç›¸åº”Navigatorç±»çš„å‚è€ƒæ–‡æ¡£ ã€‚</p>
<h3 id="æ¡ä»¶å¯¼èˆª"><a href="#æ¡ä»¶å¯¼èˆª" class="headerlink" title="æ¡ä»¶å¯¼èˆª"></a>æ¡ä»¶å¯¼èˆª</h3><p>æ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½æœ‰ä¸€ç³»åˆ—æ¡ä»¶ç›®æ ‡ï¼Œè¿™äº›ç›®æ ‡ä»…åœ¨æŸäº›æ¡ä»¶ä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚å½“ç”¨æˆ·éœ€è¦ç™»å½•æ—¶ã€‚è¿™äº›ç›®æ ‡åº”åˆ›å»ºä¸ºå•ç‹¬çš„ç›®æ ‡ï¼Œæˆ–åµŒå¥—å¯¼èˆªå›¾ï¼Œå¦ä¸€ä¸ªç›®æ ‡ä½œä¸ºå¦ä¸€ä¸ªç›®æ ‡å¯åŠ¨éœ€è¦ã€‚å›¾1æ˜¾ç¤ºäº†å¯¼èˆªåˆ°é…ç½®æ–‡ä»¶ç›®çš„åœ°çš„ç”¨æˆ·ï¼Œè¯¥é…ç½®æ–‡ä»¶ç›®çš„åœ°ç¡®å®šç”¨æˆ·æœªç™»å½•åï¼Œè¦æ±‚ç”¨æˆ·å¯¼èˆªåˆ°ç™»å½•ç›®çš„åœ°ã€‚ç™»å½•ç›®çš„åœ°ç„¶ååœ¨ç™»å½•å®Œæˆåå°†ç”¨æˆ·è¿”å›åˆ°é…ç½®æ–‡ä»¶ç›®çš„åœ°ã€‚<br><img src="./images/navigation-conditional-graph.png" alt=""><br>ç™»å½•ç›®æ ‡åº”åœ¨è¿”å›åˆ°é…ç½®æ–‡ä»¶ç›®æ ‡åä»å¯¼èˆªå †æ ˆä¸­å¼¹å‡ºã€‚popBackStack() å¯¼èˆªå›åŸå§‹ç›®çš„åœ°æ—¶è°ƒç”¨ æ–¹æ³•ã€‚åŸå§‹ç›®æ ‡å°†ä»å¯¼èˆªå †æ ˆâ€œå¼¹å‡ºâ€å¹¶å˜ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚</p>
<h3 id="å…¨å±€å¯¼èˆª"><a href="#å…¨å±€å¯¼èˆª" class="headerlink" title="å…¨å±€å¯¼èˆª"></a>å…¨å±€å¯¼èˆª</h3><p>æ‚¨å¯ä»¥ä½¿ç”¨å…¨å±€æ“ä½œæ¥åˆ›å»ºå¤šä¸ªç›®æ ‡å¯ä»¥ä½¿ç”¨çš„å…¬å…±æ“ä½œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä¸åŒç›®çš„åœ°çš„æŒ‰é’®å¯¼èˆªåˆ°åŒä¸€ä¸»åº”ç”¨ç¨‹åºå±å¹•ã€‚</p>
<p>å¯¼èˆªç¼–è¾‘å™¨ä¸­çš„ä¸€ä¸ªå…¨å±€æ“ä½œç”±æŒ‡å‘å…³è”ç›®æ ‡çš„å°ç®­å¤´è¡¨ç¤ºï¼Œå¦‚å›¾1æ‰€ç¤º<br><img src="./images/navigation-global-action.png" alt="å¯¼å…¥åµŒå¥—å›¾çš„å…¨å±€æ“ä½œ"></p>
<h4 id="åˆ›å»ºä¸€ä¸ªå…¨å±€è¡ŒåŠ¨"><a href="#åˆ›å»ºä¸€ä¸ªå…¨å±€è¡ŒåŠ¨" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå…¨å±€è¡ŒåŠ¨"></a>åˆ›å»ºä¸€ä¸ªå…¨å±€è¡ŒåŠ¨</h4><p>è¦åˆ›å»ºå…¨å±€æ“ä½œï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>åœ¨â€œ æ›²çº¿å›¾ç¼–è¾‘å™¨â€ä¸­ï¼Œå•å‡»ç›®æ ‡ä»¥çªå‡ºæ˜¾ç¤ºå®ƒã€‚</li>
<li>å³é”®å•å‡»ç›®æ ‡ä»¥æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå•ã€‚</li>
<li>é€‰æ‹©æ·»åŠ æ“ä½œ&gt;å…¨å±€ã€‚ç®­å¤´ï¼ˆï¼‰å‡ºç°åœ¨ç›®çš„åœ°çš„å·¦ä¾§ã€‚</li>
<li>å•å‡»â€œ æ–‡æœ¬â€é€‰é¡¹å¡ä»¥å¯¼èˆªåˆ°XMLæ–‡æœ¬è§†å›¾ã€‚å…¨å±€æ“ä½œçš„XMLç±»ä¼¼äºä»¥ä¸‹å†…å®¹ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;navigation xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">            xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">            xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">            android:id=&quot;@+id/main_nav&quot;</span><br><span class="line">            app:startDestination=&quot;@id/mainFragment&quot;&gt;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  &lt;action android:id=&quot;@+id/action_global_mainFragment&quot;</span><br><span class="line">          app:destination=&quot;@id/mainFragment&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/navigation&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="ä½¿ç”¨å…¨å±€æ“ä½œ"><a href="#ä½¿ç”¨å…¨å±€æ“ä½œ" class="headerlink" title="ä½¿ç”¨å…¨å±€æ“ä½œ"></a>ä½¿ç”¨å…¨å±€æ“ä½œ</h4><p>è¦åœ¨ä»£ç ä¸­ä½¿ç”¨å…¨å±€æ“ä½œï¼Œè¯·å°†å…¨å±€æ“ä½œçš„èµ„æºIDä¼ é€’navigate() ç»™æ¯ä¸ªUIå…ƒç´ çš„æ–¹æ³•ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewTransactionButton.setOnClickListener &#123; view -&gt;</span><br><span class="line">    view.findNavController().navigate(R.id.action_global_mainFragment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿ç§»åˆ°å¯¼èˆª"><a href="#è¿ç§»åˆ°å¯¼èˆª" class="headerlink" title="è¿ç§»åˆ°å¯¼èˆª"></a>è¿ç§»åˆ°å¯¼èˆª</h3><p>è¯¥NavControllerå¯¼èˆªå›¾åŠå…¶å¯¼èˆªå›¾åŒ…å«åœ¨å•ä¸ªæ´»åŠ¨ä¸­ã€‚å› æ­¤ï¼Œåœ¨è¿ç§»ç°æœ‰é¡¹ç›®ä»¥ä½¿ç”¨å¯¼èˆªæ¶æ„ç»„ä»¶æ—¶ï¼Œè¯·é€šè¿‡ä¸ºæ¯ä¸ªæ´»åŠ¨ä¸­çš„ç›®æ ‡åˆ›å»ºå¯¼èˆªå›¾ï¼Œé‡ç‚¹å…³æ³¨ä¸€æ¬¡è¿ç§»ä¸€ä¸ªæ´»åŠ¨ã€‚<br><img src="./images/navigation-migrate1.png" alt="æ´»åŠ¨åŠå…¶å„ä¸ªå¯¼èˆªå›¾"><br>ç„¶åï¼Œå¯ä»¥é€šè¿‡å‘å¯¼èˆªå›¾æ·»åŠ æ´»åŠ¨ç›®æ ‡æ¥é“¾æ¥å•ç‹¬çš„æ´»åŠ¨ï¼Œä»è€Œæ›¿æ¢startActivity()æ•´ä¸ªä»£ç åº“ä¸­çš„ç°æœ‰ç”¨æ³•ã€‚</p>
<p><img src="./images/navigation-migrate2.png" alt="ä¸€ä¸ªActivityä¸­çš„å¯¼èˆªå›¾æŒ‡å‘ç¬¬äºŒä¸ªActivity"><br>åœ¨å¤šä¸ªæ´»åŠ¨å…±äº«ç›¸åŒå¸ƒå±€çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»„åˆå¯¼èˆªå›¾ï¼Œå°†å¯¼èˆªè°ƒç”¨æ›¿æ¢ä¸ºæ´»åŠ¨ç›®æ ‡ï¼Œä»¥ç›´æ¥åœ¨ä¸¤ä¸ªå¯¼èˆªå›¾ä¹‹é—´å¯¼èˆªè°ƒç”¨ã€‚</p>
<p><img src="./images/navigation-migrate3.png" alt="åŒ…å«ç»„åˆå¯¼èˆªå›¾çš„æ´»åŠ¨ã€‚"></p>
<p>å‚è€ƒï¼š<br>[1]. å®˜ç½‘ <a href="https://developer.android.com/topic/libraries/architecture/navigation/" target="_blank" rel="noopener">https://developer.android.com/topic/libraries/architecture/navigation/</a><br>[2]. å®˜ç½‘demo <a href="https://github.com/googlecodelabs/android-navigation" target="_blank" rel="noopener">https://github.com/googlecodelabs/android-navigation</a><br>[3]. å®˜ç½‘æ•™ç¨‹ <a href="https://codelabs.developers.google.com/codelabs/android-navigation/#0" target="_blank" rel="noopener">https://codelabs.developers.google.com/codelabs/android-navigation/#0</a><br>[4]. å…³äºnavigationçš„è§£æ <a href="https://www.jianshu.com/p/ad040aab0e66" target="_blank" rel="noopener">https://www.jianshu.com/p/ad040aab0e66</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/12/24/SpringBoot-Database-H2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/24/SpringBoot-Database-H2/" itemprop="url">SpringBoot Database H2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-12-24T15:03:13+08:00">
                2018-12-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>  å†…å­˜æ•°æ®åº“ï¼ˆEmbedded databaseæˆ–in-momery databaseï¼‰å…·æœ‰é…ç½®ç®€å•ã€å¯åŠ¨é€Ÿåº¦å¿«ã€å°¤å…¶æ˜¯å…¶å¯æµ‹è¯•æ€§ç­‰ä¼˜ç‚¹ï¼Œä½¿å…¶æˆä¸ºå¼€å‘è¿‡ç¨‹ä¸­éå¸¸æœ‰ç”¨çš„è½»é‡çº§æ•°æ®åº“ã€‚åœ¨springä¸­æ”¯æŒHSQLã€H2å’ŒDerbyä¸‰ç§æ•°æ®åº“ã€‚H2æ˜¯Thomas Muelleræä¾›çš„ä¸€ä¸ªå¼€æºçš„ã€çº¯javaå®ç°çš„å…³ç³»æ•°æ®åº“ã€‚</p>
<p>å„æ•°æ®åº“ç‰¹æ€§å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>H2</th>
<th>Derby</th>
<th>HSQLDB</th>
<th>MySQL</th>
<th style="text-align:left">PostgreSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>Pure Java</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td>Memory Mode</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td>Encrypted Database</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td style="text-align:left">No</td>
</tr>
<tr>
<td>ODBC Driver</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td>Fulltext Search</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td>Multi Version Concurrency</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td style="text-align:left">Yes</td>
</tr>
<tr>
<td>Footprint (jar/dll size)</td>
<td>~1 MB</td>
<td>~2 MB</td>
<td>~1 MB</td>
<td>~4 MB</td>
<td style="text-align:left">~6 MB</td>
</tr>
</tbody>
</table>
<h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ul>
<li>JDK 1.8æˆ–æ›´é«˜ç‰ˆæœ¬</li>
<li>Maven 3.5æˆ–æ›´é«˜ç‰ˆæœ¬</li>
</ul>
<h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><ul>
<li>Spring Data JPA</li>
<li>Spring Boot</li>
</ul>
<h2 id="é¡¹ç›®ç›®å½•ç»“æ„"><a href="#é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="é¡¹ç›®ç›®å½•ç»“æ„"></a>é¡¹ç›®ç›®å½•ç»“æ„</h2><p><img src="./images/project_package.png" alt="é¡¹ç›®ç›®å½•ç»“æ„"></p>
<h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mugwort<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Spring webå¼€å‘ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æ•°æ®åº“ä¾èµ– --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- h2 åµŒå…¥å¼æ•°æ®åº“ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jpa ä¾èµ–ï¼ŒæŒä¹…åŒ–æ“ä½œä¾èµ– --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.persistence.Column;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String lastaudit;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"id"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastaudit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastaudit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastaudit</span><span class="params">(String lastaudit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastaudit = lastaudit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id + <span class="string">" | "</span> + name + <span class="string">" | "</span> + lastaudit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>@Id  å£°æ˜æ­¤å±æ€§ä¸ºä¸»é”®ã€‚è¯¥å±æ€§å€¼å¯ä»¥é€šè¿‡åº”è¯¥è‡ªèº«åˆ›å»ºï¼Œä½†æ˜¯Hibernateæ¨èé€šè¿‡Hibernateç”Ÿæˆï¼›</li>
<li>@GeneratedValue<br>æŒ‡å®šä¸»é”®çš„ç”Ÿæˆç­–ç•¥ã€‚<ul>
<li>TABLEï¼šä½¿ç”¨è¡¨ä¿å­˜idå€¼ï¼›</li>
<li>IDENTITYï¼šidentitycolumnï¼›</li>
<li>SEQUENCR ï¼šsequenceï¼›</li>
<li>AUTOï¼šæ ¹æ®æ•°æ®åº“çš„ä¸åŒä½¿ç”¨ä¸Šé¢ä¸‰ä¸ªï¼Œé»˜è®¤å€¼ï¼›</li>
</ul>
</li>
<li>@Column å£°æ˜è¯¥å±æ€§ä¸æ•°æ®åº“å­—æ®µçš„æ˜ å°„å…³ç³»ã€‚</li>
</ul>
<h3 id="æ•°æ®åº“æ“ä½œ"><a href="#æ•°æ®åº“æ“ä½œ" class="headerlink" title="æ•°æ®åº“æ“ä½œ"></a>æ•°æ®åº“æ“ä½œ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SystemRepository</span> <span class="keyword">extends</span> <span class="title">CrudRepository</span>&lt;<span class="title">SystemBean</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring Data JPAåŒ…å«äº†ä¸€äº›å†…ç½®çš„Repositoryï¼Œå®ç°äº†ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼šfindoneï¼Œfindallï¼Œsaveç­‰ã€‚</p>
<h3 id="åº”ç”¨é…ç½®"><a href="#åº”ç”¨é…ç½®" class="headerlink" title="åº”ç”¨é…ç½®"></a>åº”ç”¨é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####</span></span><br><span class="line"><span class="string">spring.application.name=Bootstrap</span> <span class="string">Spring</span> <span class="string">boot</span> <span class="string">web</span> <span class="string">with</span> <span class="string">H2</span></span><br><span class="line"><span class="comment">### jpa åªè¿›è¡Œæ›´æ–°,é»˜è®¤æ˜¯å¯åŠ¨çš„æ—¶å€™ä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€å°±åˆ é™¤åŸæ¥çš„è¡¨ç»“æ„é‡æ–°ç”Ÿæˆ</span></span><br><span class="line"><span class="string">spring.jpa.hibernate.ddl-auto=update</span></span><br><span class="line"><span class="string">spring.jpa.database-platform=org.hibernate.dialect.H2Dialect</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#æ˜¾ç¤ºSQLè¯­å¥</span></span><br><span class="line"><span class="string">spring.jpa.show-sql=true</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># æ¯æ¬¡å¯åŠ¨ç¨‹åºï¼Œç¨‹åºéƒ½ä¼šè¿è¡Œresources/db/schema.sqlæ–‡ä»¶ï¼Œå¯¹æ•°æ®åº“çš„ç»“æ„è¿›è¡Œæ“ä½œã€‚</span></span><br><span class="line"><span class="string">spring.datasource.schema=classpath:schema.sql</span></span><br><span class="line"><span class="comment"># æ¯æ¬¡å¯åŠ¨ç¨‹åºï¼Œç¨‹åºéƒ½ä¼šè¿è¡Œresources/db/data.sqlæ–‡ä»¶ï¼Œå¯¹æ•°æ®åº“çš„æ•°æ®æ“ä½œã€‚</span></span><br><span class="line"><span class="string">spring.datasource.data=classpath:data.sql</span></span><br><span class="line"><span class="comment">#### é©±åŠ¨ç±»</span></span><br><span class="line"><span class="comment">#spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">#When using database URLs like jdbc:h2:~/test, the database is stored in the user directory. For Windows, this is usually C:\Documents and #Settings\&lt;userName&gt; or C:\Users\&lt;userName&gt;. If the base directory is not set (as in jdbc:h2:./test), the database files are stored in the directory where #the application is started (the current working directory). When using the H2 Console application from the start menu, this is &lt;Installation Directory&gt;/#bin. The base directory can be set in the database URL. A fixed or relative path can be used. When using the URL jdbc:h2:file:./data/sample, the database #is stored in the directory data (relative to the current working directory). The directory is created automatically if it does not yet exist. It is also #possible to use the fully qualified directory name (and for Windows, drive name). Example: jdbc:h2:file:C:/data/test</span></span><br><span class="line"><span class="comment">####===== connect to  ======</span></span><br><span class="line"><span class="comment">##è¿™é‡Œè®¾ç½®çš„æ˜¯æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜</span></span><br><span class="line"><span class="string">spring.datasource.url=jdbc:h2:mem:h2test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE</span></span><br><span class="line"><span class="string">spring.datasource.driver-class-name=org.h2.Driver</span></span><br><span class="line"><span class="string">spring.datasource.name=sa</span></span><br><span class="line"><span class="string">spring.datasource.password=</span></span><br><span class="line"><span class="string">spring.datasource.platform=h2</span></span><br><span class="line"><span class="comment">### h2 properties</span></span><br><span class="line"><span class="string">spring.h2.console.path=/console</span></span><br><span class="line"><span class="string">spring.h2.console.enabled=true</span></span><br><span class="line"><span class="comment">###### web è®¿é—®æ¥å£</span></span><br><span class="line"><span class="string">server.port=8081</span></span><br><span class="line"><span class="comment">### æ—¥å¿—</span></span><br><span class="line"><span class="string">logging.level.root=info</span></span><br></pre></td></tr></table></figure>
<p>åœ¨application.propertiesæ–‡ä»¶ä¸­å¯¹æ•°æ®åº“è¿›è¡Œè¿æ¥é…ç½®</p>
<p>spring.datasource.url=jdbc:h2:mem:h2testï¼Œé…ç½®h2æ•°æ®åº“çš„è¿æ¥åœ°å€<br>spring.datasource.driver-class-name=org.h2.Driverï¼Œé…ç½®JDBC Driver<br>spring.datasource.username=saï¼Œé…ç½®æ•°æ®åº“ç”¨æˆ·å<br>spring.datasource.password=ï¼Œé…ç½®æ•°æ®åº“å¯†ç </p>
<p>å½“ä½ å®Œæˆä¾èµ–å’Œè¿æ¥é…ç½®è¿™ä¸¤æ­¥ä¹‹åï¼Œä½ å°±å¯ä»¥åœ¨ç¨‹åºç§ä½¿ç”¨h2äº†ã€‚springä¼šè‡ªåŠ¨å¸®ä½ å®ŒæˆDataSourceçš„æ³¨å…¥ã€‚</p>
<h4 id="æ•°æ®åˆå§‹åŒ–é…ç½®"><a href="#æ•°æ®åˆå§‹åŒ–é…ç½®" class="headerlink" title="æ•°æ®åˆå§‹åŒ–é…ç½®"></a>æ•°æ®åˆå§‹åŒ–é…ç½®</h4><p>å¦‚æœä½ éœ€è¦åœ¨ç¨‹åºå¯åŠ¨æ—¶å¯¹æ•°æ®åº“è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œåˆ™åœ¨application.propertiesæ–‡ä»¶ä¸­å¯¹æ•°æ®åº“è¿›æ¥é…ç½®</p>
<p>spring.datasource.schema=classpath:schema.sqlï¼Œè¿›è¡Œè¯¥é…ç½®åï¼Œæ¯æ¬¡å¯åŠ¨ç¨‹åºï¼Œç¨‹åºéƒ½ä¼šè¿è¡Œresources/schema.sqlæ–‡ä»¶ï¼Œå¯¹æ•°æ®åº“çš„ç»“æ„è¿›è¡Œæ“ä½œã€‚<br>spring.datasource.data=classpath:data.sql,è¿›è¡Œè¯¥é…ç½®åï¼Œæ¯æ¬¡å¯åŠ¨ç¨‹åºï¼Œç¨‹åºéƒ½ä¼šè¿è¡Œresources/data.sqlæ–‡ä»¶ï¼Œå¯¹æ•°æ®åº“çš„æ•°æ®æ“ä½œã€‚</p>
<p>è¯¥é…ç½®éå¸¸é€‚åˆå¼€å‘ç¯å¢ƒï¼Œæˆ‘ä¼šæŠŠæ•°æ®åº“çš„ç»“æ„æ„å»ºsqlæ”¾åœ¨resources/schema.sqlï¼Œæ•°æ®sqlæ”¾åœ¨resources/data.sqlä¸­ã€‚è¿™æ ·æ¯æ¬¡è¿è¡Œç¨‹åºæˆ‘éƒ½å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ–°çš„æ•°æ®åº“ã€‚è¿™æ ·å°±ä¸éœ€è¦æˆ‘æ¯æ¬¡ä¸ºäº†æµ‹è¯•è€Œä¿®æ”¹æ•°æ®ä¸­çš„å†…å®¹äº†ã€‚<br>schema.sqlä»£ç ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span>  <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span>  system_bean;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> system_bean(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line"><span class="keyword">name</span>  <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">not</span> <span class="literal">null</span> ,</span><br><span class="line">lastaudit <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">primary <span class="keyword">key</span>  (<span class="keyword">id</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>data.sqlä»£ç ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> system_bean(<span class="keyword">name</span>,lastaudit)<span class="keyword">VALUES</span>(<span class="string">'Windows Server 2012 R2 '</span>,<span class="string">'2017-08-11'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> system_bean(<span class="keyword">name</span>,lastaudit)<span class="keyword">VALUES</span>(<span class="string">'RHEL 7'</span>,<span class="string">'2017-07-21'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> system_bean(<span class="keyword">name</span>,lastaudit)<span class="keyword">VALUES</span>(<span class="string">'Solaris 11'</span>,<span class="string">'2017-08-13'</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="h2-web-consloeé…ç½®"><a href="#h2-web-consloeé…ç½®" class="headerlink" title="h2 web consloeé…ç½®"></a>h2 web consloeé…ç½®</h4><p>h2 web consloeæ˜¯ä¸€ä¸ªæ•°æ®åº“GUIç®¡ç†åº”ç”¨ï¼Œå°±å’ŒphpMyAdminç±»ä¼¼ã€‚ç¨‹åºè¿è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨h2 web consloeã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥è¿›è¡Œå¦‚ä¸‹çš„é…ç½®ã€‚</p>
<p>spring.h2.console.settings.web-allow-others=trueï¼Œè¿›è¡Œè¯¥é…ç½®åï¼Œh2 web consloeå°±å¯ä»¥åœ¨è¿œç¨‹è®¿é—®äº†ã€‚å¦åˆ™åªèƒ½åœ¨æœ¬æœºè®¿é—®ã€‚<br>spring.h2.console.path=/h2-consoleï¼Œè¿›è¡Œè¯¥é…ç½®ï¼Œä½ å°±å¯ä»¥é€šè¿‡YOUR_URL/h2-consoleè®¿é—®h2 web consloeã€‚YOUR_URLæ˜¯ä½ ç¨‹åºçš„è®¿é—®URlã€‚<br>spring.h2.console.enabled=trueï¼Œè¿›è¡Œè¯¥é…ç½®ï¼Œç¨‹åºå¼€å¯æ—¶å°±ä¼šå¯åŠ¨h2 web consloeã€‚å½“ç„¶è¿™æ˜¯é»˜è®¤çš„ï¼Œå¦‚æœä½ ä¸æƒ³åœ¨å¯åŠ¨ç¨‹åºæ—¶å¯åŠ¨h2 web consloeï¼Œé‚£ä¹ˆå°±è®¾ç½®ä¸ºfalseã€‚</p>
<p>å‚è€ƒï¼š<br>[1]. <a href="https://juejin.im/post/5ab4b339f265da238c3a9d0a" target="_blank" rel="noopener">https://juejin.im/post/5ab4b339f265da238c3a9d0a</a><br>[2]. <a href="https://412887952-qq-com.iteye.com/blog/2322756" target="_blank" rel="noopener">https://412887952-qq-com.iteye.com/blog/2322756</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/10/12/Android-pie-sliceå¼€å‘å°è®°/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/Android-pie-sliceå¼€å‘å°è®°/" itemprop="url">Android pie sliceå¼€å‘å°è®°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-10-12T12:51:02+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android-pie-sliceå¼€å‘å°è®°"><a href="#Android-pie-sliceå¼€å‘å°è®°" class="headerlink" title="Android pie sliceå¼€å‘å°è®°"></a>Android pie sliceå¼€å‘å°è®°</h2><h3 id="sliceåˆ›å»ºå’Œè¿è¡Œ"><a href="#sliceåˆ›å»ºå’Œè¿è¡Œ" class="headerlink" title="sliceåˆ›å»ºå’Œè¿è¡Œ"></a>sliceåˆ›å»ºå’Œè¿è¡Œ</h3><ol>
<li>é¦–å…ˆæ–°å»ºä¸€ä¸ªé¡¹ç›®å¹¶é€‰æ‹©ä½¿ç”¨çš„apiä¸ºAPI 28:Android 9ï¼ˆpieï¼‰æˆ–è€…åœ¨å·²æœ‰çš„é¡¹ç›®è°ƒæ•´å…¶ç¼–è¯‘ã€æœ€ä½å’Œç›®æ ‡ç‰ˆæœ¬ä¸º28ï¼ˆæœ€ä½ï¼‰ã€‚</li>
<li>åˆ›å»º slice providerï¼š<br><img src="./images/new-slice.png" alt="new slice step"><br>å½“ç”Ÿæˆslice provideråï¼Œç¼–è¯‘å™¨ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Manifest merger failed : Attribute application@appComponentFactory value=(androidx.core.app.CoreComponentFactory) from [androidx.core:core:1.0.0] AndroidManifest.xml:22:18-86</span><br><span class="line">	is also present at [com.android.support:support-compat:28.0.0] AndroidManifest.xml:22:18-91 value=(android.support.v4.app.CoreComponentFactory).</span><br><span class="line">	Suggestion: add &apos;tools:replace=&quot;android:appComponentFactory&quot;&apos; to &lt;application&gt; element at AndroidManifest.xml:5:5-35:19 to override.</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ä»¥ä¸Šé”™è¯¯ä¸»è¦æ˜¯androidåœ¨api 28ç‰ˆæœ¬åï¼Œappconmpatã€cardviewå’Œconstraintlayoutç­‰éƒ½ç§»åˆ°AndroidxåŒ…åä¸‹ï¼Œæ‰€ä»¥ä¿®æ­£æ–¹å¼ä¸ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      implementation fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class="line">//    implementation &apos;com.android.support:appcompat-v7:28.0.0&apos;</span><br><span class="line">//    implementation &apos;com.android.support.constraint:constraint-layout:1.1.3&apos;</span><br><span class="line">  implementation &apos;androidx.appcompat:appcompat:1.0.0&apos;</span><br><span class="line">  implementation &apos;androidx.constraintlayout:constraintlayout:1.1.3&apos;</span><br><span class="line"></span><br><span class="line">  implementation &apos;androidx.annotation:annotation:1.0.0&apos;</span><br><span class="line">  implementation &apos;androidx.slice:slice-builders:1.0.0&apos;</span><br><span class="line"></span><br><span class="line">  testImplementation &apos;junit:junit:4.12&apos;</span><br><span class="line">  androidTestImplementation &apos;androidx.test:runner:1.1.0-alpha3&apos;</span><br><span class="line">  androidTestImplementation &apos;androidx.test.espresso:espresso-core:3.1.0-alpha3&apos;</span><br></pre></td></tr></table></figure></p>
<p>å‚è€ƒåœ°å€ï¼š<a href="https://stackoverflow.com/questions/50782435/android-design-support-library-for-api-28-p-not-working" target="_blank" rel="noopener">https://stackoverflow.com/questions/50782435/android-design-support-library-for-api-28-p-not-working</a></p>
<ol>
<li>sliceProviderç¼–ç ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PieSliceProvider</span> <span class="keyword">extends</span> <span class="title">SliceProvider</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Instantiate any required objects. Return true if the provider was successfully created,</span></span><br><span class="line"><span class="comment">     * false otherwise.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateSliceProvider</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Converts URL to content URI (i.e. content://com.mugwort.demo...)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Uri <span class="title">onMapIntentToUri</span><span class="params">(@Nullable Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Note: implementing this is only required if you plan on catching URL requests.</span></span><br><span class="line">        <span class="comment">// This is an example solution.</span></span><br><span class="line">        Uri.Builder uriBuilder = <span class="keyword">new</span> Uri.Builder().scheme(ContentResolver.SCHEME_CONTENT);</span><br><span class="line">        <span class="keyword">if</span> (intent == <span class="keyword">null</span>) <span class="keyword">return</span> uriBuilder.build();</span><br><span class="line">        Uri data = intent.getData();</span><br><span class="line">        <span class="keyword">if</span> (data != <span class="keyword">null</span> &amp;&amp; data.getPath() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String path = data.getPath().replace(<span class="string">"/"</span>, <span class="string">""</span>);</span><br><span class="line">            uriBuilder = uriBuilder.path(path);</span><br><span class="line">        &#125;</span><br><span class="line">        Context context = getContext();</span><br><span class="line">        <span class="keyword">if</span> (context != <span class="keyword">null</span>) &#123;</span><br><span class="line">            uriBuilder = uriBuilder.authority(context.getPackageName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uriBuilder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Construct the Slice and bind data if available.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Slice <span class="title">onBindSlice</span><span class="params">(Uri sliceUri)</span> </span>&#123;</span><br><span class="line">        Context context = getContext();</span><br><span class="line">        SliceAction activityAction = createActivityAction();</span><br><span class="line">        <span class="keyword">if</span> (context == <span class="keyword">null</span> || activityAction == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"/"</span>.equals(sliceUri.getPath())) &#123;</span><br><span class="line">            <span class="comment">// Path recognized. Customize the Slice using the androidx.slice.builders API.</span></span><br><span class="line">            <span class="comment">// Note: ANRs and strict mode is enforced here so don't do any heavy operations.</span></span><br><span class="line">            <span class="comment">// Only bind data that is currently available in memory.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ListBuilder(getContext(), sliceUri, ListBuilder.INFINITY)</span><br><span class="line">                    .addRow(</span><br><span class="line">                            <span class="keyword">new</span> RowBuilder()</span><br><span class="line">                                    .setTitle(<span class="string">"URI found.hello i'am here"</span>)</span><br><span class="line">                                    .setPrimaryAction(activityAction)</span><br><span class="line">                    )</span><br><span class="line">                    .build();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Error: Path not found.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ListBuilder(getContext(), sliceUri, ListBuilder.INFINITY)</span><br><span class="line">                    .addRow(</span><br><span class="line">                            <span class="keyword">new</span> RowBuilder()</span><br><span class="line">                                    .setTitle(<span class="string">"URI not found."</span>)</span><br><span class="line">                                    .setPrimaryAction(activityAction)</span><br><span class="line">                    )</span><br><span class="line">                    .build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SliceAction <span class="title">createActivityAction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//return null;</span></span><br><span class="line">        <span class="comment">//Instead of returning null, you should create a SliceAction. Here is an example:</span></span><br><span class="line">        <span class="keyword">return</span> SliceAction.create(</span><br><span class="line">            PendingIntent.getActivity(</span><br><span class="line">                getContext(), <span class="number">0</span>, <span class="keyword">new</span> Intent(getContext(), MainActivity.class), <span class="number">0</span></span><br><span class="line">            ),</span><br><span class="line">            IconCompat.createWithResource(getContext(), R.drawable.ic_launcher_foreground),</span><br><span class="line">            ListBuilder.ICON_IMAGE,</span><br><span class="line">            <span class="string">"Open App"</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Slice has been pinned to external process. Subscribe to data source if necessary.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSlicePinned</span><span class="params">(Uri sliceUri)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// When data is received, call context.contentResolver.notifyChange(sliceUri, null) to</span></span><br><span class="line">        <span class="comment">// trigger PieSliceProvider#onBindSlice(Uri) again.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Unsubscribe from data source if necessary.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSliceUnpinned</span><span class="params">(Uri sliceUri)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Remove any observers if necessary to avoid memory leaks.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>åˆ†æï¼š</p>
<ul>
<li>é€šè¿‡ç±»æˆ‘ä»¬å‘ç°SliceProviderç»§æ‰¿äºContentProviderï¼Œå…¶APPé—´æ•°æ®çš„ä¼ é€’é€šè¿‡<br>ContentProviderçš„æ–¹å¼ï¼Œåº”ç”¨APPå‘æœç´¢APPå¯¹å¤–æä¾›å…¶å¯¹åº”Sliceçš„Uriï¼Œå°è£…æˆSliceå¯¹è±¡é€šè¿‡Parcelableåºåˆ—åŒ–çš„æ–¹å¼å®ç°APPä¹‹é—´çš„æ•°æ®ä¼ é€’ã€‚</li>
<li>sliceçš„ç»‘å®šå’Œå±•ç¤ºï¼šonBindSliceï¼Œ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Slice <span class="title">onBindSlice</span><span class="params">(Uri sliceUri)</span> </span>&#123;</span><br><span class="line">    Context context = getContext();</span><br><span class="line">    SliceAction activityAction = createActivityAction();</span><br><span class="line">    <span class="keyword">if</span> (context == <span class="keyword">null</span> || activityAction == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//â€œ/â€æ˜¯åœ¨manifestä¸­å®šä¹‰çš„</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"/"</span>.equals(sliceUri.getPath())) &#123;</span><br><span class="line">        <span class="comment">// Path recognized. Customize the Slice using the androidx.slice.builders API.</span></span><br><span class="line">        <span class="comment">// Note: ANRs and strict mode is enforced here so don't do any heavy operations.</span></span><br><span class="line">        <span class="comment">// Only bind data that is currently available in memory.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ListBuilder(getContext(), sliceUri, ListBuilder.INFINITY)</span><br><span class="line">                .addRow(</span><br><span class="line">                        <span class="keyword">new</span> RowBuilder()</span><br><span class="line">                                .setTitle(<span class="string">"URI found.hello i'am here"</span>)</span><br><span class="line">                                .setPrimaryAction(activityAction)</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Error: Path not found.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ListBuilder(getContext(), sliceUri, ListBuilder.INFINITY)</span><br><span class="line">                .addRow(</span><br><span class="line">                        <span class="keyword">new</span> RowBuilder()</span><br><span class="line">                                .setTitle(<span class="string">"URI not found."</span>)</span><br><span class="line">                                .setPrimaryAction(activityAction)</span><br><span class="line">                )</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Uriçš„schemeç»Ÿä¸€ä¸ºcontent,å¦‚ä¸Šè¿°ä¾‹å­çš„Uriä¸º:<br>content://x.x.x/</p>
<ul>
<li><p>SliceAction,è¿™ä¸ªç±»ä¼¼notificationsï¼Œå¯ä»¥ä½¿ç”¨PendingIntents æ¥å¤„ç†ç”¨æˆ·çš„ç‚¹å‡»äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»Sliceæ¨¡å—æ‰“å¼€å®¿ä¸»APPï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SliceAction <span class="title">createActivityAction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//return null;</span></span><br><span class="line">    <span class="comment">//Instead of returning null, you should create a SliceAction. Here is an example:</span></span><br><span class="line">    <span class="keyword">return</span> SliceAction.create(</span><br><span class="line">        PendingIntent.getActivity(</span><br><span class="line">            getContext(), <span class="number">0</span>, <span class="keyword">new</span> Intent(getContext(), MainActivity.class), <span class="number">0</span></span><br><span class="line">        ),</span><br><span class="line">        IconCompat.createWithResource(getContext(), R.drawable.ic_launcher_foreground),</span><br><span class="line">        ListBuilder.ICON_IMAGE,</span><br><span class="line">        <span class="string">"Open App"</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>é€šè¿‡å®‰è£…<br><a href="https://github.com/googlesamples/android-SliceViewer/releases" target="_blank" rel="noopener"> SliceViewer</a>ï¼Œåœ¨æœç´¢æ¡†è¾“å…¥uriå³å¯æ·»åŠ sliceå¹¶è·³è½¬:<br><img src="./images/slice-view.png" alt="SliceViewer"></p>
</li>
</ul>
<h3 id="Sliceæ¨¡æ¿"><a href="#Sliceæ¨¡æ¿" class="headerlink" title="Sliceæ¨¡æ¿"></a>Sliceæ¨¡æ¿</h3><ul>
<li>ListBuilder:Slicesé€šè¿‡ListBuilderç±»æ¥åˆ›å»ºã€‚åœ¨ListBuilderä¸­ï¼Œä½ å¯ä»¥æ·»åŠ ä¸åŒç±»å‹çš„è¡Œæ¨¡å—åœ¨ä½ çš„Sliceä¸­è¿›è¡Œå±•ç¤ºã€‚</li>
</ul>
<ul>
<li>SliceAction:å¯¹äºæ¯ä¸€ä¸ªSliceæ¥è¯´ï¼Œæœ€åŸºç¡€çš„æ„é€ å®ç°ç±»æ˜¯SliceActionï¼Œåœ¨SliceActionä½ å¯ä»¥æ·»åŠ PendingIntentæ¥å®ç°ç”¨æˆ·æ“ä½œï¼Œæ¯”å¦‚Toggleé€‰æ‹©æ“ä½œï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SliceAction toggleAction =SliceAction.createToggle(createToggleIntent(),<span class="string">"Toggle adaptive brightness"</span>,<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>SliceActionå¯ä»¥é…ç½®åœ¨æœç´¢APPä¸­æ˜¾ç¤ºçš„æ¨¡å—ä¸‰ç§ä¸åŒçš„æ˜¾ç¤ºæ–¹å¼ï¼š</p>
<p>â€ƒâ€ƒICON_IMAGE:tiny size and tintable:<br><img src="https://upload-images.jianshu.io/upload_images/6572543-745370335b55ea66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/406/format/webp" alt="shortcut"></p>
<p> SMALL_IMAGE:small size and non-tintable:<br><img src="https://upload-images.jianshu.io/upload_images/6572543-c4bdc8a2370df185.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/414/format/webp" alt="small">  </p>
<p>â€ƒâ€ƒLARGE_IMAGE: largest size and non-tintable:<br><img src="https://upload-images.jianshu.io/upload_images/6572543-2fa70505db53e281.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/420/format/webp" alt="large"></p>
<h3 id="æ¨¡å—æ„é€ Builder"><a href="#æ¨¡å—æ„é€ Builder" class="headerlink" title="æ¨¡å—æ„é€ Builder"></a>æ¨¡å—æ„é€ Builder</h3><p>â€ƒâ€ƒå¯¹äºæ¯ä¸ªSliceæ¨¡å—çš„åˆ›å»ºæ„é€ ï¼Œè°·æ­Œå®˜æ–¹æä¾›äº†HeaderBuilderã€RowBuilderã€GridBuilderã€RangeBuilderæ¨¡å—å››ç§æ„é€ å™¨ã€‚å…¶ä¸­ï¼ŒHeaderBuilderåªæ”¯æŒä¸€è¡Œå¤´éƒ¨çš„å±•ç¤ºviewï¼›RowBuilderå¯ä»¥æ·»åŠ ä¸€è¡Œviewè¿›è¡Œå±•ç¤ºï¼Œå¦‚æ­¤å‰æ²¡æœ‰æ·»åŠ headerï¼Œåˆ™é¦–è¡Œrowé»˜è®¤ä¸ºheaderï¼›GridBuilderæ”¯æŒä¸Šè¿°æ‰€è¯´çš„ä¸‰ç§æ¨¡å—å±•ç¤ºæ–¹å¼ï¼›è€ŒRangeBuilderåˆ™æ”¯æŒè¿›åº¦æ¡ç›¸å…³çš„viewå±•ç¤ºã€‚</p>
<h3 id="å»¶æ—¶åŠ è½½"><a href="#å»¶æ—¶åŠ è½½" class="headerlink" title="å»¶æ—¶åŠ è½½"></a>å»¶æ—¶åŠ è½½</h3><p>â€ƒâ€ƒå¯¹äºä¸€äº›éœ€è¦è€—æ—¶åŠ è½½æ•°æ®çš„æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚å›¾ç‰‡ç­‰ï¼Œå¯ä»¥é‡‡å–ä¸ListViewåŠ è½½å›¾ç‰‡ç±»ä¼¼çš„æ–¹æ³•ï¼Œå…ˆæœ¬åœ°åŠ è½½ä¸€ä¸ªé»˜è®¤çš„å ä½æ•°æ®ï¼Œç­‰è€—æ—¶æ“ä½œå®Œæˆå›è°ƒå›æ¥çœŸå®æ•°æ®çš„æ—¶å€™è°ƒç”¨getContentResolver().notifyChange(sliceUri) æ–¹æ³•ï¼Œé€šçŸ¥æœç´¢APPè°ƒç”¨Slice Uriï¼Œå®ŒæˆçœŸå®æ•°æ®çš„æ˜¾ç¤ºã€‚</p>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>â€ƒâ€ƒSliceçš„åŠŸèƒ½æ¨¡æ¿éå¸¸çš„å¼ºå¤§ï¼Œé€šè¿‡ä¸åŒçš„builderç»„åˆå¯ä»¥åœ¨æœç´¢æ¨¡å—ä¸­æ­é…å‡ºä¸°å¯Œå¤šå½©çš„Sliceï¼Œå¿«é€Ÿç›´è¾¾ç”¨æˆ·æƒ³è¦çš„åŠŸèƒ½ã€‚ä½†æ˜¯Sliceåªæä¾›äº†ä¸‰ç§æ¨¡æ¿ï¼Œè‡ªå¸¦æ¨¡æ¿ä¸­å¯¹å®‰å“åŸç”Ÿæ§ä»¶çš„æ”¯æŒæœ‰æ‰€æ¬ ç¼ºï¼Œæ¯”å¦‚ScollViewç­‰ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰è‡ªå·±çš„æ¨¡æ¿æ‰èƒ½å®ç°æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p>
<p>å‚è€ƒï¼š<br>[0].<a href="https://www.androidauthority.com/android-slices-872250/" target="_blank" rel="noopener">https://www.androidauthority.com/android-slices-872250/</a><br>[1].<a href="https://www.jianshu.com/p/a90563606e1f" target="_blank" rel="noopener">https://www.jianshu.com/p/a90563606e1f</a><br>[2].<a href="http://digi.aili.com/1642/2811309.html" target="_blank" rel="noopener">http://digi.aili.com/1642/2811309.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/08/27/åŸºç¡€æ•°æ®ä¸byteé—´çš„è½¬åŒ–/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/27/åŸºç¡€æ•°æ®ä¸byteé—´çš„è½¬åŒ–/" itemprop="url">åŸºç¡€æ•°æ®ä¸byteé—´çš„è½¬åŒ–</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-27T16:42:52+08:00">
                2018-08-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><p>   <strong>è®¡ç®—æœºä¸­å­˜å‚¨æ˜¯ç”¨è¡¥ç ï¼ï¼ï¼ŒåŒæ—¶æ³¨æ„ä¸€ä¸‹è®¡ç®—çœç•¥äº†é«˜ä½ä¸å˜éƒ¨åˆ†å’Œ å­—èŠ‚å¤§å°ç«¯é—®é¢˜</strong>  </p>
<h4 id="åŸºç¡€æ•°æ®"><a href="#åŸºç¡€æ•°æ®" class="headerlink" title="åŸºç¡€æ•°æ®"></a>åŸºç¡€æ•°æ®</h4><ul>
<li>byteï¼šæœ‰ç¬¦å·ï¼Œåœ¨ç½‘ç»œä¼ è¾“ä¸­éƒ½æ˜¯ä¼šç”¨åˆ°byteçš„ï¼Œå®ƒå 1ä¸ªå­—èŠ‚ï¼Œå…±8ä½ï¼Œæ¯”å¦‚è¯´11111111å°±å¯ä»¥ç”¨1ä¸ª<br>byteè¡¨ç¤ºï¼Œè½¬åŒ–ä¸º10è¿›åˆ¶ï¼š- ï¼ˆ2çš„6æ¬¡+2çš„5æ¬¡+2çš„4æ¬¡+2çš„3æ¬¡+2çš„2æ¬¡+2çš„1æ¬¡+2çš„0æ¬¡ï¼‰ = -127ã€‚<br>å…¶ä¸­å‰7ä½è¡¨ç¤ºæ•°å­—ï¼Œæœ€é«˜ä½è¡¨ç¤ºç¬¦å·ï¼Œ0ä¸ºæ­£ï¼Œ1ä¸ºè´Ÿã€‚èŒƒå›´æ˜¯ ï¼ˆ-2çš„7æ¬¡ ~ 2çš„7æ¬¡ - 1ï¼‰ï¼Œé‚£ä¸ºä»€ä¹ˆå‰<br>é¢æœ€å°æ˜¯-127ï¼ŒèŒƒå›´æœ€å°åˆæ˜¯-128å‘¢ï¼Ÿå› ä¸ºè§„å®š-0ï¼ˆ10000000ï¼‰ä¸º-128ã€‚</li>
<li>shortï¼šæœ‰ç¬¦å·ï¼Œå 2ä¸ªå­—èŠ‚ï¼Œå…±16ä½ã€‚åŒbyteä¸€æ ·ï¼Œå®ƒçš„å–å€¼èŒƒå›´å°±æ˜¯ ï¼ˆ-2çš„15æ¬¡ ~ 2çš„15æ¬¡ - 1ï¼‰ã€‚</li>
<li>intï¼šæœ‰ç¬¦å·ï¼Œå 4ä¸ªå­—èŠ‚ï¼Œå…±32ä½ã€‚å®ƒçš„å–å€¼èŒƒå›´å°±æ˜¯ï¼ˆ-2çš„31æ¬¡ ~ 2çš„31æ¬¡ï¼‰ã€‚</li>
<li>longï¼šæœ‰ç¬¦å·ï¼Œå 8ä¸ªå­—èŠ‚ï¼Œå…±64ä½ï¼Œå®ƒçš„å–å€¼èŒƒå›´å°±æ˜¯ï¼ˆ-2çš„63æ¬¡ ~ 2çš„63æ¬¡ï¼‰ã€‚</li>
</ul>
<h4 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h4><ul>
<li>^ï¼šè¡¨ç¤ºå¼‚æˆ–ä½è¿ç®—ï¼Œä¸¤è€…ç›¸åŒåˆ™ä¸º0ï¼Œä¸¤è€…ä¸åŒåˆ™ä¸º1ã€‚æ¯”å¦‚è¯´15^2ï¼Œ15ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯1111ï¼Œ2ç”¨2<br>è¿›åˆ¶è¡¨ç¤ºå°±æ˜¯0010ï¼Œä¸¤è€…è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œç»“æœå°±æ˜¯1101ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯13ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">A^B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
</tbody>
</table>
<ul>
<li>|ï¼šè¡¨ç¤ºæˆ–è¿ç®—ï¼Œä¸¤è€…åªæœ‰æœ‰ä¸€ä¸ªä¸º1å°±ä¸º1ï¼Œ æ¯”å¦‚è¯´13|2ï¼Œ13ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯1101ï¼Œ2ç”¨äºŒè¿›åˆ¶è¡¨ç¤º<br>å°±æ˜¯0010ï¼Œä¸¤è€…è¿›è¡Œæˆ–è¿ç®—ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯1111ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯15ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">A &#124; B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
</tbody>
</table>
<ul>
<li>&amp;ï¼šè¡¨ç¤ºä¸è¿ç®—ï¼Œä¸¤è€…éƒ½ä¸º1å°±ä¸º1ï¼Œå…¶ä½™éƒ½ä¸º0ï¼Œæ¯”å¦‚è¯´15&amp;2ï¼Œ 13ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯1111ï¼Œ2ç”¨äºŒè¿›åˆ¶<br>è¡¨ç¤ºå°±æ˜¯0010ï¼Œ ä¸¤è€…è¿›è¡Œä¸è¿ç®—ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯0010ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯2ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">B</th>
<th style="text-align:left">A&amp;B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
</tbody>
</table>
<ul>
<li>~ï¼šå–åï¼Œå°±æ˜¯æœ¬æ¥æ˜¯0å˜æˆ1ï¼Œæœ¬æ¥æ˜¯1å˜æˆ0ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">A</th>
<th style="text-align:left">ï½A</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">0</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<ul>
<li><p>&lt;&lt;:å·¦ç§»è¿ç®—ç¬¦ï¼Œä¸éœ€è¦è€ƒè™‘ç¬¦å·ä½ï¼Œå› ä¸ºåœ¨åé¢è¡¥0ï¼ŒæŠŠäºŒè¿›åˆ¶çš„æ•°å­—å‘å·¦ç§»åŠ¨ï¼Œä½ä½è¡¥0ã€‚æ¯”å¦‚è¯´ 3&lt;&lt;2ã€‚<br>3çš„äºŒè¿›åˆ¶ç ä¸º11ï¼Œå‘å·¦ç§»åŠ¨2ä½å°±æ˜¯1100ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯12ã€‚</p>
</li>
<li><p>>&gt;ï¼šå³ç§»è¿ç®—ç¬¦ï¼Œå¸¦ç¬¦å·ä½ã€‚æ ¹æ®è¿™ä¸ªè¦ç§»åŠ¨çš„æ•°å­—å†³å®šæ­£è´Ÿï¼Œå¦‚æœæ˜¯æ­£æ•°ï¼Œé‚£ä¹ˆå°±åœ¨å‰é¢è¡¥0ï¼Œå¦‚æœæ˜¯<br>è´Ÿæ•°å°±åœ¨å‰é¢è¡¥1ã€‚æ¯”å¦‚è¯´ 3&gt;&gt;2ï¼Œ3çš„äºŒè¿›åˆ¶ç ä¸º00000011ï¼Œå‘å³ç§»åŠ¨2ä½ï¼Œå°±å˜æˆ00000000ï¼Œè½¬åŒ–ä¸ºå<br>è¿›åˆ¶å°±æ˜¯0äº†ï¼ˆ3æ˜¯æ­£æ•°æ‰€ä»¥åœ¨é«˜ä½è¡¥0ï¼‰ã€‚å†æ¯”å¦‚è¯´-3&gt;&gt;2ï¼Œ-3çš„äºŒè¿›åˆ¶ç ä¸º10000011ï¼Œè½¬åŒ–ä¸ºè¡¥ç <br>ï¼ˆåªè¦æ¶‰åŠåˆ°è´Ÿæ•°ï¼Œå°±éœ€è¦è½¬æ¢åˆ°è¡¥ç è®¡ç®—ï¼Œæ­£æ•°ä¹‹æ‰€ä»¥ä¸ç”¨è½¬åŒ–ï¼Œæ˜¯å› ä¸ºä»–ä»¬çš„è¡¥ç å’ŒåŸç æ˜¯ä¸€è‡´çš„ï¼‰<br>11111101ï¼Œè¿›è¡Œä½ç§»è¿ç®—ï¼Œå°±æ˜¯11111111ï¼Œè¿™ä¸ªæ˜¯è¡¥ç ï¼Œéœ€è¦å†è½¬å›åŸç ã€‚é‚£ä¹ˆå°±æ˜¯å–å+1ï¼Œç»“æœå°±æ˜¯<br>10000001ï¼Œè½¬åŒ–ä¸ºåè¿›åˆ¶å°±æ˜¯-1ã€‚</p>
</li>
<li><p>>&gt;&gt;ï¼šå³ç§»è¿ç®—ç¬¦ï¼Œä¸ä¸Šé¢çš„åŒºåˆ«å°±æ˜¯è¿™ä¸ªè¿ç®—ç¬¦æ˜¯ <strong>æ— ç¬¦å·çš„</strong>ã€‚ä¸è®ºæ­£è´Ÿï¼Œé«˜ä½éƒ½è¡¥0ã€‚å¦‚æœè¦ç”¨<br>-3&gt;&gt;2æ¥éªŒè¯ï¼Œå› ä¸ºé«˜ä½è¡¥0ï¼Œå°±éœ€è¦æŠŠæ‰€æœ‰çš„ä½æ•°éƒ½å†™å…¨äº†ã€‚å¦‚æœæ˜¯intï¼Œé‚£å°±è¦å†™æˆ32ä½æ¥è¿ç®—ã€‚åˆ‡è®°åˆ‡è®°ã€‚<br>ä¸Šé¢å¾ˆå¤šå› ä¸ºé«˜ä½çš„å˜åŒ–â€œå–åå†å–åâ€ä¼šå¯¼è‡´å‰é¢æ‰€æœ‰çš„ä½éƒ½æ²¡å˜æ‰€ä»¥æˆ‘å°±ç®€åŒ–äº†ï¼Œä½†æ˜¯è¿™ä¸ª&gt;&gt;&gt;è¿ç®—ç¬¦ä¸è¡Œå“¦ï¼Œ<br>å®ƒä¼šæŠŠè´Ÿæ•°å˜ä¸ºæ­£æ•°ã€‚</p>
</li>
</ul>
<p>æ —å­ï¼ˆegï¼‰ï¼š<br>æ¯”å¦‚è¯´-15|3ç­‰äºå¤šå°‘å‘¢ï¼Ÿæœ‰äº›äººä¼šè§‰å¾—-15è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å°±æ˜¯10001111ï¼Œè€Œ3è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å°±æ˜¯00000011ï¼Œ<br>é‚£ä¹ˆç»“æœåº”è¯¥æ˜¯10001111å‘€ï¼Œè½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯-15å‘€ï¼Ÿå¤§å®¶å¯ä»¥è‡ªå·±å†™ä¸ªdemoå°±ä¼šå‘ç°æ˜¯ä¸å¯¹çš„ã€‚è¦æ³¨æ„<br>åœ¨è®¡ç®—æœºä¸­æ‰€æœ‰çš„éƒ½æ˜¯ç”¨è¡¥ç çš„å½¢å¼å­˜å‚¨çš„ï¼Œä¹‹æ‰€ä»¥ä¸Šé¢ä»‹ç»ä¸¤ä¸ªæ­£æ•°æ˜¯å¯¹çš„ï¼Œå› ä¸º <strong>æ­£æ•°çš„åç å’Œè¡¥ç éƒ½æ˜¯ä¸€æ ·çš„ã€‚è€Œè´Ÿæ•°æ±‚è¡¥ç åº”è¯¥æ˜¯é™¤å»ç¬¦å·ä½å–å+1</strong>ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿™ä¸ªé¢˜-15|3ï¼Œå…¶ä¸­-15çš„åŸç ä¸º10001111ï¼Œåç ä¸º11110000ï¼Œé‚£ä¹ˆè¡¥ç å°±æ˜¯11110001ï¼Œç„¶å3çš„è¡¥ç ä¸º00000011ï¼Œä¸¤è€…è¿›è¡Œæˆ–æ“ä½œå°±æ˜¯11110011ï¼Œä½ ä»¥ä¸ºç»“æŸäº†ä¹ˆï¼Ÿè¿˜æ²¡æœ‰ï¼Œå†åˆè¦æ±‚å®ƒçš„åŸç äº†ï¼Œ<strong>åŸç å°±æ˜¯è¡¥ç å†æ±‚è¡¥ç å†+1</strong>ï¼ˆæ˜¯ä¸æ˜¯å·²ç»æ™•æ‰äº†ï¼Ÿï¼‰ï¼Œä¹Ÿå°±æ˜¯<br>10001101ï¼Œç»“æœå°±æ˜¯-13ã€‚ä¸ºäº†å¤§å®¶éƒ½å¥½ç†è§£ï¼Œæˆ‘è¿™é‡Œç”¨ç®—å¼æ•´ç†ä¸€ä¸‹ï¼š</p>
<p>æ±‚ -15|3</p>
<p>[-15]åŸç  = 10001111<br>[-15]åç  = 11110000 //åŸç æ±‚åç ç¬¦å·ä½ä¸å˜<br>[-15]è¡¥ç  = 11110001 //åç +1ç­‰äºè¡¥ç </p>
<p>[3]åŸç  = 00000011<br>[3]åç  = 00000011 //æ­£æ•°éƒ½ä¸€è‡´<br>[3]è¡¥ç  = 00000011 //æ­£æ•°éƒ½ä¸€è‡´</p>
<p>-15|3 = 11110011 //ä¸¤ä¸ªè¡¥ç è¿›è¡Œæˆ–æ“ä½œ</p>
<p>[ç»“æœ]è¡¥ç  = 11110011 //ä¸Šé¢æ±‚å¾—çš„å€¼<br>[ç»“æœ]åç  = 10001100 //ç¬¦å·ä½ä¸å˜<br>[ç»“æœ]åŸç  = 10001101 //åç +1</p>
<p>100001101 è½¬åŒ–ä¸ºåè¿›åˆ¶å°±æ˜¯-13ã€‚<br>ä¸çŸ¥é“æˆ‘è¿™ä¹ˆè§£é‡Šä¼šä¸ä¼šæ›´åŠ æ¸…æ¥šä¸€äº›å‘¢ï¼ŸåŒç†çš„ï¼Œä¸Šé¢é‚£äº›ï¼ˆå°¤å…¶æ˜¯æ±‚åâ€˜~â€™æˆ‘æ•…æ„æ²¡å†™ä¾‹å­ï¼Œå¤§å®¶è‡ªå·±å»è¯•è¯•å§ï¼‰ã€‚</p>
<p>åœ¨è¯´ä¸€æ¬¡ï¼Œæ­£æ•°çš„åŸç ï¼Œè¡¥ç ï¼Œåç éƒ½ä¸€æ ·ï¼Œå¦‚æœä¸€å®šè¦è¯´ä¸ºä»€ä¹ˆä¸€æ ·ï¼Œæˆ‘å°±ä¸¾ä¸ªä¾‹å­ã€‚æœ‰è¿™ä¹ˆä¸€ä¸ªç­‰å¼7+ï¼ˆ-7ï¼‰=0ã€‚<br>æˆ‘ä»¬çŸ¥é“<br>[-7]åŸ = 10000111<br>[-7]å = 11111000<br>[-7]è¡¥ = 11111001</p>
<p>é‚£ä¹ˆå¦‚æœè¦å­˜åœ¨ä¸€ä¸ªå€¼å’Œ[-7]è¡¥ç ç›¸åŠ ç­‰äº0ï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯00000111ï¼ï¼æ‰€ä»¥æ­£æ•°çš„è¡¥ç å’ŒåŸç æ˜¯ä¸€è‡´çš„ã€‚<br>è¿™æ ·è§£é‡Šè™½ç„¶æ€ªæ€ªçš„ï¼Œä½†æ˜¯å¯ä»¥çŸ¥é“çš„ç¡®æ˜¯è¿™æ ·çš„ã€‚</p>
<h4 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h4><p>åŸºæœ¬æ­¥éª¤ï¼š<br>â‘  åˆ†æè½¬åŒ–å’Œä»£è½¬åŒ–ä¹‹é—´ä½æ•°çš„å…³ç³»<br>â‘¡ è®¡ç®—åç§»é‡ã€‚æ¯æ¬¡éƒ½å–æœ€å8ä½<br>â‘¢ æŠŠæœ€å8ä½å’Œ0xffè¿›è¡Œ&amp;æ“ä½œ<br>â‘£ å¾—å‡ºç»“æœã€‚  </p>
<p>æœ‰äººä¼šé—®ï¼Œä¸ºä»€ä¹ˆè¦å’Œ0xffè¿›è¡Œ&amp;æ“ä½œï¼Ÿè¿™é‡Œè§£é‡Šä¸‹ï¼Œå› ä¸ºå†åˆ†å‰²çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä¿è¯æœ€å8ä½æ˜¯ä¸€è‡´çš„ï¼Œæ›´é«˜ä½éƒ½è¦ç½®0ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚æ¯”å¦‚è¯´ç”±byteè½¬åŒ–æˆshortã€‚ä½æ•°ä»8ä½å˜æˆäº†16ä½ï¼Œé‚£ä¹ˆåœ¨è®¡ç®—æœºè‡ªå·±çœ‹æ¥ï¼Œå®ƒä¼šæŠŠå‰é¢å¤šå‡ºæ¥çš„8ä½ç½®1ã€‚è€Œ&amp;0xffå°±å¯ä»¥æŠŠå‰é¢æ‰€æœ‰çš„ä½æ•°éƒ½ç½®0ã€‚</p>
<ol>
<li>shortä¸byteçš„ç›¸äº’è½¬åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å‰æï¼šåœ¨è®¡ç®—æœºä¸­æ‰€æœ‰çš„éƒ½æ˜¯ç”¨è¡¥ç çš„å½¢å¼å­˜å‚¨çš„ã€‚</span></span><br><span class="line"><span class="comment">    * å°†shortè½¬æ¢ä¸ºå­—èŠ‚</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * ä¾‹å¦‚ 8çš„è¡¥ç ä¸º0000 0000 0000 1000ï¼Œæ‰€ä»¥è¦å°†è½¬æ¢ä¸ºä¸¤ä¸ªå­—èŠ‚ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯å°†8å³ç§»8ä½ç„¶åå’Œ0x00ffæ±‚ä¸ï¼Œ</span></span><br><span class="line"><span class="comment">    * è€Œç¬¬äºŒä¸ªå­—èŠ‚åˆ™æ˜¯å³ç§»0ä½ï¼Œç„¶åæ±‚ä¸</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] short2byte(<span class="keyword">short</span> s)&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">int</span> offset = <span class="number">16</span> - (i+<span class="number">1</span>)*<span class="number">8</span>;          <span class="comment">//å› ä¸ºbyteå 1ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¦è®¡ç®—åç§»é‡</span></span><br><span class="line">            b[i] = (<span class="keyword">byte</span>)((s &gt;&gt; offset)&amp;<span class="number">0xff</span>); <span class="comment">//æŠŠ16ä½åˆ†ä¸º2ä¸ª8ä½è¿›è¡Œåˆ†åˆ«å­˜å‚¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">short</span> <span class="title">byte2short</span><span class="params">(<span class="keyword">byte</span>[] b)</span></span>&#123;</span><br><span class="line">       <span class="keyword">short</span> l = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">           l&lt;&lt;=<span class="number">8</span>;               <span class="comment">//&lt;&lt;=å’Œ +=æ˜¯ä¸€æ ·çš„ï¼Œæ„æ€å°±æ˜¯ l = l &lt;&lt; 8</span></span><br><span class="line">           l |= (b[i] &amp; <span class="number">0xff</span>); <span class="comment">//å’Œä¸Šé¢ä¹Ÿæ˜¯ä¸€æ ·çš„  l = l | (b[i]&amp;0xff)</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> l;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>intä¸byteçš„ç›¸äº’è½¬åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] int2byte(<span class="keyword">int</span> s)&#123;</span><br><span class="line">         <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span>];</span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)&#123;</span><br><span class="line">             <span class="keyword">int</span> offset = <span class="number">16</span> - (i+<span class="number">1</span>)*<span class="number">8</span>;         <span class="comment">//å› ä¸ºbyteå 1ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¦è®¡ç®—åç§»é‡</span></span><br><span class="line">             b[i] = (<span class="keyword">byte</span>)((s &gt;&gt; offset)&amp;<span class="number">0xff</span>); <span class="comment">//æŠŠ32ä½åˆ†ä¸º4ä¸ª8ä½è¿›è¡Œåˆ†åˆ«å­˜å‚¨</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">byte2int</span><span class="params">(<span class="keyword">byte</span>[] b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            l&lt;&lt;=<span class="number">8</span>;              <span class="comment">//&lt;&lt;=å’Œ +=æ˜¯ä¸€æ ·çš„ï¼Œæ„æ€å°±æ˜¯ l = l &lt;&lt; 8</span></span><br><span class="line">            l |= (b[i] &amp; <span class="number">0xff</span>); <span class="comment">//å’Œä¸Šé¢ä¹Ÿæ˜¯ä¸€æ ·çš„  l = l | (b[i]&amp;0xff)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>longä¸byteçš„ç›¸äº’è½¬åŒ–   </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @æ–¹æ³•åŠŸèƒ½ å­—èŠ‚æ•°ç»„å’Œé•¿æ•´å‹çš„è½¬æ¢</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> é•¿æ•´å‹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] longToByte(<span class="keyword">long</span> number) &#123;</span><br><span class="line">		<span class="keyword">long</span> temp = number;</span><br><span class="line">		<span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">8</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; b.length; i++) &#123;</span><br><span class="line">			b[i] = <span class="keyword">new</span> Long(temp &amp; <span class="number">0xff</span>).byteValue();</span><br><span class="line">			<span class="comment">// å°†æœ€ä½ä½ä¿å­˜åœ¨æœ€ä½ä½</span></span><br><span class="line">			temp = temp &gt;&gt; <span class="number">8</span>;</span><br><span class="line">			<span class="comment">// å‘å³ç§»8ä½</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * @æ–¹æ³•åŠŸèƒ½ å­—èŠ‚æ•°ç»„å’Œé•¿æ•´å‹çš„è½¬æ¢</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> é•¿æ•´å‹</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">byteToLong</span><span class="params">(<span class="keyword">byte</span>[] b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> s = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">long</span> s0 = b[<span class="number">0</span>] &amp; <span class="number">0xff</span>;<span class="comment">// æœ€ä½ä½</span></span><br><span class="line">		<span class="keyword">long</span> s1 = b[<span class="number">1</span>] &amp; <span class="number">0xff</span>;</span><br><span class="line">		<span class="keyword">long</span> s2 = b[<span class="number">2</span>] &amp; <span class="number">0xff</span>;</span><br><span class="line">		<span class="keyword">long</span> s3 = b[<span class="number">3</span>] &amp; <span class="number">0xff</span>;</span><br><span class="line">		<span class="keyword">long</span> s4 = b[<span class="number">4</span>] &amp; <span class="number">0xff</span>;<span class="comment">// æœ€ä½ä½</span></span><br><span class="line">		<span class="keyword">long</span> s5 = b[<span class="number">5</span>] &amp; <span class="number">0xff</span>;</span><br><span class="line">		<span class="keyword">long</span> s6 = b[<span class="number">6</span>] &amp; <span class="number">0xff</span>;</span><br><span class="line">		<span class="keyword">long</span> s7 = b[<span class="number">7</span>] &amp; <span class="number">0xff</span>; <span class="comment">// s0ä¸å˜</span></span><br><span class="line">		s1 &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">		s2 &lt;&lt;= <span class="number">16</span>;</span><br><span class="line">		s3 &lt;&lt;= <span class="number">24</span>;</span><br><span class="line">		s4 &lt;&lt;= <span class="number">8</span> * <span class="number">4</span>;</span><br><span class="line">		s5 &lt;&lt;= <span class="number">8</span> * <span class="number">5</span>;</span><br><span class="line">		s6 &lt;&lt;= <span class="number">8</span> * <span class="number">6</span>;</span><br><span class="line">		s7 &lt;&lt;= <span class="number">8</span> * <span class="number">7</span>;</span><br><span class="line">		s = s0 | s1 | s2 | s3 | s4 | s5 | s6 | s7;</span><br><span class="line">		<span class="keyword">return</span> s;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>charä¸byteçš„è½¬åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å­—ç¬¦åˆ°å­—èŠ‚è½¬æ¢</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ch</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putChar</span><span class="params">(<span class="keyword">byte</span>[] bb, <span class="keyword">char</span> ch, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> temp = (<span class="keyword">int</span>) ch;</span><br><span class="line">		<span class="comment">// byte[] b = new byte[2];</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++ ) &#123;</span><br><span class="line">			bb[index + i] = <span class="keyword">new</span> Integer(temp &amp; <span class="number">0xff</span>).byteValue(); <span class="comment">// å°†æœ€é«˜ä½ä¿å­˜åœ¨æœ€ä½ä½</span></span><br><span class="line">			temp = temp &gt;&gt; <span class="number">8</span>; <span class="comment">// å‘å³ç§»8ä½</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å­—èŠ‚åˆ°å­—ç¬¦è½¬æ¢</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> b</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span> <span class="title">getChar</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (b[index + <span class="number">1</span>] &gt; <span class="number">0</span>)</span><br><span class="line">			s += b[index + <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			s += <span class="number">256</span> + b[index + <span class="number">0</span>];</span><br><span class="line">		s *= <span class="number">256</span>;</span><br><span class="line">		<span class="keyword">if</span> (b[index + <span class="number">0</span>] &gt; <span class="number">0</span>)</span><br><span class="line">			s += b[index + <span class="number">1</span>];</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			s += <span class="number">256</span> + b[index + <span class="number">0</span>];</span><br><span class="line">		<span class="keyword">char</span> ch = (<span class="keyword">char</span>) s;</span><br><span class="line">		<span class="keyword">return</span> ch;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>floatä¸byteçš„è½¬åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * floatè½¬æ¢byte</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putFloat</span><span class="params">(<span class="keyword">byte</span>[] bb, <span class="keyword">float</span> x, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// byte[] b = new byte[4];</span></span><br><span class="line">	<span class="keyword">int</span> l = Float.floatToIntBits(x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		bb[index + i] = <span class="keyword">new</span> Integer(l).byteValue();</span><br><span class="line">		l = l &gt;&gt; <span class="number">8</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€šè¿‡byteæ•°ç»„å–å¾—float</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> bb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">float</span> <span class="title">getFloat</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> l;</span><br><span class="line">	l = b[index + <span class="number">0</span>];</span><br><span class="line">	l &amp;= <span class="number">0xff</span>;</span><br><span class="line">	l |= ((<span class="keyword">long</span>) b[index + <span class="number">1</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line">	l &amp;= <span class="number">0xffff</span>;</span><br><span class="line">	l |= ((<span class="keyword">long</span>) b[index + <span class="number">2</span>] &lt;&lt; <span class="number">16</span>);</span><br><span class="line">	l &amp;= <span class="number">0xffffff</span>;</span><br><span class="line">	l |= ((<span class="keyword">long</span>) b[index + <span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">	<span class="keyword">return</span> Float.intBitsToFloat(l);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>doubleä¸byteçš„è½¬åŒ–   </li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * doubleè½¬æ¢byte</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> bb</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putDouble</span><span class="params">(<span class="keyword">byte</span>[] bb, <span class="keyword">double</span> x, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// byte[] b = new byte[8];</span></span><br><span class="line">		<span class="keyword">long</span> l = Double.doubleToLongBits(x);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">			bb[index + i] = <span class="keyword">new</span> Long(l).byteValue();</span><br><span class="line">			l = l &gt;&gt; <span class="number">8</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * é€šè¿‡byteæ•°ç»„å–å¾—float</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> bb</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">getDouble</span><span class="params">(<span class="keyword">byte</span>[] b, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">long</span> l;</span><br><span class="line">		l = b[<span class="number">0</span>];</span><br><span class="line">		l &amp;= <span class="number">0xff</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line">		l &amp;= <span class="number">0xffff</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>);</span><br><span class="line">		l &amp;= <span class="number">0xffffff</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">		l &amp;= <span class="number">0xffffffffl</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">4</span>] &lt;&lt; <span class="number">32</span>);</span><br><span class="line">		l &amp;= <span class="number">0xffffffffffl</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">5</span>] &lt;&lt; <span class="number">40</span>);</span><br><span class="line">		l &amp;= <span class="number">0xffffffffffffl</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">6</span>] &lt;&lt; <span class="number">48</span>);</span><br><span class="line">		l &amp;= <span class="number">0xffffffffffffffl</span>;</span><br><span class="line">		l |= ((<span class="keyword">long</span>) b[<span class="number">7</span>] &lt;&lt; <span class="number">56</span>);</span><br><span class="line">		<span class="keyword">return</span> Double.longBitsToDouble(l);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>booleanä¸byteçš„ç›¸äº’è½¬åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†booleanè½¬æˆbyte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> val</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> byte[]</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] Boolean2ByteArray(<span class="keyword">boolean</span> val) &#123;</span><br><span class="line">        <span class="keyword">int</span> tmp = (val == <span class="keyword">false</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> ByteBuffer.allocate(<span class="number">4</span>).putInt(tmp).array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†byte[]è½¬æˆboolean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">ByteArray2Boolean</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data == <span class="keyword">null</span> || data.length &lt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> tmp = ByteBuffer.wrap(data, <span class="number">0</span>, <span class="number">4</span>).getInt();</span><br><span class="line">        <span class="keyword">return</span> (tmp == <span class="number">0</span>) ? <span class="keyword">false</span> : <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒåœ°å€ï¼š<br>[1].longã€shrotå’Œintè½¬åŒ– <a href="https://blog.csdn.net/u012403290/article/details/68943827" target="_blank" rel="noopener">https://blog.csdn.net/u012403290/article/details/68943827</a><br>[2].longã€shrotå’Œintè½¬åŒ– <a href="https://blog.csdn.net/thanklife/article/details/17002641" target="_blank" rel="noopener">https://blog.csdn.net/thanklife/article/details/17002641</a><br>[3]. charã€floatã€doubleä¸byteè½¬åŒ– <a href="https://blog.csdn.net/LEEtcWorks/article/details/7390731" target="_blank" rel="noopener">https://blog.csdn.net/LEEtcWorks/article/details/7390731</a><br>[4]. é€šè¿‡bufferè½¬æ¢ <a href="https://blog.csdn.net/u010983881/article/details/60870360" target="_blank" rel="noopener">https://blog.csdn.net/u010983881/article/details/60870360</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/08/23/NIO-Bufferè§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/23/NIO-Bufferè§£æ/" itemprop="url">NIO-Bufferè§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-23T16:18:47+08:00">
                2018-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&nbsp; &nbsp; &nbsp; &nbsp;åœ¨NIOä¸­ï¼Œæ•°æ®çš„è¯»å†™æ“ä½œå§‹ç»ˆæ˜¯ä¸ç¼“å†²åŒºç›¸å…³è”çš„ã€‚Channelå°†æ•°æ®<br>è¯»å…¥ç¼“å†²åŒºï¼Œç„¶åæˆ‘ä»¬åˆä»ç¼“å†²åŒºè®¿é—®æ•°æ®ã€‚å†™æ•°æ®æ—¶ï¼Œé¦–å…ˆå°†è¦å‘é€çš„æ•°æ®æŒ‰é¡ºåºå¡«å…¥ç¼“å†²åŒºã€‚åŸºæœ¬ä¸Šï¼Œ<br>ç¼“å†²åŒºåªæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå®ƒçš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆé€šå¸¸ä¸ºå­—èŠ‚å‹ï¼‰ã€‚ç¼“å†²åŒºæ˜¯å®šé•¿çš„ï¼Œå®ƒä¸åƒä¸€äº›ç±»<br>é‚£æ ·å¯ä»¥æ‰©å±•å®¹é‡ï¼ˆä¾‹å¦‚ï¼ŒListï¼ŒStringBufferç­‰ï¼‰ã€‚æ³¨æ„ï¼ŒByteBufferæ˜¯æœ€å¸¸ç”¨çš„ç¼“å†²åŒºï¼Œå› ä¸ºï¼š1ï¼‰<br>å®ƒæä¾›äº†è¯»å†™å…¶ä»–æ•°æ®ç±»å‹çš„æ–¹æ³•ï¼Œ2ï¼‰ä¿¡é“çš„è¯»å†™æ–¹æ³•åªæ¥æ”¶ByteBufferã€‚</p>
<h4 id="Bufferç´¢å¼•"><a href="#Bufferç´¢å¼•" class="headerlink" title="Bufferç´¢å¼•"></a>Bufferç´¢å¼•</h4><p>ç¼“å†²åŒºä¸ä»…ä»…æ˜¯ç”¨æ¥å­˜æ”¾ä¸€ç»„å…ƒç´ çš„åˆ—è¡¨ã€‚åœ¨è¯»å†™æ•°æ®æ—¶ï¼Œå®ƒæœ‰å†…éƒ¨çŠ¶æ€æ¥è·Ÿè¸ªç¼“å†²åŒºçš„å½“å‰ä½ç½®ï¼Œä»¥åŠæœ‰æ•ˆ<br>å¯è¯»æ•°æ®çš„ç»“æŸä½ç½®ç­‰ã€‚ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼Œæ¯ä¸ªç¼“å†²åŒºç»´æŠ¤äº†æŒ‡å‘å…¶å…ƒç´ åˆ—è¡¨çš„4ä¸ªç´¢å¼•ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚<br>ï¼ˆä¸ä¹…æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ç¼“å†²åŒºçš„å„ç§æ–¹æ³•æ¥ä¿®æ”¹ç´¢å¼•å€¼ã€‚ï¼‰   </p>
<table>
<thead>
<tr>
<th style="text-align:left">ç´¢å¼•</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">å­˜å–å™¨/ä¿®æ”¹å™¨/ç”¨æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">capacity</td>
<td style="text-align:left">ç¼“å†²åŒºçš„å…ƒç´ æ€»æ˜¯ï¼ˆä¸å¯ä¿®æ”¹ï¼‰</td>
<td style="text-align:left">int capacityï¼ˆï¼‰</td>
</tr>
<tr>
<td style="text-align:left">position</td>
<td style="text-align:left">ä¸‹ä¸€ä¸ªè¦è¯»/å†™çš„å…ƒç´ ï¼ˆä»0å¼€å§‹ï¼‰</td>
<td style="text-align:left">int position(), Buffer position(int newPosition)</td>
</tr>
<tr>
<td style="text-align:left">limit</td>
<td style="text-align:left">ç¬¬ä¸€ä¸ªä¸å¯è¯»/å†™å…ƒç´ </td>
<td style="text-align:left">int limit(), Buffer limit(int newLimit)</td>
</tr>
<tr>
<td style="text-align:left">mark</td>
<td style="text-align:left">ç”¨æˆ·é€‰å®šçš„position é«˜çš„å‰ä¸€ä¸ªä½ç½®æˆ–0</td>
<td style="text-align:left">Buffer mark(),Buffer reset()</td>
</tr>
</tbody>
</table>
<p>positionå’Œlimitä¹‹é—´çš„è·ç¦»æŒ‡ç¤ºäº†å¯è¯»å–/å­˜å…¥çš„å­—èŠ‚æ•°ï¼Œjavaä¸­æä¾›äº†ä¸¤ä¸ªæ–¹ä¾¿çš„æ–¹æ³•æ¥è®¡ç®—è¿™ä¸ªè·ç¦»ã€‚  </p>
<ul>
<li>boolean hasRemainingï¼ˆï¼‰ï¼šå½“ç¼“å†²åŒºè‡³å°‘è¿˜æœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¿”å›trueï¼›</li>
<li>int remainingï¼ˆï¼‰ï¼šè¿”å›ç¼“å†²åŒºåŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼›<br>åœ¨è¿™äº›å˜é‡ä¸­ï¼Œå§‹ç»ˆä¿æŒä»¥ä¸‹å…³ç³»ä¸å˜ï¼š<br>0  â‰¤ mark â‰¤ position â‰¤ limit â‰¤ capacity<br>markå˜é‡çš„å€¼â€œè®°å½•â€äº†ä¸€ä¸ªå°†æ¥å¯è¿”å›çš„ä½ç½®ï¼Œresetï¼ˆï¼‰æ–¹æ³•åˆ™å°†postionçš„å€¼è¿˜åŸæˆä¸Šæ¬¡è°ƒç”¨markï¼ˆï¼‰<br>æ–¹æ³•åçš„positionå€¼ï¼ˆé™¤éè¿™æ ·åšä¼šè¿èƒŒä¸Šé¢çš„ä¸å˜å…³ç³»ï¼‰ï¼›</li>
</ul>
<h4 id="Bufferåˆ›å»º"><a href="#Bufferåˆ›å»º" class="headerlink" title="Bufferåˆ›å»º"></a>Bufferåˆ›å»º</h4><p>&nbsp; &nbsp; &nbsp; &nbsp;é€šå¸¸ä½¿ç”¨åˆ†é…ç©ºé—´æˆ–åŒ…è£…ä¸€ä¸ªç°æœ‰çš„åŸºæœ¬ç±»å‹æ•°ç»„æ¥åˆ›å»ºç¼“å†²åŒºã€‚åˆ›å»ºByteBufferçš„é™æ€å·¥å‚æ–¹æ³•ï¼Œä»¥åŠ<br>ç›¸åº”çš„capacityï¼Œpositionï¼Œå’Œlimitçš„åˆå§‹å€¼ä¸‹è¡¨ã€‚æ‰€æœ‰æ–°åˆ›å»ºçš„Bufferå®ä¾‹éƒ½æ²¡æœ‰å®šä¹‰å…¶markå€¼ï¼Œ<br>åœ¨è°ƒç”¨mark()æ–¹æ³•å‰ï¼Œä»»ä½•è¯•å›¾ä½¿ç”¨reset()æ–¹æ³•æ¥è®¾ç½®positionçš„å€¼çš„æ“ä½œéƒ½å°†æŠ›å‡ºInvalidMarkExceptionå¼‚å¸¸ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">æ–¹æ³•</th>
<th style="text-align:left">capacity</th>
<th style="text-align:left">position</th>
<th style="text-align:left">limit</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ByteBuffer    allocate(int capacity)</td>
<td style="text-align:left">capacity</td>
<td style="text-align:left">0</td>
<td style="text-align:left">capacity</td>
</tr>
<tr>
<td style="text-align:left">ByteBuffer    allocateDirect(int capacity)</td>
<td style="text-align:left">capacity</td>
<td style="text-align:left">0</td>
<td style="text-align:left">capacity</td>
</tr>
<tr>
<td style="text-align:left">ByteBuffer    wrap(byte[] array)</td>
<td style="text-align:left">array.length</td>
<td style="text-align:left">0</td>
<td style="text-align:left">array.length</td>
</tr>
<tr>
<td style="text-align:left">ByteBuffer    wrap(byte[] array,int offer,int length)</td>
<td style="text-align:left">array.length</td>
<td style="text-align:left">offset</td>
<td style="text-align:left">offset-array.length</td>
</tr>
</tbody>
</table>
<p>è¦åˆ†é…ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œåªéœ€è¦ç®€å•åœ°è°ƒç”¨æƒ³è¦åˆ›å»ºçš„ç¼“å†²åŒºç±»å‹çš„allocate()é™æ€æ–¹æ³•ï¼Œå¹¶æŒ‡å®šå…ƒç´ çš„æ€»æ•°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer byteBuf = ByteBuffer.allocate(20);</span><br><span class="line">DoubleBuffer dblBuf = DoubleBuffer.allocate(5);</span><br></pre></td></tr></table></figure></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;åœ¨ä¸Šé¢ä»£ç ä¸­ï¼ŒbyteBufåˆ†é…äº†20ä¸ªå­—èŠ‚ï¼ŒdblBufåˆ†é…äº†5ä¸ªJavaçš„<br>doubleå‹æ•°æ®ã€‚è¿™äº›ç¼“å†²åŒºéƒ½æ˜¯å®šé•¿çš„ï¼Œå› æ­¤æ— æ³•æ‰©å±•æˆ–ç¼©å‡å®ƒä»¬çš„å®¹é‡ã€‚å¦‚æœå‘ç°åˆšåˆ›å»ºçš„ç¼“å†²åŒºå®¹é‡å¤ªå°ï¼Œ<br>æƒŸä¸€çš„é€‰æ‹©å°±æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªå¤§å°åˆé€‚çš„ç¼“å†²åŒºã€‚<br>è¿˜å¯ä»¥é€šè¿‡è°ƒç”¨wrap()é™æ€æ–¹æ³•ï¼Œä»¥ä¸€ä¸ªå·²æœ‰çš„æ•°ç»„ä¸ºå‚æ•°ï¼Œæ¥åˆ›å»ºç¼“å†²åŒºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">byteArray[] = new byte[BUFFERSIZE];</span><br><span class="line">// ...Fill array...</span><br><span class="line">ByteBuffer byteWrap = ByteBuffer.wrap(byteArray);</span><br><span class="line">ByteBuffer subByteWrap = ByteBuffer.wrap(byteArray, 3,3);</span><br></pre></td></tr></table></figure></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;é€šè¿‡åŒ…è£…çš„æ–¹æ³•åˆ›å»ºçš„ç¼“å†²åŒº <strong>ä¿ç•™äº†è¢«åŒ…è£…æ•°ç»„å†…ä¿å­˜çš„æ•°æ®</strong>ã€‚å®é™…ä¸Šï¼Œ<br>wrap()æ–¹æ³•åªæ˜¯ç®€å•åœ°åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰æŒ‡å‘è¢«åŒ…è£…æ•°ç»„çš„å¼•ç”¨çš„ç¼“å†²åŒºï¼Œè¯¥æ•°ç»„ç§°ä¸º <strong>åæ´æ•°ç»„</strong>ã€‚å¯¹åæ´æ•°ç»„<br>ä¸­çš„æ•°æ®åšçš„ä»»ä½•ä¿®æ”¹éƒ½å°†æ”¹å˜ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œåä¹‹äº¦ç„¶ã€‚å¦‚æœæˆ‘ä»¬ä¸ºwrap()æ–¹æ³•æŒ‡å®šäº†åç§»é‡ï¼ˆoffsetï¼‰<br>å’Œé•¿åº¦ï¼ˆlengthï¼‰ï¼Œç¼“å†²åŒºå°†ä½¿ç”¨æ•´ä¸ªæ•°ç»„ä¸ºåæ´æ•°ç»„ï¼ŒåŒæ—¶å°†positionå’Œlimitçš„å€¼åˆå§‹åŒ–ä¸ºåç§»é‡<br>ï¼ˆoffsetï¼‰å’Œåç§»é‡+é•¿åº¦ï¼ˆoffset+lengthï¼‰ã€‚åœ¨åç§»é‡ä¹‹å‰å’Œé•¿åº¦ä¹‹åçš„å…ƒç´ ä¾ç„¶å¯ä»¥é€šè¿‡ç¼“å†²åŒºè®¿é—®ã€‚<br>ä½¿ç”¨åˆ†é…ç©ºé—´çš„æ–¹å¼æ¥åˆ›å»ºç¼“å†²åŒºå…¶å®ä¸ä½¿ç”¨åŒ…è£…çš„æ–¹æ³•åŒºåˆ«ä¸å¤§ã€‚æƒŸä¸€çš„åŒºåˆ«æ˜¯allocate()æ–¹æ³•åˆ›å»ºäº†<br>è‡ªå·±çš„åæ´æ•°ç»„ã€‚åœ¨ç¼“å†²åŒºä¸Šè°ƒç”¨array()æ–¹æ³•å³å¯è·å¾—åæ´æ•°ç»„çš„å¼•ç”¨ã€‚é€šè¿‡è°ƒç”¨arrayOffset()æ–¹æ³•ï¼Œ<br>ç”šè‡³è¿˜å¯ä»¥è·å–ç¼“å†²åŒºä¸­ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨åæ´æ•°ç»„ä¸­çš„åç§»é‡ã€‚ä½¿ç”¨wrap()æ–¹æ³•å’Œéé›¶åç§»é‡å‚æ•°åˆ›å»ºçš„ç¼“å†²åŒºï¼Œ<br>å…¶æ•°ç»„åç§»é‡ä¾ç„¶æ˜¯0ã€‚<br>&nbsp; &nbsp; &nbsp; &nbsp;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®ç°çš„æ‰€æœ‰ç¼“å†²åŒºéƒ½å°†æ•°æ®å­˜æ”¾åœ¨Javaåˆ†é…çš„åæ´æ•°ç»„ä¸­ã€‚<br>é€šå¸¸ï¼Œåº•å±‚å¹³å°ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ä¸èƒ½ä½¿ç”¨è¿™äº›ç¼“å†²åŒºè¿›è¡ŒI/Oæ“ä½œã€‚æ“ä½œç³»ç»Ÿå¿…é¡»ä½¿ç”¨è‡ªå·±çš„ç¼“å†²åŒºæ¥è¿›è¡ŒI/Oï¼Œ<br>å¹¶å°†ç»“æœå¤åˆ¶åˆ°ç¼“å†²åŒºçš„åæ´æ•°ç»„ä¸­ã€‚è¿™äº›å¤åˆ¶è¿‡ç¨‹ <strong>å¯èƒ½éå¸¸è€—è´¹ç³»ç»Ÿèµ„æº</strong>ï¼Œå°¤å…¶æ˜¯åœ¨æœ‰å¾ˆå¤šè¯»å†™éœ€æ±‚çš„æ—¶å€™ã€‚<br>Javaçš„NIOæä¾›äº†ä¸€ç§ <strong>ç›´æ¥ç¼“å†²åŒºï¼ˆdirect buffersï¼‰</strong> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨ç›´æ¥ç¼“å†²åŒºï¼ŒJavaå°†ä»å¹³å°<br>èƒ½å¤Ÿç›´æ¥è¿›è¡ŒI/Oæ“ä½œçš„å­˜å‚¨ç©ºé—´ä¸­ä¸ºç¼“å†²åŒºåˆ†é…åæ´å­˜å‚¨ç©ºé—´ï¼Œä»è€Œçœç•¥äº†æ•°æ®çš„å¤åˆ¶è¿‡ç¨‹ã€‚è¿™ç§ä½å±‚çš„ã€<br>æœ¬åœ°çš„I/Oé€šå¸¸åœ¨å­—èŠ‚å±‚è¿›è¡Œæ“ä½œï¼Œå› æ­¤åªèƒ½ä¸º <strong>ByteBufferè¿›è¡Œç›´æ¥ç¼“å†²åŒºåˆ†é…</strong> ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer byteBufDirect =ByteBuffer.allocateDirect(BUFFERSIZE);</span><br></pre></td></tr></table></figure></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;é€šè¿‡è°ƒç”¨isDirect()æ–¹æ³•å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªç¼“å†²åŒºæ˜¯å¦æ˜¯ç›´æ¥ç¼“å†²åŒºã€‚ç”±äº<br>ç›´æ¥ç¼“å†²åŒºæ²¡æœ‰åæ´æ•°ç»„ï¼Œåœ¨å®ƒä¸Šé¢è°ƒç”¨array()æˆ–arrayOffset()æ–¹æ³•éƒ½å°†æŠ›å‡º<br>UnsupportedOperationExceptionå¼‚å¸¸ã€‚åœ¨è€ƒè™‘æ˜¯å¦ä½¿ç”¨ç›´æ¥ç¼“å†²åŒºæ—¶éœ€è¦ç‰¢è®°å‡ ç‚¹ã€‚é¦–å…ˆï¼Œè¦çŸ¥é“è°ƒç”¨<br>allocateDirect()æ–¹æ³•å¹¶ä¸èƒ½ä¿è¯èƒ½æˆåŠŸåˆ†é…ç›´æ¥ç¼“å†²åŒºâ€“æœ‰çš„å¹³å°æˆ–JVMå¯èƒ½ä¸æ”¯æŒè¿™ä¸ªæ“ä½œï¼Œå› æ­¤åœ¨<br>å°è¯•åˆ†é…ç›´æ¥ç¼“å†²åŒºåå¿…é¡»è°ƒç”¨isDirect()æ–¹æ³•è¿›è¡Œæ£€æŸ¥ã€‚å…¶æ¬¡ï¼Œè¦çŸ¥é“ <strong>åˆ†é…å’Œé”€æ¯ç›´æ¥ç¼“å†²åŒºé€šå¸¸æ¯”åˆ†é…<br>å’Œé”€æ¯éç›´æ¥ç¼“å†²åŒºè¦æ¶ˆè€—æ›´å¤šçš„ç³»ç»Ÿèµ„æº</strong>ï¼Œå› ä¸ºç›´æ¥ç¼“å†²åŒºçš„åæ´å­˜å‚¨ç©ºé—´é€šå¸¸å­˜åœ¨ä¸JVMä¹‹å¤–ï¼Œå¯¹å®ƒçš„ç®¡ç†<br>éœ€è¦ä¸æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚æ‰€ä»¥ï¼Œåªæœ‰å½“éœ€è¦åœ¨å¾ˆå¤šI/Oæ“ä½œä¸Šé•¿æ—¶é—´ä½¿ç”¨æ—¶ï¼Œæ‰åˆ†é…ç›´æ¥ç¼“å†²åŒºã€‚å®é™…ä¸Šï¼Œ<br>åœ¨ç›¸å¯¹äºéç›´æ¥ç¼“å†²åŒºèƒ½æ˜æ˜¾æé«˜ç³»ç»Ÿæ€§èƒ½æ—¶ï¼Œä½¿ç”¨ç›´æ¥ç¼“å†²åŒºæ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚</p>
<h4 id="å­˜å‚¨å’Œæ¥å—æ•°æ®"><a href="#å­˜å‚¨å’Œæ¥å—æ•°æ®" class="headerlink" title="å­˜å‚¨å’Œæ¥å—æ•°æ®"></a>å­˜å‚¨å’Œæ¥å—æ•°æ®</h4><p>&nbsp; &nbsp; &nbsp; &nbsp;åªè¦æœ‰äº†ç¼“å†²åŒºï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥å­˜æ”¾æ•°æ®äº†ã€‚ä½œä¸ºæ•°æ®çš„â€å®¹å™¨â€ï¼Œç¼“å†²åŒº<br><strong>æ—¢å¯ç”¨æ¥è¾“å…¥ä¹Ÿå¯ç”¨æ¥è¾“å‡ºã€‚è¿™ä¸€ç‚¹å°±ä¸æµä¸åŒï¼Œæµåªèƒ½å‘ä¸€ä¸ªæ–¹å‘ä¼ é€’æ•°æ®</strong>ã€‚ä½¿ç”¨put()æ–¹æ³•å¯ä»¥å°†æ•°æ®æ”¾å…¥<br>ç¼“å†²åŒºï¼Œä½¿ç”¨get()æ–¹æ³•åˆ™å¯ä»¥ä»ç¼“å†²åŒºè·å–æ•°æ®ã€‚ä¿¡é“çš„read()æ–¹æ³•éšå¼è°ƒç”¨äº†ç»™å®šç¼“å†²åŒºçš„put()ï¼Œè€Œå…¶<br>write()æ–¹æ³•åˆ™éšå¼è°ƒç”¨äº†ç¼“å†²åŒºçš„get()æ–¹æ³•ã€‚ä¸‹é¢å±•ç¤ºByteBufferçš„get()å’Œput()æ–¹æ³•ï¼Œå½“ç„¶ï¼Œå…¶ä»–<br>ç±»å‹çš„ç¼“å†²åŒºä¹Ÿæœ‰ç±»ä¼¼çš„æ–¹æ³•ã€‚<br>ByteBuffer:è·å–å’Œå­˜æ”¾å­—èŠ‚ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„get()å’Œput()ï¼šåŸºäºç›¸å¯¹ä½ç½®å’ŒåŸºäºç»å¯¹ä½ç½®ã€‚åŸºäºç›¸å¯¹ä½ç½®<br>çš„ç‰ˆæœ¬æ ¹æ®positionçš„å½“å‰å€¼ï¼Œä»â€ä¸‹ä¸€ä¸ªâ€ä½ç½®è¯»å–æˆ–å­˜æ”¾æ•°æ®ï¼Œç„¶åæ ¹æ®æ•°æ®é‡ç»™positionå¢åŠ é€‚å½“çš„å€¼<br>ï¼ˆå³ï¼Œå•å­—èŠ‚å½¢å¼å¢åŠ 1æ•°ç»„å½¢å¼å¢åŠ array.lengthï¼Œ     æ•°ç»„/åç§»é‡/é•¿åº¦å½¢å¼åˆ™å¢åŠ lengthï¼‰ã€‚ä¹Ÿå°±æ˜¯<br>è¯´ï¼Œæ¯æ¬¡è°ƒç”¨put()æ–¹æ³•ï¼Œéƒ½æ˜¯åœ¨ç¼“å†²åŒºä¸­çš„å·²æœ‰å…ƒç´ åé¢è¿½åŠ æ•°æ®ï¼Œæ¯æ¬¡è°ƒç”¨get()æ–¹æ³•ï¼Œéƒ½æ˜¯è¯»å–ç¼“å†²åŒºçš„<br>åç»­å…ƒç´ ã€‚ä¸è¿‡ï¼Œå¦‚æœè¿™äº›æ“ä½œä¼šå¯¼è‡´positionçš„å€¼è¶…å‡ºlimitçš„é™åˆ¶ï¼Œget()æ–¹æ³•å°†æŠ›å‡ºBufferUnderflowExceptionå¼‚å¸¸ï¼Œ<br>put()æ–¹æ³•å°†æŠ›å‡ºBufferOverflowExceptionå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¼ ç»™get()æ–¹æ³•çš„ç›®æ ‡æ•°ç»„é•¿åº¦å¤§äºç¼“å†²åŒº<br>çš„å‰©ä½™ç©ºé—´å¤§å°ï¼Œget()æ–¹æ³•å°†æŠ›å‡ºBufferUnderflowExceptionå¼‚å¸¸ï¼Œéƒ¨åˆ†æ•°æ®çš„get/putæ˜¯ä¸å…è®¸çš„ã€‚<br>åŸºäºç»å¯¹ä½ç½®çš„get()å’Œput()ä»¥æŒ‡å®šçš„ç´¢å¼•ä½ç½®ä¸ºå‚æ•°ï¼Œä»è¯¥ä½ç½®è¯»å–æ•°æ®æˆ–å‘è¯¥ä½ç½®å†™å…¥æ•°æ®ã€‚ç»å¯¹ä½ç½®<br>å½¢å¼çš„getå’Œputä¸ä¼šæ”¹å˜positionçš„å€¼ã€‚å¦‚æœç»™å®šçš„ç´¢å¼•å€¼è¶…å‡ºäº†limitçš„é™åˆ¶ï¼Œå®ƒä»¬å°†æŠ›å‡ºIndexOutOfBoundsExceptionå¼‚å¸¸ã€‚<br>é™¤äº†å­—èŠ‚ç±»å‹å¤–ï¼ŒByteBufferç±»è¿˜æä¾›äº†å…¶ä»–ç±»å‹æ•°æ®çš„ç›¸å½“ä½ç½®å’Œç»å¯¹ä½ç½®çš„get/putæ–¹æ³•ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±æœ‰ç‚¹åƒDataOutputStreamäº†ã€‚</p>
<ul>
<li>ç›¸å¯¹ä½ç½®ï¼š<ul>
<li>byte get()</li>
<li>ByteBuffer get(byte[] dst)</li>
<li>ByteBuffer get(byte[] dst, int offset, int length)</li>
<li>ByteBuffer put(byte b)</li>
<li>ByteBuffer put(byte[] src)</li>
<li>ByteBuffer put(byte[] src, int offset, int length)</li>
<li>ByteBuffer put(ByteBuffer src)</li>
</ul>
</li>
<li><p>ç»å¯¹ä½ç½®ï¼š</p>
<ul>
<li>byte get(int index)</li>
<li>ByteBuffer put(int index, byte b)</li>
</ul>
</li>
<li><p>ByteBuffer:è¯»å–å’Œå­˜æ”¾Javaå¤šå­—èŠ‚åŸºæœ¬æ•°æ®</p>
<ul>
<li><type> get<type>()</type></type></li>
<li><type> get<type>(int index)</type></type></li>
<li>ByteBuffer put<type>(<type> value)</type></type></li>
<li>ByteBuffer put<type>(int index,<type> value)</type></type></li>
</ul>
</li>
</ul>
<p>&nbsp; &nbsp; &nbsp; &nbsp;å…¶ä¸­â€<type>â€œä»£è¡¨Charï¼ŒDoubleï¼ŒIntï¼ŒLongï¼ŒShortä¹‹ä¸€ï¼Œ<br>è€Œâ€<type>â€œä»£è¡¨charï¼Œdoubleï¼Œintï¼Œlongï¼Œshortä¹‹ä¸€ã€‚<br>æ¯æ¬¡è°ƒç”¨åŸºäºç›¸å¯¹ä½ç½®çš„put()æˆ–get()æ–¹æ³•ï¼Œéƒ½å°†æ ¹æ®ç‰¹å®šå‚æ•°ç±»å‹çš„é•¿åº¦å¢åŠ positionçš„å€¼ï¼šshortåŠ 2ï¼Œ<br>intåŠ 4ï¼Œç­‰ã€‚ä¸è¿‡ï¼Œå¦‚æœè¿™æ ·åšä¼šå¯¼è‡´positionçš„å€¼è¶…å‡ºlimitçš„é™åˆ¶ï¼Œget()å’Œput()æ–¹æ³•å°†åˆ†åˆ«æŠ›å‡º<br>BufferUnderflowExceptionå’ŒBufferOverflowExceptionå¼‚å¸¸ï¼šgetå’Œputä¸å…è®¸åªå¯¹éƒ¨åˆ†æ•°æ®è¿›è¡Œæ“ä½œã€‚<br>å‘ç”Ÿäº†ä¸‹æº¢/ä¸Šæº¢ï¼ˆunder/overflowï¼‰æ—¶ï¼Œpositionçš„å€¼ä¸å˜ã€‚å¯èƒ½ä½ å·²ç»æ³¨æ„åˆ°ï¼Œå¾ˆå¤šget/putæ–¹æ³•éƒ½<br>è¿”å›ä¸€ä¸ªByteBufferã€‚å®é™…ä¸Šå®ƒä»¬è¿”å›çš„å°±æ˜¯è°ƒç”¨å®ƒä»¬çš„é‚£ä¸ªByteBufferã€‚è¿™æ ·åšå¯ä»¥å®ç° <strong>é“¾å¼è°ƒç”¨ï¼ˆcall chainingï¼‰</strong>ï¼Œ<br>å³ç¬¬ä¸€æ¬¡è°ƒç”¨çš„ç»“æœå¯ä»¥ç›´æ¥ç”¨æ¥è¿›è¡Œåç»­çš„æ–¹æ³•è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åƒä¸‹é¢é‚£æ ·å°†æ•´æ•°1å’Œ2å­˜å…¥ByteBufferå®ä¾‹<br>myBufferä¸­ï¼šmyBuffer.putInt(1).putInt(2);<br>&nbsp; &nbsp; &nbsp; &nbsp;<strong>å¤šå­—èŠ‚æ•°æ®ç±»å‹æœ‰ä¸€ä¸ªå­—èŠ‚é¡ºåºï¼Œç§°ä¸ºbig-endianæˆ–little-endianã€‚<br>Javaé»˜è®¤ä½¿ç”¨big-endian</strong>ã€‚é€šè¿‡ä½¿ç”¨å†…ç½®çš„ByteOrder.BIG_ENDIANå’ŒByteOrder.LITTLE_ENDIANå®ä¾‹ï¼Œ<br>å¯ä»¥è·å–å’Œè®¾å®šå¤šå­—èŠ‚æ•°æ®ç±»å‹å†™å…¥å­—èŠ‚ç¼“å†²åŒºæ—¶çš„å­—èŠ‚é¡ºåºã€‚</type></type></p>
<ul>
<li>ByteBuffer:ç¼“å†²åŒºä¸­çš„å­—èŠ‚é¡ºåº<ul>
<li>ByteOrder order()</li>
<li>ByteBuffer order(ByteOrder order)<br>ç¬¬ä¸€ä¸ªæ–¹æ³•ä»¥ByteOrderå¸¸é‡çš„å½¢å¼è¿”å›ç¼“å†²åŒºçš„å½“å‰å­—èŠ‚é¡ºåºã€‚ç¬¬äºŒä¸ªæ–¹æ³•ç”¨æ¥è®¾ç½®å†™å¤šå­—èŠ‚æ•°æ®æ—¶çš„å­—èŠ‚é¡ºåºã€‚</li>
</ul>
</li>
</ul>
<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªä½¿ç”¨å­—èŠ‚é¡ºåºçš„ä¾‹å­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buffer = ByteBuffer.allocate(4);</span><br><span class="line">buffer.putShort((short) 1);</span><br><span class="line">buffer.order(ByteOrder.LITTLE_ENDIAN);</span><br><span class="line">buffer.putShort((short) 1);</span><br><span class="line">// Predict the byte values for buffer and test your prediction</span><br></pre></td></tr></table></figure></p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;çœ‹äº†è¿™äº›æœ‰å…³å­—èŠ‚é¡ºåºçš„è®¨è®ºï¼Œä½ å¯èƒ½å¸Œæœ›çŸ¥é“è‡ªå·±çš„å¤„ç†å™¨æ˜¯ä»€ä¹ˆå­—èŠ‚<br>é¡ºåºï¼ŒByteOrderå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•æ¥è§£ç­”è¿™ä¸ªé—®é¢˜ï¼š<br>ByteOrder:æŸ¥æ‰¾å­—èŠ‚é¡ºåº<br>static final ByteOrder BIG_ENDIAN<br>static final ByteOrder LITTLE_ENDIAN<br>static ByteOrder nativeOrder()<br>nativeOrder()æ–¹æ³•è¿”å›å¸¸é‡BIG_ENDIANæˆ–LITTLE_ENDIANä¹‹ä¸€ã€‚</p>
<h4 id="Bufferå‡†å¤‡ï¼šclearï¼ˆï¼‰ã€flipï¼ˆï¼‰å’Œrewindï¼ˆï¼‰"><a href="#Bufferå‡†å¤‡ï¼šclearï¼ˆï¼‰ã€flipï¼ˆï¼‰å’Œrewindï¼ˆï¼‰" class="headerlink" title="Bufferå‡†å¤‡ï¼šclearï¼ˆï¼‰ã€flipï¼ˆï¼‰å’Œrewindï¼ˆï¼‰"></a>Bufferå‡†å¤‡ï¼šclearï¼ˆï¼‰ã€flipï¼ˆï¼‰å’Œrewindï¼ˆï¼‰</h4><p>åœ¨ä½¿ç”¨ç¼“å†²åŒºè¿›è¡Œè¾“å…¥è¾“å‡ºæ•°æ®ä¹‹å‰ï¼Œå¿…é¡»ç¡®å®šç¼“å†²åŒºçš„positionï¼Œlimitéƒ½å·²ç»è®¾ç½®äº†æ­£ç¡®çš„å€¼ã€‚é¦–å…ˆ<br>æˆ‘ä»¬çœ‹çœ‹ä¸Šé¢ä¸‰ä¸ªæ–¹æ³•å¯¹positionå’Œlimitçš„ä¿®æ”¹æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">ByteBufferæ–¹æ³•</th>
<th style="text-align:left">å‡†å¤‡Bufferä»¥å®ç°</th>
<th style="text-align:left">position</th>
<th style="text-align:left">limit</th>
<th style="text-align:left">mark</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">clear()</td>
<td style="text-align:left">å°†æ•°æ®read()/put()è¿›ç¼“å†²åŒº</td>
<td style="text-align:left">0</td>
<td style="text-align:left">capacity</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">flip()</td>
<td style="text-align:left">ä»ç¼“å†²åŒºwrite()/get()</td>
<td style="text-align:left">0</td>
<td style="text-align:left">position</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">rewind()</td>
<td style="text-align:left">ä»ç¼“å†²åŒºrewrite()/get()</td>
<td style="text-align:left">0</td>
<td style="text-align:left">unchanged</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
</tbody>
</table>
<p>ä¸‰ç§åœ¨Bufferç±»çš„æºç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * Clears this buffer.  The position is set to zero, the limit is set to</span><br><span class="line">    * the capacity, and the mark is discarded.</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt; Invoke this method before using a sequence of channel-read or</span><br><span class="line">    * &lt;i&gt;put&lt;/i&gt; operations to fill this buffer.  For example:</span><br><span class="line">    *</span><br><span class="line">    * &lt;blockquote&gt;&lt;pre&gt;</span><br><span class="line">    * buf.clear();     // Prepare buffer for reading</span><br><span class="line">    * in.read(buf);    // Read data&lt;/pre&gt;&lt;/blockquote&gt;</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt; This method does not actually erase the data in the buffer, but it</span><br><span class="line">    * is named as if it did because it will most often be used in situations</span><br><span class="line">    * in which that might as well be the case. &lt;/p&gt;</span><br><span class="line">    *</span><br><span class="line">    * @return  This buffer</span><br><span class="line">    */</span><br><span class="line">   public final Buffer clear() &#123;</span><br><span class="line">       position = 0;</span><br><span class="line">       limit = capacity;</span><br><span class="line">       mark = -1;</span><br><span class="line">       return this;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * Flips this buffer.  The limit is set to the current position and then</span><br><span class="line">    * the position is set to zero.  If the mark is defined then it is</span><br><span class="line">    * discarded.</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt; After a sequence of channel-read or &lt;i&gt;put&lt;/i&gt; operations, invoke</span><br><span class="line">    * this method to prepare for a sequence of channel-write or relative</span><br><span class="line">    * &lt;i&gt;get&lt;/i&gt; operations.  For example:</span><br><span class="line">    *</span><br><span class="line">    * &lt;blockquote&gt;&lt;pre&gt;</span><br><span class="line">    * buf.put(magic);    // Prepend header</span><br><span class="line">    * in.read(buf);      // Read data into rest of buffer</span><br><span class="line">    * buf.flip();        // Flip buffer</span><br><span class="line">    * out.write(buf);    // Write header + data to channel&lt;/pre&gt;&lt;/blockquote&gt;</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt; This method is often used in conjunction with the &#123;@link</span><br><span class="line">    * java.nio.ByteBuffer#compact compact&#125; method when transferring data from</span><br><span class="line">    * one place to another.  &lt;/p&gt;</span><br><span class="line">    *</span><br><span class="line">    * @return  This buffer</span><br><span class="line">    */</span><br><span class="line">   public final Buffer flip() &#123;</span><br><span class="line">       limit = position;</span><br><span class="line">       position = 0;</span><br><span class="line">       mark = -1;</span><br><span class="line">       return this;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * Rewinds this buffer.  The position is set to zero and the mark is</span><br><span class="line">    * discarded.</span><br><span class="line">    *</span><br><span class="line">    * &lt;p&gt; Invoke this method before a sequence of channel-write or &lt;i&gt;get&lt;/i&gt;</span><br><span class="line">    * operations, assuming that the limit has already been set</span><br><span class="line">    * appropriately.  For example:</span><br><span class="line">    *</span><br><span class="line">    * &lt;blockquote&gt;&lt;pre&gt;</span><br><span class="line">    * out.write(buf);    // Write remaining data</span><br><span class="line">    * buf.rewind();      // Rewind buffer</span><br><span class="line">    * buf.get(array);    // Copy data into array&lt;/pre&gt;&lt;/blockquote&gt;</span><br><span class="line">    *</span><br><span class="line">    * @return  This buffer</span><br><span class="line">    */</span><br><span class="line">   public final Buffer rewind() &#123;</span><br><span class="line">       position = 0;</span><br><span class="line">       mark = -1;</span><br><span class="line">       return this;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>è§£é‡Šï¼šï¼ˆå‚è€ƒï¼š<a href="https://blog.csdn.net/FS1360472174/article/details/52141800ï¼‰" target="_blank" rel="noopener">https://blog.csdn.net/FS1360472174/article/details/52141800ï¼‰</a></p>
<ul>
<li>clear: clear å¹¶æ²¡æœ‰çœŸæ­£çš„æ¸…é™¤æ•°æ®ï¼Œå°†positionè®¾ç½®ä¸º0ï¼Œlimitè®¾ç½®ä¸ºcapacity;</li>
<li><p>flip ï¼šä¸€èˆ¬æ˜¯åˆ‡æ¢åˆ°è¯»æ“ä½œã€‚æˆ–è€…æ˜¯ä¸ºå†™æ“ä½œå‡†å¤‡ä¸€ä¸ªæ–°çš„åºåˆ—<br>egï¼šé‡å¤å‘ä¸€ä¸ªByteBufferå†™æ•°æ®çš„æ—¶å€™ï¼Œèµ‹å€¼å®Œæ¯•ï¼Œå¿…é¡»è¦flip.å¼€å§‹ä¸€ä¸ªæ–°çš„æ–°åºåˆ—ï¼Œå¦åˆ™position<br>ä¼šç­‰äºlimitï¼Œè¿”å›ç©ºå€¼</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">       byte[] bytes1=new byte[]&#123;1, 6, 3&#125;;</span><br><span class="line">       ByteBuffer buffer =fromByteArray(bytes1);</span><br><span class="line">       System.out.println(buffer);</span><br><span class="line">       byte[] bytes2 =new byte[]&#123;1,2,3&#125;;</span><br><span class="line">       ByteBuffer buffer2=fromByteArray(bytes2);</span><br><span class="line">       System.out.println(buffer2);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">    * If you are building up a ByteBuffer by repeatedly writing into it, and then want to give it away, you must remember to flip() it.</span><br><span class="line">    * If we did not flip() it, the returned ByteBuffer would be empty because the position would be equal to the limit.</span><br><span class="line">    * @param bytes</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">   public static ByteBuffer fromByteArray(byte[] bytes) &#123;</span><br><span class="line">       final ByteBuffer ret = ByteBuffer.wrap(new byte[bytes.length]);</span><br><span class="line"></span><br><span class="line">       ret.put(bytes);</span><br><span class="line">       ret.flip();</span><br><span class="line"></span><br><span class="line">       return ret;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>rewind:å€’å›ï¼Œå°†position è®¾ç½®ä¸º0ï¼Œé‡æ–°è¯»å–;</p>
</li>
</ul>
<h4 id="å‹ç¼©Bufferä¸­æ•°æ®"><a href="#å‹ç¼©Bufferä¸­æ•°æ®" class="headerlink" title="å‹ç¼©Bufferä¸­æ•°æ®"></a>å‹ç¼©Bufferä¸­æ•°æ®</h4><p>compact()æ–¹æ³•å°†positionä¸limitä¹‹é—´çš„å…ƒç´ å¤åˆ¶åˆ°ç¼“å†²åŒºçš„å¼€å§‹ä½ç½®ï¼Œä»è€Œä¸ºåç»­çš„put()/read()è°ƒ<br>ç”¨è®©å‡ºç©ºé—´ã€‚positionçš„å€¼å°†è®¾ç½®ä¸ºè¦å¤åˆ¶çš„æ•°æ®çš„é•¿åº¦ï¼Œlimitçš„å€¼å°†è®¾ç½®ä¸ºcapacityï¼Œmarkåˆ™å˜æˆæœªå®šä¹‰ã€‚<br>ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] arg) &#123;</span><br><span class="line">      byte[] bytes = new byte[]&#123;1, 6, 3, 1, 1, 1, 1, 1, 1, 1, 1&#125;;</span><br><span class="line"></span><br><span class="line">      ByteBuffer buffer = ByteBuffer.wrap(bytes);</span><br><span class="line">      byte b = buffer.get();</span><br><span class="line">      System.out.println(&quot;b:&quot; + b + &quot; position:&quot; + buffer.position()+&quot; limit:&quot;+buffer.limit()+&quot; capacity:&quot;+buffer.capacity());</span><br><span class="line">      buffer.compact();</span><br><span class="line">      System.out.println(&quot;compact  position:&quot; + buffer.position()+&quot; limit:&quot;+buffer.limit()+&quot; capacity:&quot;+buffer.capacity());</span><br><span class="line">      buffer.flip();</span><br><span class="line">      System.out.println(&quot;flip  position:&quot; + buffer.position()+&quot; limit:&quot;+buffer.limit()+&quot; capacity:&quot;+buffer.capacity());</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š<br>b:1 position:1 limit:11 capacity:11<br>compact  position:10 limit:11 capacity:11<br>flip  position:0 limit:10 capacity:11</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™ä¸ªæ“ä½œå‘¢ï¼Ÿå‡è®¾ä½ æœ‰ä¸€ä¸ªç¼“å†²åŒºè¦å†™æ•°æ®ã€‚å›é¡¾å‰é¢çš„å†…å®¹æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹write()æ–¹æ³•çš„éé˜»å¡è°ƒç”¨åªä¼šå†™å‡ºå…¶èƒ½å¤Ÿå‘é€çš„æ•°æ®ï¼Œè€Œä¸ä¼šé˜»å¡ç­‰å¾…æ‰€æœ‰æ•°æ®å‘é€å®Œã€‚å› æ­¤write()æ–¹æ³•ä¸ä¸€å®šä¼šå°†ç¼“å†²åŒºä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å‘é€å‡ºå»ã€‚åˆå‡è®¾ç°åœ¨è¦è°ƒç”¨read()æ–¹æ³•ï¼Œåœ¨ç¼“å†²åŒºä¸­æ²¡æœ‰å‘é€çš„æ•°æ®åé¢è¯»å…¥æ–°æ•°æ®ã€‚å¤„ç†æ–¹æ³•ä¹‹ä¸€å°±æ˜¯ç®€å•åœ°è®¾ç½®position = limitå’Œlimit = capacityã€‚å½“ç„¶ï¼Œåœ¨è¯»å…¥æ–°æ•°æ®åï¼Œå†æ¬¡è°ƒç”¨write()æ–¹æ³•å‰ï¼Œè¿˜éœ€è¦å°†è¿™äº›å€¼è¿˜åŸã€‚è¿™æ ·åšæœ‰ä¸ªé—®é¢˜å³ç¼“å†²åŒºçš„ç©ºé—´æœ€ç»ˆå°†æ¶ˆè€—æ®†å°½ï¼Œå¦‚ä¸Šå›¾ä¸­ï¼Œåªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ä½ç½®å¯ä»¥å†å­˜å…¥ä¸€ä¸ªå­—èŠ‚ã€‚æ­¤å¤–ï¼Œç¼“å†²åŒºå‰é¢çš„ç©ºé—´åˆè¢«æµªè´¹æ‰äº†ã€‚è¿™å°±æ˜¯compact()æ–¹æ³•è¦è§£å†³çš„é—®é¢˜ã€‚åœ¨è°ƒç”¨write()æ–¹æ³•åå’Œæ·»åŠ æ–°æ•°æ®çš„read()æ–¹æ³•å‰è°ƒç”¨compact()æ–¹æ³•ï¼Œåˆ™å°†æ‰€æœ‰â€å‰©ä½™â€çš„æ•°æ®ç§»åŠ¨åˆ°ç¼“å†²åŒºçš„å¼€å¤´ï¼Œä»è€Œä¸ºé‡Šæ”¾æœ€å¤§çš„ç©ºé—´æ¥å­˜æ”¾æ–°æ•°æ®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// Start with buffer ready for reading</span><br><span class="line">while (channel.read(buffer) != -1) &#123;</span><br><span class="line">buffer.flip();</span><br><span class="line">channel.write(buffer);</span><br><span class="line">buffer.compact();</span><br><span class="line">&#125;</span><br><span class="line">while (buffer.hasRemaining())</span><br><span class="line">channel.write(buffer);</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œå¦‚å¼€å§‹å·²ç»æåˆ°çš„ï¼Œå¤åˆ¶æ•°æ®æ˜¯ä¸€ä¸ªéå¸¸è€—è´¹ç³»ç»Ÿèµ„æºçš„æ“ä½œï¼Œå› æ­¤è¦ä¿å®ˆåœ°ä½¿ç”¨compact()æ–¹æ³•ã€‚</p>
<h4 id="Bufferé€è§†ï¼šduplicate-slice-ç­‰"><a href="#Bufferé€è§†ï¼šduplicate-slice-ç­‰" class="headerlink" title="Bufferé€è§†ï¼šduplicate(),slice()ç­‰"></a>Bufferé€è§†ï¼šduplicate(),slice()ç­‰</h4><p>&nbsp; &nbsp; &nbsp; &nbsp;NIOæä¾›äº†å¤šç§æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªä¸ç»™å®šç¼“å†²åŒºå…±äº«å†…å®¹çš„æ–°ç¼“å†²åŒºï¼Œè¿™äº›æ–¹æ³•å¯¹å…ƒç´ çš„å¤„ç†è¿‡ç¨‹å„æœ‰ä¸åŒã€‚åŸºæœ¬ä¸Šï¼Œè¿™ç§æ–°ç¼“å†²åŒºæœ‰è‡ªå·±ç‹¬ç«‹çš„çŠ¶æ€å˜é‡ï¼ˆpositionï¼Œlimitï¼Œcapacityå’Œmarkï¼‰ï¼Œä½†ä¸åŸå§‹ç¼“å†²åŒºå…±äº«äº†åŒä¸€ä¸ªåæ´å­˜å‚¨ç©ºé—´ã€‚ä»»ä½•å¯¹æ–°ç¼“å†²åŒº <strong>å†…å®¹</strong> çš„ä¿®æ”¹éƒ½å°†åæ˜ åˆ° <strong>åŸå§‹ç¼“å†²åŒºä¸Š</strong> ã€‚å¯ä»¥å°†æ–°ç¼“å†²åŒºçœ‹ä½œæ˜¯ä»å¦ä¸€ä¸ªè§’åº¦å¯¹åŒä¸€æ•°æ®çš„é€è§†ã€‚</p>
<p>duplicate()æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªä¸åŸå§‹ç¼“å†²åŒºå…±äº«å†…å®¹çš„æ–°ç¼“å†²åŒºã€‚æ–°ç¼“å†²åŒºçš„positionï¼Œlimitï¼Œmarkå’Œcapacityéƒ½åˆå§‹åŒ–ä¸ºåŸå§‹ç¼“å†²åŒºçš„ç´¢å¼•å€¼ï¼Œç„¶è€Œï¼Œå®ƒä»¬çš„è¿™äº›å€¼æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚å¦‚ä¸‹è¡¨æ ¼ä¸ºåœ¨ByteBufferä¸Šåˆ›å»ºä¸åŒé€è§†çš„æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">æ–¹æ³•</th>
<th style="text-align:left">capacity</th>
<th style="text-align:left">position</th>
<th style="text-align:left">limit</th>
<th style="text-align:left">mark</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">duplicate()</td>
<td style="text-align:left">capacity</td>
<td style="text-align:left">position</td>
<td style="text-align:left">limit</td>
<td style="text-align:left">mark</td>
</tr>
<tr>
<td style="text-align:left">slice()</td>
<td style="text-align:left">remaining()</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">asReadOnlyBuffer()</td>
<td style="text-align:left">capacity</td>
<td style="text-align:left">position</td>
<td style="text-align:left">limit</td>
<td style="text-align:left">mark</td>
</tr>
<tr>
<td style="text-align:left">asCharBuffer()</td>
<td style="text-align:left">remaining()/2</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()/2</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">asDoubleBuffer()</td>
<td style="text-align:left">remaining()/4</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()/4</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">asFloatBuffer()</td>
<td style="text-align:left">remaining()/4</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()/4</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">asIntBuffer()</td>
<td style="text-align:left">remaining()/4</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()/4</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">asLongBuffer()</td>
<td style="text-align:left">remaining()/8</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()/8</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
<tr>
<td style="text-align:left">asShortBuffer()</td>
<td style="text-align:left">remaining()/2</td>
<td style="text-align:left">0</td>
<td style="text-align:left">remaining()/2</td>
<td style="text-align:left">ä¸ºå®šä¹‰</td>
</tr>
</tbody>
</table>
<p>&nbsp; &nbsp; &nbsp; &nbsp;ç”±äºå…±äº«äº†å†…å®¹ï¼Œå¯¹åŸå§‹ç¼“å†²åŒºæˆ–ä»»ä½•å¤æœ¬æ‰€åšçš„æ”¹å˜åœ¨æ‰€æœ‰å¤æœ¬ä¸Šéƒ½å¯è§ã€‚<br>ä¸‹é¢å›åˆ°å‰é¢çš„ä¾‹å­ï¼Œå‡è®¾è¦å°†åœ¨ç½‘ç»œä¸Šå‘é€çš„æ‰€æœ‰æ•°æ®éƒ½å†™è¿›æ—¥å¿—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Start with buffer ready for writing</span><br><span class="line">ByteBuffer logBuffer = buffer.duplicate();</span><br><span class="line">while (buffer.hasRemaining()) // Write all data to network</span><br><span class="line">networkChannel.write(buffer);</span><br><span class="line">while (logBuffer.hasRemaining()) // Write all data to</span><br><span class="line">//logger</span><br><span class="line">loggerChannel.write(buffer);</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œä½¿ç”¨äº†ç¼“å†²åŒºå¤åˆ¶æ“ä½œï¼Œå‘ç½‘ç»œå†™æ•°æ®å’Œå†™æ—¥å¿—å°±å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¹¶è¡Œè¿›è¡Œã€‚slice()æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªå…±äº«äº†åŸå§‹ç¼“å†²åŒºå­åºåˆ—çš„æ–°ç¼“å†²åŒºã€‚æ–°ç¼“å†²åŒºçš„positionå€¼æ˜¯0ï¼Œè€Œå…¶limitå’Œcapacityçš„å€¼éƒ½ç­‰äºåŸå§‹ç¼“å†²åŒºçš„limitå’Œpositionçš„å·®å€¼ã€‚slice()æ–¹æ³•å°†æ–°ç¼“å†²åŒºæ•°ç»„çš„offsetå€¼è®¾ç½®ä¸ºåŸå§‹ç¼“å†²åŒºçš„positionå€¼ï¼Œç„¶è€Œï¼Œåœ¨æ–°ç¼“å†²åŒºä¸Šè°ƒç”¨array()æ–¹æ³•è¿˜æ˜¯ä¼šè¿”å›æ•´ä¸ªæ•°ç»„ã€‚<br>Channelåœ¨è¯»å†™æ•°æ®æ—¶åªä»¥ByteBufferä¸ºå‚æ•°ï¼Œç„¶è€Œæˆ‘ä»¬å¯èƒ½è¿˜å¯¹ä½¿ç”¨å…¶ä»–åŸºæœ¬ç±»å‹çš„æ•°æ®è¿›è¡Œé€šä¿¡æ„Ÿå…´è¶£ã€‚ByteBufferèƒ½å¤Ÿåˆ›å»ºä¸€ç§ç‹¬ç«‹çš„â€è§†å›¾ç¼“å†²åŒºï¼ˆview bufferï¼‰â€ï¼Œç”¨äºå°†ByteBufferçš„å†…å®¹è§£é‡Šæˆå…¶ä»–åŸºæœ¬ç±»å‹ï¼ˆå¦‚CharBufferï¼‰ã€‚è¿™æ ·å°±å¯ä»¥ä»è¯¥ç¼“å†²åŒºä¸­è¯»å–ï¼ˆå†™å…¥æ•°æ®æ˜¯å¯é€‰æ“ä½œï¼‰æ–°ç±»å‹çš„æ•°æ®ã€‚æ–°ç¼“å†²åŒºä¸åŸå§‹ç¼“å†²åŒºå…±äº«äº†åŒä¸€ä¸ªåæ´å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤ï¼Œåœ¨ <strong>ä»»ä¸€ç¼“å†²åŒºä¸Šçš„ä¿®æ”¹åœ¨æ–°ç¼“å†²åŒºå’ŒåŸå§‹ç¼“å†²åŒºä¸Šéƒ½å¯ä»¥çœ‹åˆ°</strong>ã€‚æ–°åˆ›å»ºçš„è§†å›¾ç¼“å†²åŒºçš„positionå€¼ä¸º0ï¼Œå…¶å†…å®¹ä»åŸå§‹ç¼“å†²åŒºçš„positionæ‰€æŒ‡ä½ç½®å¼€å§‹ã€‚è¿™ä¸slice()æ“ä½œéå¸¸ç›¸ä¼¼ã€‚ä¸è¿‡ï¼Œç”±äºè§†å›¾ç¼“å†²åŒºæ“ä½œçš„æ˜¯å¤šå­—èŠ‚å…ƒç´ ï¼Œæ–°ç¼“å†²åŒºçš„capacityå’Œlimitçš„å€¼ç­‰äºå‰©ä½™æ€»å­—èŠ‚æ•°é™¤ä»¥æ¯ä¸ªè¯¥ç±»å‹å…ƒç´ å¯¹åº”çš„å­—èŠ‚æ•°ï¼ˆä¾‹å¦‚ï¼Œåˆ›å»ºDoubleBufferæ—¶åˆ™é™¤ä»¥8ï¼‰ã€‚<br>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾é€šè¿‡æŸä¸ªChannelæ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯ç”±ä¸€ä¸ªå•ç‹¬å­—èŠ‚ï¼Œåè·Ÿå¤§é‡big-endiané¡ºåºçš„åŒå­—èŠ‚æ•´æ•°ï¼ˆå¦‚shortå‹ï¼‰ç»„æˆã€‚ç”±äºè¯¥æ¶ˆæ¯æ˜¯é€šè¿‡Channelé€è¾¾çš„ï¼Œå®ƒä¸€å®šåœ¨ä¸€ä¸ªByteBufferä¸­ï¼Œåœ¨æ­¤ä¸ºbufã€‚æ¶ˆæ¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åŒ…å«äº†æ¶ˆæ¯ä¸­åŒå­—èŠ‚æ•´æ•°çš„æ•°é‡ã€‚ä½ å¯èƒ½è¦è°ƒç”¨ç¬¬ä¸€ä¸ªå­—èŠ‚æŒ‡å®šæ¬¡æ•°çš„buf.getShort()æ–¹æ³•ï¼Œæˆ–è€…ä½ å¯ä»¥ä¸€æ¬¡è·å–æ‰€æœ‰çš„æ•´æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// ...get message by calling channel.read(buf) ...</span><br><span class="line">int numShorts = (int)buf.get();</span><br><span class="line">if (numShorts &lt; 0) &#123;</span><br><span class="line">throw new SomeException()</span><br><span class="line">&#125; else &#123;</span><br><span class="line">short[] shortArray = new short[numShorts];</span><br><span class="line">ShortBuffer sbuf = buf.asShortBuffer();</span><br><span class="line">sbuf.get(shortArray); // note: will throw if header was</span><br><span class="line">incorrect!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>asReadOnlyBuffer()æ–¹æ³•çš„åŠŸèƒ½ä¸duplicate()æ–¹æ³•ç›¸ä¼¼ï¼Œåªæ˜¯ä»»ä½•ä¼šä¿®æ”¹æ–°ç¼“å†²åŒºå†…å®¹çš„æ–¹æ³•éƒ½å°†æŠ›å‡ºReadOnlyBufferExceptionå¼‚å¸¸ã€‚åŒ…æ‹¬å„ç§å‹å¼çš„put()ï¼Œcompact()ç­‰ï¼Œç”šè‡³è¿åœ¨ç¼“å†²åŒºä¸Šè°ƒç”¨æ— æ–¹å‘æ€§çš„array()å’ŒarrayOffset()æ–¹æ³•ä¹Ÿä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚å½“ç„¶ï¼Œå¯¹äº§ç”Ÿè¿™ä¸ªåªè¯»ç¼“å†²åŒºçš„éåªè¯»ç¼“å†²åŒºè¿›è¡Œçš„ä»»ä½•ä¿®æ”¹ï¼Œ<br>ä»ç„¶ä¼šä¸æ–°çš„åªè¯»ç¼“å†²åŒºå…±äº«ã€‚å°±åƒç”¨duplicate()åˆ›å»ºçš„ç¼“å†²åŒºä¸€æ ·ï¼Œåªè¯»ç¼“å†²åŒºä¹Ÿæœ‰ç‹¬ç«‹çš„ç¼“å†²åŒºçŠ¶æ€å˜é‡ã€‚å¯ä»¥ä½¿ç”¨isReadOnly()æ–¹æ³•æ¥æ£€æŸ¥ä¸€ä¸ªç¼“å†²åŒºæ˜¯å¦æ˜¯åªè¯»çš„ã€‚å¦‚æœåŸç¼“å†²åŒºå·²ç»æ˜¯åªè¯»çš„ï¼Œè°ƒç”¨duplicate()æˆ–slice()æ–¹æ³•ä¹Ÿå°†åˆ›å»ºæ–°çš„åªè¯»ç¼“å†²åŒºã€‚</p>
<h4 id="å­—ç¬¦ç¼–ç "><a href="#å­—ç¬¦ç¼–ç " class="headerlink" title="å­—ç¬¦ç¼–ç "></a>å­—ç¬¦ç¼–ç </h4><p>&nbsp; &nbsp; &nbsp; &nbsp;å­—ç¬¦æ˜¯ç”±å­—èŠ‚åºåˆ—è¿›è¡Œç¼–ç çš„ï¼Œè€Œä¸”åœ¨å­—èŠ‚åºåˆ—ä¸å­—ç¬¦é›†åˆä¹‹é—´æœ‰å„ç§æ˜ å°„ï¼ˆç§°ä¸ºå­—ç¬¦é›†ï¼‰æ–¹å¼ã€‚NIOç¼“å†²åŒºçš„å¦ä¸€ä¸ªç”¨é€”æ˜¯åœ¨å„ç§å­—ç¬¦é›†ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚è¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜éœ€è¦äº†è§£java.nio.charsetåŒ…ä¸­å¦å¤–ä¸¤ä¸ªç±»ï¼šCharsetEncoderå’ŒCharsetDecoderç±»ã€‚è¦è¿›è¡Œç¼–ç ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªCharsetå®ä¾‹æ¥åˆ›å»ºä¸€ä¸ªç¼–ç å™¨å¹¶è°ƒç”¨encodeæ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Charset charSet = Charset.forName(&quot;US-ASCII&quot;);</span><br><span class="line">CharsetEncoder encoder = charSet.newEncoder();</span><br><span class="line">ByteBuffer buffer = encoder.encode(CharBuffer.wrap(&quot;Hi</span><br><span class="line">mom&quot;));</span><br></pre></td></tr></table></figure></p>
<p>è¦è¿›è¡Œè§£ç ï¼Œéœ€è¦ä½¿ç”¨Charsetå®ä¾‹æ¥åˆ›å»ºä¸€ä¸ªè§£ç å™¨ï¼Œå¹¶è°ƒç”¨decodeæ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CharsetDecoder decoder = charSet.newDecoder();</span><br><span class="line">CharBuffer cBuf = decoder.decode(buffer);</span><br></pre></td></tr></table></figure></p>
<p>è™½ç„¶è¿™ç§æ–¹æ³•èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä½†å½“éœ€è¦è¿›è¡Œå¤šæ¬¡ç¼–ç æ—¶ï¼Œæ•ˆç‡å°±ä¼šå˜å¾—è¾ƒä½ã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡è°ƒç”¨encode/decode<br>æ–¹æ³•éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°Byte/CharBufferå®ä¾‹ã€‚å…¶ä»–å¯¼è‡´ä½æ•ˆç‡çš„åœ°æ–¹ä¸ç¼–ç å™¨çš„åˆ›å»ºå’Œæ“ä½œæœ‰å…³ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">encoder.reset();</span><br><span class="line">if (encoder.encode(CharBuffer.wrap(&quot;Hi &quot;),buffer,false)</span><br><span class="line">== CoderResult.OVERFLOW) &#123;</span><br><span class="line">// ... deal with lack of space in buffer ...</span><br><span class="line">&#125;</span><br><span class="line">if (encoder.encode(CharBuffer.wrap(&quot;Mom&quot;),buffer,true)</span><br><span class="line">== CoderResult.OVERFLOW) &#123;</span><br><span class="line">// ... ditto ...</span><br><span class="line">&#125;</span><br><span class="line">encoder.flush(buffer);</span><br></pre></td></tr></table></figure></p>
<p>encode()æ–¹æ³•å°†ç»™å®šCharBufferè½¬æ¢ä¸ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œå¹¶å°†å…¶å†™å…¥ç»™å®šçš„ç¼“å†²åŒºã€‚å¦‚æœç¼“å†²åŒºå¤ªå°ï¼Œencode()æ–¹æ³•çš„è¿”å›å€¼ç­‰äºCoderResult.OVERFLOWã€‚å¦‚æœè¾“å…¥çš„æ•°æ®å®Œå…¨è¢«æ¥æ”¶ï¼Œå¹¶ä¸”ç¼–ç å™¨è¿˜å‡†å¤‡å¯¹æ›´å¤šæ•°æ®è¿›è¡Œç¼–ç ï¼Œencode()æ–¹æ³•çš„è¿”å›å€¼åˆ™ç­‰äºCoderResult.UNDERFLOWã€‚å¦å¤–ï¼Œå¦‚æœè¾“å…¥çš„æ•°æ®æ ¼å¼æœ‰é”™è¯¯ï¼Œåˆ™å°†è¿”å›ä¸€ä¸ªCoderResultå¯¹è±¡ï¼Œå¹¶æŒ‡ç¤ºäº†æ‰€å­˜åœ¨çš„é—®é¢˜çš„ä½ç½®å’Œç±»å‹ã€‚åªæœ‰åˆ°è¾¾äº†è¾“å…¥æ•°æ®çš„ç»“å°¾æ—¶ï¼Œæ‰å°†æœ€åçš„booleanå‚æ•°è®¾ä¸ºtrueã€‚flush()æ–¹æ³•å°†ä»»ä½•ç¼“å­˜çš„ç¼–ç æ•°æ®æ¨é€åˆ°ç¼“å†²åŒºã€‚æ³¨æ„ï¼Œåœ¨æ–°åˆ›å»ºçš„ç¼–ç å™¨ä¸Šè°ƒç”¨reset()æ–¹æ³•å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œè¯¥æ–¹æ³•ç”¨æ¥é‡æ–°è®¾ç½®ç¼–ç å™¨çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä½¿å…¶èƒ½å¤Ÿè¿›è¡Œå†æ¬¡ç¼–ç ã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€åé€šè¿‡ä¸€æ®µç®€çŸ­ä»£ç å±•ç¤ºallocateã€flipã€getã€compactå’Œclearæ–¹æ³•å¯¹positionã€limitçš„ä¿®æ”¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] arg) throws IOException &#123;</span><br><span class="line"></span><br><span class="line"> ByteBuffer buffer1 = ByteBuffer.allocate(10);</span><br><span class="line"> RandomAccessFile fine = new RandomAccessFile(new File(&quot;b.txt&quot;), &quot;rw&quot;);</span><br><span class="line"> FileChannel fc = fine.getChannel();//åˆ†é…ç©ºé—´åpositionä¸º0ï¼Œlimit=capacity=10ï¼›</span><br><span class="line"> output(&quot;allocate&quot;, buffer1);</span><br><span class="line"> fc.read(buffer1);</span><br><span class="line"> output(&quot;read&quot;, buffer1);</span><br><span class="line"> buffer1.flip();                 //å°†limitè®¾ç½®ä¸ºpositionï¼Œç„¶åå°†positionè®¾ç½®ä¸º0</span><br><span class="line"> output(&quot;flip&quot;, buffer1);</span><br><span class="line"> buffer1.get();                          //å°†positionåŠ ä¸€</span><br><span class="line"> output(&quot;get&quot;, buffer1);</span><br><span class="line"> buffer1.rewind();                       //é‡ç½®positionä¸º0</span><br><span class="line"> output(&quot;rewind&quot;, buffer1);</span><br><span class="line"> buffer1.compact();                         //å°†positionåˆ°limitçš„æ•°æ®ç§»åˆ°æ•°ç»„å‰ç«¯ï¼Œå¹¶å°†positionè®¾ç½®ä¸ºï¼ˆlimit-positionçš„è·ç¦»ï¼‰ï¼Œlimit=capacity</span><br><span class="line"> output(&quot;compact&quot;, buffer1);</span><br><span class="line"> buffer1.clear();                    //é‡ç½®positionä¸º0ï¼Œlimit=capacity</span><br><span class="line"> output(&quot;clear&quot;, buffer1);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static void output(String tag, ByteBuffer buffer) &#123;</span><br><span class="line">      System.out.println(tag + &quot; position:&quot; + buffer.position() + &quot; limit:&quot; + buffer.limit() + &quot; capacity:&quot; + buffer.capacity());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç»“æœå¦‚ä¸‹ï¼š<br>allocate position:0 limit:10 capacity:10<br>read position:6 limit:10 capacity:10<br>flip position:0 limit:6 capacity:10<br>get position:1 limit:6 capacity:10<br>rewind position:0 limit:6 capacity:10<br>compact position:6 limit:10 capacity:10<br>clear position:0 limit:10 capacity:10<br>get position:2 limit:10 capacity:10</p>
<p>å‚è€ƒï¼š<br>[1] ï¼ˆè¯‘æ–‡ï¼‰javaä¸­çš„ShortBuffer <a href="https://blog.csdn.net/u010142437/article/details/42082735" target="_blank" rel="noopener">https://blog.csdn.net/u010142437/article/details/42082735</a><br>[2] Bufferè¯¦è§£ <a href="https://blog.csdn.net/guofengpu/article/details/51995730" target="_blank" rel="noopener">https://blog.csdn.net/guofengpu/article/details/51995730</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/08/16/æ ¹æ®Uriè·å–æ–‡æ¡£çš„è·¯å¾„/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/16/æ ¹æ®Uriè·å–æ–‡æ¡£çš„è·¯å¾„/" itemprop="url">æ ¹æ®Uriè·å–æ–‡æ¡£çš„è·¯å¾„</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-16T14:11:33+08:00">
                2018-08-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>æ ¹æ®Urlè·å–æ–‡æ¡£çš„ç»å¯¹è·¯å¾„ï¼Œè§£å†³Android4.4ä»¥ä¸Šç‰ˆæœ¬Uriè½¬æ¢ã€‚<br>Androidåœ¨4.4ä¹‹åçš„ç‰ˆæœ¬(åŒ…æ‹¬4.4)ä¸­ï¼Œä»ç›¸å†Œä¸­é€‰å–å›¾ç‰‡è¿”å›Uriè¿›è¡Œäº†æ”¹åŠ¨ã€‚æ‰€ä»¥æ— æ³•é€šè¿‡è¯¥Uriæ¥å–å¾—æ–‡ä»¶è·¯å¾„ä»è€Œè§£ç å›¾ç‰‡å°†å…¶æ˜¾ç¤ºå‡ºæ¥ã€‚<br><code>åœ¨4.3æˆ–ä»¥ä¸‹å¯ä»¥ç›´æ¥ç”¨Intent.ACTION_GET_CONTENTæ‰“å¼€ç›¸å†Œ;åœ¨4.4æˆ–ä»¥ä¸Š,å®˜æ–¹å»ºè®®ç”¨ACTION_OPEN_DOCUMENTæ‰“å¼€ç›¸å†Œ</code><br>åœ¨Android4.4ä¹‹å‰å¾—åˆ°çš„Uriä¸ºï¼š</p>
<ul>
<li>content://media/external/images/media/8302  </li>
<li>content://media/external/video/media  </li>
<li>content://media/external/images/media  </li>
</ul>
<p>è€Œåœ¨Android4.4åå¾—åˆ°çš„å¯èƒ½æ˜¯ä»¥ä¸‹ï¼š</p>
<ul>
<li>content://com.android.providers.media.documents/document/image:8302</li>
<li>content://com.android.providers.downloads.documents/document/5</li>
</ul>
<p>ä»¥ä¸‹ä¸ºAndroid4.4ä¹‹åçš„é€‚é…ï¼š  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"> /**</span><br><span class="line"> *</span><br><span class="line"> * ä¸“ä¸ºAndroid4.4è®¾è®¡çš„ä»Uriè·å–æ–‡ä»¶ç»å¯¹è·¯å¾„</span><br><span class="line"> */</span><br><span class="line">@SuppressLint(&quot;NewApi&quot;)</span><br><span class="line">public static String getPath(final Context context, final Uri uri) &#123;</span><br><span class="line">    final boolean isKitKat = Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT;</span><br><span class="line">    LogUtil.d(&quot;uri:&quot; + uri);</span><br><span class="line">    // DocumentProvider</span><br><span class="line">    if (isKitKat &amp;&amp; DocumentsContract.isDocumentUri(context, uri)) &#123;</span><br><span class="line">        // ExternalStorageProvider</span><br><span class="line">        if (isExternalStorageDocument(uri)) &#123;</span><br><span class="line">            final String docId = DocumentsContract.getDocumentId(uri);</span><br><span class="line">            final String[] split = docId.split(&quot;:&quot;);</span><br><span class="line">            final String type = split[0];</span><br><span class="line"></span><br><span class="line">            if (&quot;primary&quot;.equalsIgnoreCase(type)) &#123;</span><br><span class="line">                return Environment.getExternalStorageDirectory() + &quot;/&quot; + split[1];</span><br><span class="line">            &#125;</span><br><span class="line">            // TODO handle non-primary volumes</span><br><span class="line">        &#125;</span><br><span class="line">        // DownloadsProvider</span><br><span class="line">        else if (isDownloadsDocument(uri)) &#123;</span><br><span class="line"></span><br><span class="line">            final String id = DocumentsContract.getDocumentId(uri);</span><br><span class="line">            final Uri contentUri = ContentUris.withAppendedId(Uri.parse(&quot;content://downloads/public_downloads&quot;), Long.valueOf(id));</span><br><span class="line"></span><br><span class="line">            return getDataColumn(context, contentUri, null, null);</span><br><span class="line">        &#125;</span><br><span class="line">        // MediaProvider</span><br><span class="line">        else if (isMediaDocument(uri)) &#123;</span><br><span class="line">            final String docId = DocumentsContract.getDocumentId(uri);</span><br><span class="line">            final String[] split = docId.split(&quot;:&quot;);</span><br><span class="line">            final String type = split[0];</span><br><span class="line"></span><br><span class="line">            Uri contentUri = null;</span><br><span class="line">            if (&quot;image&quot;.equals(type)) &#123;</span><br><span class="line">                contentUri = MediaStore.Images.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">            &#125; else if (&quot;video&quot;.equals(type)) &#123;</span><br><span class="line">                contentUri = MediaStore.Video.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">            &#125; else if (&quot;audio&quot;.equals(type)) &#123;</span><br><span class="line">                contentUri = MediaStore.Audio.Media.EXTERNAL_CONTENT_URI;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            final String selection = &quot;_id=?&quot;;</span><br><span class="line">            final String[] selectionArgs = new String[]&#123;split[1]&#125;;</span><br><span class="line">            LogUtil.d(&quot;format uri:&quot; + contentUri);</span><br><span class="line">            return getDataColumn(context, contentUri, selection, selectionArgs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // MediaStore (and general)</span><br><span class="line">    else if (&quot;content&quot;.equalsIgnoreCase(uri.getScheme())) &#123;</span><br><span class="line">        return getDataColumn(context, uri, null, null);</span><br><span class="line">    &#125;</span><br><span class="line">    // File</span><br><span class="line">    else if (&quot;file&quot;.equalsIgnoreCase(uri.getScheme())) &#123;</span><br><span class="line">        return uri.getPath();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Get the value of the data column for this Uri. This is useful for</span><br><span class="line"> * MediaStore Uris, and other file-based ContentProviders.</span><br><span class="line"> *</span><br><span class="line"> * @param context       The context.</span><br><span class="line"> * @param uri           The Uri to query.</span><br><span class="line"> * @param selection     (Optional) Filter used in the query.</span><br><span class="line"> * @param selectionArgs (Optional) Selection arguments used in the query.</span><br><span class="line"> * @return The value of the _data column, which is typically a file path.</span><br><span class="line"> */</span><br><span class="line">public static String getDataColumn(Context context, Uri uri, String selection,</span><br><span class="line">                                   String[] selectionArgs) &#123;</span><br><span class="line"></span><br><span class="line">    Cursor cursor = null;</span><br><span class="line">    final String column = &quot;_data&quot;;</span><br><span class="line">    final String[] projection = &#123;column&#125;;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        cursor = context.getContentResolver().query(uri, projection, selection, selectionArgs,</span><br><span class="line">                null);</span><br><span class="line">        if (cursor != null &amp;&amp; cursor.moveToFirst()) &#123;</span><br><span class="line">            final int column_index = cursor.getColumnIndexOrThrow(column);</span><br><span class="line">            return cursor.getString(column_index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        if (cursor != null)</span><br><span class="line">            cursor.close();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line">  * @param uri The Uri to check.</span><br><span class="line">  * @return Whether the Uri authority is ExternalStorageProvider.</span><br><span class="line">  */</span><br><span class="line"> public static boolean isExternalStorageDocument(Uri uri) &#123;</span><br><span class="line">     return &quot;com.android.externalstorage.documents&quot;.equals(uri.getAuthority());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">  * @param uri The Uri to check.</span><br><span class="line">  * @return Whether the Uri authority is DownloadsProvider.</span><br><span class="line">  */</span><br><span class="line"> public static boolean isDownloadsDocument(Uri uri) &#123;</span><br><span class="line">     return &quot;com.android.providers.downloads.documents&quot;.equals(uri.getAuthority());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /**</span><br><span class="line">  * @param uri The Uri to check.</span><br><span class="line">  * @return Whether the Uri authority is MediaProvider.</span><br><span class="line">  */</span><br><span class="line"> public static boolean isMediaDocument(Uri uri) &#123;</span><br><span class="line">     return &quot;com.android.providers.media.documents&quot;.equals(uri.getAuthority());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸ªè·å–Mp3æ–‡æ¡£çš„Uriï¼Œå…¶æ ¼å¼ç±»ä¼¼ï¼šcontent://com.android.providers.media.documents/document/audio%3A39ï¼Œ<br>ç„¶åæˆ‘æ ¹æ®ä»£ç è¿›ä¸€æ­¥åˆ†æï¼Œé¦–å…ˆçœ‹åˆ¤æ–­æ¡ä»¶ï¼šisKitKat &amp;&amp; DocumentsContract.isDocumentUri(context, uri)ï¼Œ<br>è¿™é‡Œåˆ¤æ–­äº†ç‰ˆæœ¬å·å’Œè¯¥Uriæ˜¯å¦æ˜¯æ–‡æ¡£ç±»Uriï¼Œä¹‹æ‰€ä»¥è¦åˆ¤æ–­ç‰ˆæœ¬å·æ˜¯Uriçš„ç”Ÿæˆåœ¨Api19ä»¥åå‘é€å˜åŒ–ï¼Œé€šè¿‡å®˜æ–¹æ–‡æ¡£DocumentsContractï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥éªŒè¯è¿™ç‚¹ï¼ŒDocumentsContractæ˜¯åœ¨Api19åŠ å…¥çš„ï¼Œå…¶å®šä¹‰å°±æ˜¯å®šä¹‰æ–‡æ¡£æä¾›è€…ä¸å¹³å°ä¹‹é—´çš„åè®®ï¼Œå…¶ä¸»è¦ä½œç”¨å°±æ˜¯å…³äºæ–‡æ¡£Uriçš„ä¸€ç³»åˆ—æ“ä½œã€‚<br>ä¸‹é¢æ˜¯å…¶å†…éƒ¨å®ç°ä»£ç ï¼ˆä»£ç éƒ½æ˜¯åœ¨DocumentsContractç±»ä¸­ï¼‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">private static final String PATH_DOCUMENT = &quot;document&quot;;</span><br><span class="line">private static final String PATH_TREE = &quot;tree&quot;;</span><br><span class="line">public static final String PROVIDER_INTERFACE = &quot;android.content.action.DOCUMENTS_PROVIDER&quot;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">   * Test if the given URI represents a &#123;@link Document&#125; backed by a</span><br><span class="line">   * &#123;@link DocumentsProvider&#125;.</span><br><span class="line">   *</span><br><span class="line">   * @see #buildDocumentUri(String, String)</span><br><span class="line">   * @see #buildDocumentUriUsingTree(Uri, String)</span><br><span class="line">   */</span><br><span class="line">  public static boolean isDocumentUri(Context context, @Nullable Uri uri) &#123;</span><br><span class="line">      if (isContentUri(uri) &amp;&amp; isDocumentsProvider(context, uri.getAuthority())) &#123;</span><br><span class="line">          final List&lt;String&gt; paths = uri.getPathSegments();</span><br><span class="line">          if (paths.size() == 2) &#123;</span><br><span class="line">              return PATH_DOCUMENT.equals(paths.get(0));</span><br><span class="line">          &#125; else if (paths.size() == 4) &#123;</span><br><span class="line">              return PATH_TREE.equals(paths.get(0)) &amp;&amp; PATH_DOCUMENT.equals(paths.get(2));</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return false;</span><br><span class="line">  &#125;</span><br><span class="line">  /** &#123;@hide&#125; */</span><br><span class="line">   public static boolean isContentUri(@Nullable Uri uri) &#123;</span><br><span class="line">      // public static final String SCHEME_CONTENT = &quot;content&quot;;     !!add by custom</span><br><span class="line">       return uri != null &amp;&amp; ContentResolver.SCHEME_CONTENT.equals(uri.getScheme());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   private static boolean isDocumentsProvider(Context context, String authority) &#123;</span><br><span class="line">    final Intent intent = new Intent(PROVIDER_INTERFACE);</span><br><span class="line">    final List&lt;ResolveInfo&gt; infos = context.getPackageManager()</span><br><span class="line">            .queryIntentContentProviders(intent, 0);</span><br><span class="line">    for (ResolveInfo info : infos) &#123;</span><br><span class="line">        if (authority.equals(info.providerInfo.authority)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå‰ææ¡ä»¶æ˜¯åˆ¤æ–­æ˜¯å¦æ˜¯contentUri&amp;&amp;documentProviderï¼Œç„¶ååœ¨è¿›ä¸€æ­¥åˆ¤æ–­å…¶pathSegments<br>æ˜¯å¦æ˜¯document/æˆ–è€…tree/document/å¼€å¤´ã€‚å…¶ä¸­isDocumentsProvideræ–¹æ³•ä¸æ˜¯ç‰¹åˆ«ç†è§£ï¼Œå¸Œæœ›å¤§ç¥æŒ‡ç‚¹ä¸‹ã€‚</p>
<p>å‚è€ƒåœ°å€ï¼š<br>[1] è§£å†³Android4.4ä»¥ä¸Šç‰ˆæœ¬Uriè½¬æ¢  <a href="https://blog.csdn.net/q445697127/article/details/40537945" target="_blank" rel="noopener">https://blog.csdn.net/q445697127/article/details/40537945</a><br>[2] <a href="https://stackoverflow.com/questions/20067508/get-real-path-from-uri-android-kitkat-new-storage-access-framework" target="_blank" rel="noopener">https://stackoverflow.com/questions/20067508/get-real-path-from-uri-android-kitkat-new-storage-access-framework</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/08/12/LinearLayoutæºç è§£è¯»/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/12/LinearLayoutæºç è§£è¯»/" itemprop="url">LinearLayoutæºç è§£è¯»</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-08-12T10:01:49+08:00">
                2018-08-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="LinearLayoutåŸºç¡€"><a href="#LinearLayoutåŸºç¡€" class="headerlink" title="LinearLayoutåŸºç¡€"></a>LinearLayoutåŸºç¡€</h3><p>LinearLayoutæ‰€å…·æœ‰çš„å±æ€§ï¼š</p>
<ul>
<li>orientationï¼šè§†å›¾çš„å¸ƒå±€æ–¹å‘ï¼Œé»˜è®¤å€¼ï¼š-1ï¼›</li>
<li>gravityï¼šç»˜åˆ¶èµ·å§‹ç‚¹ï¼Œé»˜è®¤å€¼ï¼š-1ï¼›</li>
<li>baselineAlignedï¼šåŸºå‡†çº¿å¯¹é½ï¼Œå…¶æ•ˆæœå¯ä»¥é€šè¿‡ä¿®æ”¹xmlçš„å±æ€§å€¼ç›´æ¥çœ‹åˆ°æ•ˆæœï¼Œé»˜è®¤å€¼ï¼štrueï¼›</li>
<li>weightSumï¼šå­è§†å›¾æƒé‡å’Œï¼Œé»˜è®¤å€¼ï¼š-1.0fï¼›</li>
<li>baselineAlignedChildIndexï¼šä»¥ç¬¬Indexä¸ªå­è§†å›¾çš„åŸºå‡†çº¿ä¸ºå¯¹é½ï¼Œè¯¥LinearLayoutä¸‹çš„viewä»¥<br>æŸä¸ªç»§æ‰¿TextViewçš„Viewçš„åŸºçº¿å¯¹é½ï¼Œé»˜è®¤å€¼ï¼š-1ï¼›</li>
<li>measureWithLargestChildï¼šä»¥æœ€å¤§å­è§†å›¾å®½é«˜ï¼Œä¸ºå…¶å­è§†å›¾çš„å®½é«˜ï¼Œ<strong>å…¶èµ·ä½œç”¨å‰ææ˜¯ä¸ºtrueï¼Œä¸”LinearLayoutåœ¨è¯¥æ–¹å‘çš„å®½æˆ–é«˜ä¸ºwarp_contentï¼Œä¸”å­è§†å›¾å…·æœ‰æƒé‡</strong>ã€‚é»˜è®¤å€¼ï¼šfalseï¼›</li>
<li>dividerï¼šåˆ†å‰²çº¿ï¼›</li>
<li>showDividersï¼šåˆ†å‰²çº¿æ˜¾ç¤ºæ ·å¼ï¼ˆmiddle|end|beginning|nonï¼‰ï¼Œé»˜è®¤å€¼ï¼šSHOW_DIVIDER_NONEï¼›</li>
<li><p>dividerPaddingï¼šåˆ†å‰²çº¿å†…è¾¹è·ï¼Œé»˜è®¤å€¼ï¼š0ï¼›</p>
<p>è§£é‡Šï¼š</p>
</li>
<li>åŸºå‡†çº¿<br>å…¶ä¸»è¦ä½œç”¨æ˜¯åœ¨ç»˜åˆ¶å­—æ¯çš„æ—¶å€™æœ‰ä¸ªåŸºçº¿å¯¹é½ï¼Œè¿™ä¸ªç±»ä¼¼æˆ‘ä»¬å­¦ä¹ è‹±è¯­å­—æ¯çš„æ—¶å€™ç”¨çš„å››çº¿è°±ï¼š<br><img src="./images/baselineAligned_expand.png" alt="åŸºçº¿ç¤ºæ„å›¾"><br>å…¶ä¸­çº¢çº¿å°±æ˜¯åŸºçº¿ï¼ˆbaselineï¼‰ï¼Œå’Œä¸‹é¢æˆ‘ä»¬ä¹¦å†™è‹±è¯­å­—æ¯çš„å››çº¿è°±æ˜¯ä¸æ˜¯å¾ˆåƒï¼ŒåŸºçº¿å°±æ˜¯ç¬¬ä¸‰æ¡ã€‚<br><img src="./images/baselineAligned_ch.png" alt="è‹±è¯­ä¹¦å†™å››çº¿è°±"></li>
</ul>
<ul>
<li>æºç ä¹‹å‚ç›´æ–¹å‘æµ‹é‡ï¼ˆvoid measureVertical(int widthMeasureSpec, int heightMeasureSpec)ï¼‰</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * Measures the children when the orientation of this LinearLayout is set</span><br><span class="line">     * to &#123;@link #VERTICAL&#125;.</span><br><span class="line">     *</span><br><span class="line">     * @param widthMeasureSpec Horizontal space requirements as imposed by the parent.</span><br><span class="line">     * @param heightMeasureSpec Vertical space requirements as imposed by the parent.</span><br><span class="line">     *</span><br><span class="line">     * @see #getOrientation()</span><br><span class="line">     * @see #setOrientation(int)</span><br><span class="line">     * @see #onMeasure(int, int)</span><br><span class="line">     */</span><br><span class="line">    void measureVertical(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">		// mTotalLengthä½œä¸ºLinearLayoutæˆå‘˜å˜é‡ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯åœ¨æµ‹é‡çš„æ—¶å€™é€šè¿‡ç´¯åŠ å¾—åˆ°æ‰€æœ‰å­æ§ä»¶çš„é«˜åº¦å’Œï¼ˆVerticalï¼‰æˆ–è€…å®½åº¦å’Œï¼ˆHorizontalï¼‰</span><br><span class="line">        mTotalLength = 0;</span><br><span class="line">		// maxWidthç”¨æ¥è®°å½•æ‰€æœ‰å­æ§ä»¶ä¸­æ§ä»¶å®½åº¦æœ€å¤§çš„å€¼ã€‚</span><br><span class="line">        int maxWidth = 0;</span><br><span class="line">		// å­æ§ä»¶çš„æµ‹é‡çŠ¶æ€ï¼Œä¼šåœ¨éå†å­æ§ä»¶æµ‹é‡çš„æ—¶å€™é€šè¿‡combineMeasuredStatesæ¥åˆå¹¶ä¸Šä¸€ä¸ªå­æ§ä»¶æµ‹é‡çŠ¶æ€ä¸å½“å‰éå†åˆ°çš„å­æ§ä»¶çš„æµ‹é‡çŠ¶æ€ï¼Œé‡‡å–çš„æ˜¯æŒ‰ä½ç›¸æˆ–</span><br><span class="line">        int childState = 0;</span><br><span class="line"></span><br><span class="line">		/**</span><br><span class="line">		* ä»¥ä¸‹ä¸¤ä¸ªæœ€å¤§å®½åº¦è·Ÿä¸Šé¢çš„maxWidthæœ€å¤§çš„åŒºåˆ«åœ¨äºmatchWidthLocallyè¿™ä¸ªå‚æ•°</span><br><span class="line">		* å½“matchWidthLocallyä¸ºçœŸï¼Œé‚£ä¹ˆä»¥ä¸‹ä¸¤ä¸ªå˜é‡åªä¼šè·Ÿå½“å‰å­æ§ä»¶çš„å·¦å³marginå’Œç›¸æ¯”è¾ƒå–å¤§å€¼</span><br><span class="line">		* å¦åˆ™ï¼Œåˆ™è·ŸmaxWidthçš„è®¡ç®—æ–¹æ³•ä¸€æ ·</span><br><span class="line">		*/</span><br><span class="line">		// å­æ§ä»¶ä¸­layout_weight&lt;=0çš„Viewçš„æœ€å¤§å®½åº¦</span><br><span class="line">        int alternativeMaxWidth = 0;</span><br><span class="line">		// å­æ§ä»¶ä¸­layout_weight&gt;0çš„Viewçš„æœ€å¤§å®½åº¦</span><br><span class="line">        int weightedMaxWidth = 0;</span><br><span class="line">		// æ˜¯å¦å­æ§ä»¶å…¨æ˜¯match_parentçš„æ ‡å¿—ä½ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°æµ‹é‡</span><br><span class="line">        boolean allFillParent = true;</span><br><span class="line">		// æ‰€æœ‰å­æ§ä»¶çš„weightä¹‹å’Œ</span><br><span class="line">        float totalWeight = 0;</span><br><span class="line"></span><br><span class="line">		// å¦‚æ‚¨æ‰€è§ï¼Œå¾—åˆ°æ‰€æœ‰å­æ§ä»¶çš„æ•°é‡ï¼Œå‡†ç¡®çš„è¯´ï¼Œå®ƒå¾—åˆ°çš„æ˜¯æ‰€æœ‰åŒçº§å­æ§ä»¶çš„æ•°é‡</span><br><span class="line">        // åœ¨å®˜æ–¹çš„æ³¨é‡Šä¸­ä¹Ÿæœ‰ç€å¯¹åº”çš„ä¾‹å­</span><br><span class="line">        // æ¯”å¦‚TableRowï¼Œå‡å¦‚TableRowé‡Œé¢æœ‰Nä¸ªæ§ä»¶ï¼Œè€ŒLinearLayoutï¼ˆTableLayoutä¹Ÿæ˜¯ç»§æ‰¿LinearLayoutå“¦ï¼‰ä¸‹æœ‰Mä¸ªTableRowï¼Œé‚£ä¹ˆè¿™é‡Œè¿”å›çš„æ˜¯Mï¼Œè€ŒéM*N</span><br><span class="line">        // ä½†å®é™…ä¸Šï¼Œå®˜æ–¹ä¼¼ä¹ä¹Ÿåªæ˜¯ç›´æ¥è¿”å›getChildCount()ï¼Œèµ·è¿™ä¸ªæ–¹æ³•åçš„åŸå› ä¼°è®¡æ˜¯ä¸ºäº†è®©äººæ›´åŠ çš„æ˜ç™½ï¼Œæ¯•ç«Ÿå¦‚æœæ˜¯getChildCount()å¯èƒ½ä¼šè®©äººè¯¯è®¤ä¸ºä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›æ‰€æœ‰ï¼ˆåŒ…æ‹¬ä¸åŒçº§ï¼‰çš„å­æ§ä»¶æ•°é‡</span><br><span class="line">        final int count = getVirtualChildCount();</span><br><span class="line"></span><br><span class="line">		// å¾—åˆ°æµ‹é‡æ¨¡å¼</span><br><span class="line">        final int widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        final int heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">		// å½“å­æ§ä»¶ä¸ºmatch_parentçš„æ—¶å€™ï¼Œè¯¥å€¼ä¸ºtureï¼ŒåŒæ—¶åˆ¤å®šçš„è¿˜æœ‰ä¸Šé¢æ‰€è¯´çš„matchWidthLocallyï¼Œè¿™ä¸ªå˜é‡å†³å®šäº†å­æ§ä»¶çš„æµ‹é‡æ˜¯çˆ¶æ§ä»¶å¹²é¢„è¿˜æ˜¯å¡«å……çˆ¶æ§ä»¶ï¼ˆå‰©ä½™çš„ç©ºç™½ä½ç½®ï¼‰ã€‚</span><br><span class="line">        boolean matchWidth = false;</span><br><span class="line"></span><br><span class="line">        boolean skippedMeasure = false;</span><br><span class="line"></span><br><span class="line">        final int baselineChildIndex = mBaselineAlignedChildIndex;        </span><br><span class="line">        final boolean useLargestChild = mUseLargestChild;</span><br><span class="line"></span><br><span class="line">        int largestChildHeight = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line">        // See how tall everyone is. Also remember max width.</span><br><span class="line"></span><br><span class="line">		//æŸ¥çœ‹æ¯ä¸€ä¸ªé«˜ï¼Œå¹¶è®°ä½æœ€å¤§å®½åº¦</span><br><span class="line">        for (int i = 0; i &lt; count; ++i) &#123;</span><br><span class="line">			//é¦–å…ˆè·å–å­View</span><br><span class="line">            final View child = getVirtualChildAt(i);</span><br><span class="line">			//å¦‚æœå­Viewæ˜¯nullå°±ç»§ç»­æµ‹é‡ä¸‹ä¸€ä¸ªå­View</span><br><span class="line">            if (child == null) &#123;</span><br><span class="line">				// ç›®å‰è€Œè¨€ï¼ŒmeasureNullChild()æ–¹æ³•è¿”å›çš„æ°¸è¿œæ˜¯0ï¼Œä¼°è®¡æ˜¯è®¾è®¡è€…ç•™ä¸‹æ¥ä»¥åæˆ–è®¸æœ‰è¡¥å……çš„ã€‚</span><br><span class="line">                mTotalLength += measureNullChild(i);</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">			//å¦‚æœå­Viewæ˜¯GONEçš„ä¹Ÿä¸ç®—åœ¨æ€»é«˜åº¦é‡Œé¢ï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºGONEå’ŒINVISIBLEçš„åŒºåˆ«</span><br><span class="line">            if (child.getVisibility() == View.GONE) &#123;</span><br><span class="line">				// åŒä¸Šï¼Œè¿”å›çš„éƒ½æ˜¯0ã€‚</span><br><span class="line">               // äº‹å®ä¸Šè¿™é‡Œçš„æ„æ€åº”è¯¥æ˜¯å½“å‰éå†åˆ°çš„Viewä¸ºGoneçš„æ—¶å€™ï¼Œå°±è·³è¿‡è¿™ä¸ªViewï¼Œä¸‹ä¸€å¥çš„continueå…³é”®å­—ä¹Ÿæ­£æ˜¯è¿™ä¸ªæ„æ€ã€‚</span><br><span class="line">               // å¿½ç•¥å½“å‰çš„Viewï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆGoneçš„æ§ä»¶ä¸å ç”¨å¸ƒå±€èµ„æºçš„åŸå› ã€‚ï¼ˆæ¯•ç«Ÿæ ¹æœ¬æ²¡æœ‰åˆ†é…ç©ºé—´ï¼‰</span><br><span class="line">               i += getChildrenSkipCount(child, i);</span><br><span class="line">               continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">			// æ ¹æ®showDividerçš„å€¼ï¼ˆbefore/middle/endï¼‰æ¥å†³å®šéå†åˆ°å½“å‰å­æ§ä»¶æ—¶ï¼Œé«˜åº¦æ˜¯å¦éœ€è¦åŠ ä¸Šdividerçš„é«˜åº¦</span><br><span class="line">            // æ¯”å¦‚showDividerä¸ºbeforeï¼Œé‚£ä¹ˆåªä¼šåœ¨ç¬¬0ä¸ªå­æ§ä»¶æµ‹é‡æ—¶åŠ ä¸Šdivideré«˜åº¦ï¼Œå…¶ä½™æƒ…å†µä¸‹éƒ½ä¸åŠ </span><br><span class="line">            if (hasDividerBeforeChildAt(i)) &#123;</span><br><span class="line">                mTotalLength += mDividerHeight;</span><br><span class="line">            &#125;</span><br><span class="line">			//æœ‰æ—¶å€™æˆ‘ä»¬åœ¨ä»£ç é‡Œé¢é€šè¿‡InflateræœåŠ¡ï¼ŒåŠ¨æ€åŠ è½½ä¸€ä¸ªå¸ƒå±€ï¼Œç„¶åå»è®¾ç½®ä»–çš„LayoutParamsï¼Œ</span><br><span class="line">			//å¦‚æœä¸å¼•ç”¨çˆ¶å®¹å™¨çš„LayoutParamså°±ä¼šæŠ¥ä¸€ä¸ªå¼ºè½¬é”™è¯¯ï¼ŒåŸå› å°±åœ¨è¿™ä¸ªçˆ¶å®¹å™¨åœ¨add,measureçš„æ—¶å€™éƒ½ä¼š</span><br><span class="line">			//æŠŠå­Viewçš„LayoutParamså¼ºè½¬æˆè‡ªå·±çš„ç±»å‹</span><br><span class="line">            LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams) child.getLayoutParams();</span><br><span class="line">			//å¾—åˆ°æ¯ä¸ªå­æ§ä»¶çš„LayoutParamsåï¼Œç´¯åŠ æƒé‡å’Œ,åé¢ç”¨äºè·ŸweightSumç›¸æ¯”è¾ƒ</span><br><span class="line">            totalWeight += lp.weight;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			// æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæµ‹é‡æ¨¡å¼æœ‰ä¸‰ç§ï¼š</span><br><span class="line">            // * UNSPECIFIEDï¼šçˆ¶æ§ä»¶å¯¹å­æ§ä»¶æ— çº¦æŸ,åŸºæœ¬æ²¡æœ‰ç”¨åˆ°</span><br><span class="line">            // * Exactlyï¼šçˆ¶æ§ä»¶å¯¹å­æ§ä»¶å¼ºçº¦æŸï¼Œå­æ§ä»¶æ°¸è¿œåœ¨çˆ¶æ§ä»¶è¾¹ç•Œå†…ï¼Œè¶Šç•Œåˆ™è£å‰ªã€‚å¦‚æœè¦è®°å¿†çš„è¯ï¼Œå¯ä»¥è®°å¿†ä¸ºæœ‰å¯¹åº”çš„å…·ä½“æ•°å€¼æˆ–è€…æ˜¯Match_parent</span><br><span class="line">            // * AT_Mostï¼šå­æ§ä»¶ä¸ºwrap_contentçš„æ—¶å€™ï¼Œæµ‹é‡å€¼ä¸ºAT_MOSTã€‚</span><br><span class="line"></span><br><span class="line">            // ä¸‹é¢çš„if/elseåˆ†æ”¯éƒ½æ˜¯è·Ÿweightç›¸å…³</span><br><span class="line">			//è¿™é‡Œå°±å€¼å¾—æ³¨æ„ä¸‹äº†å¦‚æœå½“å‰çš„LinearLayoutæ˜¯EXACTLYæ¨¡å¼ï¼Œä¸”å­viewçš„é«˜åº¦ä¸º0ï¼Œä¸”æƒé‡å¤§äº0</span><br><span class="line">			//è¿™ä¸ªå­viewåªæœ‰åœ¨LinearLayouté«˜åº¦æœ‰å‰©ä½™çš„æ—¶å€™ï¼Œæ‰ä¼šæ ¹æ®æƒé‡çš„å æ¯”å»å¹³åˆ†å‰©ä½™ç©ºé—´</span><br><span class="line">			//ä¸Šæ–‡è¯´çš„äºŒæ¬¡æµ‹é‡ä¹Ÿå°±æŒ‡çš„è¿™éƒ¨åˆ†</span><br><span class="line">            if (heightMode == MeasureSpec.EXACTLY &amp;&amp; lp.height == 0 &amp;&amp; lp.weight &gt; 0) &#123;</span><br><span class="line">                // Optimization: don&apos;t bother measuring children who are going to use</span><br><span class="line">                // leftover space. These views will get measured again down below if</span><br><span class="line">                // there is any leftover space.</span><br><span class="line">				// è¿™ä¸ªifé‡Œé¢éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</span><br><span class="line">                // * LinearLayoutçš„é«˜åº¦ä¸ºmatch_parent(æˆ–è€…æœ‰å…·ä½“å€¼)</span><br><span class="line">                // * å­æ§ä»¶çš„é«˜åº¦ä¸º0</span><br><span class="line">                // * å­æ§ä»¶çš„weight&gt;0   	</span><br><span class="line"></span><br><span class="line">				// å¦‚æœLinearLayoutçš„å‚ç›´æ–¹å‘æµ‹é‡æ¨¡å¼æ˜¯EXACTLYï¼Œå³ç¡®å®šå€¼ï¼Œä¸”å­è§†å›¾çš„é«˜åº¦ä¸º0ï¼Œweightå¤§äº0ï¼Œ</span><br><span class="line">        //åˆ™å…ˆå°†æ€»é«˜åº¦åŠ ä¸Šå­è§†å›¾çš„topMarginå’ŒbottomMarginï¼Œå¹¶è®¾ç½®skippedMeasureï¼ˆæš‚æ—¶è·³è¿‡æµ‹é‡æ ‡è¯†ï¼‰ä¸ºtrue</span><br><span class="line"></span><br><span class="line">                // è¿™å…¶å®å°±æ˜¯æˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹ç”¨weightæ—¶çš„å†™æ³•ï¼Œæ­¤æ—¶éœ€è¦è®°ä½viewçš„topMarginå’ŒbottomMarginï¼ˆå¯¹äºæ–¹å‘ä¸ºï¼‰</span><br><span class="line">                // æµ‹é‡åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œä¼šç»™ä¸ªæ ‡å¿—ä½ï¼Œç¨åå†å¤„ç†ã€‚æ­¤æ—¶ä¼šè®¡ç®—æ€»é«˜åº¦</span><br><span class="line">                final int totalLength = mTotalLength;</span><br><span class="line">                mTotalLength = Math.max(totalLength, totalLength + lp.topMargin + lp.bottomMargin);</span><br><span class="line">                skippedMeasure = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">				// åˆ°è¿™ä¸ªåˆ†æ”¯ï¼Œåˆ™éœ€è¦å¯¹ä¸åŒçš„æƒ…å†µè¿›è¡Œæµ‹é‡</span><br><span class="line">                int oldHeight = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line">                if (lp.height == 0 &amp;&amp; lp.weight &gt; 0) &#123;</span><br><span class="line">                    // heightMode is !!either UNSPECIFIED or AT_MOST!!, and this</span><br><span class="line">                    // child wanted to stretch to fill available space.</span><br><span class="line">                    // Translate that to WRAP_CONTENT so that it does not end up</span><br><span class="line">                    // with a height of 0</span><br><span class="line">					// æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ„å‘³ç€çˆ¶ç±»å³LinearLayoutæ˜¯wrap_contentï¼Œæˆ–è€…modeä¸ºUNSPECIFIED</span><br><span class="line">                    // é‚£ä¹ˆæ­¤æ—¶å°†å½“å‰å­æ§ä»¶çš„é«˜åº¦ç½®ä¸ºwrap_content</span><br><span class="line">                    // ä¸ºä½•éœ€è¦è¿™ä¹ˆåšï¼Œä¸»è¦æ˜¯å› ä¸ºå½“çˆ¶ç±»ä¸ºwrap_contentæ—¶ï¼Œå…¶å¤§å°å®é™…ä¸Šç”±å­æ§ä»¶æ§åˆ¶</span><br><span class="line">                    // æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè‡ªå®šä¹‰æ§ä»¶çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæŒ‡å®šæµ‹é‡æ¨¡å¼ä¸ºwrap_contentæ—¶çš„é»˜è®¤å¤§å°</span><br><span class="line">                    // è¿™é‡Œå¼ºåˆ¶ç»™å®šä¸ºwrap_contentä¸ºçš„å°±æ˜¯é˜²æ­¢å­æ§ä»¶é«˜åº¦ä¸º0.</span><br><span class="line"></span><br><span class="line">					//è¿™é‡Œå…¶å®å®˜æ–¹çš„æ³¨é‡Šè®²äº†ä¹ŸæŒºæ¸…æ¥šçš„ï¼Œåˆ°äº†è¿™æ­¥ï¼Œå½“å‰çš„LinearLayoutçš„æ¨¡å¼</span><br><span class="line">					//è‚¯å®šæ˜¯UNSPECIFIEDæˆ–è€…MOSTï¼Œå› ä¸ºEXACTLYæ¨¡å¼ä¼šè¿›å…¥ä¸Šä¸€ä¸ªåˆ¤æ–­</span><br><span class="line">					//ç„¶åæŠŠå­Viewçš„é«˜åº¦èµ‹å€¼æˆ-1(WRAP_CONTENT)</span><br><span class="line">					// å¦‚æœå‚ç›´æ–¹å‘æµ‹é‡æ¨¡å¼ä¸ºUNSPECIFIEDæˆ–AT_MOSTï¼ŒåŒæ—¶å­è§†å›¾æƒ³è¦å°½é‡è·å–å¯ç”¨çš„å‰©ä½™ç©ºé—´ï¼Œ</span><br><span class="line">          //æŠŠå­è§†å›¾çš„é«˜åº¦æ”¹ä¸ºWRAP_CONTENTï¼Œè¿™æ ·å­è§†å›¾çš„æœ€ç»ˆé«˜åº¦å°±ä¸ä¼šæ˜¯0</span><br><span class="line"></span><br><span class="line">                    oldHeight = 0;</span><br><span class="line">                    lp.height = LayoutParams.WRAP_CONTENT;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                // Determine how big this child would like to be. If this or</span><br><span class="line">                // previous children have given a weight, then we allow it to</span><br><span class="line">                // use all available space (and we will shrink things later</span><br><span class="line">                // if needed).</span><br><span class="line">				/**ã€1ã€‘*/</span><br><span class="line">                // ä¸‹é¢è¿™å¥è™½ç„¶æœ€ç»ˆè°ƒç”¨çš„æ˜¯ViewGroupé€šç”¨çš„åŒåæ–¹æ³•ï¼Œä½†ä¼ å…¥çš„heightå€¼æ˜¯è·Ÿå¹³æ—¶ä¸ä¸€æ ·çš„</span><br><span class="line">                // è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¼ å…¥çš„heightæ˜¯è·Ÿweightæœ‰å…³ï¼Œå…³äºè¿™é‡Œï¼Œç¨åçš„æ–‡å­—æè¿°ä¼šç€é‡é˜è¿°</span><br><span class="line"></span><br><span class="line">				// è¿™ä¸ªå‡½æ•°æœ€åä¼šè°ƒç”¨child.measure(childWidthMeasureSpec, childHeightMeasureSpec)</span><br><span class="line">        //æµ‹é‡å‡ºå­è§†å›¾è¦å ç”¨å¤šå¤§ç©ºé—´ï¼Œå¹¶è®¾ç½®å­è§†å›¾çš„mMeasuredWidthå’ŒmMeasuredHeight</span><br><span class="line">                measureChildBeforeLayout(</span><br><span class="line">                       child, i, widthMeasureSpec, 0, heightMeasureSpec,</span><br><span class="line">                       totalWeight == 0 ? mTotalLength : 0);</span><br><span class="line"></span><br><span class="line">				// é‡ç½®å­æ§ä»¶é«˜åº¦ï¼Œç„¶åè¿›è¡Œç²¾ç¡®èµ‹å€¼</span><br><span class="line">                if (oldHeight != Integer.MIN_VALUE) &#123;</span><br><span class="line">                   lp.height = oldHeight;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                final int childHeight = child.getMeasuredHeight();</span><br><span class="line">                final int totalLength = mTotalLength;</span><br><span class="line"></span><br><span class="line">				// getNextLocationOffsetè¿”å›çš„æ°¸è¿œæ˜¯0ï¼Œå› æ­¤è¿™é‡Œå®é™…ä¸Šæ˜¯æ¯”è¾ƒchildæµ‹é‡å‰åçš„æ€»é«˜åº¦ï¼Œå–å¤§å€¼ã€‚</span><br><span class="line">				//åŠ ä¸Šå­Viewçš„marginå€¼</span><br><span class="line">                mTotalLength = Math.max(totalLength, totalLength + childHeight + lp.topMargin +</span><br><span class="line">                       lp.bottomMargin + getNextLocationOffset(child));</span><br><span class="line"></span><br><span class="line">				// é‡æ–°è®¾ç½®æœ€å¤§å­è§†å›¾é«˜åº¦</span><br><span class="line">                if (useLargestChild) &#123;</span><br><span class="line">                    largestChildHeight = Math.max(childHeight, largestChildHeight);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            /**</span><br><span class="line">             * If applicable, compute the additional offset to the child&apos;s baseline</span><br><span class="line">             * we&apos;ll need later when asked &#123;@link #getBaseline&#125;.</span><br><span class="line">             */</span><br><span class="line">			// è®¡ç®—å­è§†å›¾baselineçš„åç§»é‡</span><br><span class="line">            if ((baselineChildIndex &gt;= 0) &amp;&amp; (baselineChildIndex == i + 1)) &#123;</span><br><span class="line">               mBaselineChildTop = mTotalLength;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // if we are trying to use a child index for our baseline, the above</span><br><span class="line">            // book keeping only works if there are no children above it with</span><br><span class="line">            // weight.  fail fast to aid the developer.</span><br><span class="line">			// å¦‚æœè¦ä¸ºbaselineæŒ‡å®šå­è§†å›¾ç´¢å¼•ï¼Œåªæœ‰åœ¨æ­¤å­è§†å›¾ä¹‹ä¸Šçš„è§†å›¾æ²¡æœ‰è®¾ç½®weightå±æ€§æ—¶æ‰æœ‰æ•ˆ</span><br><span class="line">            if (i &lt; baselineChildIndex &amp;&amp; lp.weight &gt; 0) &#123;</span><br><span class="line">                throw new RuntimeException(&quot;A child of LinearLayout with index &quot;</span><br><span class="line">                        + &quot;less than mBaselineAlignedChildIndex has weight &gt; 0, which &quot;</span><br><span class="line">                        + &quot;won&apos;t work.  Either remove the weight, or don&apos;t set &quot;</span><br><span class="line">                        + &quot;mBaselineAlignedChildIndex.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			// ä¸‹é¢å¼€å§‹æµ‹é‡å®½åº¦</span><br><span class="line">            boolean matchWidthLocally = false;</span><br><span class="line"></span><br><span class="line">            // è¿˜è®°å¾—æˆ‘ä»¬å˜é‡é‡Œåˆè¯´åˆ°è¿‡matchWidthLocallyè¿™ä¸ªä¸œä¸œå—</span><br><span class="line">            // å½“çˆ¶ç±»ï¼ˆLinearLayoutï¼‰ä¸æ˜¯match_parentæˆ–è€…ç²¾ç¡®å€¼çš„æ—¶å€™ï¼Œä½†å­æ§ä»¶å´æ˜¯ä¸€ä¸ªmatch_parent</span><br><span class="line">            // é‚£ä¹ˆmatchWidthLocallyå’ŒmatchWidthç½®ä¸ºtrue</span><br><span class="line">            // æ„å‘³ç€è¿™ä¸ªæ§ä»¶å°†ä¼šå æ®çˆ¶ç±»ï¼ˆæ°´å¹³æ–¹å‘ï¼‰çš„æ‰€æœ‰ç©ºé—´</span><br><span class="line">            if (widthMode != MeasureSpec.EXACTLY &amp;&amp; lp.width == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">                // The width of the linear layout will scale, and at least one</span><br><span class="line">                // child said it wanted to match our width. Set a flag</span><br><span class="line">                // indicating that we need to remeasure at least that view when</span><br><span class="line">                // we know our width.</span><br><span class="line">				//å¦‚æœLinearLayoutå®½åº¦ä¸æ˜¯å·²ç¡®å®šçš„ï¼Œå¦‚wrap_content,è€Œå­è§†å›¾æ˜¯MATCH_PARENTï¼Œ  </span><br><span class="line">                matchWidth = true;</span><br><span class="line">                matchWidthLocally = true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">			// è®¡ç®—å­è§†å›¾æ€»å®½åº¦ï¼ˆåŒ…å«å·¦å³å¤–è¾¹è·ï¼‰</span><br><span class="line">            final int margin = lp.leftMargin + lp.rightMargin;</span><br><span class="line">            final int measuredWidth = child.getMeasuredWidth() + margin;</span><br><span class="line">            maxWidth = Math.max(maxWidth, measuredWidth);</span><br><span class="line">			// åˆå¹¶å­å…ƒç´ çš„æµ‹é‡çŠ¶æ€</span><br><span class="line">            childState = combineMeasuredStates(childState, child.getMeasuredState());</span><br><span class="line"></span><br><span class="line">			// å­è§†å›¾å®½åº¦æ˜¯å¦éƒ½ä¸ºMATCH_PARENT</span><br><span class="line">            allFillParent = allFillParent &amp;&amp; lp.width == LayoutParams.MATCH_PARENT;</span><br><span class="line">            if (lp.weight &gt; 0) &#123;</span><br><span class="line">                /*</span><br><span class="line">                 * Widths of weighted Views are bogus if we end up</span><br><span class="line">                 * remeasuring, so keep them separate.</span><br><span class="line">                 */</span><br><span class="line">				//å¦‚è®¾ç½®äº†weighå±æ€§ï¼Œåˆ™å­è§†å›¾çš„å®½åº¦éœ€è¦åœ¨çˆ¶è§†å›¾ç¡®å®šåæ‰èƒ½ç¡®å®šã€‚è¿™é‡Œå¹¶ä¸æ˜¯çœŸå®çš„å®½åº¦  </span><br><span class="line">                weightedMaxWidth = Math.max(weightedMaxWidth,</span><br><span class="line">                        matchWidthLocally ? margin : measuredWidth);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                alternativeMaxWidth = Math.max(alternativeMaxWidth,</span><br><span class="line">                        matchWidthLocally ? margin : measuredWidth);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i += getChildrenSkipCount(child, i);</span><br><span class="line">        &#125;</span><br><span class="line">		//for å¾ªç¯ç»“æŸ</span><br><span class="line"></span><br><span class="line">		// ä¸‹é¢çš„è¿™ä¸€æ®µä»£ç ä¸»è¦æ˜¯ä¸ºuseLargestChildå±æ€§æœåŠ¡çš„ï¼Œä¸åœ¨æœ¬æ–‡ä¸»è¦åˆ†æèŒƒå›´ï¼Œç•¥è¿‡</span><br><span class="line">        if (mTotalLength &gt; 0 &amp;&amp; hasDividerBeforeChildAt(count)) &#123;</span><br><span class="line">            mTotalLength += mDividerHeight;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (useLargestChild &amp;&amp;</span><br><span class="line">                (heightMode == MeasureSpec.AT_MOST || heightMode == MeasureSpec.UNSPECIFIED)) &#123;</span><br><span class="line">            mTotalLength = 0;</span><br><span class="line"></span><br><span class="line">			// å¦‚æœè®¾ç½®äº†useLargestChildå±æ€§ï¼Œä¸”LinearLayoutçš„å‚ç›´æ–¹å‘æµ‹é‡æ¨¡å¼æ˜¯AT_MOSTæˆ–UNSPECIFIEDï¼Œ</span><br><span class="line">      //é‡æ–°æµ‹é‡æ€»é«˜åº¦ï¼ŒuseLargestChildå±æ€§ä¼šä½¿æ‰€æœ‰å¸¦weightå±æ€§çš„å­è§†å›¾å…·æœ‰æœ€å¤§å­è§†å›¾çš„æœ€å°å°ºå¯¸</span><br><span class="line">            for (int i = 0; i &lt; count; ++i) &#123;</span><br><span class="line">                final View child = getVirtualChildAt(i);</span><br><span class="line"></span><br><span class="line">                if (child == null) &#123;</span><br><span class="line">                    mTotalLength += measureNullChild(i);</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (child.getVisibility() == GONE) &#123;</span><br><span class="line">                    i += getChildrenSkipCount(child, i);</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                final LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams)</span><br><span class="line">                        child.getLayoutParams();</span><br><span class="line">                // Account for negative margins</span><br><span class="line">                final int totalLength = mTotalLength;</span><br><span class="line">                mTotalLength = Math.max(totalLength, totalLength + largestChildHeight +</span><br><span class="line">                        lp.topMargin + lp.bottomMargin + getNextLocationOffset(child));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		//åœ¨è¿™ä¸¤æ®µä»£ç ä¹‹é—´è¿˜æœ‰äº›æ‚ä¸ƒæ‚å…«çš„å¤„ç†ï¼Œå¦‚æœè¯»è€…æœ‰å…´è¶£å¯ä»¥è‡ªå·±é˜…è¯»åˆ†æä¸‹</span><br><span class="line">		//å½“æµ‹é‡å®Œå­Viewçš„å¤§å°åï¼Œæ€»é«˜åº¦ä¼šå†åŠ ä¸Špaddingçš„é«˜åº¦</span><br><span class="line">        // Add in our padding</span><br><span class="line">        mTotalLength += mPaddingTop + mPaddingBottom;</span><br><span class="line"></span><br><span class="line">        int heightSize = mTotalLength;</span><br><span class="line">		    //å¦‚æœè®¾ç½®äº†minimumheightå±æ€§ï¼Œä¼šæ ¹æ®å½“å‰ä½¿ç”¨é«˜åº¦å’Œæœ€å°é«˜åº¦è¿›è¡Œæ¯”è¾ƒ</span><br><span class="line">        //ç„¶åå–ä¸¤è€…ä¸­å¤§çš„å€¼,getSuggestedMinimumHeightä¸ºèƒŒæ™¯çš„æœ€å°é«˜å’Œè§†å›¾è®¾ç½®çš„æœ€å°é«˜çš„å¤§å€¼</span><br><span class="line">        // Check against our minimum height</span><br><span class="line">        heightSize = Math.max(heightSize, getSuggestedMinimumHeight());</span><br><span class="line"></span><br><span class="line">        // Reconcile our calculated size with the heightMeasureSpe</span><br><span class="line">		// æŠŠæµ‹é‡å‡ºæ¥çš„é«˜åº¦ä¸æµ‹é‡æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå¾—åˆ°æœ€ç»ˆçš„é«˜åº¦ï¼ŒMeasureSpecå®é™…ä¸Šæ˜¯ä¸€ä¸ª32ä½çš„intï¼Œé«˜ä¸¤ä½æ˜¯æµ‹é‡æ¨¡å¼ï¼Œ</span><br><span class="line">    //å‰©ä¸‹çš„å°±æ˜¯å¤§å°ï¼Œå› æ­¤heightSize = heightSizeAndState &amp; MEASURED_SIZE_MASK;ä½œç”¨å°±æ˜¯ç”¨æ¥å¾—åˆ°å¤§å°çš„ç²¾ç¡®å€¼ï¼ˆä¸å«æµ‹é‡æ¨¡å¼ï¼‰</span><br><span class="line">        int heightSizeAndState = resolveSizeAndState(heightSize, heightMeasureSpec, 0);</span><br><span class="line">        heightSize = heightSizeAndState &amp; MEASURED_SIZE_MASK;</span><br><span class="line"></span><br><span class="line">		//åˆ°äº†è¿™é‡Œï¼Œä¼šå†å¯¹å¸¦weightå±æ€§çš„å­Viewè¿›è¡Œä¸€æ¬¡æµ‹ç»˜</span><br><span class="line">        //é¦–å…ˆè®¡ç®—å‰©ä½™é«˜åº¦</span><br><span class="line"></span><br><span class="line">		//ç®—å‡ºå‰©ä½™ç©ºé—´ï¼Œå‡å¦‚ä¹‹å‰æ˜¯skippçš„è¯ï¼Œé‚£ä¹ˆå‡ ä¹å¯ä»¥è‚¯å®šæ˜¯æœ‰å‰©ä½™ç©ºé—´ï¼ˆåŒæ—¶æœ‰weightï¼‰çš„</span><br><span class="line">        // Either expand children with weight to take up available space or</span><br><span class="line">        // shrink them if they extend beyond our current bounds. If we skipped</span><br><span class="line">        // measurement on any children, we need to measure them now.</span><br><span class="line">        int delta = heightSize - mTotalLength;</span><br><span class="line">        if (skippedMeasure || delta != 0 &amp;&amp; totalWeight &gt; 0.0f) &#123;</span><br><span class="line">			//å¦‚æœè®¾ç½®äº†weightSumå°±ä¼šä½¿ç”¨ä½ è®¾ç½®çš„weightSumï¼Œå¦åˆ™é‡‡ç”¨å½“å‰æ‰€æœ‰å­Viewçš„æƒé‡å’Œã€‚æ‰€ä»¥å¦‚æœè¦æ‰‹åŠ¨è®¾ç½®weightSumçš„æ—¶å€™ï¼Œåƒä¸‡åˆ«è®¡ç®—é”™è¯¯å“¦</span><br><span class="line">            float weightSum = mWeightSum &gt; 0.0f ? mWeightSum : totalWeight;</span><br><span class="line"></span><br><span class="line">            mTotalLength = 0;</span><br><span class="line">			//è¿™é‡Œçš„ä»£ç å°±å’Œç¬¬ä¸€æ¬¡æµ‹é‡å¾ˆåƒäº†</span><br><span class="line">            for (int i = 0; i &lt; count; ++i) &#123;</span><br><span class="line">                final View child = getVirtualChildAt(i);</span><br><span class="line"></span><br><span class="line">                if (child.getVisibility() == View.GONE) &#123;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">                float childExtra = lp.weight;</span><br><span class="line">                if (childExtra &gt; 0) &#123;</span><br><span class="line">					// å…¨ç¯‡æœ€ç²¾åçš„ä¸€ä¸ªåœ°æ–¹ã€‚ã€‚ã€‚ã€‚æ‹¥æœ‰weightçš„æ—¶å€™è®¡ç®—æ–¹å¼,ps:æ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œchildä¾ç„¶è¿˜æ²¡è¿›è¡Œè‡ªèº«çš„measure</span><br><span class="line">					//å­æ§ä»¶çš„weightå æ¯”*å‰©ä½™é«˜åº¦</span><br><span class="line">                    // Child said it could absorb extra space -- give him his share</span><br><span class="line">                    int share = (int) (childExtra * delta / weightSum);</span><br><span class="line">					// weightSumè®¡ä½™</span><br><span class="line">                    weightSum -= childExtra;</span><br><span class="line">					//å‰©ä½™é«˜åº¦å‡å»åˆ†é…å‡ºå»çš„é«˜åº¦</span><br><span class="line">                    delta -= share;</span><br><span class="line"></span><br><span class="line">                    final int childWidthMeasureSpec = getChildMeasureSpec(widthMeasureSpec,</span><br><span class="line">                            mPaddingLeft + mPaddingRight +</span><br><span class="line">                                    lp.leftMargin + lp.rightMargin, lp.width);</span><br><span class="line">					//å¦‚æœæ˜¯å½“å‰LinearLayoutçš„æ¨¡å¼æ˜¯EXACTLY</span><br><span class="line">                    //é‚£ä¹ˆè¿™ä¸ªå­Viewæ˜¯æ²¡æœ‰è¢«æµ‹é‡è¿‡çš„ï¼Œå°±éœ€è¦æµ‹é‡ä¸€æ¬¡</span><br><span class="line">                    //å¦‚æœä¸æ˜¯EXACTLYçš„ï¼Œåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯é‡Œå°±è¢«æµ‹é‡ä¸€äº›äº†</span><br><span class="line">                    // TODO: Use a field like lp.isMeasured to figure out if this</span><br><span class="line">                    // child has been previously measured</span><br><span class="line">                    if ((lp.height != 0) || (heightMode != MeasureSpec.EXACTLY)) &#123;</span><br><span class="line">                        // child was measured once already above...</span><br><span class="line">                        // base new measurement on stored values</span><br><span class="line">						//å¦‚æœæ˜¯éEXACTLYæ¨¡å¼ä¸‹çš„å­Viewå°±å†åŠ ä¸Š</span><br><span class="line">                        //weightåˆ†é…å æ¯”*å‰©ä½™é«˜åº¦</span><br><span class="line">						// ä¸Šé¢å·²ç»æµ‹é‡è¿‡è¿™ä¸ªå­è§†å›¾ï¼ŒæŠŠä¸Šé¢æµ‹é‡çš„ç»“æœåŠ ä¸Šæ ¹æ®weightåˆ†é…çš„å¤§å°</span><br><span class="line">                        int childHeight = child.getMeasuredHeight() + share;</span><br><span class="line">                        if (childHeight &lt; 0) &#123;</span><br><span class="line">                            childHeight = 0;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">						//é‡æ–°æµ‹é‡ä¸€æ¬¡ï¼Œå› ä¸ºé«˜åº¦å‘ç”Ÿäº†å˜åŒ–</span><br><span class="line">                        child.measure(childWidthMeasureSpec,</span><br><span class="line">                                MeasureSpec.makeMeasureSpec(childHeight, MeasureSpec.EXACTLY));</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // child was skipped in the loop above.</span><br><span class="line">                        // Measure for this first time here  </span><br><span class="line"></span><br><span class="line">						//å¦‚æœæ˜¯EXACTLYæ¨¡å¼ä¸‹çš„</span><br><span class="line">                        //è¿™é‡Œåªä¼šæŠŠweightå æ¯”æ‰€æ‹¥æœ‰çš„é«˜åº¦åˆ†é…ç»™ä½ çš„å­View</span><br><span class="line">						// ä¸Šé¢æµ‹é‡çš„æ—¶å€™è¢«è·³è¿‡ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œè¿›è¡Œæµ‹é‡    </span><br><span class="line">                        child.measure(childWidthMeasureSpec,</span><br><span class="line">                                MeasureSpec.makeMeasureSpec(share &gt; 0 ? share : 0,</span><br><span class="line">                                        MeasureSpec.EXACTLY));</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    // Child may now not fit in vertical dimension.</span><br><span class="line">                    childState = combineMeasuredStates(childState, child.getMeasuredState()</span><br><span class="line">                            &amp; (MEASURED_STATE_MASK&gt;&gt;MEASURED_HEIGHT_STATE_SHIFT));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                final int margin =  lp.leftMargin + lp.rightMargin;</span><br><span class="line">                final int measuredWidth = child.getMeasuredWidth() + margin;</span><br><span class="line">                maxWidth = Math.max(maxWidth, measuredWidth);</span><br><span class="line"></span><br><span class="line">                boolean matchWidthLocally = widthMode != MeasureSpec.EXACTLY &amp;&amp;</span><br><span class="line">                        lp.width == LayoutParams.MATCH_PARENT;</span><br><span class="line"></span><br><span class="line">                alternativeMaxWidth = Math.max(alternativeMaxWidth,</span><br><span class="line">                        matchWidthLocally ? margin : measuredWidth);</span><br><span class="line"></span><br><span class="line">                allFillParent = allFillParent &amp;&amp; lp.width == LayoutParams.MATCH_PARENT;</span><br><span class="line"></span><br><span class="line">                final int totalLength = mTotalLength;</span><br><span class="line">                mTotalLength = Math.max(totalLength, totalLength + child.getMeasuredHeight() +</span><br><span class="line">                        lp.topMargin + lp.bottomMargin + getNextLocationOffset(child));</span><br><span class="line">            &#125;</span><br><span class="line">            // è¿™é‡Œå¾—åˆ°æœ€ç»ˆé«˜åº¦</span><br><span class="line">            // Add in our padding</span><br><span class="line">            mTotalLength += mPaddingTop + mPaddingBottom;</span><br><span class="line">            // TODO: Should we recompute the heightSpec based on the new total length?</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">			 // æ²¡æœ‰weightçš„æƒ…å†µä¸‹ï¼Œåªçœ‹useLargestChildå‚æ•°ï¼Œå¦‚æœéƒ½æ— ç›¸å…³ï¼Œé‚£å°±èµ°layoutæµç¨‹äº†ï¼Œå› æ­¤è¿™é‡Œå¿½ç•¥</span><br><span class="line">            alternativeMaxWidth = Math.max(alternativeMaxWidth,weightedMaxWidth);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            // We have no limit, so make all weighted views as tall as the largest child.</span><br><span class="line">            // Children will have already been measured once.</span><br><span class="line">			// ä½¿æ‰€æœ‰å…·æœ‰weightå±æ€§ è§†å›¾éƒ½å’Œæœ€å¤§å­è§†å›¾ä¸€æ ·é«˜ï¼Œå­è§†å›¾å¯èƒ½åœ¨ä¸Šé¢å·²ç»è¢«æµ‹é‡è¿‡ä¸€æ¬¡</span><br><span class="line">            if (useLargestChild &amp;&amp; heightMode != MeasureSpec.EXACTLY) &#123;</span><br><span class="line">                for (int i = 0; i &lt; count; i++) &#123;</span><br><span class="line">                    final View child = getVirtualChildAt(i);</span><br><span class="line"></span><br><span class="line">                    if (child == null || child.getVisibility() == View.GONE) &#123;</span><br><span class="line">                        continue;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    final LinearLayout.LayoutParams lp =</span><br><span class="line">                            (LinearLayout.LayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">                    float childExtra = lp.weight;</span><br><span class="line">                    if (childExtra &gt; 0) &#123;</span><br><span class="line">                        child.measure(</span><br><span class="line">                                MeasureSpec.makeMeasureSpec(child.getMeasuredWidth(),</span><br><span class="line">                                        MeasureSpec.EXACTLY),</span><br><span class="line">                                MeasureSpec.makeMeasureSpec(largestChildHeight,</span><br><span class="line">                                        MeasureSpec.EXACTLY));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (!allFillParent &amp;&amp; widthMode != MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            maxWidth = alternativeMaxWidth;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        maxWidth += mPaddingLeft + mPaddingRight;</span><br><span class="line"></span><br><span class="line">        // Check against our minimum width</span><br><span class="line">        maxWidth = Math.max(maxWidth, getSuggestedMinimumWidth());</span><br><span class="line"></span><br><span class="line">		// è®¾ç½®æµ‹é‡å®Œçš„å®½é«˜</span><br><span class="line">        setMeasuredDimension(resolveSizeAndState(maxWidth, widthMeasureSpec, childState),</span><br><span class="line">                heightSizeAndState);</span><br><span class="line"></span><br><span class="line">        if (matchWidth) &#123;</span><br><span class="line">			// ä½¿å®½åº¦ä¸€è‡´</span><br><span class="line">            forceUniformWidth(count, heightMeasureSpec);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å‚ç›´ç»˜åˆ¶ä¸­ä¸»è¦æ‰§è¡Œé€»è¾‘åœ¨ä¸¤å¤§å—ä»£ç ï¼Œç¬¬ä¸€ä¸ªforå¾ªç¯ï¼Œç¬¬äºŒä¸ªifåˆ¤æ–­ä¸­çš„forå¾ªç¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†å—åˆ†æè¯¥å‡½æ•°æºç ï¼š</p>
<h4 id="å˜é‡çš„å®šä¹‰"><a href="#å˜é‡çš„å®šä¹‰" class="headerlink" title="å˜é‡çš„å®šä¹‰"></a>å˜é‡çš„å®šä¹‰</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">void measureVertical(int widthMeasureSpec, int heightMeasureSpec) &#123;      </span><br><span class="line">        // mTotalLengthä½œä¸ºLinearLayoutæˆå‘˜å˜é‡ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯åœ¨æµ‹é‡çš„æ—¶å€™é€šè¿‡ç´¯åŠ å¾—åˆ°æ‰€æœ‰å­æ§ä»¶çš„é«˜åº¦å’Œï¼ˆVerticalï¼‰æˆ–è€…å®½åº¦å’Œï¼ˆHorizontalï¼‰</span><br><span class="line">        mTotalLength = 0;</span><br><span class="line">        // maxWidthç”¨æ¥è®°å½•æ‰€æœ‰å­æ§ä»¶ä¸­æ§ä»¶å®½åº¦æœ€å¤§çš„å€¼ã€‚</span><br><span class="line">        int maxWidth = 0;</span><br><span class="line">        // å­æ§ä»¶çš„æµ‹é‡çŠ¶æ€ï¼Œä¼šåœ¨éå†å­æ§ä»¶æµ‹é‡çš„æ—¶å€™é€šè¿‡combineMeasuredStatesæ¥åˆå¹¶ä¸Šä¸€ä¸ªå­æ§ä»¶æµ‹é‡çŠ¶æ€ä¸å½“å‰éå†åˆ°çš„å­æ§ä»¶çš„æµ‹é‡çŠ¶æ€ï¼Œé‡‡å–çš„æ˜¯æŒ‰ä½ç›¸æˆ–</span><br><span class="line">        int childState = 0;</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * ä»¥ä¸‹ä¸¤ä¸ªæœ€å¤§å®½åº¦è·Ÿä¸Šé¢çš„maxWidthæœ€å¤§çš„åŒºåˆ«åœ¨äºmatchWidthLocallyè¿™ä¸ªå‚æ•°</span><br><span class="line">         * å½“matchWidthLocallyä¸ºçœŸï¼Œé‚£ä¹ˆä»¥ä¸‹ä¸¤ä¸ªå˜é‡åªä¼šè·Ÿå½“å‰å­æ§ä»¶çš„å·¦å³marginå’Œç›¸æ¯”è¾ƒå–å¤§å€¼</span><br><span class="line">         * å¦åˆ™ï¼Œåˆ™è·ŸmaxWidthçš„è®¡ç®—æ–¹æ³•ä¸€æ ·</span><br><span class="line">         */</span><br><span class="line">        // å­æ§ä»¶ä¸­layout_weight&lt;=0çš„Viewçš„æœ€å¤§å®½åº¦</span><br><span class="line">        int alternativeMaxWidth = 0;</span><br><span class="line">        // å­æ§ä»¶ä¸­layout_weight&gt;0çš„Viewçš„æœ€å¤§å®½åº¦</span><br><span class="line">        int weightedMaxWidth = 0;</span><br><span class="line">        // æ˜¯å¦å­æ§ä»¶å…¨æ˜¯match_parentçš„æ ‡å¿—ä½ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ–°æµ‹é‡</span><br><span class="line">        boolean allFillParent = true;</span><br><span class="line">        // æ‰€æœ‰å­æ§ä»¶çš„weightä¹‹å’Œ</span><br><span class="line">        float totalWeight = 0;</span><br><span class="line"></span><br><span class="line">        // å¦‚æ‚¨æ‰€è§ï¼Œå¾—åˆ°æ‰€æœ‰å­æ§ä»¶çš„æ•°é‡ï¼Œå‡†ç¡®çš„è¯´ï¼Œå®ƒå¾—åˆ°çš„æ˜¯æ‰€æœ‰åŒçº§å­æ§ä»¶çš„æ•°é‡</span><br><span class="line">        // åœ¨å®˜æ–¹çš„æ³¨é‡Šä¸­ä¹Ÿæœ‰ç€å¯¹åº”çš„ä¾‹å­</span><br><span class="line">        // æ¯”å¦‚TableRowï¼Œå‡å¦‚TableRowé‡Œé¢æœ‰Nä¸ªæ§ä»¶ï¼Œè€ŒLinearLayoutï¼ˆTableLayoutä¹Ÿæ˜¯ç»§æ‰¿LinearLayoutå“¦ï¼‰ä¸‹æœ‰Mä¸ªTableRowï¼Œé‚£ä¹ˆè¿™é‡Œè¿”å›çš„æ˜¯Mï¼Œè€ŒéM*N</span><br><span class="line">        // ä½†å®é™…ä¸Šï¼Œå®˜æ–¹ä¼¼ä¹ä¹Ÿåªæ˜¯ç›´æ¥è¿”å›getChildCount()ï¼Œèµ·è¿™ä¸ªæ–¹æ³•åçš„åŸå› ä¼°è®¡æ˜¯ä¸ºäº†è®©äººæ›´åŠ çš„æ˜ç™½ï¼Œæ¯•ç«Ÿå¦‚æœæ˜¯getChildCount()å¯èƒ½ä¼šè®©äººè¯¯è®¤ä¸ºä¸ºä»€ä¹ˆæ²¡æœ‰è¿”å›æ‰€æœ‰ï¼ˆåŒ…æ‹¬ä¸åŒçº§ï¼‰çš„å­æ§ä»¶æ•°é‡</span><br><span class="line">        final int count = getVirtualChildCount();</span><br><span class="line"></span><br><span class="line">        // å¾—åˆ°æµ‹é‡æ¨¡å¼</span><br><span class="line">        final int widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        final int heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        // å½“å­æ§ä»¶ä¸ºmatch_parentçš„æ—¶å€™ï¼Œè¯¥å€¼ä¸ºtureï¼ŒåŒæ—¶åˆ¤å®šçš„è¿˜æœ‰ä¸Šé¢æ‰€è¯´çš„matchWidthLocallyï¼Œè¿™ä¸ªå˜é‡å†³å®šäº†å­æ§ä»¶çš„æµ‹é‡æ˜¯çˆ¶æ§ä»¶å¹²é¢„è¿˜æ˜¯å¡«å……çˆ¶æ§ä»¶ï¼ˆå‰©ä½™çš„ç©ºç™½ä½ç½®ï¼‰ã€‚</span><br><span class="line">        boolean matchWidth = false;</span><br><span class="line"></span><br><span class="line">        boolean skippedMeasure = false;</span><br><span class="line"></span><br><span class="line">        final int baselineChildIndex = mBaselineAlignedChildIndex;        </span><br><span class="line">        final boolean useLargestChild = mUseLargestChild;</span><br><span class="line"></span><br><span class="line">        int largestChildHeight = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line">        // ...... åº•ä¸‹ä¸¤ä¸ªforå¾ªç¯</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å˜é‡å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ç•™æ„ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>mTotalLengthï¼šè¿™ä¸ªå°±æ˜¯æœ€ç»ˆå¾—åˆ°çš„æ•´ä¸ªLinearLayoutçš„é«˜åº¦ï¼ˆå­æ§ä»¶é«˜åº¦ç´¯åŠ åŠè‡ªèº«paddingï¼‰</li>
<li>ä¸‰ä¸ªè·Ÿwidthç›¸å…³çš„å˜é‡</li>
<li>weightç›¸å…³çš„å˜é‡</li>
</ul>
<h4 id="ç¬¬ä¸€ä¸ªforä»£ç å—å’ŒbaselineChildIndexå¤„ç†"><a href="#ç¬¬ä¸€ä¸ªforä»£ç å—å’ŒbaselineChildIndexå¤„ç†" class="headerlink" title="ç¬¬ä¸€ä¸ªforä»£ç å—å’ŒbaselineChildIndexå¤„ç†"></a>ç¬¬ä¸€ä¸ªforä»£ç å—å’ŒbaselineChildIndexå¤„ç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">void measureVertical(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        // ...ä¸Šé¢çš„ä¸€å¤§å †å±€éƒ¨å˜é‡</span><br><span class="line">        for (int i = 0; i &lt; count; ++i) &#123;</span><br><span class="line"></span><br><span class="line">            final View child = getVirtualChildAt(i);</span><br><span class="line"></span><br><span class="line">            if (child == null) &#123;</span><br><span class="line">                // ç›®å‰è€Œè¨€ï¼ŒmeasureNullChild()æ–¹æ³•è¿”å›çš„æ°¸è¿œæ˜¯0ï¼Œä¼°è®¡æ˜¯è®¾è®¡è€…ç•™ä¸‹æ¥ä»¥åæˆ–è®¸æœ‰è¡¥å……çš„ã€‚</span><br><span class="line">                mTotalLength += measureNullChild(i);</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (child.getVisibility() == GONE) &#123;</span><br><span class="line">               // åŒä¸Šï¼Œè¿”å›çš„éƒ½æ˜¯0ã€‚</span><br><span class="line">               // äº‹å®ä¸Šè¿™é‡Œçš„æ„æ€åº”è¯¥æ˜¯å½“å‰éå†åˆ°çš„Viewä¸ºGoneçš„æ—¶å€™ï¼Œå°±è·³è¿‡è¿™ä¸ªViewï¼Œä¸‹ä¸€å¥çš„continueå…³é”®å­—ä¹Ÿæ­£æ˜¯è¿™ä¸ªæ„æ€ã€‚</span><br><span class="line">               // å¿½ç•¥å½“å‰çš„Viewï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆGoneçš„æ§ä»¶ä¸å ç”¨å¸ƒå±€èµ„æºçš„åŸå› ã€‚ï¼ˆæ¯•ç«Ÿæ ¹æœ¬æ²¡æœ‰åˆ†é…ç©ºé—´ï¼‰</span><br><span class="line">                i += getChildrenSkipCount(child, i);</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // æ ¹æ®showDividerçš„å€¼ï¼ˆbefore/middle/endï¼‰æ¥å†³å®šéå†åˆ°å½“å‰å­æ§ä»¶æ—¶ï¼Œé«˜åº¦æ˜¯å¦éœ€è¦åŠ ä¸Šdividerçš„é«˜åº¦</span><br><span class="line">            // æ¯”å¦‚showDividerä¸ºbeforeï¼Œé‚£ä¹ˆåªä¼šåœ¨ç¬¬0ä¸ªå­æ§ä»¶æµ‹é‡æ—¶åŠ ä¸Šdivideré«˜åº¦ï¼Œå…¶ä½™æƒ…å†µä¸‹éƒ½ä¸åŠ </span><br><span class="line">            if (hasDividerBeforeChildAt(i)) &#123;</span><br><span class="line">                mTotalLength += mDividerWidth;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            final LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams)</span><br><span class="line">                    child.getLayoutParams();</span><br><span class="line">            // å¾—åˆ°æ¯ä¸ªå­æ§ä»¶çš„LayoutParamsåï¼Œç´¯åŠ æƒé‡å’Œï¼Œåé¢ç”¨äºè·ŸweightSumç›¸æ¯”è¾ƒ</span><br><span class="line">            totalWeight += lp.weight;</span><br><span class="line"></span><br><span class="line">            // æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæµ‹é‡æ¨¡å¼æœ‰ä¸‰ç§ï¼š</span><br><span class="line">            // * UNSPECIFIEDï¼šçˆ¶æ§ä»¶å¯¹å­æ§ä»¶æ— çº¦æŸ</span><br><span class="line">            // * Exactlyï¼šçˆ¶æ§ä»¶å¯¹å­æ§ä»¶å¼ºçº¦æŸï¼Œå­æ§ä»¶æ°¸è¿œåœ¨çˆ¶æ§ä»¶è¾¹ç•Œå†…ï¼Œè¶Šç•Œåˆ™è£å‰ªã€‚å¦‚æœè¦è®°å¿†çš„è¯ï¼Œå¯ä»¥è®°å¿†ä¸ºæœ‰å¯¹åº”çš„å…·ä½“æ•°å€¼æˆ–è€…æ˜¯Match_parent</span><br><span class="line">            // * AT_Mostï¼šå­æ§ä»¶ä¸ºwrap_contentçš„æ—¶å€™ï¼Œæµ‹é‡å€¼ä¸ºAT_MOSTã€‚</span><br><span class="line"></span><br><span class="line">            // ä¸‹é¢çš„if/elseåˆ†æ”¯éƒ½æ˜¯è·Ÿweightç›¸å…³</span><br><span class="line">            if (heightMode == MeasureSpec.EXACTLY &amp;&amp; lp.height == 0 &amp;&amp; lp.weight &gt; 0) &#123;</span><br><span class="line">                // è¿™ä¸ªifé‡Œé¢éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</span><br><span class="line">                // * LinearLayoutçš„é«˜åº¦ä¸ºmatch_parent(æˆ–è€…æœ‰å…·ä½“å€¼)</span><br><span class="line">                // * å­æ§ä»¶çš„é«˜åº¦ä¸º0</span><br><span class="line">                // * å­æ§ä»¶çš„weight&gt;0</span><br><span class="line">                // è¿™å…¶å®å°±æ˜¯æˆ‘ä»¬é€šå¸¸æƒ…å†µä¸‹ç”¨weightæ—¶çš„å†™æ³•</span><br><span class="line">                // æµ‹é‡åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œä¼šç»™ä¸ªæ ‡å¿—ä½ï¼Œç¨åå†å¤„ç†ã€‚æ­¤æ—¶ä¼šè®¡ç®—æ€»é«˜åº¦</span><br><span class="line">                final int totalLength = mTotalLength;</span><br><span class="line">                mTotalLength = Math.max(totalLength, totalLength + lp.topMargin + lp.bottomMargin);</span><br><span class="line">                skippedMeasure = true;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                // åˆ°è¿™ä¸ªåˆ†æ”¯ï¼Œåˆ™éœ€è¦å¯¹ä¸åŒçš„æƒ…å†µè¿›è¡Œæµ‹é‡</span><br><span class="line">                int oldHeight = Integer.MIN_VALUE;</span><br><span class="line"></span><br><span class="line">                if (lp.height == 0 &amp;&amp; lp.weight &gt; 0) &#123;</span><br><span class="line">                    // æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ„å‘³ç€çˆ¶ç±»å³LinearLayoutæ˜¯wrap_contentï¼Œæˆ–è€…modeä¸ºUNSPECIFIED</span><br><span class="line">                    // é‚£ä¹ˆæ­¤æ—¶å°†å½“å‰å­æ§ä»¶çš„é«˜åº¦ç½®ä¸ºwrap_content</span><br><span class="line">                    // ä¸ºä½•éœ€è¦è¿™ä¹ˆåšï¼Œä¸»è¦æ˜¯å› ä¸ºå½“çˆ¶ç±»ä¸ºwrap_contentæ—¶ï¼Œå…¶å¤§å°å®é™…ä¸Šç”±å­æ§ä»¶æ§åˆ¶</span><br><span class="line">                    // æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œè‡ªå®šä¹‰æ§ä»¶çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šæŒ‡å®šæµ‹é‡æ¨¡å¼ä¸ºwrap_contentæ—¶çš„é»˜è®¤å¤§å°</span><br><span class="line">                    // è¿™é‡Œå¼ºåˆ¶ç»™å®šä¸ºwrap_contentä¸ºçš„å°±æ˜¯é˜²æ­¢å­æ§ä»¶é«˜åº¦ä¸º0.</span><br><span class="line">                    oldHeight = 0;</span><br><span class="line">                    lp.height = LayoutParams.WRAP_CONTENT;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                /**ã€1ã€‘*/</span><br><span class="line">                // ä¸‹é¢è¿™å¥è™½ç„¶æœ€ç»ˆè°ƒç”¨çš„æ˜¯ViewGroupé€šç”¨çš„åŒåæ–¹æ³•ï¼Œä½†ä¼ å…¥çš„heightå€¼æ˜¯è·Ÿå¹³æ—¶ä¸ä¸€æ ·çš„</span><br><span class="line">                // è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¼ å…¥çš„heightæ˜¯è·Ÿweightæœ‰å…³ï¼Œå…³äºè¿™é‡Œï¼Œç¨åçš„æ–‡å­—æè¿°ä¼šç€é‡é˜è¿°</span><br><span class="line">                measureChildBeforeLayout(</span><br><span class="line">                       child, i, widthMeasureSpec, 0, heightMeasureSpec,</span><br><span class="line">                       totalWeight == 0 ? mTotalLength : 0);</span><br><span class="line"></span><br><span class="line">                // é‡ç½®å­æ§ä»¶é«˜åº¦ï¼Œç„¶åè¿›è¡Œç²¾ç¡®èµ‹å€¼</span><br><span class="line">                if (oldHeight != Integer.MIN_VALUE) &#123;</span><br><span class="line">                   lp.height = oldHeight;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                final int childHeight = child.getMeasuredHeight();</span><br><span class="line">                final int totalLength = mTotalLength;</span><br><span class="line">                // getNextLocationOffsetè¿”å›çš„æ°¸è¿œæ˜¯0ï¼Œå› æ­¤è¿™é‡Œå®é™…ä¸Šæ˜¯æ¯”è¾ƒchildæµ‹é‡å‰åçš„æ€»é«˜åº¦ï¼Œå–å¤§å€¼ã€‚</span><br><span class="line">                mTotalLength = Math.max(totalLength, totalLength + childHeight + lp.topMargin +</span><br><span class="line">                       lp.bottomMargin + getNextLocationOffset(child));</span><br><span class="line"></span><br><span class="line">                if (useLargestChild) &#123;</span><br><span class="line">                    largestChildHeight = Math.max(childHeight, largestChildHeight);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if ((baselineChildIndex &gt;= 0) &amp;&amp; (baselineChildIndex == i + 1)) &#123;</span><br><span class="line">               mBaselineChildTop = mTotalLength;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (i &lt; baselineChildIndex &amp;&amp; lp.weight &gt; 0) &#123;</span><br><span class="line">                throw new RuntimeException(&quot;A child of LinearLayout with index &quot;</span><br><span class="line">                        + &quot;less than mBaselineAlignedChildIndex has weight &gt; 0, which &quot;</span><br><span class="line">                        + &quot;won&apos;t work.  Either remove the weight, or don&apos;t set &quot;</span><br><span class="line">                        + &quot;mBaselineAlignedChildIndex.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            boolean matchWidthLocally = false;</span><br><span class="line"></span><br><span class="line">            // è¿˜è®°å¾—æˆ‘ä»¬å˜é‡é‡Œåˆè¯´åˆ°è¿‡matchWidthLocallyè¿™ä¸ªä¸œä¸œå—</span><br><span class="line">            // å½“çˆ¶ç±»ï¼ˆLinearLayoutï¼‰ä¸æ˜¯match_parentæˆ–è€…ç²¾ç¡®å€¼çš„æ—¶å€™ï¼Œä½†å­æ§ä»¶å´æ˜¯ä¸€ä¸ªmatch_parent</span><br><span class="line">            // é‚£ä¹ˆmatchWidthLocallyå’ŒmatchWidthç½®ä¸ºtrue</span><br><span class="line">            // æ„å‘³ç€è¿™ä¸ªæ§ä»¶å°†ä¼šå æ®çˆ¶ç±»ï¼ˆæ°´å¹³æ–¹å‘ï¼‰çš„æ‰€æœ‰ç©ºé—´</span><br><span class="line">            if (widthMode != MeasureSpec.EXACTLY &amp;&amp; lp.width == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">                matchWidth = true;</span><br><span class="line">                matchWidthLocally = true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            final int margin = lp.leftMargin + lp.rightMargin;</span><br><span class="line">            final int measuredWidth = child.getMeasuredWidth() + margin;</span><br><span class="line">            maxWidth = Math.max(maxWidth, measuredWidth);</span><br><span class="line">            childState = combineMeasuredStates(childState, child.getMeasuredState());</span><br><span class="line"></span><br><span class="line">            allFillParent = allFillParent &amp;&amp; lp.width == LayoutParams.MATCH_PARENT;</span><br><span class="line"></span><br><span class="line">            if (lp.weight &gt; 0) &#123;</span><br><span class="line">                weightedMaxWidth = Math.max(weightedMaxWidth,</span><br><span class="line">                        matchWidthLocally ? margin : measuredWidth);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                alternativeMaxWidth = Math.max(alternativeMaxWidth,</span><br><span class="line">                        matchWidthLocally ? margin : measuredWidth);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i += getChildrenSkipCount(child, i);</span><br><span class="line">        &#125;</span><br><span class="line">        //... åº•ä¸‹ç¬¬äºŒä¸ªforå¾ªç¯</span><br><span class="line">    &#125;</span><br><span class="line">```   </span><br><span class="line">  åœ¨ç¬¬ä¸€ä¸ªforå¾ªç¯ä¸­ï¼Œä¸»è¦æ˜¯if()&#123;&#125;else&#123;&#125;åˆ†æ”¯ï¼Œåˆ¤æ–­æ˜¯heightMode == MeasureSpec.EXACTLY &amp;&amp;</span><br><span class="line">  lp.height == 0 &amp;&amp; lp.weight &gt; 0ï¼Œè¿™ä¸ªä¸»è¦æ˜¯linearLayoutæµ‹é‡æ¨¡å¼ä¸ºEXACTLYä¸”å­è§†å›¾æ˜ç¡®</span><br><span class="line"> äº†æ˜¯ä½¿ç”¨linearLayoutçš„å‰©ä½™ç©ºé—´ï¼Œæ­¤æ—¶å°†å…¶ä¸Šä¸‹é—´è·è®¡å…¥æ€»é«˜åº¦å¹¶ä»¥ä¹‹å‰çš„åšå¯¹æ¯”å»å¤§å€¼ï¼Œå¹¶è®¾ç½®</span><br><span class="line"> skippedMeasureæ ‡å¿—ä¸ºtrueã€‚è€Œåœ¨elseä¸­åˆ™ä¸ºå¤æ‚ç‚¹ï¼Œelseä¸­é¦–å…ˆå¯¹lp.height == 0 &amp;&amp;</span><br><span class="line">  lp.weight &gt; 0çš„å­è§†å›¾çš„heightåšé¢„å¤„ç†ä½¿å…¶ä¸ºLayoutParams.WRAP_CONTENTï¼ˆå› ä¸ºçˆ¶ç±»å³</span><br><span class="line">  LinearLayoutæ­¤æ—¶æ˜¯wrap_contentï¼Œæˆ–è€…modeä¸ºUNSPECIFIEDï¼‰ï¼Œæ¥ç€å¯¹å­è§†å›¾è¿›è¡Œæµ‹é‡ï¼ˆ</span><br><span class="line">  è¿™ä¸ªå—æ€»æƒé‡å½±å“ï¼‰ï¼Œå¹¶å°†å…¶é«˜åº¦å’Œä¸Šä¸‹é—´è·è®¡å…¥åˆ°æ€»é«˜åº¦ä¸­ã€‚ä¹‹åå¯¹baselineChildIndexåšå¤„ç†ï¼Œ</span><br><span class="line">  è®¡å…¥æ€»çš„åŸºçº¿é«˜åº¦å¹¶åˆ¤å®šåŸºçº¿é…ç½®æ˜¯å¦åˆç†ï¼Œä¸åˆç†æŠ›å‡ºå¼‚å¸¸ï¼Œæœ€åæ ¹æ®å­è§†å›¾è®¾ç½®æœ€å¤§å®½åº¦ã€</span><br><span class="line">  allFillParentã€weightedMaxWidthæˆ–alternativeMaxWidthå˜é‡ã€‚</span><br><span class="line"></span><br><span class="line">#### ç¬¬2ä¸ªé‡è¦ä»£ç å—ï¼ˆif()&#123;&#125;else&#123;&#125;åˆ†æ”¯)ï¼‰æ‰§è¡Œå‰çš„å¤„ç† ####</span><br></pre></td></tr></table></figure>
<p>void measureVertical(int widthMeasureSpec, int heightMeasureSpec) {<br>// â€¦ å±€éƒ¨å˜é‡å®šä¹‰å’Œç¬¬ä¸€ä¸ªforå¾ªç¯<br>// ä¸‹é¢çš„è¿™ä¸€æ®µä»£ç ä¸»è¦æ˜¯ä¸ºuseLargestChildå±æ€§æœåŠ¡çš„ï¼Œä¸åœ¨æœ¬æ–‡ä¸»è¦åˆ†æèŒƒå›´ï¼Œç•¥è¿‡<br>        if (mTotalLength &gt; 0 &amp;&amp; hasDividerBeforeChildAt(count)) {<br>            mTotalLength += mDividerHeight;<br>        }</p>
<pre><code>  if (useLargestChild &amp;&amp;
          (heightMode == MeasureSpec.AT_MOST || heightMode == MeasureSpec.UNSPECIFIED)) {
      mTotalLength = 0;

      // å¦‚æœè®¾ç½®äº†useLargestChildå±æ€§ï¼Œä¸”LinearLayoutçš„å‚ç›´æ–¹å‘æµ‹é‡æ¨¡å¼æ˜¯AT_MOSTæˆ–UNSPECIFIEDï¼Œ
//é‡æ–°æµ‹é‡æ€»é«˜åº¦ï¼ŒuseLargestChildå±æ€§ä¼šä½¿æ‰€æœ‰å¸¦weightå±æ€§çš„å­è§†å›¾å…·æœ‰æœ€å¤§å­è§†å›¾çš„æœ€å°å°ºå¯¸
      for (int i = 0; i &lt; count; ++i) {
          final View child = getVirtualChildAt(i);

          if (child == null) {
              mTotalLength += measureNullChild(i);
              continue;
          }

          if (child.getVisibility() == GONE) {
              i += getChildrenSkipCount(child, i);
              continue;
          }

          final LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams)
                  child.getLayoutParams();
          // Account for negative margins
          final int totalLength = mTotalLength;
          mTotalLength = Math.max(totalLength, totalLength + largestChildHeight +
                  lp.topMargin + lp.bottomMargin + getNextLocationOffset(child));
      }
  }
  //... ç¬¬2ä¸ªé‡è¦ä»£ç å—
}
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¿™é‡Œä¸»è¦å¯¹useLargestChildå±æ€§å¤„ç†ï¼Œæ‰§è¡Œå‰ææ˜¯è®¾ç½®äº†useLargestChildå±æ€§ï¼Œä¸”LinearLayoutçš„å‚ç›´</span><br><span class="line">æ–¹å‘æµ‹é‡æ¨¡å¼æ˜¯AT_MOSTæˆ–UNSPECIFIEDï¼Œé‡æ–°æµ‹é‡æ€»é«˜åº¦ï¼ŒuseLargestChildå±æ€§ä¼šä½¿æ‰€æœ‰å¸¦weightå±æ€§çš„å­è§†</span><br><span class="line">å›¾å…·æœ‰æœ€å¤§å­è§†å›¾çš„æœ€å°å°ºå¯¸</span><br><span class="line"></span><br><span class="line">ç¬¬2ä¸ªé‡è¦ä»£ç å—ï¼ˆif()&#123;&#125;else&#123;&#125;åˆ†æ”¯)ï¼‰æ‰§è¡Œé€»è¾‘</span><br></pre></td></tr></table></figure>
<p>//å½“æµ‹é‡å®Œå­Viewçš„å¤§å°åï¼Œæ€»é«˜åº¦ä¼šå†åŠ ä¸Špaddingçš„é«˜åº¦<br>        // Add in our padding<br>        mTotalLength += mPaddingTop + mPaddingBottom;</p>
<pre><code>int heightSize = mTotalLength;
//å¦‚æœè®¾ç½®äº†minimumheightå±æ€§ï¼Œä¼šæ ¹æ®å½“å‰ä½¿ç”¨é«˜åº¦å’Œæœ€å°é«˜åº¦è¿›è¡Œæ¯”è¾ƒ
//ç„¶åå–ä¸¤è€…ä¸­å¤§çš„å€¼,getSuggestedMinimumHeightä¸ºèƒŒæ™¯çš„æœ€å°é«˜å’Œè§†å›¾è®¾ç½®çš„æœ€å°é«˜çš„å¤§å€¼
// Check against our minimum height
heightSize = Math.max(heightSize, getSuggestedMinimumHeight());

// Reconcile our calculated size with the heightMeasureSpe
// æŠŠæµ‹é‡å‡ºæ¥çš„é«˜åº¦ä¸æµ‹é‡æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå¾—åˆ°æœ€ç»ˆçš„é«˜åº¦ï¼ŒMeasureSpecå®é™…ä¸Šæ˜¯ä¸€ä¸ª32ä½çš„intï¼Œé«˜ä¸¤ä½æ˜¯æµ‹é‡æ¨¡å¼ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¤§å°ï¼Œå› æ­¤heightSize = heightSizeAndState &amp; MEASURED_SIZE_MASK;ä½œç”¨å°±æ˜¯ç”¨æ¥å¾—åˆ°å¤§å°çš„ç²¾ç¡®å€¼ï¼ˆä¸å«æµ‹é‡æ¨¡å¼ï¼‰
int heightSizeAndState = resolveSizeAndState(heightSize, heightMeasureSpec, 0);
heightSize = heightSizeAndState &amp; MEASURED_SIZE_MASK;

//åˆ°äº†è¿™é‡Œï¼Œä¼šå†å¯¹å¸¦weightå±æ€§çš„å­Viewè¿›è¡Œä¸€æ¬¡æµ‹ç»˜
//é¦–å…ˆè®¡ç®—å‰©ä½™é«˜åº¦

//ç®—å‡ºå‰©ä½™ç©ºé—´ï¼Œå‡å¦‚ä¹‹å‰æ˜¯skippçš„è¯ï¼Œé‚£ä¹ˆå‡ ä¹å¯ä»¥è‚¯å®šæ˜¯æœ‰å‰©ä½™ç©ºé—´ï¼ˆåŒæ—¶æœ‰weightï¼‰çš„
// Either expand children with weight to take up available space or
// shrink them if they extend beyond our current bounds. If we skipped
// measurement on any children, we need to measure them now.
int delta = heightSize - mTotalLength;
if (skippedMeasure || delta != 0 &amp;&amp; totalWeight &gt; 0.0f) {
    //å¦‚æœè®¾ç½®äº†weightSumå°±ä¼šä½¿ç”¨ä½ è®¾ç½®çš„weightSumï¼Œå¦åˆ™é‡‡ç”¨å½“å‰æ‰€æœ‰å­Viewçš„æƒé‡å’Œã€‚æ‰€ä»¥å¦‚æœè¦æ‰‹åŠ¨è®¾ç½®weightSumçš„æ—¶å€™ï¼Œåƒä¸‡åˆ«è®¡ç®—é”™è¯¯å“¦
    float weightSum = mWeightSum &gt; 0.0f ? mWeightSum : totalWeight;

    mTotalLength = 0;
    //è¿™é‡Œçš„ä»£ç å°±å’Œç¬¬ä¸€æ¬¡æµ‹é‡å¾ˆåƒäº†
    for (int i = 0; i &lt; count; ++i) {
        final View child = getVirtualChildAt(i);

        if (child.getVisibility() == View.GONE) {
            continue;
        }

        LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams) child.getLayoutParams();

        float childExtra = lp.weight;
        if (childExtra &gt; 0) {
            // å…¨ç¯‡æœ€ç²¾åçš„ä¸€ä¸ªåœ°æ–¹ã€‚ã€‚ã€‚ã€‚æ‹¥æœ‰weightçš„æ—¶å€™è®¡ç®—æ–¹å¼,ps:æ‰§è¡Œåˆ°è¿™é‡Œæ—¶ï¼Œchildä¾ç„¶è¿˜æ²¡è¿›è¡Œè‡ªèº«çš„measure
            //å­æ§ä»¶çš„weightå æ¯”*å‰©ä½™é«˜åº¦
            // Child said it could absorb extra space -- give him his share
            int share = (int) (childExtra * delta / weightSum);
            // weightSumè®¡ä½™
            weightSum -= childExtra;
            //å‰©ä½™é«˜åº¦å‡å»åˆ†é…å‡ºå»çš„é«˜åº¦
            delta -= share;

            final int childWidthMeasureSpec = getChildMeasureSpec(widthMeasureSpec,
                    mPaddingLeft + mPaddingRight +
                            lp.leftMargin + lp.rightMargin, lp.width);
            //å¦‚æœæ˜¯å½“å‰LinearLayoutçš„æ¨¡å¼æ˜¯EXACTLY
            //é‚£ä¹ˆè¿™ä¸ªå­Viewæ˜¯æ²¡æœ‰è¢«æµ‹é‡è¿‡çš„ï¼Œå°±éœ€è¦æµ‹é‡ä¸€æ¬¡
            //å¦‚æœä¸æ˜¯EXACTLYçš„ï¼Œåœ¨ç¬¬ä¸€æ¬¡å¾ªç¯é‡Œå°±è¢«æµ‹é‡ä¸€äº›äº†
            // TODO: Use a field like lp.isMeasured to figure out if this
            // child has been previously measured
            if ((lp.height != 0) || (heightMode != MeasureSpec.EXACTLY)) {
                // child was measured once already above...
                // base new measurement on stored values
                //å¦‚æœæ˜¯éEXACTLYæ¨¡å¼ä¸‹çš„å­Viewå°±å†åŠ ä¸Š
                //weightåˆ†é…å æ¯”*å‰©ä½™é«˜åº¦
                // ä¸Šé¢å·²ç»æµ‹é‡è¿‡è¿™ä¸ªå­è§†å›¾ï¼ŒæŠŠä¸Šé¢æµ‹é‡çš„ç»“æœåŠ ä¸Šæ ¹æ®weightåˆ†é…çš„å¤§å°
                int childHeight = child.getMeasuredHeight() + share;
                if (childHeight &lt; 0) {
                    childHeight = 0;
                }

                //é‡æ–°æµ‹é‡ä¸€æ¬¡ï¼Œå› ä¸ºé«˜åº¦å‘ç”Ÿäº†å˜åŒ–
                child.measure(childWidthMeasureSpec,
                        MeasureSpec.makeMeasureSpec(childHeight, MeasureSpec.EXACTLY));
            } else {
                // child was skipped in the loop above.
                // Measure for this first time here  

                //å¦‚æœæ˜¯EXACTLYæ¨¡å¼ä¸‹çš„
                //è¿™é‡Œåªä¼šæŠŠweightå æ¯”æ‰€æ‹¥æœ‰çš„é«˜åº¦åˆ†é…ç»™ä½ çš„å­View
                // ä¸Šé¢æµ‹é‡çš„æ—¶å€™è¢«è·³è¿‡ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œè¿›è¡Œæµ‹é‡    
                child.measure(childWidthMeasureSpec,
                        MeasureSpec.makeMeasureSpec(share &gt; 0 ? share : 0,
                                MeasureSpec.EXACTLY));
            }

            // Child may now not fit in vertical dimension.
            childState = combineMeasuredStates(childState, child.getMeasuredState()
                    &amp; (MEASURED_STATE_MASK&gt;&gt;MEASURED_HEIGHT_STATE_SHIFT));
        }

        final int margin =  lp.leftMargin + lp.rightMargin;
        final int measuredWidth = child.getMeasuredWidth() + margin;
        maxWidth = Math.max(maxWidth, measuredWidth);

        boolean matchWidthLocally = widthMode != MeasureSpec.EXACTLY &amp;&amp;
                lp.width == LayoutParams.MATCH_PARENT;

        alternativeMaxWidth = Math.max(alternativeMaxWidth,
                matchWidthLocally ? margin : measuredWidth);

        allFillParent = allFillParent &amp;&amp; lp.width == LayoutParams.MATCH_PARENT;

        final int totalLength = mTotalLength;
        mTotalLength = Math.max(totalLength, totalLength + child.getMeasuredHeight() +
                lp.topMargin + lp.bottomMargin + getNextLocationOffset(child));
    }
    // è¿™é‡Œå¾—åˆ°æœ€ç»ˆé«˜åº¦
    // Add in our padding
    mTotalLength += mPaddingTop + mPaddingBottom;
    // TODO: Should we recompute the heightSpec based on the new total length?
} else {
     // æ²¡æœ‰weightçš„æƒ…å†µä¸‹ï¼Œåªçœ‹useLargestChildå‚æ•°ï¼Œå¦‚æœéƒ½æ— ç›¸å…³ï¼Œé‚£å°±èµ°layoutæµç¨‹äº†ï¼Œå› æ­¤è¿™é‡Œå¿½ç•¥
    alternativeMaxWidth = Math.max(alternativeMaxWidth,weightedMaxWidth);


    // We have no limit, so make all weighted views as tall as the largest child.
    // Children will have already been measured once.
    // ä½¿æ‰€æœ‰å…·æœ‰weightå±æ€§ è§†å›¾éƒ½å’Œæœ€å¤§å­è§†å›¾ä¸€æ ·é«˜ï¼Œå­è§†å›¾å¯èƒ½åœ¨ä¸Šé¢å·²ç»è¢«æµ‹é‡è¿‡ä¸€æ¬¡
    if (useLargestChild &amp;&amp; heightMode != MeasureSpec.EXACTLY) {
        for (int i = 0; i &lt; count; i++) {
            final View child = getVirtualChildAt(i);

            if (child == null || child.getVisibility() == View.GONE) {
                continue;
            }

            final LinearLayout.LayoutParams lp =
                    (LinearLayout.LayoutParams) child.getLayoutParams();

            float childExtra = lp.weight;
            if (childExtra &gt; 0) {
                child.measure(
                        MeasureSpec.makeMeasureSpec(child.getMeasuredWidth(),
                                MeasureSpec.EXACTLY),
                        MeasureSpec.makeMeasureSpec(largestChildHeight,
                                MeasureSpec.EXACTLY));
            }
        }
    }
}
</code></pre><p>```<br>åœ¨è¿›å…¥ifelseåˆ†æ”¯å‰ï¼Œå…ˆè®¡ç®—è§†å›¾çš„æ€»é«˜åº¦ï¼Œå¹¶ä¸æµ‹é‡æ¨¡å¼è¿›è¡Œæ¯”è¾ƒï¼ˆresolveSizeAndStateï¼‰å¾—åˆ°æœ€ç»ˆé«˜åº¦ï¼Œ<br>åœ¨å‡å»æ€»é«˜åº¦ï¼Œå¾—åˆ°æœ€ç»ˆè¿˜å‰©å¤šé«˜ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥åˆ†é…ç»™å¸¦æƒé‡çš„è§†å›¾çš„é«˜ï¼‰ï¼›<br>ifelseé¦–å…ˆåˆ¤æ–­ï¼ˆskippedMeasure || delta != 0 &amp;&amp; totalWeight &gt; 0.0fï¼‰ï¼Œ</p>
<ul>
<li><p>å¦‚æœè¯¥æ¡ä»¶ä¸ºtrueï¼Œå…ˆå°†æ€»é«˜åº¦ç½®ä¸º0å†è¿›å…¥forå¾ªç¯ï¼Œæ­¤å¤„æ ¹æ®å­è§†å›¾çš„æƒé‡ï¼Œå†æ¬¡åˆ¤å®š(lp.height != 0) || (heightMode != MeasureSpec.EXACTLY)</p>
<ul>
<li>trueï¼šå­è§†å›¾å†æ¬¡æµ‹é‡ åˆ™è®¡ç®—å­è§†å›¾å¯ä»¥å¾—åˆ°å¤šå°‘é«˜ï¼ˆæœ‰å¯èƒ½ä¸ºè´Ÿï¼Œä¹Ÿå°±æ˜¯å­è§†å›¾è¦åå‡ºä¸€å®šé«˜åº¦å‡ºæ¥ï¼‰ï¼Œç„¶åå­è§†å›¾æµ‹é‡é«˜åº¦å’Œåˆ†é…çš„é«˜åº¦ç›¸åŠ ï¼Œå°äº0ï¼Œåˆ™é‡ç½®ä¸º0ï¼Œæœ€ååœ¨æµ‹é‡ä¸€æ¬¡ã€‚</li>
<li><p>falseï¼šç›´æ¥æµ‹é‡å­è§†å›¾ï¼Œè¿™ä¸ªæ˜¯ä¹‹å‰è¢«è·³è¿‡æ²¡æœ‰æµ‹é‡çš„å­è§†å›¾ï¼›<br>æœ€åå†æ¬¡æµ‹é‡è§†å›¾çš„å®½å’Œæ€»é«˜åº¦ã€‚</p>
</li>
<li><p>å¦‚æœè¯¥æ¡ä»¶ä¸ºfalseï¼šçœ‹useLargestChildå‚æ•°ï¼Œå¦‚æœéƒ½æ— ç›¸å…³ï¼Œé‚£å°±èµ°layoutæµç¨‹äº†ï¼Œ<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œç›´æ¥åˆ¤æ–­æ˜¯useLargestChild &amp;&amp; heightMode != MeasureSpec.EXACTLYï¼Œå¦‚æœæ¡ä»¶æˆç«‹çš„è¯ï¼Œéå†å­è§†å›¾ï¼Œå†æ¬¡åˆ¤æ–­å­è§†å›¾æ˜¯å¦å«æœ‰æƒé‡ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥å°†å­è§†å›¾é«˜åº¦éƒ½æ˜¯largestChildHeightã€‚å¦‚æœæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™å•¥ä¹Ÿä¸åšã€‚</p>
</li>
</ul>
</li>
</ul>
<p>æœ€åå°±æ˜¯è§†å›¾maxWidthè®¡ç®—ï¼Œå¹¶setMeasuredDimensionï¼ˆè¿™ä¸ªæ˜¯ä¸€å®šè¦çš„ï¼‰ï¼Œè‡ªæ­¤å‚ç›´æ–¹å‘å·²ç»æµ‹é‡å®Œæ¯•ã€‚</p>
<p><strong>æ€»ç»“</strong><br>è¿™é‡Œå¤§ç¯‡å¹…è®²è§£measureVertical()çš„æµç¨‹ï¼Œäº‹å®ä¸Šå¯¹äºLinearLayoutæ¥è¯´ï¼Œå…¶æœ€å¤§çš„ç‰¹æ€§ä¹Ÿæ­£æ˜¯ä¸¤ä¸ª<br>æ–¹å‘çš„æ’å¸ƒä»¥åŠweightçš„è®¡ç®—æ–¹å¼ã€‚å›è¿‡å¤´æ¥çœ‹æµ‹é‡è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè®¾è®¡è€…çš„æµ‹é‡è®¡ç®—æ€è·¯ï¼Œå°±æ˜¯å°†æœ‰weight<br>å’Œä¸å«æœ‰weightçš„æµ‹é‡åˆ†å¼€å¤„ç†ï¼Œå†åˆ©ç”¨heightè·Ÿ0æ¯”è¾ƒæ¥æ›´åŠ çš„ç»†åˆ†æ¯ä¸€ç§æƒ…å†µã€‚<br>æœ€åæˆ‘ä»¬åœ¨ç†ä¸‹å…¶æµ‹é‡ä¸åŒæƒ…å†µå’ŒåŸç†ï¼š</p>
<ul>
<li>çˆ¶æ§ä»¶ä¸ºmatch_parentï¼ˆæˆ–è€…ç²¾ç¡®å€¼ï¼‰ï¼Œå­æ§ä»¶æ‹¥æœ‰weightï¼Œå¹¶ä¸”é«˜åº¦ç»™å®šä¸º0ï¼Œä¹Ÿå³å­æ§ä»¶æ˜ç¡®è¡¨ç¤ºä½¿ç”¨å‰©ä½™ç©ºé—´ï¼š<ul>
<li>å­æ§ä»¶çš„é«˜åº¦æ¯”ä¾‹å°†ä¼šè·Ÿæˆ‘ä»¬åˆ†é…çš„layout_weightä¸€è‡´ï¼ŒåŸå› åœ¨äºweightäºŒæ¬¡æµ‹é‡æ—¶èµ°äº†elseåˆ†æ”¯ï¼Œä¼ å…¥çš„æ˜¯è®¡ç®—å‡ºæ¥çš„shareå€¼ï¼›</li>
</ul>
</li>
<li>çˆ¶æ§ä»¶æ˜¯match_parentï¼ˆæˆ–è€…ç²¾ç¡®å€¼ï¼‰ï¼Œå­æ§ä»¶æ‹¥æœ‰weightï¼Œä½†é«˜åº¦ç»™å®šä¸ºmatch_parentï¼ˆæˆ–è€…ç²¾ç¡®å€¼ï¼‰ï¼Œå­æ§ä»¶ä½¿ç”¨è‡ªå·±çš„é«˜åº¦æˆ–è€…çˆ¶æ§ä»¶çš„é«˜åº¦ï¼Œä½†åœ¨çˆ¶æ§ä»¶ç©ºé—´ä¸è¶³æ—¶ï¼Œå…¶å¤§å°å¯ä»¥è°ƒæ•´ï¼š<ul>
<li>å­æ§ä»¶é«˜åº¦æ¯”ä¾‹å°†ä¼šè·Ÿæˆ‘ä»¬åˆ†é…çš„layout_weightç›¸åï¼ŒåŸå› åœ¨äºåœ¨æ­¤ä¹‹å‰å­æ§ä»¶æµ‹é‡è¿‡ä¸€æ¬¡ï¼ŒåŒæ—¶å­æ§ä»¶çš„æµ‹é‡é«˜åº¦ä¸ºçˆ¶æ§ä»¶çš„é«˜åº¦ï¼Œåœ¨è®¡ç®—å‰©ä½™ç©ºé—´çš„æ—¶å€™å¾—å‡ºä¸€ä¸ªè´Ÿå€¼ï¼ŒåŠ ä¸Šè‡ªèº«çš„æµ‹é‡é«˜åº¦çš„æ—¶å€™åè€Œæ›´å°ï¼›</li>
</ul>
</li>
<li>çˆ¶æ§ä»¶æ˜¯wrap_contentï¼Œå­æ§ä»¶æ‹¥æœ‰weightï¼š<ul>
<li>å­æ§ä»¶çš„é«˜åº¦å°†ä¼šå¼ºè¡Œç½®ä¸ºå…¶wrap_contentç»™çš„å€¼å¹¶ä»¥wrap_contentæ¨¡å¼è¿›è¡Œæµ‹é‡</li>
</ul>
</li>
<li>çˆ¶æ§ä»¶æ˜¯wrap_contentï¼Œå­æ§ä»¶æ²¡æœ‰weightï¼š<ul>
<li>å­æ§ä»¶çš„é«˜åº¦è·Ÿå…¶ä»–çš„viewgroupä¸€è‡´</li>
</ul>
</li>
</ul>
<p>è‡ªæ­¤ï¼ŒLinearLayoutåœ¨å‚ç›´æ–¹å‘çš„æµ‹é‡åˆ†æå·²ç»ç»“æŸã€‚</p>
<p>å‚è€ƒåœ°å€ï¼š<br>[1]. baselineAlignedè§£æ <a href="http://www.bubuko.com/infodetail-612730.html" target="_blank" rel="noopener">http://www.bubuko.com/infodetail-612730.html</a><br>[2]. measureWithLargestChildä½¿ç”¨è§£æ <a href="https://blog.csdn.net/a87b01c14/article/details/49420449" target="_blank" rel="noopener">https://blog.csdn.net/a87b01c14/article/details/49420449</a><br>[3]. LinearLayoutå‚ç›´æµ‹é‡åˆ†æ <a href="https://www.jianshu.com/p/aea27bac7c8e" target="_blank" rel="noopener">https://www.jianshu.com/p/aea27bac7c8e</a><br>[4]. viewå’ŒLinearLayoutæºç åˆ†æ <a href="https://www.jianshu.com/p/f9b9f05222a8" target="_blank" rel="noopener">https://www.jianshu.com/p/f9b9f05222a8</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/07/22/android-camera2é¢„è§ˆæ‹ç…§å½•åˆ¶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/22/android-camera2é¢„è§ˆæ‹ç…§å½•åˆ¶/" itemprop="url">android-camera2é¢„è§ˆæ‹ç…§å½•åˆ¶</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-22T10:06:52+08:00">
                2018-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Android 5.0(Lollipop)å¢åŠ äº†Camera2 APIï¼Œå¹¶å°†åŸæœ‰çš„Camera APIæ ‡è®°ä¸ºåºŸå¼ƒã€‚å¯¹äºåŸæœ‰çš„Camera APIæ¥è¯´ï¼ŒCamera2é‡æ–°å®šä¹‰äº†ç›¸æœºçš„APIï¼Œä¹Ÿé‡æ„äº†ç›¸æœºAPIçš„æ¶æ„ã€‚åœ¨Camera2ä¸­å…¶ä¸»è¦æ€æƒ³æ˜¯åŸºäºä¼šè¯æ¨¡å¼å’Œäº‹ä»¶é©±åŠ¨ä¸ç›¸æœºå®ç°äº¤äº’ï¼Œå¯¹äºé¢„è§ˆã€æ‹ç…§ã€å½•åˆ¶ç­‰æ“ä½œéƒ½æ˜¯åœ¨ä¼šè¯çš„åŸºç¡€ä¸‹è¯·æ±‚æŸç§ç±»å‹çš„ä¼šè¯æ“ä½œã€‚</p>
<p>æ¯”å¦‚ä¸€æ¬¡æ‹ç…§çš„æ“ä½œï¼š<br><img src="&quot;./images/take-picture.png&quot;" alt="æ‹ç…§">    </p>
<p>ä¸‹é¢ä¸€èµ·çœ‹ä¸‹camera2çš„æ“ä½œï¼š</p>
<ol>
<li>ç›¸æœºåˆå§‹åŒ–<br>æˆ‘ä»¬çŸ¥é“è¦ä½¿ç”¨ç›¸æœºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è·å¾—ç›¸å…³çš„æƒé™ï¼Œä¸»è¦æ˜¯åœ¨manifestä¸­å®šä¹‰ï¼Œå…¶æ¬¡åœ¨Android6.0è¿˜éœ€è¦åŠ¨æ€è·å–æƒé™ã€‚</li>
</ol>
<ul>
<li>åœ¨manifestä¸­å®šä¹‰éœ€è¦çš„æƒé™<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å¦‚æœè¦ä¿å­˜ç…§ç‰‡ã€å½•åˆ¶è§†é¢‘ï¼Œè¿˜éœ€è¦ä¸¤ä¸ªæƒé™ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;</span><br><span class="line">&lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<p>ç›¸æœºåŠŸèƒ½ï¼šç›¸æœºç‰¹æ€§ï¼Œå¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-feature android:name=&quot;android.hardware.camera&quot; /&gt;</span><br><span class="line">&lt;uses-feature android:name=&quot;android.hardware.camera.autofocus&quot; /&gt;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>åŠ¨æ€æƒé™ç”³è¯·<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private final String[] VIDEO_PERMISSIONS = &#123;</span><br><span class="line">           Manifest.permission.CAMERA,</span><br><span class="line">           Manifest.permission.RECORD_AUDIO,</span><br><span class="line">           Manifest.permission.WRITE_EXTERNAL_STORAGE,</span><br><span class="line">           Manifest.permission.READ_EXTERNAL_STORAGE,</span><br><span class="line">   &#125;;</span><br><span class="line">......</span><br><span class="line">   if (!hasPermissionsGranted(getApplicationContext(), VIDEO_PERMISSIONS)) &#123;</span><br><span class="line">               requestPermissions(VIDEO_PERMISSIONS, 1);</span><br><span class="line">               return;</span><br><span class="line">           &#125;</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">hasPermissionsGranted(Context context, String[] permissions) &#123;</span><br><span class="line">       for (String permission : permissions) &#123;</span><br><span class="line">           if (ActivityCompat.checkSelfPermission(context, permission)</span><br><span class="line">                   != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">               return false;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       return true;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä»¥ä¸ŠåŸºç¡€å·¥ä½œå¥½äº†åŸºæœ¬å¯ä»¥å¼€å§‹å¯¹ç›¸æœºæ“ä½œäº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">//åˆå§‹åŒ–ç›¸æœºè®¾å¤‡</span><br><span class="line">private void initCamera() &#123;</span><br><span class="line">       //è®¾å¤‡ç®¡ç†ç±»</span><br><span class="line">       cameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE);</span><br><span class="line">       try &#123;</span><br><span class="line">         //è·å–ç›¸æœºè®¾å¤‡ç‰¹å¾ç±»ï¼Œé€šè¿‡è¯¥ç±»å¯ä»¥è·å–ç›¸æœºçš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚ç›¸æœºçš„æ–¹å‘</span><br><span class="line">           CameraCharacteristics characteristics = cameraManager.getCameraCharacteristics(cameraManager.getCameraIdList()[0]);</span><br><span class="line">           mSensorOrientation = characteristics.get(CameraCharacteristics.SENSOR_ORIENTATION);</span><br><span class="line">           Log.e(TAG, &quot;sensor_orientation is :&quot; + mSensorOrientation);</span><br><span class="line">           StreamConfigurationMap streamConfigurationMap = characteristics.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);</span><br><span class="line">           //è·å–å½•åˆ¶è§†å±æ—¶çš„å®½é«˜ï¼Œè¿™ä¸ªé€šè¿‡MediaRecorderç±»è·å–ç³»ç»Ÿæ”¯æŒçš„å½•åˆ¶è§†é¢‘çš„å®½é«˜ï¼Œä¸»è¦æ˜¯é˜²æ­¢é…ç½®å½•åˆ¶é€‚é…é…ç½®æ—¶å¤±è´¥</span><br><span class="line">           mVideoSize = chooseVideoSize(streamConfigurationMap.getOutputSizes(MediaRecorder.class));</span><br><span class="line">           //æ ¹æ®å½•åˆ¶è§†é¢‘æ”¯æŒçš„å®½é«˜å’ŒSurfaceTextureæ”¯æŒçš„å®½é«˜ï¼Œä»¥åŠå½“å‰è§†å›¾çš„å®½é«˜è®¾ç½®é¢„è§ˆè§†å›¾çš„å®½é«˜</span><br><span class="line">           mPreviewSize = chooseOptimalSize(streamConfigurationMap.getOutputSizes(SurfaceTexture.class), surfaceView.getWidth(), surfaceView.getHeight(), mVideoSize);</span><br><span class="line">           //imageReaderåˆå§‹åŒ–ï¼Œç”¨äºè·å–æ‹ç…§ä¿¡æ¯</span><br><span class="line">           imageReader = ImageReader.newInstance(mPreviewSize.getWidth(), mPreviewSize.getHeight(), ImageFormat.JPEG, 2);</span><br><span class="line">           imageReader.setOnImageAvailableListener(new ImageReader.OnImageAvailableListener() &#123;</span><br><span class="line">               @Override</span><br><span class="line">               public void onImageAvailable(ImageReader reader) &#123;</span><br><span class="line">                   imageView.setVisibility(View.VISIBLE);</span><br><span class="line">                   // æ‹¿åˆ°æ‹ç…§ç…§ç‰‡æ•°æ®</span><br><span class="line">                   Image image = reader.acquireNextImage();</span><br><span class="line">                   ByteBuffer buffer = image.getPlanes()[0].getBuffer();</span><br><span class="line">                   byte[] bytes = new byte[buffer.remaining()];</span><br><span class="line">                   buffer.get(bytes);//ç”±ç¼“å†²åŒºå­˜å…¥å­—èŠ‚æ•°ç»„</span><br><span class="line">                   final Bitmap bitmap = BitmapFactory.decodeByteArray(bytes, 0, bytes.length);</span><br><span class="line">                   if (bitmap != null) &#123;</span><br><span class="line">                       imageView.setImageBitmap(bitmap);</span><br><span class="line">                   &#125;</span><br><span class="line">                   updatePreView();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;, mainHandler);</span><br><span class="line">           //æ‰“å¼€æ‘„åƒå¤´ï¼ŒstateCallbackä¸ºç›¸æœºçš„çŠ¶æ€ç›‘å¬å›è°ƒ</span><br><span class="line">           cameraManager.openCamera(cameraManager.getCameraIdList()[0], stateCallback, mainHandler);</span><br><span class="line">           mMediaRecorder = new MediaRecorder();</span><br><span class="line">           Log.d(TAG, &quot;open camera&quot;);</span><br><span class="line"></span><br><span class="line">       &#125; catch (CameraAccessException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   //å¼€å¯ç›¸æœºåæœ‰ä¸€ä¸ªå›è°ƒï¼ŒstateCallback,è¯¥å›è°ƒæ˜¯ç”¨æ¥è¿”å›ç›¸æœºæ˜¯å¦æ­£å¸¸æ‰“å¼€çš„çŠ¶æ€çš„å¼€å¯ç›¸æœºåæœ‰ä¸€ä¸ªå›è°ƒï¼ŒstateCallback,è¯¥å›è°ƒæ˜¯ç”¨æ¥è¿”å›ç›¸æœºæ˜¯å¦æ­£å¸¸æ‰“å¼€çš„çŠ¶æ€çš„</span><br><span class="line">     private CameraDevice.StateCallback stateCallback = new CameraDevice.StateCallback() &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public void onOpened(@NonNull CameraDevice cameraDevice) &#123;</span><br><span class="line">             Log.d(TAG, &quot;camera open&quot;);</span><br><span class="line">             mCameraDevice = cameraDevice;</span><br><span class="line">             takePreview();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         @Override</span><br><span class="line">         public void onDisconnected(@NonNull CameraDevice cameraDevice) &#123;</span><br><span class="line">             Log.d(TAG, &quot;camera onDisconnected&quot;);</span><br><span class="line"></span><br><span class="line">             if (null != mCameraDevice) &#123;</span><br><span class="line">                 mCameraDevice.close();</span><br><span class="line">                 mCameraDevice = null;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         @Override</span><br><span class="line">         public void onError(@NonNull CameraDevice cameraDevice, int i) &#123;</span><br><span class="line">             Log.d(TAG, &quot;camera onError&quot;);</span><br><span class="line">             cameraDevice.close();</span><br><span class="line">             mCameraDevice = null;</span><br><span class="line">             Toast.makeText(ImageShowActivity.this, &quot;æ‘„åƒå¤´å¼€å¯å¤±è´¥&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>å¼€å¯ç›¸æœºé¢„è§ˆ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * å¼€å§‹é¢„è§ˆ,æ­¤å¤„åˆ›å»ºä¸€ä¸ªæ•è·è§†é¢‘ä¿¡æ¯çš„è¯·æ±‚ï¼Œä»¥æ­¤æ¥è·å–ä¸€ä¸ªä¼šè¯sessionï¼Œåœ¨è·å–ä¼šè¯æ—¶ç›‘å¬å…¶é…ç½®çŠ¶æ€ï¼Œä¸€æ—¦æˆåŠŸï¼Œåˆ™æ­¤æ—¶é€šè¿‡ä¼šè¯æ„å»ºä¸€ä¸ªé‡å¤é¢„è§ˆçš„è¯·æ±‚ï¼›</span><br><span class="line">   */</span><br><span class="line">  private void takePreview() &#123;</span><br><span class="line">      try &#123;</span><br><span class="line">          closePreviewSession();</span><br><span class="line">          SurfaceTexture surfaceTexture = surfaceView.getSurfaceTexture();</span><br><span class="line">          surfaceTexture.setDefaultBufferSize(mPreviewSize.getWidth(), mPreviewSize.getHeight());</span><br><span class="line">          Log.e(TAG, &quot;preview SurfaceTexture buffer size is width:&quot; + mPreviewSize.getWidth() + &quot; height :&quot; + mPreviewSize.getHeight());</span><br><span class="line">          Surface previewSurface = new Surface(surfaceTexture);</span><br><span class="line">          List&lt;Surface&gt; surfaces = new ArrayList&lt;&gt;();</span><br><span class="line">          surfaces.add(previewSurface);</span><br><span class="line">          surfaces.add(imageReader.getSurface());</span><br><span class="line">          // åˆ›å»ºCameraCaptureSessionï¼Œè¯¥å¯¹è±¡è´Ÿè´£ç®¡ç†å¤„ç†é¢„è§ˆè¯·æ±‚å’Œæ‹ç…§è¯·æ±‚</span><br><span class="line">          mCameraDevice.createCaptureSession(surfaces, new CameraCaptureSession.StateCallback() //</span><br><span class="line">          &#123;</span><br><span class="line">              @Override</span><br><span class="line">              public void onConfigured(CameraCaptureSession cameraCaptureSession) &#123;</span><br><span class="line">                  Log.d(&quot;onConfigured&quot;, &quot;onConfigured&quot;);</span><br><span class="line">                  if (null == mCameraDevice) return;</span><br><span class="line">                  // å½“æ‘„åƒå¤´å·²ç»å‡†å¤‡å¥½æ—¶ï¼Œå¼€å§‹æ˜¾ç¤ºé¢„è§ˆ</span><br><span class="line">                  mCameraCaptureSession = cameraCaptureSession;</span><br><span class="line">                  updatePreView();</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              @Override</span><br><span class="line">              public void onConfigureFailed(CameraCaptureSession cameraCaptureSession) &#123;</span><br><span class="line">                  Log.d(&quot;onConfigureFailed&quot;, &quot;onConfigureFailed&quot;);</span><br><span class="line"></span><br><span class="line">                  Toast.makeText(ImageShowActivity.this, &quot;é…ç½®å¤±è´¥&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;, childHandler);</span><br><span class="line">      &#125; catch (CameraAccessException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  /**</span><br><span class="line">    * æ›´æ–°é¢„è§ˆè§†å›¾ï¼Œæ„å»ºä¸€ä¸ªTEMPLATE_PREVIEWæ•è·è¯·æ±‚ï¼Œæ­¤æ—¶æ˜¯å¯¹ä¼šè¯è¿›è¡Œè®¾ç½®ï¼ï¼ï¼setRepeatingRequestï¼ï¼ï¼</span><br><span class="line">    */  </span><br><span class="line">  private void updatePreView() &#123;</span><br><span class="line">       try &#123;</span><br><span class="line">           // åˆ›å»ºé¢„è§ˆéœ€è¦çš„CaptureRequest.Builder</span><br><span class="line">           CaptureRequest.Builder mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW);</span><br><span class="line">           // å°†SurfaceViewçš„surfaceä½œä¸ºCaptureRequest.Builderçš„ç›®æ ‡</span><br><span class="line">           SurfaceTexture surfaceTexture = surfaceView.getSurfaceTexture();</span><br><span class="line">           Log.e(TAG, &quot;update preview SurfaceTexture buffer size is width:&quot; + mPreviewSize.getWidth() + &quot; height :&quot; + mPreviewSize.getHeight());</span><br><span class="line">           surfaceTexture.setDefaultBufferSize(mPreviewSize.getWidth(), mPreviewSize.getHeight());</span><br><span class="line">           Surface previewSurface = new Surface(surfaceTexture);</span><br><span class="line"></span><br><span class="line">           mPreviewBuilder.addTarget(previewSurface);</span><br><span class="line">           mPreviewBuilder.set(CaptureRequest.CONTROL_MODE, CameraMetadata.CONTROL_MODE_AUTO);</span><br><span class="line">           mCameraCaptureSession.setRepeatingRequest(mPreviewBuilder.build(), null, childHandler);</span><br><span class="line">       &#125; catch (CameraAccessException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‹ç…§</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * æ‹ç…§ï¼Œæ„å»ºä¸€ä¸ªTEMPLATE_STILL_CAPTUREé™æ€çš„ç›¸æœºä¿¡æ¯æ•è·è¯·æ±‚ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦è·å–ImageReaderçš„surfaceå¹¶å°†å…¶ä½œä¸ºæ•è·å»è¯·æ±‚çš„ç›®æ ‡è¾“å‡ºã€‚</span><br><span class="line">     */</span><br><span class="line">private void takePicture() &#123;</span><br><span class="line">      if (mCameraDevice == null)</span><br><span class="line">          return;</span><br><span class="line">      // åˆ›å»ºæ‹ç…§éœ€è¦çš„CaptureRequest.Builder</span><br><span class="line">      try &#123;</span><br><span class="line">          CaptureRequest.Builder captureRequestBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE);</span><br><span class="line">          // å°†surfaceHolderçš„surfaceä½œä¸ºCaptureRequest.Builderçš„ç›®æ ‡</span><br><span class="line">          captureRequestBuilder.addTarget(imageReader.getSurface());</span><br><span class="line">          // è‡ªåŠ¨å¯¹ç„¦</span><br><span class="line">          captureRequestBuilder.set(CaptureRequest.CONTROL_AF_MODE, CaptureRequest.CONTROL_AF_MODE_CONTINUOUS_PICTURE);</span><br><span class="line">          // è‡ªåŠ¨æ›å…‰</span><br><span class="line">          captureRequestBuilder.set(CaptureRequest.CONTROL_AE_MODE, CaptureRequest.CONTROL_AE_MODE_ON_AUTO_FLASH);</span><br><span class="line">          // è·å–æ‰‹æœºæ–¹å‘ï¼Œæ‰‹æœºç«–å±å’Œå¹³æ¿çš„æ–¹å‘æ˜¯ä¸åŒçš„ï¼Œéœ€è¦è°ƒæ•´ã€‚</span><br><span class="line">          int rotation = getWindowManager().getDefaultDisplay().getRotation();</span><br><span class="line">          // æ ¹æ®è®¾å¤‡æ–¹å‘è®¡ç®—è®¾ç½®ç…§ç‰‡çš„æ–¹å‘</span><br><span class="line">          captureRequestBuilder.set(CaptureRequest.JPEG_ORIENTATION, getOrientation(rotation));</span><br><span class="line">          //æ‹ç…§</span><br><span class="line">          CaptureRequest mCaptureRequest = captureRequestBuilder.build();</span><br><span class="line">          mCameraCaptureSession.capture(mCaptureRequest, null, childHandler);</span><br><span class="line">      &#125; catch (CameraAccessException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * Retrieves the JPEG orientation from the specified screen rotation.</span><br><span class="line">    *</span><br><span class="line">    * @param rotation The screen rotation.</span><br><span class="line">    * @return The JPEG orientation (one of 0, 90, 270, and 360)</span><br><span class="line">    */</span><br><span class="line">   private int getOrientation(int rotation) &#123;</span><br><span class="line">       // Sensor orientation is 90 for most devices, or 270 for some devices (eg. Nexus 5X)</span><br><span class="line">       // We have to take that into account and rotate JPEG properly.</span><br><span class="line">       // For devices with orientation of 90, we simply return our mapping from ORIENTATIONS.</span><br><span class="line">       // For devices with orientation of 270, we need to rotate the JPEG 180 degrees.</span><br><span class="line">       return (ORIENTATIONS.get(rotation) + mSensorOrientation + 270) % 360;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>å½•åˆ¶è§†é¢‘</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * è§†å±å½•åˆ¶ï¼Œæ¯”è¾ƒä¸Šå±‚apiæ˜¯ç›´æ¥é€šè¿‡Recorderç±»æ¥å®ç°å½•åˆ¶ï¼Œé€šè¿‡è¿™ä¸ªä¸éœ€è¦è‡ªå·±å¯¹è§†å±æ•°æ®è¿›è¡Œå¤„ç†ï¼Œåªéœ€è¦æŒ‡å®šå…·ä½“ç¼–ç æ ¼å¼å³å¯ï¼ŒåŒæ—¶æ³¨æ„è¿™é‡Œæ˜¯é‡å¯ä¸€ä¸ªä¼šè¯ã€‚</span><br><span class="line">     */</span><br><span class="line">    private void startRecordingVideo() &#123;</span><br><span class="line">        //å…³é—­é¢„è§ˆä¼šè¯</span><br><span class="line">        closePreviewSession();</span><br><span class="line">        //å¯¹Recoderç±»è¿›è¡Œè®¾ç½®</span><br><span class="line">        setUpMediaRecorder();</span><br><span class="line">        try &#123;</span><br><span class="line">            //åˆ›å»ºå½•åˆ¶çš„sessionä¼šè¯ä¸­çš„è¯·æ±‚</span><br><span class="line">            CaptureRequest.Builder mPreviewBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_RECORD);</span><br><span class="line">            //å‘CaptureRequestæ·»åŠ surface</span><br><span class="line">            SurfaceTexture surfaceTexture = surfaceView.getSurfaceTexture();</span><br><span class="line">            Log.e(TAG, &quot;video SurfaceTexture  buffer size is width:&quot; + mVideoSize.getWidth() + &quot; height :&quot; + mVideoSize.getHeight());</span><br><span class="line">            surfaceTexture.setDefaultBufferSize(mVideoSize.getWidth(), mVideoSize.getHeight());</span><br><span class="line">            Surface previewSurface = new Surface(surfaceTexture);</span><br><span class="line">            mPreviewBuilder.addTarget(previewSurface);</span><br><span class="line">            //å‘CaptureRequestæ·»åŠ surface</span><br><span class="line">            mPreviewBuilder.addTarget(mMediaRecorder.getSurface());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            mCameraDevice.createCaptureSession(Arrays.asList(previewSurface, mMediaRecorder.getSurface()), new</span><br><span class="line">                    CameraCaptureSession.StateCallback() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void onConfigured(@NonNull CameraCaptureSession cameraCaptureSession) &#123;</span><br><span class="line">                            mCameraCaptureSession = cameraCaptureSession;</span><br><span class="line">                            updatePreView();</span><br><span class="line">                            runOnUiThread(new Runnable() &#123;</span><br><span class="line">                                @Override</span><br><span class="line">                                public void run() &#123;</span><br><span class="line">                                    mMediaRecorder.start();</span><br><span class="line"></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        @Override</span><br><span class="line">                        public void onConfigureFailed(@NonNull CameraCaptureSession cameraCaptureSession) &#123;</span><br><span class="line">                            Log.d(&quot;onConfigureFailed&quot;, &quot;onConfigureFailed&quot;);</span><br><span class="line"></span><br><span class="line">                            Toast.makeText(ImageShowActivity.this, &quot;RecordingVideo é…ç½®å¤±è´¥&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, childHandler);</span><br><span class="line">        &#125; catch (CameraAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * å¯¹Recorderç±»è¿›è¡Œè®¾ç½®ï¼Œä¸»è¦åŒ…æ‹¬éŸ³é¢‘ã€è§†é¢‘æºã€è§†é¢‘è¾“å‡ºæ ¼å¼ã€è¾“å‡ºè·¯å¾„ã€ç¼–ç é¢‘ç‡ã€è§†é¢‘å¸§é¢‘ç‡ã€è§†é¢‘å®½é«˜ã€è§†é¢‘ç¼–ç æ ¼å¼ã€éŸ³é¢‘ç¼–ç æ ¼å¼</span><br><span class="line">     */</span><br><span class="line">    private void setUpMediaRecorder() &#123;</span><br><span class="line">        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);</span><br><span class="line">        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.SURFACE);</span><br><span class="line">        mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4);</span><br><span class="line">        //!!!è¿™é‡Œéœ€è¦è®¾ç½®è·¯å¾„ï¼Œè¦ä¸è·å–surfaceæ—¶ä¼šä¸ºç©ºã€‚context.getExternalFilesDir(null);</span><br><span class="line">        mMediaRecorder.setOutputFile(Environment</span><br><span class="line">                .getExternalStorageDirectory() + &quot;/&quot; + System.currentTimeMillis() + &quot;.mp4&quot;);</span><br><span class="line">        mMediaRecorder.setVideoEncodingBitRate(10000000);</span><br><span class="line">        mMediaRecorder.setVideoFrameRate(30);</span><br><span class="line">        // è®¾ç½®è§†é¢‘å½•åˆ¶çš„åˆ†è¾¨ç‡ã€‚å¿…é¡»æ”¾åœ¨è®¾ç½®ç¼–ç å’Œæ ¼å¼çš„åé¢ï¼Œå¦åˆ™æŠ¥é”™!!!!!!éœ€è¦å°å¿ƒè®¾ç½®ï¼ŒåŒæ—¶éœ€è¦æ ¹æ®Recorderç±»æ¥é´é€‰å‡ºå½“å‰è®¾å¤‡æ”¯æŒçš„åˆ†è¾¨ç‡ï¼Œå¦‚æœä¸æ°å½“ï¼Œåˆ™å½•åˆ¶è§†é¢‘çš„æ—¶å€™ä¼šæ˜¾ç¤ºé…ç½®å¤±è´¥</span><br><span class="line">        Log.e(TAG, &quot;video size is width:&quot; + mVideoSize.getWidth() + &quot; height :&quot; + mVideoSize.getHeight());</span><br><span class="line">        mMediaRecorder.setVideoSize(mVideoSize.getWidth(), mVideoSize.getHeight());</span><br><span class="line"></span><br><span class="line">        mMediaRecorder.setVideoEncoder(MediaRecorder.VideoEncoder.H264);</span><br><span class="line">        mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC);</span><br><span class="line">        int rotation = getWindowManager().getDefaultDisplay().getRotation();</span><br><span class="line">        //è°ƒæ•´è§†é¢‘çš„æ–¹å‘</span><br><span class="line">        switch (mSensorOrientation) &#123;</span><br><span class="line">            case SENSOR_ORIENTATION_DEFAULT_DEGREES:</span><br><span class="line">                mMediaRecorder.setOrientationHint(DEFAULT_ORIENTATIONS.get(rotation));</span><br><span class="line">                break;</span><br><span class="line">            case SENSOR_ORIENTATION_INVERSE_DEGREES:</span><br><span class="line">                mMediaRecorder.setOrientationHint(INVERSE_ORIENTATIONS.get(rotation));</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            mMediaRecorder.prepare();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æ‰‹æœºæ”¯æŒçš„ä¸€äº›åˆ†è¾¨ç‡ï¼š<br>width:4608 height:3456<br>width:4608 height:2304<br>width:3456 height:3456<br>width:3840 height:2160<br>width:3280 height:2448<br>width:3264 height:2448<br>width:3264 height:1840<br>width:3264 height:1632<br>width:2448 height:2448<br>width:2592 height:1952<br>width:2048 height:1536<br>width:1920 height:1080<br>width:1440 height:1080<br>width:1536 height:864<br>width:1456 height:1456<br>width:1920 height:960<br>width:1440 height:720<br>width:1280 height:960<br>width:1280 height:720<br>width:960 height:720</p>
<p>å‚è€ƒåœ°å€ï¼š<br>[1].å®˜ç½‘ç¤ºä¾‹ <a href="https://github.com/googlesamples/android-Camera2Basic" target="_blank" rel="noopener">https://github.com/googlesamples/android-Camera2Basic</a><br>[2]. <a href="https://blog.csdn.net/z_x_Qiang/article/details/77600880?locationNum=1&amp;fps=1" target="_blank" rel="noopener">https://blog.csdn.net/z_x_Qiang/article/details/77600880?locationNum=1&amp;fps=1</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/07/17/httpä¹‹headè§£æ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/17/httpä¹‹headè§£æ/" itemprop="url">httpä¹‹headè§£æ</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-17T11:31:15+08:00">
                2018-07-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table>
<thead>
<tr>
<th style="text-align:left">Header</th>
<th style="text-align:left">Header è§£é‡Š</th>
<th style="text-align:left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Accept-Ranges</td>
<td style="text-align:left">è¡¨æ˜æœåŠ¡å™¨æ˜¯å¦æ”¯æŒæŒ‡å®šèŒƒå›´è¯·æ±‚åŠé‚£ç§ç±»å‹çš„åˆ†æ®µè¯·æ±‚</td>
<td style="text-align:left">Accept-Ranges: bytes</td>
</tr>
<tr>
<td style="text-align:left">Age</td>
<td style="text-align:left">ä»åŸå§‹æœåŠ¡å™¨åˆ°ä»£ç†ç¼“å­˜å½¢æˆçš„ä¼°ç®—æ—¶é—´ï¼ˆä»¥ç§’è®¡ï¼Œéè´Ÿï¼‰</td>
<td style="text-align:left">Ageï¼š12</td>
</tr>
<tr>
<td style="text-align:left">Allow</td>
<td style="text-align:left">å¯¹æŸç½‘ç»œèµ„æºçš„æœ‰æ•ˆè¯·æ±‚è¡Œä¸ºï¼Œä¸å…è®¸åˆ™è¿”å›405</td>
<td style="text-align:left">Allowï¼šGETï¼ŒHEAD</td>
</tr>
<tr>
<td style="text-align:left">Cache-Control</td>
<td style="text-align:left">å‘Šè¯‰æ‰€æœ‰çš„ç¼“å­˜æœºåˆ¶æ˜¯å¦å¯ä»¥ç¼“å­˜åŠé‚£ç§ç±»å‹</td>
<td style="text-align:left">Cache-Control: no-cache</td>
</tr>
<tr>
<td style="text-align:left">Content-Encoding</td>
<td style="text-align:left">webæœåŠ¡å™¨æ”¯æŒçš„è¿”å›å†…å®¹å‹ç¼©ç¼–ç ç±»å‹</td>
<td style="text-align:left">Content-Encoding:gzip</td>
</tr>
<tr>
<td style="text-align:left">Content-Language</td>
<td style="text-align:left">å“åº”ä½“çš„è¯­è¨€</td>
<td style="text-align:left">Content-Language: en,zh</td>
</tr>
<tr>
<td style="text-align:left">Content-Length</td>
<td style="text-align:left">å“åº”ä½“çš„é•¿åº¦</td>
<td style="text-align:left">Content-Length:348</td>
</tr>
<tr>
<td style="text-align:left">Content-Location</td>
<td style="text-align:left">è¯·æ±‚èµ„æºå¯æ›¿ä»£çš„å¤‡ç”¨çš„å¦ä¸€ä¸ªåœ°å€</td>
<td style="text-align:left">Content-Location: /index.htm</td>
</tr>
<tr>
<td style="text-align:left">Content-MD5</td>
<td style="text-align:left">è¿”å›èµ„æºçš„MD5æ ¡éªŒå€¼</td>
<td style="text-align:left">Content-MD5: Q2hlY2sgSW50ZWdyaXR5IQ==</td>
</tr>
<tr>
<td style="text-align:left">Content-Range</td>
<td style="text-align:left">åœ¨æ•´ä¸ªè¿”å›ä½“ä¸­æœ¬éƒ¨åˆ†çš„å­—èŠ‚ä½ç½®</td>
<td style="text-align:left">Content-Range: bytes 21010-47021/47022</td>
</tr>
<tr>
<td style="text-align:left">Content-type</td>
<td style="text-align:left">è¿”å›å†…å®¹çš„MIMEç±»å‹</td>
<td style="text-align:left">Content-Type: text/html; charset=utf-8</td>
</tr>
<tr>
<td style="text-align:left">Date</td>
<td style="text-align:left">åŸå§‹æœåŠ¡å™¨æ¶ˆæ¯å‘å‡ºçš„æ—¶é—´</td>
<td style="text-align:left">Date: Tue, 15 Nov 2010 08:12:31 GMT</td>
</tr>
<tr>
<td style="text-align:left">ETag</td>
<td style="text-align:left">è¯·æ±‚å˜é‡çš„å®ä½“æ ‡ç­¾çš„å½“å‰å€¼</td>
<td style="text-align:left">ETag: â€œ737060cd8c284d8af7ad3082f209582dâ€</td>
</tr>
<tr>
<td style="text-align:left">Expires</td>
<td style="text-align:left">å“åº”è¿‡æœŸçš„æ—¥æœŸå’Œæ—¶é—´</td>
<td style="text-align:left">Expires: Thu, 01 Dec 2010 16:00:00 GMT</td>
</tr>
<tr>
<td style="text-align:left">Last-Modified</td>
<td style="text-align:left">è¯·æ±‚èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´</td>
<td style="text-align:left">Last-Modified: Tue, 15 Nov 2010 12:45:26 GMT</td>
</tr>
<tr>
<td style="text-align:left">Location</td>
<td style="text-align:left">ç”¨æ¥é‡å®šå‘æ¥æ”¶æ–¹åˆ°éè¯·æ±‚URLçš„ä½ç½®æ¥å®Œæˆè¯·æ±‚å’Œæ ‡è¯†æ–°çš„èµ„æº</td>
<td style="text-align:left">Location: <a href="http://www.zcmhi.com/archives/94.html" target="_blank" rel="noopener">http://www.zcmhi.com/archives/94.html</a></td>
</tr>
<tr>
<td style="text-align:left">Pragma</td>
<td style="text-align:left">åŒ…æ‹¬å®ç°ç‰¹å®šçš„æŒ‡ä»¤ï¼Œå®ƒå¯åº”ç”¨åˆ°å“åº”é“¾ä¸Šçš„ä»»ä½•æ¥æ”¶æ–¹</td>
<td style="text-align:left">Pragma: no-cache</td>
</tr>
<tr>
<td style="text-align:left">Proxy-Authenticate</td>
<td style="text-align:left">å®ƒæŒ‡å‡ºè®¤è¯æ–¹æ¡ˆå’Œå¯åº”ç”¨åˆ°ä»£ç†çš„è¯¥URLä¸Šçš„å‚æ•°</td>
<td style="text-align:left">Proxy-Authenticate: Basic</td>
</tr>
<tr>
<td style="text-align:left">refresh</td>
<td style="text-align:left">åº”ç”¨äºé‡å®šå‘æˆ–ä¸€ä¸ªæ–°çš„èµ„æºè¢«åˆ›é€ ï¼Œåœ¨5ç§’ä¹‹åé‡å®šå‘ï¼ˆç”±ç½‘æ™¯æå‡ºï¼Œè¢«å¤§éƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰</td>
<td style="text-align:left">Refresh: 5; url=</td>
</tr>
</tbody>
</table>
<p><a href="http://www.zcmhi.com/archives/94.html" target="_blank" rel="noopener">http://www.zcmhi.com/archives/94.html</a> |<br>| Retry-After | å¦‚æœå®ä½“æš‚æ—¶ä¸å¯å–ï¼Œé€šçŸ¥å®¢æˆ·ç«¯åœ¨æŒ‡å®šæ—¶é—´ä¹‹åå†æ¬¡å°è¯•  | Retry-After: 120 |<br>| Server | webæœåŠ¡å™¨è½¯ä»¶åç§° | Server: Apache/1.3.27 (Unix) (Red-Hat/Linux) |<br>| Set-Cookie | è®¾ç½®Http Cookie | Set-Cookie: UserID=JohnDoe; Max-Age=3600; Version=1 |<br>| Trailer | æŒ‡å‡ºå¤´åŸŸåœ¨åˆ†å—ä¼ è¾“ç¼–ç çš„å°¾éƒ¨å­˜åœ¨ | Trailer: Max-Forwards |<br>| Transfet-Encoding | æ–‡ä»¶ä¼ è¾“ç¼–ç  | Transfer-Encoding:chunked |<br>| Vary | å‘Šè¯‰ä¸‹æ¸¸ä»£ç†æ˜¯ä½¿ç”¨ç¼“å­˜å“åº”è¿˜æ˜¯ä»åŸå§‹æœåŠ¡å™¨è¯·æ±‚ | Vary: * |<br>| Via | å‘Šè¯‰ä»£ç†å®¢æˆ·ç«¯å“åº”æ˜¯é€šè¿‡å“ªé‡Œå‘é€çš„ | Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1) |<br>| Warning | è­¦å‘Šå®ä½“å¯èƒ½å­˜åœ¨çš„é—®é¢˜ | Warning: 199 Miscellaneous warning |<br>| WWW-Authenticate | è¡¨æ˜å®¢æˆ·ç«¯è¯·æ±‚å®ä½“åº”è¯¥ä½¿ç”¨çš„æˆæƒæ–¹æ¡ˆ  | WWW-Authenticate: Basic |</p>
<h3 id="HTTP-Requestçš„Headerä¿¡æ¯"><a href="#HTTP-Requestçš„Headerä¿¡æ¯" class="headerlink" title="HTTP Requestçš„Headerä¿¡æ¯"></a>HTTP Requestçš„Headerä¿¡æ¯</h3><p>httpè¯·æ±‚ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šè¯·æ±‚è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€è¯·æ±‚æ­£æ–‡ã€‚è¯·æ±‚è¡Œä»¥ä¸€ä¸ªæ–¹æ³•ç¬¦å·å¼€å¤´ï¼Œä»¥ç©ºæ ¼åˆ†å¼€ï¼Œåé¢è·Ÿç€è¯·æ±‚çš„URIå’Œåè®®çš„ç‰ˆæœ¬ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š<br>POST /rest/sur?dk=28192985&amp;ak=23565637&amp;av=4.5.0&amp;c=default-Channel&amp;v=3.0&amp;s=72eec83f97e2d4b15457f2b348b450d2&amp;d=Wp4zp4JKnXIDAPzAGdNq5Fdp&amp;sv=6.2.0&amp;p=MacOSX&amp;t=1531794939&amp;u=&amp;is=0 HTTP/1.1<br>ä¸€ä¸ªç®€å•çš„è¯·æ±‚å¤´ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /rest/sur?dk=28192985&amp;ak=23565637&amp;av=4.5.0&amp;c=default-Channel&amp;v=3.0&amp;s=72eec83f97e2d4b15457f2b348b450d2&amp;d=Wp4zp4JKnXIDAPzAGdNq5Fdp&amp;sv=6.2.0&amp;p=MacOSX&amp;t=1531794939&amp;u=&amp;is=0 HTTP/1.1</span><br><span class="line">Host	adash.m.taobao.com</span><br><span class="line">Content-Type	multipart/form-data; boundary=--iphone_BOUNDARY--</span><br><span class="line">Connection	keep-alive</span><br><span class="line">Accept	*/*</span><br><span class="line">User-Agent	%E9%92%89%E9%92%89/400 CFNetwork/901.1 Darwin/17.6.0 (x86_64)</span><br><span class="line">Accept-Language	zh-cn</span><br><span class="line">Accept-Encoding	gzip</span><br><span class="line">Content-Length	702</span><br></pre></td></tr></table></figure></p>
<ol>
<li>HTTPè¯·æ±‚æ–¹å¼</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">æ–¹æ³•</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">GET</td>
<td style="text-align:left">å‘WebæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªæ–‡ä»¶</td>
</tr>
<tr>
<td style="text-align:left">POST</td>
<td style="text-align:left">å‘WebæœåŠ¡å™¨å‘é€æ•°æ®è®©WebæœåŠ¡å™¨è¿›è¡Œå¤„ç†</td>
</tr>
<tr>
<td style="text-align:left">PUT</td>
<td style="text-align:left">å‘WebæœåŠ¡å™¨å‘é€æ•°æ®å¹¶å­˜å‚¨åœ¨WebæœåŠ¡å™¨å†…éƒ¨</td>
</tr>
<tr>
<td style="text-align:left">HEAD</td>
<td style="text-align:left">æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">ä»WebæœåŠ¡å™¨ä¸Šåˆ é™¤ä¸€ä¸ªæ–‡ä»¶</td>
</tr>
<tr>
<td style="text-align:left">CONNECT</td>
<td style="text-align:left">å¯¹é€šé“æä¾›æ”¯æŒ</td>
</tr>
<tr>
<td style="text-align:left">TRACE</td>
<td style="text-align:left">è·Ÿè¸ªåˆ°æœåŠ¡å™¨çš„è·¯å¾„</td>
</tr>
<tr>
<td style="text-align:left">OPTIONS</td>
<td style="text-align:left">æŸ¥è¯¢WebæœåŠ¡å™¨çš„æ€§èƒ½</td>
</tr>
</tbody>
</table>
<p>è¯´æ˜ï¼š<br>ä¸»è¦ä½¿ç”¨åˆ°â€œGETâ€å’Œâ€œPOSTâ€ã€‚</p>
<p>å®ä¾‹ï¼š<br>POST /test/tupian/cm HTTP/1.1<br>åˆ†æˆä¸‰éƒ¨åˆ†ï¼š</p>
<ul>
<li><p>POSTï¼šHTTPè¯·æ±‚æ–¹å¼</p>
</li>
<li><p>/test/tupian/cmï¼šè¯·æ±‚WebæœåŠ¡å™¨çš„ç›®å½•åœ°å€ï¼ˆæˆ–è€…æŒ‡ä»¤ï¼‰</p>
</li>
<li><p>HTTP/1.1: URIï¼ˆUniform Resource Identifierï¼Œç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰åŠå…¶ç‰ˆæœ¬</p>
</li>
</ul>
<p><strong>å¤‡æ³¨ï¼š</strong>  åœ¨Ajaxä¸­ï¼Œå¯¹åº”methodå±æ€§è®¾ç½®ã€‚</p>
<ol>
<li>Host</li>
</ol>
<p>è¯´æ˜ï¼š<br>è¯·æ±‚çš„webæœåŠ¡å™¨åŸŸååœ°å€</p>
<p>å®ä¾‹ï¼š<br>ä¾‹å¦‚webè¯·æ±‚URLï¼š<a href="http://zjm-forum-test10.zjm.baidu.com:8088/test/tupian/cm" target="_blank" rel="noopener">http://zjm-forum-test10.zjm.baidu.com:8088/test/tupian/cm</a> ï¼ŒHostå°±ä¸ºzjm-forum-test10.zjm.baidu.com:8088</p>
<ol>
<li>User-Agent</li>
</ol>
<p>è¯´æ˜ï¼š<br>HTTPå®¢æˆ·ç«¯è¿è¡Œçš„æµè§ˆå™¨ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡è¯¥å¤´éƒ¨ä¿¡æ¯ï¼ŒwebæœåŠ¡å™¨å¯ä»¥åˆ¤æ–­åˆ°å½“å‰HTTPè¯·æ±‚çš„å®¢æˆ·ç«¯æµè§ˆå™¨ç±»åˆ«ã€‚</p>
<p>å®ä¾‹ï¼š<br>User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.8.1.11) Gecko/20071127 Firefox/2.0.0.11</p>
<ol>
<li>Accept</li>
</ol>
<p>è¯´æ˜ï¼š<br>æŒ‡å®šå®¢æˆ·ç«¯èƒ½å¤Ÿæ¥æ”¶çš„å†…å®¹ç±»å‹ï¼Œå†…å®¹ç±»å‹ä¸­çš„å…ˆåæ¬¡åºè¡¨ç¤ºå®¢æˆ·ç«¯æ¥æ”¶çš„å…ˆåæ¬¡åºã€‚</p>
<p>å®ä¾‹ï¼š<br>Accept:text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,<em>/</em>;q=0.5</p>
<p>å¤‡æ³¨ï¼š<br>åœ¨Prototypï¼ˆ1.5ï¼‰çš„Ajaxä»£ç å°è£…ä¸­ï¼Œå°†Accepté»˜è®¤è®¾ç½®ä¸ºâ€œtext/javascript, text/html, application/xml, text/xml, <em>/</em>â€ã€‚è¿™æ˜¯å› ä¸ºAjaxé»˜è®¤è·å–æœåŠ¡å™¨è¿”å›çš„Jsonæ•°æ®æ¨¡å¼ã€‚åœ¨Ajaxä»£ç ä¸­ï¼Œå¯ä»¥ä½¿ç”¨XMLHttpRequest å¯¹è±¡ä¸­setRequestHeaderå‡½æ•°æ–¹æ³•æ¥åŠ¨æ€è®¾ç½®è¿™äº›Headerä¿¡æ¯ã€‚</p>
<ol>
<li>Accept-Language</li>
</ol>
<p>è¯´æ˜ï¼š<br>æŒ‡å®šHTTPå®¢æˆ·ç«¯æµè§ˆå™¨ç”¨æ¥å±•ç¤ºè¿”å›ä¿¡æ¯æ‰€ä¼˜å…ˆé€‰æ‹©çš„è¯­è¨€ã€‚</p>
<p>å®ä¾‹ï¼š<br>Accept-Language: zh-cn,zh;q=0.5   ,è¿™é‡Œé»˜è®¤ä¸ºä¸­æ–‡ã€‚</p>
<ol>
<li>Accept-Encoding</li>
</ol>
<p>è¯´æ˜ï¼š<br>æŒ‡å®šå®¢æˆ·ç«¯æµè§ˆå™¨å¯ä»¥æ”¯æŒçš„webæœåŠ¡å™¨è¿”å›å†…å®¹å‹ç¼©ç¼–ç ç±»å‹ã€‚è¡¨ç¤ºå…è®¸æœåŠ¡å™¨åœ¨å°†è¾“å‡ºå†…å®¹å‘é€åˆ°å®¢æˆ·ç«¯ä»¥å‰è¿›è¡Œå‹ç¼©ï¼Œä»¥èŠ‚çº¦å¸¦å®½ã€‚è€Œè¿™é‡Œè®¾ç½®çš„å°±æ˜¯å®¢æˆ·ç«¯æµè§ˆå™¨æ‰€èƒ½å¤Ÿæ”¯æŒçš„è¿”å›å‹ç¼©æ ¼å¼ã€‚</p>
<p>å®ä¾‹ï¼š<br>Accept-Encoding: gzip,deflate</p>
<p><strong>å¤‡æ³¨ï¼š</strong>  å…¶å®åœ¨ç™¾åº¦å¾ˆå¤šäº§å“çº¿ä¸­ï¼Œapacheåœ¨ç»™å®¢æˆ·ç«¯è¿”å›é¡µé¢æ•°æ®ä¹‹å‰ï¼Œå°†æ•°æ®ä»¥gzipæ ¼å¼è¿›è¡Œå‹ç¼©ã€‚</p>
<p>å¦å¤–æœ‰å…³deflateå‹ç¼©ä»‹ç»ï¼š<a href="http://man.chinaunix.net/newsoft/ApacheMenual_CN_2.2new/mod/mod_deflate.html" target="_blank" rel="noopener">http://man.chinaunix.net/newsoft/ApacheMenual_CN_2.2new/mod/mod_deflate.html</a></p>
<ol>
<li>Accept-Charset</li>
</ol>
<p>è¯´æ˜ï¼š<br>æµè§ˆå™¨å¯ä»¥æ¥å—çš„å­—ç¬¦ç¼–ç é›†ã€‚</p>
<p>å®ä¾‹ï¼šAccept-Charset: gb2312,utf-8;q=0.7,*;q=0.7</p>
<ol>
<li>Content-Type</li>
</ol>
<p>è¯´æ˜ï¼š  æ˜¾ç¤ºæ­¤HTTPè¯·æ±‚æäº¤çš„å†…å®¹ç±»å‹ã€‚ä¸€èˆ¬åªæœ‰postæäº¤æ—¶æ‰éœ€è¦è®¾ç½®è¯¥å±æ€§ã€‚</p>
<p>å®ä¾‹ï¼š  Content-type: application/x-www-form-urlencoded;charset:UTF-8</p>
<p>æœ‰å…³Content-Typeå±æ€§å€¼å¯ä»¥å¦‚ä¸‹ä¸¤ç§ç¼–ç ç±»å‹ï¼š  </p>
<ul>
<li>â€œapplication/x-www-form-urlencodedâ€ï¼š è¡¨å•æ•°æ®å‘æœåŠ¡å™¨æäº¤æ—¶æ‰€é‡‡ç”¨çš„ç¼–ç ç±»å‹ï¼Œé»˜è®¤çš„ç¼ºçœå€¼å°±æ˜¯â€œapplication/x-www-form-urlencodedâ€ã€‚ ç„¶è€Œï¼Œåœ¨å‘æœåŠ¡å™¨å‘é€å¤§é‡çš„æ–‡æœ¬ã€åŒ…å«éASCIIå­—ç¬¦çš„æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®æ—¶è¿™ç§ç¼–ç æ–¹å¼æ•ˆç‡å¾ˆä½ã€‚</li>
<li>â€œmultipart/form-dataâ€ï¼š åœ¨æ–‡ä»¶ä¸Šè½½æ—¶ï¼Œæ‰€ä½¿ç”¨çš„ç¼–ç ç±»å‹åº”å½“æ˜¯â€œmultipart/form-dataâ€ï¼Œå®ƒæ—¢å¯ä»¥å‘é€æ–‡æœ¬æ•°æ®ï¼Œä¹Ÿæ”¯æŒäºŒè¿›åˆ¶æ•°æ®ä¸Šè½½ã€‚  </li>
</ul>
<p>å½“æäº¤ä¸ºè¡¨å•æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€œapplication/x-www-form-urlencodedâ€ï¼›å½“æäº¤çš„æ˜¯æ–‡ä»¶æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨â€œmultipart/form-dataâ€ç¼–ç ç±»å‹ã€‚</p>
<p>åœ¨Content-Typeå±æ€§å½“ä¸­è¿˜æ˜¯æŒ‡å®šæäº¤å†…å®¹çš„charsetå­—ç¬¦ç¼–ç ã€‚ä¸€èˆ¬ä¸è¿›è¡Œè®¾ç½®ï¼Œå®ƒåªæ˜¯å‘Šè¯‰webæœåŠ¡å™¨postæäº¤çš„æ•°æ®é‡‡ç”¨çš„ä½•ç§å­—ç¬¦ç¼–ç ã€‚ ä¸€èˆ¬åœ¨å¼€å‘è¿‡ç¨‹ï¼Œæ˜¯ç”±å‰ç«¯å·¥ç¨‹ä¸åç«¯UIå·¥ç¨‹å¸ˆå•†é‡å¥½ä½¿ç”¨ä»€ä¹ˆå­—ç¬¦ç¼–ç æ ¼å¼æ¥postæäº¤çš„ï¼Œç„¶ååç«¯uiå·¥ç¨‹å¸ˆæŒ‰ç…§å›ºå®šçš„å­—ç¬¦ç¼–ç æ¥è§£ææäº¤çš„æ•°æ®ã€‚æ‰€ä»¥è¿™é‡Œè®¾ç½®çš„charsetæ²¡æœ‰å¤šå¤§ä½œç”¨ã€‚</p>
<ol>
<li>Connection</li>
</ol>
<p>è¯´æ˜ï¼š è¡¨ç¤ºæ˜¯å¦éœ€è¦æŒä¹…è¿æ¥ã€‚å¦‚æœwebæœåŠ¡å™¨ç«¯çœ‹åˆ°è¿™é‡Œçš„å€¼ä¸ºâ€œKeep-Aliveâ€ï¼Œæˆ–è€…çœ‹åˆ°è¯·æ±‚ä½¿ç”¨çš„æ˜¯HTTP 1.1ï¼ˆHTTP 1.1é»˜è®¤è¿›è¡ŒæŒä¹…è¿æ¥ï¼‰ï¼Œå®ƒå°±å¯ä»¥åˆ©ç”¨æŒä¹…è¿æ¥çš„ä¼˜ç‚¹ï¼Œå½“é¡µé¢åŒ…å«å¤šä¸ªå…ƒç´ æ—¶ï¼ˆä¾‹å¦‚Appletï¼Œå›¾ç‰‡ï¼‰ï¼Œæ˜¾è‘—åœ°å‡å°‘ä¸‹è½½æ‰€éœ€è¦çš„æ—¶é—´ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œ webæœåŠ¡å™¨éœ€è¦åœ¨è¿”å›ç»™å®¢æˆ·ç«¯HTTPå¤´ä¿¡æ¯ä¸­å‘é€ä¸€ä¸ªContent-Lengthï¼ˆè¿”å›ä¿¡æ¯æ­£æ–‡çš„é•¿åº¦ï¼‰å¤´ï¼Œæœ€ç®€å•çš„å®ç°æ–¹æ³•æ˜¯ï¼šå…ˆæŠŠå†…å®¹å†™å…¥ByteArrayOutputStreamï¼Œç„¶ ååœ¨æ­£å¼å†™å‡ºå†…å®¹ä¹‹å‰è®¡ç®—å®ƒçš„å¤§å°ã€‚</p>
<p>å®ä¾‹ï¼š Connection: keep-alive</p>
<ol>
<li>Keep-Alive</li>
</ol>
<p>è¯´æ˜ï¼šæ˜¾ç¤ºæ­¤HTTPè¿æ¥çš„Keep-Aliveæ—¶é—´ã€‚ä½¿å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨ç«¯çš„è¿æ¥æŒç»­æœ‰æ•ˆï¼Œå½“å‡ºç°å¯¹æœåŠ¡å™¨çš„åç»§è¯·æ±‚æ—¶ï¼ŒKeep-AliveåŠŸèƒ½é¿å…äº†å»ºç«‹æˆ–è€…é‡æ–°å»ºç«‹è¿æ¥ã€‚</p>
<p>ä»¥å‰HTTPè¯·æ±‚æ˜¯ä¸€ç«™å¼è¿æ¥ï¼Œä»HTTP/1.1åè®®ä¹‹åï¼Œå°±æœ‰äº†é•¿è¿æ¥ï¼Œå³åœ¨è§„å®šçš„Keep-Aliveæ—¶é—´å†…ï¼Œè¿æ¥æ˜¯ä¸ä¼šæ–­å¼€çš„ã€‚</p>
<p>å®ä¾‹ï¼š Keep-Alive: 300</p>
<ol>
<li>cookie</li>
</ol>
<p>è¯´æ˜ï¼šHTTPè¯·æ±‚å‘é€æ—¶ï¼Œä¼šæŠŠä¿å­˜åœ¨è¯¥è¯·æ±‚åŸŸåä¸‹çš„æ‰€æœ‰cookieå€¼ä¸€èµ·å‘é€ç»™webæœåŠ¡å™¨ã€‚</p>
<ol>
<li>Referer</li>
</ol>
<p>è¯´æ˜ï¼šåŒ…å«ä¸€ä¸ªURLï¼Œç”¨æˆ·ä»è¯¥URLä»£è¡¨çš„é¡µé¢å‡ºå‘è®¿é—®å½“å‰è¯·æ±‚çš„é¡µé¢</p>
<h3 id="æœåŠ¡å™¨ç«¯è¿”å›HTTPå¤´éƒ¨ä¿¡æ¯"><a href="#æœåŠ¡å™¨ç«¯è¿”å›HTTPå¤´éƒ¨ä¿¡æ¯" class="headerlink" title="æœåŠ¡å™¨ç«¯è¿”å›HTTPå¤´éƒ¨ä¿¡æ¯"></a>æœåŠ¡å™¨ç«¯è¿”å›HTTPå¤´éƒ¨ä¿¡æ¯</h3><p>ç®€å•ç¤ºä¾‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type	text/plain</span><br><span class="line">Content-Length	8</span><br><span class="line">Last-Modified	Mon, 15 May 2017 18:04:40 GMT</span><br><span class="line">ETag	&quot;ae780585f49b94ce1444eb7d28906123&quot;</span><br><span class="line">Accept-Ranges	bytes</span><br><span class="line">Server	AmazonS3</span><br><span class="line">X-Amz-Cf-Id	jodC9tJqDu4my9HVAend7hMtgKNcrlV4SUHJOKveUP-hHSIJ6ewkig==</span><br><span class="line">Cache-Control	no-cache, no-store, must-revalidate</span><br><span class="line">Date	Tue, 17 Jul 2018 02:28:52 GMT</span><br><span class="line">Proxy-Connection	Keep-alive</span><br></pre></td></tr></table></figure></p>
<ol>
<li>Content-Length</li>
</ol>
<p>è¯´æ˜ï¼šè¡¨ç¤ºwebæœåŠ¡å™¨è¿”å›æ¶ˆæ¯æ­£æ–‡çš„é•¿åº¦</p>
<ol>
<li>Content-Type:</li>
</ol>
<p>è¯´æ˜ï¼šè¿”å›æ•°æ®çš„ç±»å‹ï¼ˆä¾‹å¦‚text/htmlæ–‡æœ¬ç±»å‹ï¼‰å’Œå­—ç¬¦ç¼–ç æ ¼å¼ã€‚</p>
<p>å®ä¾‹ï¼š Content-Type: text/html;charset=utf-8</p>
<ol>
<li>Date<br>è¯´æ˜ï¼šæ˜¾ç¤ºå½“å‰çš„æ—¶é—´</li>
</ol>
<p>æœ¬æ–‡æ ¹æ®RFC2616(HTTP/1.1è§„èŒƒ),å‚è€ƒ</p>
<p><a href="http://www.w3.org/Protocols/rfc2068/rfc2068" target="_blank" rel="noopener">http://www.w3.org/Protocols/rfc2068/rfc2068</a></p>
<p><a href="http://www.w3.org/Protocols/rfc2616/rfc2616" target="_blank" rel="noopener">http://www.w3.org/Protocols/rfc2616/rfc2616</a></p>
<p><a href="http://www.ietf.org/rfc/rfc3229.txt" target="_blank" rel="noopener">http://www.ietf.org/rfc/rfc3229.txt</a></p>
<p><a href="https://blog.csdn.net/u012359618/article/details/50240617" target="_blank" rel="noopener">https://blog.csdn.net/u012359618/article/details/50240617</a>  </p>
<p><a href="https://www.cnblogs.com/wenqiang/p/5698772.html" target="_blank" rel="noopener">https://www.cnblogs.com/wenqiang/p/5698772.html</a></p>
<p>é€šå¸¸HTTPæ¶ˆæ¯åŒ…æ‹¬å®¢æˆ·æœºå‘æœåŠ¡å™¨çš„è¯·æ±‚æ¶ˆæ¯å’ŒæœåŠ¡å™¨å‘å®¢æˆ·æœºçš„å“åº”æ¶ˆæ¯ã€‚è¿™ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ç”±ä¸€ä¸ªèµ·å§‹è¡Œï¼Œä¸€ä¸ªæˆ–è€…å¤šä¸ªå¤´åŸŸï¼Œä¸€ä¸ªåªæ˜¯å¤´åŸŸç»“æŸçš„ç©ºè¡Œå’Œå¯ é€‰çš„æ¶ˆæ¯ä½“ç»„æˆã€‚HTTPçš„å¤´åŸŸåŒ…æ‹¬é€šç”¨å¤´ï¼Œè¯·æ±‚å¤´ï¼Œå“åº”å¤´å’Œå®ä½“å¤´å››ä¸ªéƒ¨åˆ†ã€‚æ¯ä¸ªå¤´åŸŸç”±ä¸€ä¸ªåŸŸåï¼Œå†’å·ï¼ˆ:ï¼‰å’ŒåŸŸå€¼ä¸‰éƒ¨åˆ†ç»„æˆã€‚åŸŸåæ˜¯å¤§å°å†™æ— å…³çš„ï¼ŒåŸŸ å€¼å‰å¯ä»¥æ·»åŠ ä»»ä½•æ•°é‡çš„ç©ºæ ¼ç¬¦ï¼Œå¤´åŸŸå¯ä»¥è¢«æ‰©å±•ä¸ºå¤šè¡Œï¼Œåœ¨æ¯è¡Œå¼€å§‹å¤„ï¼Œä½¿ç”¨è‡³å°‘ä¸€ä¸ªç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ã€‚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://cattlefoot.github.io/2018/07/17/okhttpä½¿ç”¨è®°å½•/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CallteFoot">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CallteFoot's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/17/okhttpä½¿ç”¨è®°å½•/" itemprop="url">okhttpä½¿ç”¨è®°å½•</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2018-07-17T09:27:19+08:00">
                2018-07-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>Applicaion Interceptorå’ŒNetworkInterceptoråŒºåˆ«<br>Application interceptorsï¼š</li>
</ol>
<ul>
<li>Donâ€™t need to worry about intermediate responses like redirects and retries.ï¼ˆä¸å¿…æ‹…å¿ƒé‡å®šå‘å’Œé‡è¯•ç­‰ä¸­é—´å“åº”ï¼Œå› ä¸ºå®ƒå¤„äºç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œä¼šè·å–åˆ°æœ€ç»ˆçš„å“åº” response ã€‚ï¼‰</li>
<li>Are always invoked once, even if the HTTP response is served from the cache.ï¼ˆå³ä½¿ä»ç¼“å­˜æä¾›HTTPå“åº”ï¼Œä¹Ÿå§‹ç»ˆè°ƒç”¨ä¸€æ¬¡ï¼‰</li>
<li>Observe the applicationâ€™s original intent. Unconcerned with OkHttp-injected headers like If-None-Match.ï¼ˆè§‚å¯Ÿåº”ç”¨ç¨‹åºçš„åŸå§‹æ„å›¾ã€‚ ä¸å»å…³æ³¨OkHttpæ³¨å…¥çš„å¤´ä¿¡æ¯ï¼Œå¦‚If-None-Matchã€‚ï¼‰</li>
<li>Permitted to short-circuit and not call Chain.proceed().ï¼ˆå…è®¸çŸ­è·¯è€Œä¸è°ƒç”¨Chain.proceedï¼ˆï¼‰ï¼Œå› ä¸ºæ˜¯ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„æ‹¦æˆªå™¨ï¼Œå› æ­¤å®ƒæœ‰æƒå†³å®šäº†æ˜¯å¦è¦è°ƒç”¨å…¶ä»–æ‹¦æˆªï¼Œä¹Ÿå°±æ˜¯ Chain.proceed() æ–¹æ³•æ˜¯å¦è¦è¢«æ‰§è¡Œã€‚ï¼‰</li>
<li>Permitted to retry and make multiple calls to Chain.proceed().ï¼ˆå…è®¸é‡è¯•å¹¶å¤šæ¬¡è°ƒç”¨Chain.proceedï¼ˆï¼‰ï¼Œå› ä¸ºæ˜¯ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„æ‹¦æˆªå™¨ï¼Œå› æ­¤å®ƒæœ‰å¯ä»¥å¤šæ¬¡è°ƒç”¨ Chain.proceed() æ–¹æ³•ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ç›¸å½“ä¸é‡æ–°è¯·æ±‚çš„ä½œç”¨äº†ã€‚ï¼‰</li>
</ul>
<p>Network Interceptors  </p>
<ul>
<li>Able to operate on intermediate responses like redirects and retries.ï¼ˆèƒ½å¤Ÿå¯¹é‡å®šå‘å’Œé‡è¯•ç­‰ä¸­é—´å“åº”è¿›è¡Œæ“ä½œï¼Œå› ä¸º NetworkInterceptor æ˜¯æ’åœ¨ç¬¬ 6 ä¸ªæ‹¦æˆªå™¨ä¸­ï¼Œå› æ­¤å¯ä»¥æ“ä½œç»è¿‡ RetryAndFollowup è¿›è¡Œå¤±è´¥é‡è¯•æˆ–è€…é‡å®šå‘ä¹‹åå¾—åˆ°çš„resposneï¼‰</li>
<li>Not invoked for cached responses that short-circuit the network.ï¼ˆæœªè°ƒç”¨ä½¿ç½‘ç»œçŸ­è·¯çš„ç¼“å­˜å“åº”ï¼Œå¯¹äºä»ç¼“å­˜è·å–çš„ response åˆ™ä¸ä¼šå»è§¦å‘ NetworkInterceptor ã€‚å› ä¸ºå“åº”ç›´æ¥ä» CacheInterceptor è¿”å›äº†ï¼‰</li>
<li>Observe the data just as it will be transmitted over the network.ï¼ˆè§‚å¯Ÿæ•°æ®ï¼Œå°±åƒå®ƒå°†é€šè¿‡ç½‘ç»œä¼ è¾“ä¸€æ ·ï¼‰</li>
<li>Access to the Connection that carries the request.ï¼ˆè®¿é—®å¸¦æœ‰è¯·æ±‚çš„Connectionï¼‰</li>
</ul>
<p>å‚è€ƒåœ°å€ï¼š<br>[1]. å®˜ç½‘ <a href="https://github.com/square/okhttp/wiki/Interceptors" target="_blank" rel="noopener">https://github.com/square/okhttp/wiki/Interceptors</a><br>[2]. ç®€ä¹¦ <a href="https://www.jianshu.com/p/d04b463806c8" target="_blank" rel="noopener">https://www.jianshu.com/p/d04b463806c8</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">CallteFoot</p>
              <p class="site-description motion-element" itemprop="description">the blog from a anroid coder</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">50</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">68</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CallteFoot</span>

  
</div>


  <div class="powered-by">ç”± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">ä¸»é¢˜ &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
